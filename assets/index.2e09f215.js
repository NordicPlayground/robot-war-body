(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();var Pg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};const Ld=e=>e.reduce((t,r)=>Array.isArray(r)?t.concat(Ld(r)):t.concat(r),[]);var Ze=Ld;const Cg=e=>Object.assign({},e);var Mg=Cg;const Og=(e,t,r)=>(e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e);var Rg=Og;const Lg=()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var ol=Lg;const Fg=ol,Gg=e=>{const t=Fg();return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t};var Ng=Gg;const Dg=(e,t)=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e);var Fd=Dg;const kg=(e,t)=>{const r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],i=t[5],c=t[6],l=t[7],u=t[8],d=t[9],h=t[10],p=t[11],E=t[12],g=t[13],b=t[14],P=t[15],F=r*i-n*a,R=r*c-s*a,M=r*l-o*a,G=n*c-s*i,L=n*l-o*i,U=s*l-o*c,ee=u*g-d*E,oe=u*b-h*E,pe=u*P-p*E,Q=d*b-h*g,Se=d*P-p*g,qe=h*P-p*b;let $e=F*qe-R*Se+M*Q+G*pe-L*oe+U*ee;return $e?($e=1/$e,e[0]=(i*qe-c*Se+l*Q)*$e,e[1]=(s*Se-n*qe-o*Q)*$e,e[2]=(g*U-b*L+P*G)*$e,e[3]=(h*L-d*U-p*G)*$e,e[4]=(c*pe-a*qe-l*oe)*$e,e[5]=(r*qe-s*pe+o*oe)*$e,e[6]=(b*M-E*U-P*R)*$e,e[7]=(u*U-h*M+p*R)*$e,e[8]=(a*Se-i*pe+l*ee)*$e,e[9]=(n*pe-r*Se-o*ee)*$e,e[10]=(E*L-g*M+P*F)*$e,e[11]=(d*M-u*L-p*F)*$e,e[12]=(i*oe-a*Q-c*ee)*$e,e[13]=(r*Q-n*oe+s*ee)*$e,e[14]=(g*R-E*G-b*F)*$e,e[15]=(u*G-d*R+h*F)*$e,e):null};var Bg=kg;const Ig=(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15];var zg=Ig;const Vg=1e5,Ug=1e-5,qg=1e-13,Xg=Math.PI*2;var it={EPS:Ug,NEPS:qg,TAU:Xg,spatialResolution:Vg};const{NEPS:jg}=it,Gd=e=>Math.abs(e)<jg?0:e,Hg=e=>Gd(Math.sin(e)),Yg=e=>Gd(Math.cos(e));var Ut={sin:Hg,cos:Yg};const Zg=e=>(e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e);var Nd=Zg;const{EPS:Wg}=it,{sin:Qg,cos:Kg}=Ut,Jg=Nd,e5=(e,t,r)=>{let[n,s,o]=r;const a=n*n+s*s+o*o;if(Math.abs(a)<Wg)return Jg(e);const i=1/Math.sqrt(a);n*=i,s*=i,o*=i;const c=Qg(t),l=Kg(t),u=1-l;return e[0]=n*n*u+l,e[1]=s*n*u+o*c,e[2]=o*n*u-s*c,e[3]=0,e[4]=n*s*u-o*c,e[5]=s*s*u+l,e[6]=o*s*u+n*c,e[7]=0,e[8]=n*o*u+s*c,e[9]=s*o*u-n*c,e[10]=o*o*u+l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e};var Dd=e5;const t5=(e,t)=>(e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e);var r5=t5;const{sin:Bi,cos:Ii}=Ut,n5=(e,t,r,n)=>{const s=Bi(t),o=Ii(t),a=Bi(r),i=Ii(r),c=Bi(n),l=Ii(n);return e[0]=i*o,e[1]=i*s,e[2]=-a,e[3]=0,e[4]=c*a*o-l*s,e[5]=l*o+c*a*s,e[6]=c*i,e[7]=0,e[8]=c*s+l*a*o,e[9]=l*a*s-c*o,e[10]=l*i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e};var s5=n5;const o5=(e,t)=>(e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e);var a5=o5;const i5=ol,c5=(e,t,r,n,s,o,a,i,c,l,u,d,h,p,E,g)=>{const b=i5();return b[0]=e,b[1]=t,b[2]=r,b[3]=n,b[4]=s,b[5]=o,b[6]=a,b[7]=i,b[8]=c,b[9]=l,b[10]=u,b[11]=d,b[12]=h,b[13]=p,b[14]=E,b[15]=g,b};var l5=c5;const f5=(e,t)=>(e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e);var kd=f5;const u5=(e,t,r)=>(e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e);var Bd=u5;const d5=(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2];var ba=d5;const h5=ba,m5=(e,t)=>{const r=e[0],n=e[1],s=e[2],o=t[0],a=t[1],i=t[2],c=Math.sqrt(r*r+n*n+s*s),l=Math.sqrt(o*o+a*a+i*i),u=c*l,d=u&&h5(e,t)/u;return Math.acos(Math.min(Math.max(d,-1),1))};var p5=m5;const v5=()=>[0,0,0];var wa=v5;const g5=wa,y5=e=>{const t=g5();return t[0]=e[0],t[1]=e[1],t[2]=e[2],t};var b5=y5;const w5=(e,t)=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],e);var Id=w5;const _5=(e,t,r)=>{const n=t[0],s=t[1],o=t[2],a=r[0],i=r[1],c=r[2];return e[0]=s*c-o*i,e[1]=o*a-n*c,e[2]=n*i-s*a,e};var Ks=_5;const x5=(e,t)=>{const r=t[0]-e[0],n=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(r*r+n*n+s*s)};var zd=x5;const E5=(e,t,r)=>(e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e);var $5=E5;const A5=(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2];var T5=A5;const S5=(e,t)=>(e[0]=t,e[1]=t,e[2]=t,e);var P5=S5;const C5=wa,M5=(e,t,r)=>{const n=C5();return n[0]=e,n[1]=t,n[2]=r,n};var O5=M5;const R5=(e,t,r=0)=>(e[0]=t[0],e[1]=t[1],e[2]=r,e);var L5=R5;const F5=e=>{const t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)};var Vd=F5;const G5=(e,t,r,n)=>(e[0]=t[0]+n*(r[0]-t[0]),e[1]=t[1]+n*(r[1]-t[1]),e[2]=t[2]+n*(r[2]-t[2]),e);var N5=G5;const D5=(e,t,r)=>(e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e);var Ud=D5;const k5=(e,t,r)=>(e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e);var qd=k5;const B5=(e,t,r)=>(e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e);var I5=B5;const z5=(e,t)=>(e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e);var V5=z5;const U5=(e,t)=>{const r=t[0],n=t[1],s=t[2];let o=r*r+n*n+s*s;return o>0&&(o=1/Math.sqrt(o)),e[0]=r*o,e[1]=n*o,e[2]=s*o,e};var al=U5;const q5=kd,X5=wa,j5=Ks,H5=(e,t)=>{const r=q5(X5(),t),n=0+(r[0]<r[1]&&r[0]<r[2]),s=0+(r[1]<=r[0]&&r[1]<r[2]),o=0+(r[2]<=r[0]&&r[2]<=r[1]);return j5(e,t,[n,s,o])};var Y5=H5;const Z5=(e,t,r,n)=>{const s=[],o=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],o[0]=s[0],o[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),o[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e};var W5=Z5;const Q5=(e,t,r,n)=>{const s=[],o=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],o[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),o[1]=s[1],o[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e};var K5=Q5;const J5=(e,t,r,n)=>{const s=[],o=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],o[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),o[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=t[2],e};var ey=J5;const ty=(e,t,r)=>(e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e);var Xd=ty;const ry=(e,t,r)=>(e[0]=Math.round(t[0]/r)*r+0,e[1]=Math.round(t[1]/r)*r+0,e[2]=Math.round(t[2]/r)*r+0,e);var ny=ry;const sy=(e,t)=>{const r=t[0]-e[0],n=t[1]-e[1],s=t[2]-e[2];return r*r+n*n+s*s};var jd=sy;const oy=e=>{const t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n};var Hd=oy;const ay=(e,t,r)=>(e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e);var _a=ay;const iy=e=>`[${e[0].toFixed(7)}, ${e[1].toFixed(7)}, ${e[2].toFixed(7)}]`;var cy=iy;const ly=(e,t,r)=>{const n=t[0],s=t[1],o=t[2];let a=r[3]*n+r[7]*s+r[11]*o+r[15];return a=a||1,e[0]=(r[0]*n+r[4]*s+r[8]*o+r[12])/a,e[1]=(r[1]*n+r[5]*s+r[9]*o+r[13])/a,e[2]=(r[2]*n+r[6]*s+r[10]*o+r[14])/a,e};var fy=ly,ze={abs:kd,add:Bd,angle:p5,clone:b5,copy:Id,create:wa,cross:Ks,distance:zd,divide:$5,dot:ba,equals:T5,fromScalar:P5,fromValues:O5,fromVec2:L5,length:Vd,lerp:N5,max:Ud,min:qd,multiply:I5,negate:V5,normalize:al,orthogonal:Y5,rotateX:W5,rotateY:K5,rotateZ:ey,scale:Xd,snap:ny,squaredDistance:jd,squaredLength:Hd,subtract:_a,toString:cy,transform:fy};const Xr=ze,uy=Dd,dy=(e,t,r)=>{const n=Xr.normalize(Xr.create(),t),s=Xr.normalize(Xr.create(),r),o=Xr.cross(Xr.create(),s,n),a=Xr.dot(s,n);if(a===-1)return uy(e,Math.PI,Xr.orthogonal(o,n));const i=1/(1+a);return e[0]=o[0]*o[0]*i+a,e[1]=o[1]*o[0]*i-o[2],e[2]=o[2]*o[0]*i+o[1],e[3]=0,e[4]=o[0]*o[1]*i+o[2],e[5]=o[1]*o[1]*i+a,e[6]=o[2]*o[1]*i-o[0],e[7]=0,e[8]=o[0]*o[2]*i-o[1],e[9]=o[1]*o[2]*i+o[0],e[10]=o[2]*o[2]*i+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e};var hy=dy;const{sin:my,cos:py}=Ut,vy=(e,t)=>{const r=my(t),n=py(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e};var gy=vy;const{sin:yy,cos:by}=Ut,wy=(e,t)=>{const r=yy(t),n=by(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e};var _y=wy;const{sin:xy,cos:Ey}=Ut,$y=(e,t)=>{const r=xy(t),n=Ey(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e};var Ay=$y;const Ty=e=>e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[7]===0&&e[8]===0&&e[9]===0&&e[10]===1&&e[11]===0&&e[12]===0&&e[13]===0&&e[14]===0&&e[15]===1;var Sy=Ty;const Py=e=>Rr(e[1])&&Rr(e[2])&&Rr(e[3])&&Rr(e[4])&&Rr(e[6])&&Rr(e[7])&&Rr(e[8])&&Rr(e[9])&&Rr(e[11])&&e[15]===1,Rr=e=>Math.abs(e)<Number.EPSILON;var Cy=Py;const My=e=>{const t=e[4]*e[9]-e[8]*e[5],r=e[8]*e[1]-e[0]*e[9],n=e[0]*e[5]-e[4]*e[1];return t*e[2]+r*e[6]+n*e[10]<0};var Oy=My;const Ry=(e,t)=>{const[r,n,s,o]=t;return e[0]=1-2*r*r,e[1]=-2*n*r,e[2]=-2*s*r,e[3]=0,e[4]=-2*r*n,e[5]=1-2*n*n,e[6]=-2*s*n,e[7]=0,e[8]=-2*r*s,e[9]=-2*n*s,e[10]=1-2*s*s,e[11]=0,e[12]=2*r*o,e[13]=2*n*o,e[14]=2*s*o,e[15]=1,e};var Ly=Ry;const Fy=(e,t,r)=>{const n=t[0],s=t[1],o=t[2],a=t[3],i=t[4],c=t[5],l=t[6],u=t[7],d=t[8],h=t[9],p=t[10],E=t[11],g=t[12],b=t[13],P=t[14],F=t[15];let R=r[0],M=r[1],G=r[2],L=r[3];return e[0]=R*n+M*i+G*d+L*g,e[1]=R*s+M*c+G*h+L*b,e[2]=R*o+M*l+G*p+L*P,e[3]=R*a+M*u+G*E+L*F,R=r[4],M=r[5],G=r[6],L=r[7],e[4]=R*n+M*i+G*d+L*g,e[5]=R*s+M*c+G*h+L*b,e[6]=R*o+M*l+G*p+L*P,e[7]=R*a+M*u+G*E+L*F,R=r[8],M=r[9],G=r[10],L=r[11],e[8]=R*n+M*i+G*d+L*g,e[9]=R*s+M*c+G*h+L*b,e[10]=R*o+M*l+G*p+L*P,e[11]=R*a+M*u+G*E+L*F,R=r[12],M=r[13],G=r[14],L=r[15],e[12]=R*n+M*i+G*d+L*g,e[13]=R*s+M*c+G*h+L*b,e[14]=R*o+M*l+G*p+L*P,e[15]=R*a+M*u+G*E+L*F,e};var Gy=Fy;const{EPS:Ny}=it,{sin:Dy,cos:ky}=Ut,By=Fd,Iy=(e,t,r,n)=>{let[s,o,a]=n;const i=s*s+o*o+a*a;if(Math.abs(i)<Ny)return By(e,t);const c=1/Math.sqrt(i);s*=c,o*=c,a*=c;const l=Dy(r),u=ky(r),d=1-u,h=t[0],p=t[1],E=t[2],g=t[3],b=t[4],P=t[5],F=t[6],R=t[7],M=t[8],G=t[9],L=t[10],U=t[11],ee=s*s*d+u,oe=o*s*d+a*l,pe=a*s*d-o*l,Q=s*o*d-a*l,Se=o*o*d+u,qe=a*o*d+s*l,$e=s*a*d+o*l,Xe=o*a*d-s*l,Ne=a*a*d+u;return e[0]=h*ee+b*oe+M*pe,e[1]=p*ee+P*oe+G*pe,e[2]=E*ee+F*oe+L*pe,e[3]=g*ee+R*oe+U*pe,e[4]=h*Q+b*Se+M*qe,e[5]=p*Q+P*Se+G*qe,e[6]=E*Q+F*Se+L*qe,e[7]=g*Q+R*Se+U*qe,e[8]=h*$e+b*Xe+M*Ne,e[9]=p*$e+P*Xe+G*Ne,e[10]=E*$e+F*Xe+L*Ne,e[11]=g*$e+R*Xe+U*Ne,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e};var zy=Iy;const{sin:Vy,cos:Uy}=Ut,qy=(e,t,r)=>{const n=Vy(r),s=Uy(r),o=t[4],a=t[5],i=t[6],c=t[7],l=t[8],u=t[9],d=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*s+l*n,e[5]=a*s+u*n,e[6]=i*s+d*n,e[7]=c*s+h*n,e[8]=l*s-o*n,e[9]=u*s-a*n,e[10]=d*s-i*n,e[11]=h*s-c*n,e};var Xy=qy;const{sin:jy,cos:Hy}=Ut,Yy=(e,t,r)=>{const n=jy(r),s=Hy(r),o=t[0],a=t[1],i=t[2],c=t[3],l=t[8],u=t[9],d=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*s-l*n,e[1]=a*s-u*n,e[2]=i*s-d*n,e[3]=c*s-h*n,e[8]=o*n+l*s,e[9]=a*n+u*s,e[10]=i*n+d*s,e[11]=c*n+h*s,e};var Zy=Yy;const{sin:Wy,cos:Qy}=Ut,Ky=(e,t,r)=>{const n=Wy(r),s=Qy(r),o=t[0],a=t[1],i=t[2],c=t[3],l=t[4],u=t[5],d=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*s+l*n,e[1]=a*s+u*n,e[2]=i*s+d*n,e[3]=c*s+h*n,e[4]=l*s-o*n,e[5]=u*s-a*n,e[6]=d*s-i*n,e[7]=h*s-c*n,e};var Jy=Ky;const eb=(e,t,r)=>{const n=r[0],s=r[1],o=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e};var tb=eb;const rb=(e,t,r)=>(e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e);var nb=rb;const sb=e=>e.map(t=>t.toFixed(7)).toString();var ob=sb;const ab=(e,t,r)=>{const n=r[0],s=r[1],o=r[2];let a,i,c,l,u,d,h,p,E,g,b,P;return t===e?(e[12]=t[0]*n+t[4]*s+t[8]*o+t[12],e[13]=t[1]*n+t[5]*s+t[9]*o+t[13],e[14]=t[2]*n+t[6]*s+t[10]*o+t[14],e[15]=t[3]*n+t[7]*s+t[11]*o+t[15]):(a=t[0],i=t[1],c=t[2],l=t[3],u=t[4],d=t[5],h=t[6],p=t[7],E=t[8],g=t[9],b=t[10],P=t[11],e[0]=a,e[1]=i,e[2]=c,e[3]=l,e[4]=u,e[5]=d,e[6]=h,e[7]=p,e[8]=E,e[9]=g,e[10]=b,e[11]=P,e[12]=a*n+u*s+E*o+t[12],e[13]=i*n+d*s+g*o+t[13],e[14]=c*n+h*s+b*o+t[14],e[15]=l*n+p*s+P*o+t[15]),e};var ib=ab,dt={add:Rg,clone:Ng,copy:Fd,create:ol,invert:Bg,equals:zg,fromRotation:Dd,fromScaling:r5,fromTaitBryanRotation:s5,fromTranslation:a5,fromValues:l5,fromVectorRotation:hy,fromXRotation:gy,fromYRotation:_y,fromZRotation:Ay,identity:Nd,isIdentity:Sy,isOnlyTransformScale:Cy,isMirroring:Oy,mirrorByPlane:Ly,multiply:Gy,rotate:zy,rotateX:Xy,rotateY:Zy,rotateZ:Jy,scale:tb,subtract:nb,toString:ob,translate:ib};const cb=dt,lb=e=>(e===void 0&&(e=[]),{sides:e,transforms:cb.create()});var xa=lb;const fb=(e,t)=>(e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e);var ub=fb;const db=(e,t,r)=>(e[0]=t[0]+r[0],e[1]=t[1]+r[1],e);var hb=db,Yd={exports:{}};const mb=e=>Math.atan2(e[1],e[0]);var il=mb;(function(e){e.exports=il})(Yd);const pb=il,vb=e=>pb(e)*57.29577951308232;var gb=vb;const yb=()=>[0,0];var Ea=yb;const bb=Ea,wb=e=>{const t=bb();return t[0]=e[0],t[1]=e[1],t};var _b=wb;const xb=(e,t)=>(e[0]=t[0],e[1]=t[1],e);var Eb=xb;const $b=(e,t,r)=>(e[0]=0,e[1]=0,e[2]=t[0]*r[1]-t[1]*r[0],e);var Ab=$b;const Tb=(e,t)=>{const r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)};var Sb=Tb;const Pb=(e,t,r)=>(e[0]=t[0]/r[0],e[1]=t[1]/r[1],e);var Cb=Pb;const Mb=(e,t)=>e[0]*t[0]+e[1]*t[1];var Ob=Mb;const Rb=(e,t)=>e[0]===t[0]&&e[1]===t[1];var Lb=Rb;const{sin:Fb,cos:Gb}=Ut,Nb=(e,t)=>(e[0]=Gb(t),e[1]=Fb(t),e);var Zd=Nb;const Db=Zd,kb=(e,t)=>Db(e,t*.017453292519943295);var Bb=kb;const Ib=(e,t)=>(e[0]=t,e[1]=t,e);var zb=Ib;const Vb=Ea,Ub=(e,t)=>{const r=Vb();return r[0]=e,r[1]=t,r};var qb=Ub;const Xb=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]);var jb=Xb;const Hb=(e,t,r,n)=>{const s=t[0],o=t[1];return e[0]=s+n*(r[0]-s),e[1]=o+n*(r[1]-o),e};var Yb=Hb;const Zb=(e,t,r)=>(e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e);var Wb=Zb;const Qb=(e,t,r)=>(e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e);var Kb=Qb;const Jb=(e,t,r)=>(e[0]=t[0]*r[0],e[1]=t[1]*r[1],e);var e3=Jb;const t3=(e,t)=>(e[0]=-t[0],e[1]=-t[1],e);var r3=t3;const n3=(e,t,r,n)=>{const s=t[0]-r[0],o=t[1]-r[1],a=Math.cos(n),i=Math.sin(n);return e[0]=s*a-o*i+r[0],e[1]=s*i+o*a+r[1],e};var Wd=n3;const{TAU:s3}=it,o3=Ea,a3=Wd,i3=(e,t)=>a3(e,t,o3(),s3/4);var c3=i3;const l3=(e,t)=>{const r=t[0],n=t[1];let s=r*r+n*n;return s>0&&(s=1/Math.sqrt(s)),e[0]=r*s,e[1]=n*s,e};var f3=l3;const u3=(e,t,r)=>(e[0]=t[0]*r,e[1]=t[1]*r,e);var d3=u3;const h3=(e,t,r)=>(e[0]=Math.round(t[0]/r)*r+0,e[1]=Math.round(t[1]/r)*r+0,e);var m3=h3;const p3=(e,t)=>{const r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n};var v3=p3;const g3=e=>{const t=e[0],r=e[1];return t*t+r*r};var y3=g3;const b3=(e,t,r)=>(e[0]=t[0]-r[0],e[1]=t[1]-r[1],e);var w3=b3;const _3=e=>`[${e[0].toFixed(7)}, ${e[1].toFixed(7)}]`;var x3=_3;const E3=(e,t,r)=>{const n=t[0],s=t[1];return e[0]=r[0]*n+r[4]*s+r[12],e[1]=r[1]*n+r[5]*s+r[13],e};var $3=E3,rt={abs:ub,add:hb,angle:Yd.exports,angleDegrees:gb,angleRadians:il,clone:_b,copy:Eb,create:Ea,cross:Ab,distance:Sb,divide:Cb,dot:Ob,equals:Lb,fromAngleDegrees:Bb,fromAngleRadians:Zd,fromScalar:zb,fromValues:qb,length:jb,lerp:Yb,max:Wb,min:Kb,multiply:e3,negate:r3,normal:c3,normalize:f3,rotate:Wd,scale:d3,snap:m3,squaredDistance:v3,squaredLength:y3,subtract:w3,toString:x3,transform:$3};const zi=rt,A3=xa,T3=e=>{if(!Array.isArray(e))throw new Error("the given points must be an array");let t=e.length;if(t<3)throw new Error("the given points must define a closed geometry with three or more points");zi.equals(e[0],e[t-1])&&--t;const r=[];let n=e[t-1];for(let s=0;s<t;s++){const o=e[s];r.push([zi.clone(n),zi.clone(o)]),n=o}return A3(r)};var S3=T3;const P3=dt,k1=rt,C3=xa,M3=e=>{if(e[0]!==0)throw new Error("invalid compact binary data");const t=C3();t.transforms=P3.clone(e.slice(1,17));for(let r=21;r<e.length;r+=4){const n=k1.fromValues(e[r+0],e[r+1]),s=k1.fromValues(e[r+2],e[r+3]);t.sides.push([n,s])}return e[17]>=0&&(t.color=[e[17],e[18],e[19],e[20]]),t};var O3=M3;const R3=e=>!!(e&&typeof e=="object"&&"sides"in e&&"transforms"in e&&Array.isArray(e.sides)&&"length"in e.transforms);var Qd=R3;const B1=dt,Bo=rt,L3=e=>(B1.isIdentity(e.transforms)||(e.sides=e.sides.map(t=>{const r=Bo.transform(Bo.create(),t[0],e.transforms),n=Bo.transform(Bo.create(),t[1],e.transforms);return[r,n]}),e.transforms=B1.create()),e);var F3=L3;const G3=F3,N3=e=>G3(e).sides;var Js=N3;const D3=xa,k3=Js,B3=e=>{const r=k3(e).map(n=>[n[1],n[0]]);return r.reverse(),D3(r)};var I3=B3;const Rs=rt,z3=Js,V3=e=>{const t=new Map,r=n=>{const s=n.toString();return t.has(s)?t.get(s):(t.set(s,n),n)};return e.map(n=>n.map(r))},U3=e=>{const t=new Map;return V3(e).forEach(n=>{t.has(n[0])?t.get(n[0]).push(n):t.set(n[0],[n])}),t},q3=e=>{const t=U3(z3(e)),r=[];for(;;){let n;for(const[a,i]of t){if(n=i.shift(),!n){t.delete(a);continue}break}if(n===void 0)break;const s=[],o=n[0];for(;;){s.push(n[0]);const a=n[1];if(a===o)break;const i=t.get(a);if(!i)throw new Error(`geometry is not closed at vertex ${a}`);const c=X3(n,i);i.length===0&&t.delete(a),n=c}s.length>0&&s.push(s.shift()),r.push(s)}return t.clear(),r},X3=(e,t)=>{if(t.length===1)return t.pop();const r=Rs.create(),n=Rs.angleDegrees(Rs.subtract(r,e[1],e[0]));let s,o;t.forEach((i,c)=>{let u=Rs.angleDegrees(Rs.subtract(r,i[1],i[0]))-n;u<-180&&(u+=360),u>=180&&(u-=360),(o===void 0||u>s)&&(o=c,s=u)});const a=t[o];return t.splice(o,1),a};var Kd=q3;const j3=Js,H3=e=>{const r=j3(e).map(n=>n[0]);return r.length>0&&r.push(r.shift()),r};var Y3=H3;const I1=rt,Z3=Js,W3=e=>{const t=Z3(e);let r="geom2 ("+t.length+` sides):
[
`;return t.forEach(n=>{r+="  ["+I1.toString(n[0])+", "+I1.toString(n[1])+`]
`}),r+=`]
`,r};var Q3=W3;const K3=e=>{const t=e.sides,r=e.transforms;let n=[-1,-1,-1,-1];e.color&&(n=e.color);const s=new Float32Array(1+16+4+t.length*4);s[0]=0,s[1]=r[0],s[2]=r[1],s[3]=r[2],s[4]=r[3],s[5]=r[4],s[6]=r[5],s[7]=r[6],s[8]=r[7],s[9]=r[8],s[10]=r[9],s[11]=r[10],s[12]=r[11],s[13]=r[12],s[14]=r[13],s[15]=r[14],s[16]=r[15],s[17]=n[0],s[18]=n[1],s[19]=n[2],s[20]=n[3];for(let o=0;o<t.length;o++){const a=o*4+21,i=t[o][0],c=t[o][1];s[a+0]=i[0],s[a+1]=i[1],s[a+2]=c[0],s[a+3]=c[1]}return s};var J3=K3;const z1=dt,ew=(e,t)=>{const r=z1.multiply(z1.create(),e,t.transforms);return Object.assign({},t,{transforms:r})};var tw=ew;const rw=rt,nw=Qd,sw=Kd,ow=e=>{if(!nw(e))throw new Error("invalid geom2 structure");if(sw(e),e.sides.forEach(t=>{if(rw.equals(t[0],t[1]))throw new Error(`geom2 self-edge ${t[0]}`)}),!e.transforms.every(Number.isFinite))throw new Error(`geom2 invalid transforms ${e.transforms}`)};var aw=ow,Je={clone:Mg,create:xa,fromPoints:S3,fromCompactBinary:O3,isA:Qd,reverse:I3,toOutlines:Kd,toPoints:Y3,toSides:Js,toString:Q3,toCompactBinary:J3,transform:tw,validate:aw};const iw=e=>Object.assign({},e);var cw=iw;const lw=dt,fw=e=>(e===void 0&&(e=[]),{polygons:e,transforms:lw.create()});var $a=fw;const uw=e=>((e===void 0||e.length<3)&&(e=[]),{vertices:e});var us=uw;const dw=us,hw=ze,mw=(...e)=>{let t,r;return e.length===1?(t=dw(),r=e[0]):(t=e[0],r=e[1]),t.vertices=r.vertices.map(n=>hw.clone(n)),t};var pw=mw;const vw=ze,gw=us,yw=e=>{const t=e.map(r=>vw.clone(r));return gw(t)};var bw=yw;const ww=us,_w=(e,t)=>{const r=ww(e);return r.plane=t,r};var xw=_w;const Ew=()=>[0,0,0,0];var Aa=Ew;const $w=Aa,Aw=e=>{const t=$w();return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t};var Jd=Aw;const Tw=(e,t)=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e);var eh=Tw;const Sw=(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3];var th=Sw;const Pw=(e,t)=>(e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e);var rh=Pw;const Vi=ze,Cw=(e,t,r)=>{const n=Vi.normalize(Vi.create(),t),s=Vi.dot(r,n);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=s,e};var Mw=Cw;const Ow=Aa,Rw=(e,t,r,n)=>{const s=Ow();return s[0]=e,s[1]=t,s[2]=r,s[3]=n,s};var nh=Rw;const $r=ze,Lw=(e,...t)=>{const r=t.length,n=$r.create(),s=$r.create(),o=a=>{const i=t[a],c=t[(a+1)%r],l=t[(a+2)%r];return $r.subtract(n,c,i),$r.subtract(s,l,i),$r.cross(n,n,s),$r.normalize(n,n),n};return e[0]=0,e[1]=0,e[2]=0,r===3?$r.copy(e,o(0)):(t.forEach((a,i)=>{$r.add(e,e,o(i))}),$r.normalize(e,e)),e[3]=$r.dot(e,t[0]),e};var sh=Lw;const{EPS:Ui}=it,qt=ze,Fw=(e,t,r,n)=>{let s=qt.subtract(qt.create(),r,t),o=qt.subtract(qt.create(),n,t);qt.length(s)<Ui&&(s=qt.orthogonal(s,o)),qt.length(o)<Ui&&(o=qt.orthogonal(o,s));let a=qt.cross(qt.create(),s,o);qt.length(a)<Ui&&(o=qt.orthogonal(o,s),a=qt.cross(a,s,o)),a=qt.normalize(a,a);const i=qt.dot(a,t);return e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=i,e};var Gw=Fw;const Nw=ze,Dw=(e,t)=>{const r=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]-e[3],n=t[0]-r*e[0],s=t[1]-r*e[1],o=t[2]-r*e[2];return Nw.fromValues(n,s,o)};var kw=Dw;const Bw=ze,Iw=(e,t)=>Bw.dot(e,t)-e[3];var oh=Iw;const zw=e=>`(${e[0].toFixed(9)}, ${e[1].toFixed(9)}, ${e[2].toFixed(9)}, ${e[3].toFixed(9)})`;var ah=zw;const Vw=dt,Xt=ze,Uw=sh,qw=rh,Xw=(e,t,r)=>{const n=Vw.isMirroring(r),s=Xt.orthogonal(Xt.create(),t),o=Xt.cross(s,t,s),a=Xt.cross(Xt.create(),t,o);let i=Xt.fromScalar(Xt.create(),t[3]);Xt.multiply(i,i,t);let c=Xt.add(Xt.create(),i,o),l=Xt.add(Xt.create(),i,a);return i=Xt.transform(i,i,r),c=Xt.transform(c,c,r),l=Xt.transform(l,l,r),Uw(e,i,c,l),n&&qw(e,e),e};var jw=Xw,Pr={clone:Jd,copy:eh,create:Aa,equals:th,flip:rh,fromNormalAndPoint:Mw,fromValues:nh,fromPoints:sh,fromPointsRandom:Gw,projectionOfPoint:kw,signedDistanceToPoint:oh,toString:ah,transform:jw};const V1=Pr,Hw=us,Yw=e=>{const t=e.vertices.slice().reverse(),r=Hw(t);return e.plane&&(r.plane=V1.flip(V1.create(),e.plane)),r};var Zw=Yw;const Ww=e=>!!(e&&typeof e=="object"&&"vertices"in e&&Array.isArray(e.vertices));var ih=Ww;const U1=Pr,bn=ze,Qw=e=>Kw(e.vertices),Kw=e=>{const t=e.length;if(t>2){const r=U1.fromPoints(U1.create(),...e);let n=e[t-2],s=e[t-1];for(let o=0;o<t;o++){const a=e[o];if(!Jw(n,s,a,r))return!1;n=s,s=a}}return!0},Jw=(e,t,r,n)=>{const s=bn.cross(bn.create(),bn.subtract(bn.create(),t,e),bn.subtract(bn.create(),r,t));return bn.dot(s,n)>=0};var ch=Qw;const q1=Pr,e_=e=>(e.plane||(e.plane=q1.fromPoints(q1.create(),...e.vertices)),e.plane);var cl=e_;const t_=cl,r_=e=>{const t=e.vertices.length;if(t<3)return 0;const r=e.vertices,n=t_(e),s=Math.abs(n[0]),o=Math.abs(n[1]),a=Math.abs(n[2]);if(s+o+a===0)return 0;let i=3;s>o&&s>a?i=1:o>a&&(i=2);let c=0,l=0,u=1,d=2;switch(i){case 1:for(u=1;u<t;u++)l=u-1,d=(u+1)%t,c+=r[u][1]*(r[d][2]-r[l][2]);c+=r[0][1]*(r[1][2]-r[t-1][2]),c/=2*n[0];break;case 2:for(u=1;u<t;u++)l=u-1,d=(u+1)%t,c+=r[u][2]*(r[d][0]-r[l][0]);c+=r[0][2]*(r[1][0]-r[t-1][0]),c/=2*n[1];break;case 3:default:for(u=1;u<t;u++)l=u-1,d=(u+1)%t,c+=r[u][0]*(r[d][1]-r[l][1]);c+=r[0][0]*(r[1][1]-r[t-1][1]),c/=2*n[2];break}return c};var lh=r_;const Ls=ze,n_=e=>{const t=e.vertices,r=t.length,n=r===0?Ls.create():Ls.clone(t[0]),s=Ls.clone(n);for(let o=1;o<r;o++)Ls.min(n,n,t[o]),Ls.max(s,s,t[o]);return[n,s]};var s_=n_;const o_=(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3];var a_=o_;const i_=(e,t)=>(e[0]=t,e[1]=t,e[2]=t,e[3]=t,e);var c_=i_;const l_=(e,t,r)=>{const[n,s,o,a]=t;return e[0]=r[0]*n+r[4]*s+r[8]*o+r[12]*a,e[1]=r[1]*n+r[5]*s+r[9]*o+r[13]*a,e[2]=r[2]*n+r[6]*s+r[10]*o+r[14]*a,e[3]=r[3]*n+r[7]*s+r[11]*o+r[15]*a,e};var f_=l_,fh={clone:Jd,copy:eh,create:Aa,dot:a_,equals:th,fromScalar:c_,fromValues:nh,toString:ah,transform:f_};const u_=fh,X1=new WeakMap,d_=e=>{let t=X1.get(e);if(t)return t;const r=e.vertices,n=u_.create();if(r.length===0)return n[0]=0,n[1]=0,n[2]=0,n[3]=0,n;let s=r[0],o=s,a=s,i=s,c=s,l=s;r.forEach(p=>{s[0]>p[0]&&(s=p),o[1]>p[1]&&(o=p),a[2]>p[2]&&(a=p),i[0]<p[0]&&(i=p),c[1]<p[1]&&(c=p),l[2]<p[2]&&(l=p)}),n[0]=(s[0]+i[0])*.5,n[1]=(o[1]+c[1])*.5,n[2]=(a[2]+l[2])*.5;const u=n[0]-i[0],d=n[1]-c[1],h=n[2]-l[2];return n[3]=Math.sqrt(u*u+d*d+h*h),X1.set(e,n),n};var h_=d_;const qi=ze,m_=e=>{let t=0;const r=e.vertices,n=qi.create();for(let s=0;s<r.length-2;s++)qi.cross(n,r[s+1],r[s+2]),t+=qi.dot(r[0],n);return t/=6,t};var p_=m_;const v_=e=>e.vertices;var g_=v_;const y_=ze,b_=e=>{let t="poly3: vertices: [";return e.vertices.forEach(r=>{t+=`${y_.toString(r)}, `}),t+="]",t};var w_=b_;const __=dt,j1=ze,x_=us,E_=(e,t)=>{const r=t.vertices.map(n=>j1.transform(j1.create(),n,e));return __.isMirroring(e)&&r.reverse(),x_(r)};var $_=E_;const A_=oh,{NEPS:T_}=it,S_=ze,P_=ih,C_=ch,M_=lh,O_=cl,R_=e=>{if(!P_(e))throw new Error("invalid poly3 structure");if(e.vertices.length<3)throw new Error(`poly3 not enough vertices ${e.vertices.length}`);if(M_(e)<=0)throw new Error("poly3 area must be greater than zero");for(let t=0;t<e.vertices.length;t++)if(S_.equals(e.vertices[t],e.vertices[(t+1)%e.vertices.length]))throw new Error(`poly3 duplicate vertex ${e.vertices[t]}`);if(!C_(e))throw new Error("poly3 must be convex");if(e.vertices.forEach(t=>{if(!t.every(Number.isFinite))throw new Error(`poly3 invalid vertex ${t}`)}),e.vertices.length>3){const t=O_(e);e.vertices.forEach(r=>{const n=Math.abs(A_(t,r));if(n>T_)throw new Error(`poly3 must be coplanar: vertex ${r} distance ${n}`)})}};var L_=R_,st={clone:pw,create:us,fromPoints:bw,fromPointsAndPlane:xw,invert:Zw,isA:ih,isConvex:ch,measureArea:lh,measureBoundingBox:s_,measureBoundingSphere:h_,measureSignedVolume:p_,plane:cl,toPoints:g_,toString:w_,transform:$_,validate:L_};const F_=st,G_=$a,N_=e=>{if(!Array.isArray(e))throw new Error("the given points must be an array");const t=e.map((n,s)=>F_.create(n));return G_(t)};var D_=N_;const k_=ze,B_=dt,I_=st,z_=$a,V_=e=>{if(e[0]!==1)throw new Error("invalid compact binary data");const t=z_();t.transforms=B_.clone(e.slice(1,17));const r=e[21];let n=22,s=e.length-r*3;for(;s<e.length;){const o=e[n];n++;const a=[];for(let i=0;i<o;i++)a.push(k_.fromValues(e[s],e[s+1],e[s+2])),s+=3;t.polygons.push(I_.create(a))}return e[17]>=0&&(t.color=[e[17],e[18],e[19],e[20]]),t};var U_=V_;const H1=dt,q_=st,X_=e=>(H1.isIdentity(e.transforms)||(e.polygons=e.polygons.map(t=>q_.transform(e.transforms,t)),e.transforms=H1.create()),e);var j_=X_;const H_=j_,Y_=e=>H_(e).polygons;var Ta=Y_;const Z_=st,W_=$a,Q_=Ta,K_=e=>{const r=Q_(e).map(n=>Z_.invert(n));return W_(r)};var J_=K_;const ex=e=>!!(e&&typeof e=="object"&&"polygons"in e&&"transforms"in e&&Array.isArray(e.polygons)&&"length"in e.transforms);var uh=ex;const tx=st,rx=Ta,nx=e=>rx(e).map(n=>tx.toPoints(n));var sx=nx;const ox=st,ax=Ta,ix=e=>{const t=ax(e);let r="geom3 ("+t.length+` polygons):
`;return t.forEach(n=>{r+="  "+ox.toString(n)+`
`}),r};var cx=ix;const lx=st,fx=e=>{const t=e.polygons,r=e.transforms,n=t.length,s=t.reduce((l,u)=>l+u.vertices.length,0);let o=[-1,-1,-1,-1];e.color&&(o=e.color);const a=new Float32Array(1+16+4+1+n+s*3);a[0]=1,a[1]=r[0],a[2]=r[1],a[3]=r[2],a[4]=r[3],a[5]=r[4],a[6]=r[5],a[7]=r[6],a[8]=r[7],a[9]=r[8],a[10]=r[9],a[11]=r[10],a[12]=r[11],a[13]=r[12],a[14]=r[13],a[15]=r[14],a[16]=r[15],a[17]=o[0],a[18]=o[1],a[19]=o[2],a[20]=o[3],a[21]=s;let i=22,c=i+n;return t.forEach(l=>{const u=lx.toPoints(l);a[i]=u.length,i++;for(let d=0;d<u.length;d++){const h=u[d];a[c+0]=h[0],a[c+1]=h[1],a[c+2]=h[2],c+=3}}),a};var ux=fx;const Y1=dt,dx=(e,t)=>{const r=Y1.multiply(Y1.create(),e,t.transforms);return Object.assign({},t,{transforms:r})};var hx=dx;const mx=st,px=uh,vx=e=>{if(!px(e))throw new Error("invalid geom3 structure");if(e.polygons.forEach(mx.validate),gx(e),!e.transforms.every(Number.isFinite))throw new Error(`geom3 invalid transforms ${e.transforms}`)},gx=e=>{const t=new Map;e.polygons.forEach(({vertices:n})=>{n.forEach((s,o)=>{const a=`${s}`,i=`${n[(o+1)%n.length]}`,c=`${a}/${i}`,l=t.has(c)?t.get(c):0;t.set(c,l+1)})});const r=[];if(t.forEach((n,s)=>{const o=s.split("/").reverse().join("/"),a=t.get(o);n!==a&&r.push(s.replace("/"," -> "))}),r.length>0)throw new Error(`non-manifold edges ${r.length}
${r.join(`
`)}`)};var yx=vx,et={clone:cw,create:$a,fromPoints:D_,fromCompactBinary:U_,invert:J_,isA:uh,toPoints:sx,toPolygons:Ta,toString:cx,toCompactBinary:ux,transform:hx,validate:yx};const bx=e=>Object.assign({},e);var ll=bx;const{EPS:Z1}=it,wx=rt,_x=ll,xx=e=>{if(e.isClosed)return e;const t=_x(e);if(t.isClosed=!0,t.points.length>1){const r=t.points,n=r[0];let s=r[r.length-1];for(;wx.distance(n,s)<Z1*Z1&&(r.pop(),r.length!==1);)s=r[r.length-1]}return t};var dh=xx;const Ex=dt,$x=e=>(e===void 0&&(e=[]),{points:e,isClosed:!1,transforms:Ex.create()});var Sa=$x;const{EPS:W1}=it,Q1=rt,Ax=dh,Tx=Sa,Sx=(e,t)=>{const r={closed:!1};let{closed:n}=Object.assign({},r,e),s=Tx();if(s.points=t.map(o=>Q1.clone(o)),s.points.length>1){const o=s.points[0],a=s.points[s.points.length-1];Q1.distance(o,a)<W1*W1&&(n=!0)}return n===!0&&(s=Ax(s)),s};var fl=Sx;const K1=dt,J1=rt,Px=e=>(K1.isIdentity(e.transforms)||(e.points=e.points.map(t=>J1.transform(J1.create(),t,e.transforms)),e.transforms=K1.create()),e);var Cx=Px;const Mx=Cx,Ox=e=>Mx(e).points;var ds=Ox;const{TAU:Io}=it,Ot=rt,Rx=fl,Lx=ds,Fx=(e,t)=>{const r={radius:[0,0],xaxisrotation:0,clockwise:!1,large:!1,segments:16};let{endpoint:n,radius:s,xaxisrotation:o,clockwise:a,large:i,segments:c}=Object.assign({},r,e);if(!Array.isArray(n))throw new Error("endpoint must be an array of X and Y values");if(n.length<2)throw new Error("endpoint must contain X and Y values");if(n=Ot.clone(n),!Array.isArray(s))throw new Error("radius must be an array of X and Y values");if(s.length<2)throw new Error("radius must contain X and Y values");if(c<4)throw new Error("segments must be four or more");const l=1e5;if(t.isClosed)throw new Error("the given path cannot be closed");const u=Lx(t);if(u.length<1)throw new Error("the given path must contain one or more points (as the starting point for the arc)");let d=s[0],h=s[1];const p=u[u.length-1];d=Math.round(d*l)/l,h=Math.round(h*l)/l,n=Ot.fromValues(Math.round(n[0]*l)/l,Math.round(n[1]*l)/l);const E=!a;let g=[];if(d===0||h===0)g.push(n);else{d=Math.abs(d),h=Math.abs(h);const P=o,F=Math.cos(P),R=Math.sin(P),M=Ot.subtract(Ot.create(),p,n);Ot.scale(M,M,.5);const G=Math.round((F*M[0]+R*M[1])*l)/l,L=Math.round((-R*M[0]+F*M[1])*l)/l,U=Ot.fromValues(G,L),ee=U[0]*U[0]/(d*d)+U[1]*U[1]/(h*h);if(ee>1){const Nt=Math.sqrt(ee);d*=Nt,h*=Nt,d=Math.round(d*l)/l,h=Math.round(h*l)/l}let oe=Math.sqrt((d*d*h*h-d*d*U[1]*U[1]-h*h*U[0]*U[0])/(d*d*U[1]*U[1]+h*h*U[0]*U[0]));E===i&&(oe=-oe);const pe=Ot.fromValues(d*U[1]/h,-h*U[0]/d);Ot.scale(pe,pe,oe);let Q=Ot.fromValues(F*pe[0]-R*pe[1],R*pe[0]+F*pe[1]);Q=Ot.add(Q,Q,Ot.scale(Ot.create(),Ot.add(Ot.create(),p,n),.5));const Se=Ot.fromValues((U[0]-pe[0])/d,(U[1]-pe[1])/h),qe=Ot.fromValues((-U[0]-pe[0])/d,(-U[1]-pe[1])/h),$e=Ot.angleRadians(Se);let Ne=Ot.angleRadians(qe)-$e;Ne=Ne%Io,!E&&Ne>0?Ne-=Io:E&&Ne<0&&(Ne+=Io);let Lt=Math.ceil(Math.abs(Ne)/Io*c)+1;Lt<1&&(Lt=1);for(let Nt=1;Nt<Lt;Nt++){const Nr=$e+Nt/Lt*Ne,yr=Math.cos(Nr),Dr=Math.sin(Nr),br=Ot.fromValues(F*d*yr-R*h*Dr,R*d*yr+F*h*Dr);Ot.add(br,br,Q),g.push(br)}Lt&&g.push(e.endpoint)}return g=u.concat(g),Rx({},g)};var Gx=Fx;const Nx=fl,Dx=ds,{equals:kx}=rt,Bx=(...e)=>{let t=!1,r=[];return e.forEach((n,s)=>{const o=Dx(n).slice();if(r.length>0&&o.length>0&&kx(o[0],r[r.length-1])&&o.shift(),o.length>0&&t)throw new Error(`Cannot concatenate to a closed path; check the ${s}th path`);t=n.isClosed,r=r.concat(o)}),Nx({closed:t},r)};var hh=Bx;const Ix=hh,zx=Sa,Vx=(e,t)=>Ix(t,zx(e));var mh=Vx;const{TAU:Ux}=it,ar=rt,qx=rt,Xx=mh,jx=ds,Hx=(e,t)=>{const r={segments:16};let{controlPoints:n,segments:s}=Object.assign({},r,e);if(!Array.isArray(n))throw new Error("controlPoints must be an array of one or more points");if(n.length<1)throw new Error("controlPoints must be an array of one or more points");if(s<4)throw new Error("segments must be four or more");if(t.isClosed)throw new Error("the given geometry cannot be closed");const o=jx(t);if(o.length<1)throw new Error("the given path must contain one or more points (as the starting point for the bezier curve)");if(n=n.slice(),n[0]===null){if(n.length<2)throw new Error("a null control point must be passed with one more control points");let L=o[o.length-2];if("lastBezierControlPoint"in t&&(L=t.lastBezierControlPoint),!Array.isArray(L))throw new Error("the given path must contain TWO or more points if given a null control point");const U=ar.scale(ar.create(),o[o.length-1],2);ar.subtract(U,U,L),n[0]=U}n.unshift(o[o.length-1]);const i=n.length-1,c=[];let l=1;for(let L=0;L<=i;++L)L>0&&(l*=L),c.push(l);const u=[];for(let L=0;L<=i;++L){const U=c[i]/(c[L]*c[i-L]);u.push(U)}const d=ar.create(),h=ar.create(),p=qx.create(),E=L=>{let U=1,ee=Math.pow(1-L,i);const oe=L!==1?1/(1-L):1,pe=ar.create();for(let Q=0;Q<=i;++Q){Q===i&&(ee=1);const Se=u[Q]*U*ee,qe=ar.scale(d,n[Q],Se);ar.add(pe,pe,qe),U*=L,ee*=oe}return pe},g=[],b=[],P=i+1;for(let L=0;L<P;++L){const U=L/(P-1),ee=E(U);g.push(ee),b.push(U)}let F=1;const R=Ux/s,M=Math.sin(R);for(;F<g.length-1;){const L=ar.subtract(d,g[F],g[F-1]);ar.normalize(L,L);const U=ar.subtract(h,g[F+1],g[F]);ar.normalize(U,U);const ee=ar.cross(p,L,U);if(Math.abs(ee[2])>M){const oe=b[F-1],pe=b[F+1],Q=oe+(pe-oe)*1/3,Se=oe+(pe-oe)*2/3,qe=E(Q),$e=E(Se);g.splice(F,1,qe,$e),b.splice(F,1,Q,Se),F--,F<1&&(F=1)}else++F}g.shift();const G=Xx(g,t);return G.lastBezierControlPoint=n[n.length-2],G};var Yx=Hx;const Zx=rt,eu=ds,Wx=(e,t)=>{if(e.isClosed!==t.isClosed||e.points.length!==t.points.length)return!1;const r=eu(e),n=eu(t),s=r.length;let o=0;do{let a=!1;for(let i=0;i<s;i++)if(!Zx.equals(r[i],n[(i+o)%s])){a=!0;break}if(a===!1)return!0;if(!e.isClosed)return!1}while(++o<s);return!1};var Qx=Wx;const Kx=dt,Jx=rt,eE=Sa,tE=e=>{if(e[0]!==2)throw new Error("invalid compact binary data");const t=eE();t.transforms=Kx.clone(e.slice(1,17)),t.isClosed=!!e[17];for(let r=22;r<e.length;r+=2){const n=Jx.fromValues(e[r],e[r+1]);t.points.push(n)}return e[18]>=0&&(t.color=[e[18],e[19],e[20],e[21]]),t};var rE=tE;const nE=e=>!!(e&&typeof e=="object"&&"points"in e&&"transforms"in e&&"isClosed"in e&&Array.isArray(e.points)&&"length"in e.transforms);var ph=nE;const sE=ll,oE=e=>{const t=sE(e);return t.points=e.points.slice().reverse(),t};var aE=oE;const iE=rt,cE=ds,lE=e=>{const t=cE(e);let r="path ("+t.length+" points, "+e.isClosed+`):
[
`;return t.forEach(n=>{r+="  "+iE.toString(n)+`,
`}),r+=`]
`,r};var fE=lE;const uE=e=>{const t=e.points,r=e.transforms;let n=[-1,-1,-1,-1];e.color&&(n=e.color);const s=new Float32Array(1+16+1+4+t.length*2);s[0]=2,s[1]=r[0],s[2]=r[1],s[3]=r[2],s[4]=r[3],s[5]=r[4],s[6]=r[5],s[7]=r[6],s[8]=r[7],s[9]=r[8],s[10]=r[9],s[11]=r[10],s[12]=r[11],s[13]=r[12],s[14]=r[13],s[15]=r[14],s[16]=r[15],s[17]=e.isClosed?1:0,s[18]=n[0],s[19]=n[1],s[20]=n[2],s[21]=n[3];for(let o=0;o<t.length;o++){const a=o*2+22,i=t[o];s[a]=i[0],s[a+1]=i[1]}return s};var dE=uE;const tu=dt,hE=(e,t)=>{const r=tu.multiply(tu.create(),e,t.transforms);return Object.assign({},t,{transforms:r})};var mE=hE;const pE=rt,vE=ph,gE=e=>{if(!vE(e))throw new Error("invalid path2 structure");if(e.points.length>1){for(let t=0;t<e.points.length;t++)if(pE.equals(e.points[t],e.points[(t+1)%e.points.length]))throw new Error(`path2 duplicate points ${e.points[t]}`)}if(e.points.forEach(t=>{if(!t.every(Number.isFinite))throw new Error(`path2 invalid point ${t}`)}),!e.transforms.every(Number.isFinite))throw new Error(`path2 invalid transforms ${e.transforms}`)};var yE=gE,lt={appendArc:Gx,appendBezier:Yx,appendPoints:mh,clone:ll,close:dh,concat:hh,create:Sa,equals:Qx,fromPoints:fl,fromCompactBinary:rE,isA:ph,reverse:aE,toPoints:ds,toString:fE,toCompactBinary:dE,transform:mE,validate:yE};const bE=Ze,vh=Je,gh=et,yh=lt,bh=st,wE=(e,t)=>{const r=vh.clone(t);return r.color=e,r},_E=(e,t)=>{const r=gh.clone(t);return r.color=e,r},xE=(e,t)=>{const r=yh.clone(t);return r.color=e,r},EE=(e,t)=>{const r=bh.clone(t);return r.color=e,r},$E=(e,...t)=>{if(!Array.isArray(e))throw new Error("color must be an array");if(e.length<3)throw new Error("color must contain R, G and B values");if(e.length===3&&(e=[e[0],e[1],e[2],1]),t=bE(t),t.length===0)throw new Error("wrong number of arguments");const r=t.map(n=>vh.isA(n)?wE(e,n):gh.isA(n)?_E(e,n):yh.isA(n)?xE(e,n):bh.isA(n)?EE(e,n):(n.color=e,n));return r.length===1?r[0]:r};var AE=$E;const TE={black:[0/255,0/255,0/255],silver:[192/255,192/255,192/255],gray:[128/255,128/255,128/255],white:[255/255,255/255,255/255],maroon:[128/255,0/255,0/255],red:[255/255,0/255,0/255],purple:[128/255,0/255,128/255],fuchsia:[255/255,0/255,255/255],green:[0/255,128/255,0/255],lime:[0/255,255/255,0/255],olive:[128/255,128/255,0/255],yellow:[255/255,255/255,0/255],navy:[0/255,0/255,128/255],blue:[0/255,0/255,255/255],teal:[0/255,128/255,128/255],aqua:[0/255,255/255,255/255],aliceblue:[240/255,248/255,255/255],antiquewhite:[250/255,235/255,215/255],aquamarine:[127/255,255/255,212/255],azure:[240/255,255/255,255/255],beige:[245/255,245/255,220/255],bisque:[255/255,228/255,196/255],blanchedalmond:[255/255,235/255,205/255],blueviolet:[138/255,43/255,226/255],brown:[165/255,42/255,42/255],burlywood:[222/255,184/255,135/255],cadetblue:[95/255,158/255,160/255],chartreuse:[127/255,255/255,0/255],chocolate:[210/255,105/255,30/255],coral:[255/255,127/255,80/255],cornflowerblue:[100/255,149/255,237/255],cornsilk:[255/255,248/255,220/255],crimson:[220/255,20/255,60/255],cyan:[0/255,255/255,255/255],darkblue:[0/255,0/255,139/255],darkcyan:[0/255,139/255,139/255],darkgoldenrod:[184/255,134/255,11/255],darkgray:[169/255,169/255,169/255],darkgreen:[0/255,100/255,0/255],darkgrey:[169/255,169/255,169/255],darkkhaki:[189/255,183/255,107/255],darkmagenta:[139/255,0/255,139/255],darkolivegreen:[85/255,107/255,47/255],darkorange:[255/255,140/255,0/255],darkorchid:[153/255,50/255,204/255],darkred:[139/255,0/255,0/255],darksalmon:[233/255,150/255,122/255],darkseagreen:[143/255,188/255,143/255],darkslateblue:[72/255,61/255,139/255],darkslategray:[47/255,79/255,79/255],darkslategrey:[47/255,79/255,79/255],darkturquoise:[0/255,206/255,209/255],darkviolet:[148/255,0/255,211/255],deeppink:[255/255,20/255,147/255],deepskyblue:[0/255,191/255,255/255],dimgray:[105/255,105/255,105/255],dimgrey:[105/255,105/255,105/255],dodgerblue:[30/255,144/255,255/255],firebrick:[178/255,34/255,34/255],floralwhite:[255/255,250/255,240/255],forestgreen:[34/255,139/255,34/255],gainsboro:[220/255,220/255,220/255],ghostwhite:[248/255,248/255,255/255],gold:[255/255,215/255,0/255],goldenrod:[218/255,165/255,32/255],greenyellow:[173/255,255/255,47/255],grey:[128/255,128/255,128/255],honeydew:[240/255,255/255,240/255],hotpink:[255/255,105/255,180/255],indianred:[205/255,92/255,92/255],indigo:[75/255,0/255,130/255],ivory:[255/255,255/255,240/255],khaki:[240/255,230/255,140/255],lavender:[230/255,230/255,250/255],lavenderblush:[255/255,240/255,245/255],lawngreen:[124/255,252/255,0/255],lemonchiffon:[255/255,250/255,205/255],lightblue:[173/255,216/255,230/255],lightcoral:[240/255,128/255,128/255],lightcyan:[224/255,255/255,255/255],lightgoldenrodyellow:[250/255,250/255,210/255],lightgray:[211/255,211/255,211/255],lightgreen:[144/255,238/255,144/255],lightgrey:[211/255,211/255,211/255],lightpink:[255/255,182/255,193/255],lightsalmon:[255/255,160/255,122/255],lightseagreen:[32/255,178/255,170/255],lightskyblue:[135/255,206/255,250/255],lightslategray:[119/255,136/255,153/255],lightslategrey:[119/255,136/255,153/255],lightsteelblue:[176/255,196/255,222/255],lightyellow:[255/255,255/255,224/255],limegreen:[50/255,205/255,50/255],linen:[250/255,240/255,230/255],magenta:[255/255,0/255,255/255],mediumaquamarine:[102/255,205/255,170/255],mediumblue:[0/255,0/255,205/255],mediumorchid:[186/255,85/255,211/255],mediumpurple:[147/255,112/255,219/255],mediumseagreen:[60/255,179/255,113/255],mediumslateblue:[123/255,104/255,238/255],mediumspringgreen:[0/255,250/255,154/255],mediumturquoise:[72/255,209/255,204/255],mediumvioletred:[199/255,21/255,133/255],midnightblue:[25/255,25/255,112/255],mintcream:[245/255,255/255,250/255],mistyrose:[255/255,228/255,225/255],moccasin:[255/255,228/255,181/255],navajowhite:[255/255,222/255,173/255],oldlace:[253/255,245/255,230/255],olivedrab:[107/255,142/255,35/255],orange:[255/255,165/255,0/255],orangered:[255/255,69/255,0/255],orchid:[218/255,112/255,214/255],palegoldenrod:[238/255,232/255,170/255],palegreen:[152/255,251/255,152/255],paleturquoise:[175/255,238/255,238/255],palevioletred:[219/255,112/255,147/255],papayawhip:[255/255,239/255,213/255],peachpuff:[255/255,218/255,185/255],peru:[205/255,133/255,63/255],pink:[255/255,192/255,203/255],plum:[221/255,160/255,221/255],powderblue:[176/255,224/255,230/255],rosybrown:[188/255,143/255,143/255],royalblue:[65/255,105/255,225/255],saddlebrown:[139/255,69/255,19/255],salmon:[250/255,128/255,114/255],sandybrown:[244/255,164/255,96/255],seagreen:[46/255,139/255,87/255],seashell:[255/255,245/255,238/255],sienna:[160/255,82/255,45/255],skyblue:[135/255,206/255,235/255],slateblue:[106/255,90/255,205/255],slategray:[112/255,128/255,144/255],slategrey:[112/255,128/255,144/255],snow:[255/255,250/255,250/255],springgreen:[0/255,255/255,127/255],steelblue:[70/255,130/255,180/255],tan:[210/255,180/255,140/255],thistle:[216/255,191/255,216/255],tomato:[255/255,99/255,71/255],turquoise:[64/255,224/255,208/255],violet:[238/255,130/255,238/255],wheat:[245/255,222/255,179/255],whitesmoke:[245/255,245/255,245/255],yellowgreen:[154/255,205/255,50/255]};var wh=TE;const SE=wh,PE=e=>SE[e.toLowerCase()];var CE=PE;const ME=e=>{if(e=e.replace("#",""),e.length<6)throw new Error("the given notation must contain 3 or more hex values");const t=parseInt(e.substring(0,2),16)/255,r=parseInt(e.substring(2,4),16)/255,n=parseInt(e.substring(4,6),16)/255;if(e.length>=8){const s=parseInt(e.substring(6,8),16)/255;return[t,r,n,s]}return[t,r,n]};var OE=ME;const RE=(e,t,r)=>(r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e);var _h=RE;const LE=Ze,Xi=_h,FE=(...e)=>{if(e=LE(e),e.length<3)throw new Error("values must contain H, S and L values");const t=e[0],r=e[1],n=e[2];let s=n,o=n,a=n;if(r!==0){const i=n<.5?n*(1+r):n+r-n*r,c=2*n-i;s=Xi(c,i,t+1/3),o=Xi(c,i,t),a=Xi(c,i,t-1/3)}if(e.length>3){const i=e[3];return[s,o,a,i]}return[s,o,a]};var GE=FE;const NE=Ze,DE=(...e)=>{if(e=NE(e),e.length<3)throw new Error("values must contain H, S and V values");const t=e[0],r=e[1],n=e[2];let s=0,o=0,a=0;const i=Math.floor(t*6),c=t*6-i,l=n*(1-r),u=n*(1-c*r),d=n*(1-(1-c)*r);switch(i%6){case 0:s=n,o=d,a=l;break;case 1:s=u,o=n,a=l;break;case 2:s=l,o=n,a=d;break;case 3:s=l,o=u,a=n;break;case 4:s=d,o=l,a=n;break;case 5:s=n,o=l,a=u;break}if(e.length>3){const h=e[3];return[s,o,a,h]}return[s,o,a]};var kE=DE;const BE=Ze,IE=(...e)=>{if(e=BE(e),e.length<3)throw new Error("values must contain R, G and B values");const t=e[0]*255,r=e[1]*255,n=e[2]*255;let s=`#${Number(16777216+t*65536+r*256+n).toString(16).substring(1,7)}`;return e.length>3&&(s=s+Number(e[3]*255).toString(16)),s};var zE=IE;const VE=Ze,UE=(...e)=>{if(e=VE(e),e.length<3)throw new Error("values must contain R, G and B values");const t=e[0],r=e[1],n=e[2],s=Math.max(t,r,n),o=Math.min(t,r,n);let a,i;const c=(s+o)/2;if(s===o)a=i=0;else{const l=s-o;switch(i=c>.5?l/(2-s-o):l/(s+o),s){case t:a=(r-n)/l+(r<n?6:0);break;case r:a=(n-t)/l+2;break;case n:a=(t-r)/l+4;break}a/=6}if(e.length>3){const l=e[3];return[a,i,c,l]}return[a,i,c]};var qE=UE;const XE=Ze,jE=(...e)=>{if(e=XE(e),e.length<3)throw new Error("values must contain R, G and B values");const t=e[0],r=e[1],n=e[2],s=Math.max(t,r,n),o=Math.min(t,r,n);let a;const i=s,c=s-o,l=s===0?0:c/s;if(s===o)a=0;else{switch(s){case t:a=(r-n)/c+(r<n?6:0);break;case r:a=(n-t)/c+2;break;case n:a=(t-r)/c+4;break}a/=6}if(e.length>3){const u=e[3];return[a,l,i,u]}return[a,l,i]};var HE=jE,YE={colorize:AE,colorNameToRgb:CE,cssColors:wh,hexToRgb:OE,hslToRgb:GE,hsvToRgb:kE,hueToColorComponent:_h,rgbToHex:zE,rgbToHsl:qE,rgbToHsv:HE};const ZE=e=>{if(!Array.isArray(e))throw new Error("Bezier points must be a valid array/");if(e.length<2)throw new Error("Bezier points must contain at least 2 values.");const t=WE(e);return{points:e,pointType:t,dimensions:t==="float_single"?0:e[0].length,permutations:ru(e.length-1),tangentPermutations:ru(e.length-2)}},WE=function(e){let t=null;return e.forEach(r=>{let n="";if(Number.isFinite(r))n="float_single";else if(Array.isArray(r))r.forEach(s=>{if(!Number.isFinite(s))throw new Error("Bezier point values must all be numbers.")}),n="float_"+r.length;else throw new Error("Bezier points must all be numbers or arrays of number.");if(t==null)t=n;else if(t!==n)throw new Error("Bezier points must be either all numbers or all arrays of numbers of the same size.")}),t},ru=function(e){const t=[];for(let r=0;r<=e;r++)t.push(ji(e)/(ji(r)*ji(e-r)));return t},ji=function(e){let t=1;for(let r=2;r<=e;r++)t*=r;return t};var QE=ZE;const KE=(e,t)=>{if(e<0||e>1)throw new Error("Bezier valueAt() input must be between 0 and 1");if(t.pointType==="float_single")return nu(t,t.points,e);{const r=[];for(let n=0;n<t.dimensions;n++){const s=[];for(let o=0;o<t.points.length;o++)s.push(t.points[o][n]);r.push(nu(t,s,e))}return r}},nu=function(e,t,r){const n=t.length-1;let s=0;for(let o=0;o<=n;o++)s+=e.permutations[o]*Math.pow(1-r,n-o)*Math.pow(r,o)*t[o];return s};var JE=KE;const e$=(e,t)=>{if(e<0||e>1)throw new Error("Bezier tangentAt() input must be between 0 and 1");if(t.pointType==="float_single")return su(t,t.points,e);{const r=[];for(let n=0;n<t.dimensions;n++){const s=[];for(let o=0;o<t.points.length;o++)s.push(t.points[o][n]);r.push(su(t,s,e))}return r}},su=function(e,t,r){const n=t.length-1;let s=0;for(let o=0;o<n;o++){const a=n*(t[o+1]-t[o]);s+=e.tangentPermutations[o]*Math.pow(1-r,n-1-o)*Math.pow(r,o)*a}return s};var t$=e$,r$={create:QE,valueAt:JE,tangentAt:t$},n$={bezier:r$};const s$=e=>{let t=0;for(let r=0;r<e.length;r++){const n=(r+1)%e.length;t+=e[r][0]*e[n][1],t-=e[n][0]*e[r][1]}return t/2};var Pa=s$;const o$=Pa,a$=e=>o$(e.vertices);var xh=a$;const i$=e=>((e===void 0||e.length<3)&&(e=[]),{vertices:e});var Eh=i$;const c$=Eh,l$=e=>{const t=e.vertices.slice().reverse();return c$(t)};var $h=l$;const f$=xh,u$=$h,d$=(e,t)=>{if(e.length===0)return 0;const r=t.vertices;return r.length<3?0:(f$(t)<0&&(t=u$(t)),e.reduce((s,o)=>s+h$(o,r),0)===e.length?1:0)},h$=(e,t)=>{const r=t.length,n=e[0],s=e[1];let o=t[r-1],a=t[0],i=o[1]>s,c=0,l=0;for(let u=r+1;--u;){const d=a[1]>s;if(i!==d){const h=o[0]>n,p=a[0]>n;(h&&p||a[0]-(a[1]-s)*(o[0]-a[0])/(o[1]-a[1])>=n)&&(c=!c)}i=d,o=a,a=t[++l]}return c};var m$=d$,ul={arePointsInside:m$,create:Eh,flip:$h,measureArea:xh},dl={geom2:Je,geom3:et,path2:lt,poly2:ul,poly3:st};const p$=()=>[0,1,0];var hl=p$;const v$=hl,g$=e=>{const t=v$();return t[0]=e[0],t[1]=e[1],t[2]=e[2],t};var y$=g$;const Hi=rt,b$=e=>{const t=Hi.normal(Hi.create(),e);return Hi.negate(t,t),t};var ml=b$;const ou=rt,w$=e=>ou.scale(ou.create(),e,e[2]);var Ca=w$;const _$=rt,x$=ml,E$=Ca,$$=(e,t)=>{const r=E$(e),n=x$(e),s=(n[1]-r[1])/(n[0]-r[0]),o=r[1]-s*r[0],a=-1/s,c=(t[1]-a*t[0]-o)/(s-a),l=s*c+o;return _$.fromValues(c,l)};var A$=$$;const T$=(e,t)=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],e);var Ah=T$;const S$=rt,P$=(e,t)=>{let r=S$.dot(t,e);return r=Math.abs(r-e[2]),r};var C$=P$;const M$=(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2];var O$=M$;const Fs=rt,R$=(e,t,r)=>{const n=Fs.subtract(Fs.create(),r,t);Fs.normal(n,n),Fs.normalize(n,n);const s=Fs.dot(t,n);return e[0]=n[0],e[1]=n[1],e[2]=s,e};var Th=R$;const L$=hl,F$=(e,t,r)=>{const n=L$();return n[0]=e,n[1]=t,n[2]=r,n};var Sh=F$;const{NEPS:Yi}=it,G$=(e,t)=>Math.abs(e[0]-t[0])<=Yi&&Math.abs(e[1]-t[1])<=Yi&&Math.abs(e[2]-t[2])<=Yi;var Ma=G$;const N$=(e,t,r)=>{let n=r-e[1],s=t[1]-e[1];s<0&&(n=-n,s=-s);let o;return n<=0?o=0:n>=s?o=1:s<1e-10?o=.5:o=n/s,e[0]+o*(t[0]-e[0])};var Ph=N$;const D$=(e,t,r,n)=>{if(e[0]===t[0]&&e[1]===t[1]||r[0]===n[0]&&r[1]===n[1])return;const s=(n[1]-r[1])*(t[0]-e[0])-(n[0]-r[0])*(t[1]-e[1]);if(Math.abs(s)<Number.MIN_VALUE)return;const o=((n[0]-r[0])*(e[1]-r[1])-(n[1]-r[1])*(e[0]-r[0]))/s,a=((t[0]-e[0])*(e[1]-r[1])-(t[1]-e[1])*(e[0]-r[0]))/s;if(o<0||o>1||a<0||a>1)return;const i=e[0]+o*(t[0]-e[0]),c=e[1]+o*(t[1]-e[1]);return[i,c]};var Ch=D$;const k$=(e,t,r,n,s,o)=>{const a=e*n-t*r,i=1/a;let c=s*n-t*o,l=-s*r+e*o;return c*=i,l*=i,[c,l]};var B$=k$,eo={aboutEqualNormals:Ma,area:Pa,cos:Ut.cos,interpolateBetween2DPointsForY:Ph,intersect:Ch,sin:Ut.sin,solve2Linear:B$};const I$=rt,{solve2Linear:z$}=eo,V$=(e,t)=>{const r=z$(e[0],e[1],t[0],t[1],e[2],t[2]);return I$.clone(r)};var U$=V$;const au=rt,q$=Ah,X$=Sh,j$=(e,t)=>{const r=au.negate(au.create(),t),n=-t[2];return q$(e,X$(r[0],r[1],n))};var H$=j$;const Y$=e=>`line2: (${e[0].toFixed(7)}, ${e[1].toFixed(7)}, ${e[2].toFixed(7)})`;var Z$=Y$;const iu=rt,W$=Th,Q$=Ca,K$=ml,J$=(e,t,r)=>{const n=Q$(t),s=K$(t);return iu.transform(n,n,r),iu.transform(s,s,r),W$(e,n,s)};var eA=J$;const tA=Ca,rA=(e,t)=>{let r=(e[2]-e[1]*t)/e[0];return Number.isNaN(r)&&(r=tA(e)[0]),r};var nA=rA,pl={clone:y$,closestPoint:A$,copy:Ah,create:hl,direction:ml,distanceToPoint:C$,equals:O$,fromPoints:Th,fromValues:Sh,intersectPointOfLines:U$,origin:Ca,reverse:H$,toString:Z$,transform:eA,xAtY:nA};const cu=ze,sA=()=>[cu.fromValues(0,0,0),cu.fromValues(0,0,1)];var Mh=sA;const lu=ze,oA=Mh,aA=e=>{const t=oA();return lu.copy(t[0],e[0]),lu.copy(t[1],e[1]),t};var iA=aA;const wn=ze,cA=(e,t)=>{const r=e[0],n=e[1],s=wn.dot(wn.subtract(wn.create(),t,r),n),o=wn.dot(n,n),a=s/o,i=wn.scale(wn.create(),n,a);return wn.add(i,i,r),i};var Oh=cA;const fu=ze,lA=(e,t)=>(fu.copy(e[0],t[0]),fu.copy(e[1],t[1]),e);var fA=lA;const uA=e=>e[1];var dA=uA;const Zi=ze,hA=Oh,mA=(e,t)=>{const r=hA(e,t),n=Zi.subtract(Zi.create(),t,r);return Zi.length(n)};var pA=mA;const uu=ze,vA=(e,t)=>!(!uu.equals(e[1],t[1])||!uu.equals(e[0],t[0]));var gA=vA;const zo=ze,yA=(e,t,r)=>{const n=zo.normalize(zo.create(),r);return zo.copy(e[0],t),zo.copy(e[1],n),e};var to=yA;const _n=ze,{solve2Linear:Wi}=eo,{EPS:bA}=it,wA=to,_A=(e,t,r)=>{let n=_n.cross(_n.create(),t,r),s=_n.length(n);if(s<bA)throw new Error("parallel planes do not intersect");s=1/s,n=_n.scale(n,n,s);const o=Math.abs(n[0]),a=Math.abs(n[1]),i=Math.abs(n[2]);let c,l;return o>=a&&o>=i?(l=Wi(t[1],t[2],r[1],r[2],t[3],r[3]),c=_n.fromValues(0,l[0],l[1])):a>=o&&a>=i?(l=Wi(t[0],t[2],r[0],r[2],t[3],r[3]),c=_n.fromValues(l[0],0,l[1])):(l=Wi(t[0],t[1],r[0],r[1],t[3],r[3]),c=_n.fromValues(l[0],l[1],0)),wA(e,c,n)};var xA=_A;const du=ze,EA=to,$A=(e,t,r)=>{const n=du.subtract(du.create(),r,t);return EA(e,t,n)};var AA=$A;const jn=ze,TA=(e,t)=>{const r=t,n=t[3],s=e[0],o=e[1],a=(n-jn.dot(r,s))/jn.dot(r,o);return jn.add(jn.create(),s,jn.scale(jn.create(),o,a))};var SA=TA;const PA=e=>e[0];var CA=PA;const Qi=ze,MA=to,OA=(e,t)=>{const r=Qi.clone(t[0]),n=Qi.negate(Qi.create(),t[1]);return MA(e,r,n)};var RA=OA;const LA=e=>{const t=e[0],r=e[1];return`line3: point: (${t[0].toFixed(7)}, ${t[1].toFixed(7)}, ${t[2].toFixed(7)}) direction: (${r[0].toFixed(7)}, ${r[1].toFixed(7)}, ${r[2].toFixed(7)})`};var FA=LA;const Hn=ze,GA=to,NA=(e,t,r)=>{const n=t[0],s=t[1],o=Hn.add(Hn.create(),n,s),a=Hn.transform(Hn.create(),n,r),i=Hn.transform(o,o,r),c=Hn.subtract(i,i,a);return GA(e,a,c)};var DA=NA,kA={clone:iA,closestPoint:Oh,copy:fA,create:Mh,direction:dA,distanceToPoint:pA,equals:gA,fromPlanes:xA,fromPointAndDirection:to,fromPoints:AA,intersectPointOfLineAndPlane:SA,origin:CA,reverse:RA,toString:FA,transform:DA},BA={constants:it,line2:pl,line3:kA,mat4:dt,plane:Pr,utils:eo,vec2:rt,vec3:ze,vec4:fh};const IA=Ze,Rh=Je,Lh=et,zA=lt,VA=st,ua=new WeakMap,UA=()=>0,qA=e=>{let t=ua.get(e);return t||(t=Rh.toSides(e).reduce((n,s)=>n+(s[0][0]*s[1][1]-s[0][1]*s[1][0]),0),t*=.5,ua.set(e,t),t)},XA=e=>{let t=ua.get(e);return t||(t=Lh.toPolygons(e).reduce((n,s)=>n+VA.measureArea(s),0),ua.set(e,t),t)},jA=(...e)=>{if(e=IA(e),e.length===0)throw new Error("wrong number of arguments");const t=e.map(r=>zA.isA(r)?UA():Rh.isA(r)?qA(r):Lh.isA(r)?XA(r):0);return t.length===1?t[0]:t};var Fh=jA;const HA=Ze,YA=Fh,ZA=(...e)=>{if(e=HA(e),e.length===0)throw new Error("measureAggregateArea: no geometries supplied");const t=YA(e);if(e.length===1)return t;const r=0;return t.reduce((n,s)=>n+s,r)};var WA=ZA;const QA=Ze,Sr=rt,Gs=ze,Gh=Je,Nh=et,Dh=lt,hu=st,is=new WeakMap,KA=e=>{let t=is.get(e);if(t)return t;const r=Dh.toPoints(e);let n;r.length===0?n=Sr.create():n=Sr.clone(r[0]);let s=Sr.clone(n);return r.forEach(o=>{Sr.min(n,n,o),Sr.max(s,s,o)}),n=[n[0],n[1],0],s=[s[0],s[1],0],t=[n,s],is.set(e,t),t},JA=e=>{let t=is.get(e);if(t)return t;const r=Gh.toPoints(e);let n;r.length===0?n=Sr.create():n=Sr.clone(r[0]);let s=Sr.clone(n);return r.forEach(o=>{Sr.min(n,n,o),Sr.max(s,s,o)}),n=[n[0],n[1],0],s=[s[0],s[1],0],t=[n,s],is.set(e,t),t},e4=e=>{let t=is.get(e);if(t)return t;const r=Nh.toPolygons(e);let n=Gs.create();if(r.length>0){const o=hu.toPoints(r[0]);Gs.copy(n,o[0])}let s=Gs.clone(n);return r.forEach(o=>{hu.toPoints(o).forEach(a=>{Gs.min(n,n,a),Gs.max(s,s,a)})}),n=[n[0],n[1],n[2]],s=[s[0],s[1],s[2]],t=[n,s],is.set(e,t),t},t4=(...e)=>{if(e=QA(e),e.length===0)throw new Error("wrong number of arguments");const t=e.map(r=>Dh.isA(r)?KA(r):Gh.isA(r)?JA(r):Nh.isA(r)?e4(r):[[0,0,0],[0,0,0]]);return t.length===1?t[0]:t};var Cn=t4;const r4=Ze,n4=qd,s4=Ud,o4=Cn,a4=(...e)=>{if(e=r4(e),e.length===0)throw new Error("measureAggregateBoundingBox: no geometries supplied");const t=o4(e);if(e.length===1)return t;const r=[[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE]];return t.reduce((n,s)=>(n=[n4(n[0],n[0],s[0]),s4(n[1],n[1],s[1])],n),r)};var vl=a4;const{EPS:i4}=it,c4=(e,t)=>{let r=0;for(let n=0;n<t;n++)r+=e[1][n]-e[0][n];return i4*r/t};var kh=c4;const l4=Ze,f4=vl,u4=kh,{geom2:d4,geom3:h4,path2:m4}=dl,p4=(...e)=>{if(e=l4(e),e.length===0)throw new Error("measureAggregateEpsilon: no geometries supplied");const t=f4(e);let r=0;return r=e.reduce((n,s)=>m4.isA(s)||d4.isA(s)?Math.max(n,2):h4.isA(s)?Math.max(n,3):0,r),u4(t,r)};var v4=p4;const g4=Ze,y4=Je,Bh=et,b4=lt,w4=st,mu=new WeakMap,_4=()=>0,x4=()=>0,E4=e=>{let t=mu.get(e);return t||(t=Bh.toPolygons(e).reduce((n,s)=>n+w4.measureSignedVolume(s),0),mu.set(e,t),t)},$4=(...e)=>{if(e=g4(e),e.length===0)throw new Error("wrong number of arguments");const t=e.map(r=>b4.isA(r)?_4():y4.isA(r)?x4():Bh.isA(r)?E4(r):0);return t.length===1?t[0]:t};var Ih=$4;const A4=Ze,T4=Ih,S4=(...e)=>{if(e=A4(e),e.length===0)throw new Error("measureAggregateVolume: no geometries supplied");const t=T4(e);if(e.length===1)return t;const r=0;return t.reduce((n,s)=>n+s,r)};var P4=S4;const C4=Ze,zh=rt,Jt=ze,Vh=Je,Uh=et,qh=lt,pu=st,cs=new WeakMap,M4=e=>{let t=cs.get(e);if(t!==void 0)return t;const r=Jt.create();let n=0;const s=qh.toPoints(e);if(s.length>0){let o=0;const a=Jt.create();s.forEach(i=>{Jt.add(r,r,Jt.fromVec2(a,i,0)),o++}),Jt.scale(r,r,1/o),s.forEach(i=>{n=Math.max(n,zh.squaredDistance(r,i))}),n=Math.sqrt(n)}return t=[r,n],cs.set(e,t),t},O4=e=>{let t=cs.get(e);if(t!==void 0)return t;const r=Jt.create();let n=0;const s=Vh.toSides(e);if(s.length>0){let o=0;const a=Jt.create();s.forEach(i=>{Jt.add(r,r,Jt.fromVec2(a,i[0],0)),o++}),Jt.scale(r,r,1/o),s.forEach(i=>{n=Math.max(n,zh.squaredDistance(r,i[0]))}),n=Math.sqrt(n)}return t=[r,n],cs.set(e,t),t},R4=e=>{let t=cs.get(e);if(t!==void 0)return t;const r=Jt.create();let n=0;const s=Uh.toPolygons(e);if(s.length>0){let o=0;s.forEach(a=>{pu.toPoints(a).forEach(i=>{Jt.add(r,r,i),o++})}),Jt.scale(r,r,1/o),s.forEach(a=>{pu.toPoints(a).forEach(i=>{n=Math.max(n,Jt.squaredDistance(r,i))})}),n=Math.sqrt(n)}return t=[r,n],cs.set(e,t),t},L4=(...e)=>{e=C4(e);const t=e.map(r=>qh.isA(r)?M4(r):Vh.isA(r)?O4(r):Uh.isA(r)?R4(r):[[0,0,0],0]);return t.length===1?t[0]:t};var F4=L4;const G4=Ze,N4=Cn,D4=(...e)=>{e=G4(e);const t=e.map(r=>{const n=N4(r);return[n[0][0]+(n[1][0]-n[0][0])/2,n[0][1]+(n[1][1]-n[0][1])/2,n[0][2]+(n[1][2]-n[0][2])/2]});return t.length===1?t[0]:t};var k4=D4;const B4=Ze,Tr=ze,Xh=Je,jh=et,da=new WeakMap,I4=e=>{let t=da.get(e);if(t!==void 0)return t;const r=Xh.toSides(e);let n=0,s=0,o=0;if(r.length>0){for(let i=0;i<r.length;i++){const c=r[i][0],l=r[i][1],u=c[0]*l[1]-c[1]*l[0];n+=u,s+=(c[0]+l[0])*u,o+=(c[1]+l[1])*u}n/=2;const a=1/(n*6);s*=a,o*=a}return t=Tr.fromValues(s,o,0),da.set(e,t),t},z4=e=>{let t=da.get(e);if(t!==void 0)return t;t=Tr.create();const r=jh.toPolygons(e);if(r.length===0)return t;let n=0;const s=Tr.create();return r.forEach(o=>{const a=o.vertices;for(let i=0;i<a.length-2;i++){Tr.cross(s,a[i+1],a[i+2]);const c=Tr.dot(a[0],s)/6;n+=c,Tr.add(s,a[0],a[i+1]),Tr.add(s,s,a[i+2]);const l=Tr.scale(s,s,1/4*c);Tr.add(t,t,l)}}),Tr.scale(t,t,1/n),da.set(e,t),t},V4=(...e)=>{e=B4(e);const t=e.map(r=>Xh.isA(r)?I4(r):jh.isA(r)?z4(r):[0,0,0]);return t.length===1?t[0]:t};var U4=V4;const q4=Ze,X4=Cn,j4=(...e)=>{e=q4(e);const t=e.map(r=>{const n=X4(r);return[n[1][0]-n[0][0],n[1][1]-n[0][1],n[1][2]-n[0][2]]});return t.length===1?t[0]:t};var H4=j4;const Y4=Ze,{geom2:Z4,geom3:W4,path2:Q4}=dl,gl=kh,yl=Cn,K4=e=>gl(yl(e),2),J4=e=>gl(yl(e),2),eT=e=>gl(yl(e),3),tT=(...e)=>{if(e=Y4(e),e.length===0)throw new Error("wrong number of arguments");const t=e.map(r=>Q4.isA(r)?K4(r):Z4.isA(r)?J4(r):W4.isA(r)?eT(r):0);return t.length===1?t[0]:t};var rn=tT,rT={measureAggregateArea:WA,measureAggregateBoundingBox:vl,measureAggregateEpsilon:v4,measureAggregateVolume:P4,measureArea:Fh,measureBoundingBox:Cn,measureBoundingSphere:F4,measureCenter:k4,measureCenterOfMass:U4,measureDimensions:H4,measureEpsilon:rn,measureVolume:Ih};const nT=(e,t)=>Array.isArray(e)&&e.length>=t?e.every(r=>Number.isFinite(r)):!1,sT=(e,t)=>Number.isFinite(e)&&e>t,oT=(e,t)=>Number.isFinite(e)&&e>=t;var Gt={isNumberArray:nT,isGT:sT,isGTE:oT};const{EPS:vu,TAU:Yn}=it,Lr=rt,aT=lt,{isGT:iT,isGTE:Ki,isNumberArray:cT}=Gt,lT=e=>{const t={center:[0,0],radius:1,startAngle:0,endAngle:Yn,makeTangent:!1,segments:32};let{center:r,radius:n,startAngle:s,endAngle:o,makeTangent:a,segments:i}=Object.assign({},t,e);if(!cT(r,2))throw new Error("center must be an array of X and Y values");if(!iT(n,0))throw new Error("radius must be greater than zero");if(!Ki(s,0))throw new Error("startAngle must be positive");if(!Ki(o,0))throw new Error("endAngle must be positive");if(!Ki(i,4))throw new Error("segments must be four or more");s=s%Yn,o=o%Yn;let c=Yn;s<o&&(c=o-s),s>o&&(c=o+(Yn-s));const l=Math.acos((n*n+n*n-vu*vu)/(2*n*n)),u=Lr.clone(r);let d;const h=[];if(c<l)d=Lr.fromAngleRadians(Lr.create(),s),Lr.scale(d,d,n),Lr.add(d,d,u),h.push(d);else{const p=Math.max(1,Math.floor(i*(c/Yn)))+1;let E=p*.5/c;E>.25&&(E=.25);const g=a?p+2:p;for(let b=0;b<=g;b++){let P=b;a&&(P=(b-1)*(p-2*E)/p+E,P<0&&(P=0),P>p&&(P=p));const F=s+P*(c/p);d=Lr.fromAngleRadians(Lr.create(),F),Lr.scale(d,d,n),Lr.add(d,d,u),h.push(d)}}return aT.fromPoints({closed:!1},h)};var fT=lT;const{EPS:gu,TAU:jr}=it,Ji=rt,uT=Je,{sin:dT,cos:hT}=Ut,{isGTE:ec,isNumberArray:yu}=Gt,mT=e=>{const t={center:[0,0],radius:[1,1],startAngle:0,endAngle:jr,segments:32};let{center:r,radius:n,startAngle:s,endAngle:o,segments:a}=Object.assign({},t,e);if(!yu(r,2))throw new Error("center must be an array of X and Y values");if(!yu(n,2))throw new Error("radius must be an array of X and Y values");if(!n.every(p=>p>0))throw new Error("radius values must be greater than zero");if(!ec(s,0))throw new Error("startAngle must be positive");if(!ec(o,0))throw new Error("endAngle must be positive");if(!ec(a,3))throw new Error("segments must be three or more");s=s%jr,o=o%jr;let i=jr;s<o&&(i=o-s),s>o&&(i=o+(jr-s));const c=Math.min(n[0],n[1]),l=Math.acos((c*c+c*c-gu*gu)/(2*c*c));if(i<l)throw new Error("startAngle and endAngle do not define a significant rotation");a=Math.floor(a*(i/jr));const u=Ji.clone(r),d=i/a,h=[];a=i<jr?a+1:a;for(let p=0;p<a;p++){const E=d*p+s,g=Ji.fromValues(n[0]*hT(E),n[1]*dT(E));Ji.add(g,u,g),h.push(g)}return i<jr&&h.push(u),uT.fromPoints(h)};var Hh=mT;const{TAU:pT}=it,vT=Hh,{isGT:gT}=Gt,yT=e=>{const t={center:[0,0],radius:1,startAngle:0,endAngle:pT,segments:32};let{center:r,radius:n,startAngle:s,endAngle:o,segments:a}=Object.assign({},t,e);if(!gT(n,0))throw new Error("radius must be greater than zero");return n=[n,n],vT({center:r,radius:n,startAngle:s,endAngle:o,segments:a})};var Yh=yT;const bT=et,wT=st,{isNumberArray:bu}=Gt,_T=e=>{const t={center:[0,0,0],size:[2,2,2]},{center:r,size:n}=Object.assign({},t,e);if(!bu(r,3))throw new Error("center must be an array of X, Y and Z values");if(!bu(n,3))throw new Error("size must be an array of width, depth and height values");if(!n.every(o=>o>0))throw new Error("size values must be greater than zero");return bT.create([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(o=>{const a=o[0].map(i=>[r[0]+n[0]/2*(2*!!(i&1)-1),r[1]+n[1]/2*(2*!!(i&2)-1),r[2]+n[2]/2*(2*!!(i&4)-1)]);return wT.create(a)}))};var Zh=_T;const xT=Zh,{isGT:ET}=Gt,$T=e=>{const t={center:[0,0,0],size:2};let{center:r,size:n}=Object.assign({},t,e);if(!ET(n,0))throw new Error("size must be greater than zero");return n=[n,n,n],xT({center:r,size:n})};var AT=$T;const{EPS:wu,TAU:Hr}=it,zt=ze,TT=et,ST=st,{sin:PT,cos:CT}=Ut,{isGT:MT,isGTE:tc,isNumberArray:rc}=Gt,OT=e=>{const t={center:[0,0,0],height:2,startRadius:[1,1],startAngle:0,endRadius:[1,1],endAngle:Hr,segments:32};let{center:r,height:n,startRadius:s,startAngle:o,endRadius:a,endAngle:i,segments:c}=Object.assign({},t,e);if(!rc(r,3))throw new Error("center must be an array of X, Y and Z values");if(!MT(n,0))throw new Error("height must be greater then zero");if(!rc(s,2))throw new Error("startRadius must be an array of X and Y values");if(!s.every(oe=>oe>=0))throw new Error("startRadius values must be positive");if(!rc(a,2))throw new Error("endRadius must be an array of X and Y values");if(!a.every(oe=>oe>=0))throw new Error("endRadius values must be positive");if(a.every(oe=>oe===0)&&s.every(oe=>oe===0))throw new Error("at least one radius must be positive");if(!tc(o,0))throw new Error("startAngle must be positive");if(!tc(i,0))throw new Error("endAngle must be positive");if(!tc(c,4))throw new Error("segments must be four or more");o=o%Hr,i=i%Hr;let l=Hr;o<i&&(l=i-o),o>i&&(l=i+(Hr-o));const u=Math.min(s[0],s[1],a[0],a[1]),d=Math.acos((u*u+u*u-wu*wu)/(2*u*u));if(l<d)throw new Error("startAngle and endAngle do not define a significant rotation");const h=Math.floor(c*(l/Hr)),p=zt.fromValues(0,0,-(n/2)),E=zt.fromValues(0,0,n/2),g=zt.subtract(zt.create(),E,p),b=zt.fromValues(1,0,0),P=zt.fromValues(0,1,0),F=zt.create(),R=zt.create(),M=zt.create(),G=(oe,pe,Q)=>{const Se=pe*l+o;return zt.scale(F,b,Q[0]*CT(Se)),zt.scale(R,P,Q[1]*PT(Se)),zt.add(F,F,R),zt.scale(M,g,oe),zt.add(M,M,p),zt.add(zt.create(),F,M)},L=(...oe)=>{const pe=oe.map(Q=>zt.add(zt.create(),Q,r));return ST.create(pe)},U=[];for(let oe=0;oe<h;oe++){const pe=oe/h;let Q=(oe+1)/h;l===Hr&&oe===h-1&&(Q=0),a[0]===s[0]&&a[1]===s[1]?(U.push(L(p,G(0,Q,a),G(0,pe,a))),U.push(L(G(0,Q,a),G(1,Q,a),G(1,pe,a),G(0,pe,a))),U.push(L(E,G(1,pe,a),G(1,Q,a)))):(s[0]>0&&s[1]>0&&U.push(L(p,G(0,Q,s),G(0,pe,s))),(s[0]>0||s[1]>0)&&U.push(L(G(0,pe,s),G(0,Q,s),G(1,pe,a))),a[0]>0&&a[1]>0&&U.push(L(E,G(1,pe,a),G(1,Q,a))),(a[0]>0||a[1]>0)&&U.push(L(G(1,pe,a),G(0,Q,s),G(1,Q,a))))}return l<Hr&&(U.push(L(p,G(0,0,s),E)),U.push(L(G(0,0,s),G(1,0,a),E)),U.push(L(p,E,G(0,1,s))),U.push(L(G(0,1,s),E,G(1,1,a)))),TT.create(U)};var Wh=OT;const RT=Wh,{isGT:LT}=Gt,FT=e=>{const t={center:[0,0,0],height:2,radius:1,segments:32},{center:r,height:n,radius:s,segments:o}=Object.assign({},t,e);if(!LT(s,0))throw new Error("radius must be greater than zero");return RT({center:r,height:n,startRadius:[s,s],endRadius:[s,s],segments:o})};var GT=FT;const{TAU:_u}=it,Ve=ze,NT=et,xu=st,{sin:Eu,cos:$u}=Ut,{isGTE:DT,isNumberArray:Au}=Gt,kT=e=>{const t={center:[0,0,0],radius:[1,1,1],segments:32,axes:[[1,0,0],[0,-1,0],[0,0,1]]},{center:r,radius:n,segments:s,axes:o}=Object.assign({},t,e);if(!Au(r,3))throw new Error("center must be an array of X, Y and Z values");if(!Au(n,3))throw new Error("radius must be an array of X, Y and Z values");if(!n.every(E=>E>0))throw new Error("radius values must be greater than zero");if(!DT(s,4))throw new Error("segments must be four or more");const a=Ve.scale(Ve.create(),Ve.normalize(Ve.create(),o[0]),n[0]),i=Ve.scale(Ve.create(),Ve.normalize(Ve.create(),o[1]),n[1]),c=Ve.scale(Ve.create(),Ve.normalize(Ve.create(),o[2]),n[2]),l=Math.round(s/4);let u;const d=[],h=Ve.create(),p=Ve.create();for(let E=0;E<=s;E++){const g=_u*E/s,b=Ve.add(Ve.create(),Ve.scale(h,a,$u(g)),Ve.scale(p,i,Eu(g)));if(E>0){let P,F;for(let R=0;R<=l;R++){const M=_u/4*R/l,G=$u(M),L=Eu(M);if(R>0){let U=[],ee;ee=Ve.subtract(Ve.create(),Ve.scale(h,u,P),Ve.scale(p,c,F)),U.push(Ve.add(ee,ee,r)),ee=Ve.subtract(Ve.create(),Ve.scale(h,b,P),Ve.scale(p,c,F)),U.push(Ve.add(ee,ee,r)),R<l&&(ee=Ve.subtract(Ve.create(),Ve.scale(h,b,G),Ve.scale(p,c,L)),U.push(Ve.add(ee,ee,r))),ee=Ve.subtract(Ve.create(),Ve.scale(h,u,G),Ve.scale(p,c,L)),U.push(Ve.add(ee,ee,r)),d.push(xu.create(U)),U=[],ee=Ve.add(Ve.create(),Ve.scale(h,u,P),Ve.scale(p,c,F)),U.push(Ve.add(Ve.create(),r,ee)),ee=Ve.add(ee,Ve.scale(h,b,P),Ve.scale(p,c,F)),U.push(Ve.add(Ve.create(),r,ee)),R<l&&(ee=Ve.add(ee,Ve.scale(h,b,G),Ve.scale(p,c,L)),U.push(Ve.add(Ve.create(),r,ee))),ee=Ve.add(ee,Ve.scale(h,u,G),Ve.scale(p,c,L)),U.push(Ve.add(Ve.create(),r,ee)),U.reverse(),d.push(xu.create(U))}P=G,F=L}}u=b}return NT.create(d)};var Qh=kT;const BT=et,IT=st,{isNumberArray:Tu}=Gt,zT=e=>{const t={points:[],faces:[],colors:void 0,orientation:"outward"},{points:r,faces:n,colors:s,orientation:o}=Object.assign({},t,e);if(!(Array.isArray(r)&&Array.isArray(n)))throw new Error("points and faces must be arrays");if(r.length<3)throw new Error("three or more points are required");if(n.length<1)throw new Error("one or more faces are required");if(s){if(!Array.isArray(s))throw new Error("colors must be an array");if(s.length!==n.length)throw new Error("faces and colors must have the same length")}r.forEach((i,c)=>{if(!Tu(i,3))throw new Error(`point ${c} must be an array of X, Y, Z values`)}),n.forEach((i,c)=>{if(i.length<3)throw new Error(`face ${c} must contain 3 or more indexes`);if(!Tu(i,i.length))throw new Error(`face ${c} must be an array of numbers`)}),o!=="outward"&&n.forEach(i=>i.reverse());const a=n.map((i,c)=>{const l=IT.create(i.map(u=>r[u]));return s&&s[c]&&(l.color=s[c]),l});return BT.create(a)};var Kh=zT;const Su=dt,Pu=ze,VT=et,UT=Kh,{isGT:qT,isGTE:XT}=Gt,jT=e=>{const t={radius:1,frequency:6};let{radius:r,frequency:n}=Object.assign({},t,e);if(!qT(r,0))throw new Error("radius must be greater than zero");if(!XT(n,6))throw new Error("frequency must be six or more");n=Math.floor(n/6);const s=[[.850651,0,-.525731],[.850651,-0,.525731],[-.850651,-0,.525731],[-.850651,0,-.525731],[0,-.525731,.850651],[0,.525731,.850651],[0,.525731,-.850651],[0,-.525731,-.850651],[-.525731,-.850651,-0],[.525731,-.850651,-0],[.525731,.850651,0],[-.525731,.850651,0]],o=[[0,9,1],[1,10,0],[6,7,0],[10,6,0],[7,9,0],[5,1,4],[4,1,9],[5,10,1],[2,8,3],[3,11,2],[2,5,4],[4,8,2],[2,11,5],[3,7,6],[6,11,3],[8,7,3],[9,8,4],[11,10,5],[10,11,6],[8,9,7]],a=(h,p,E)=>{const g=h[0],b=h[1],P=h[2];let F=E;const R=[],M=[];for(let G=0;G<p;G++)for(let L=0;L<p-G;L++){const U=G/p,ee=(G+1)/p,oe=L/(p-G),pe=(L+1)/(p-G),Q=p-G-1?L/(p-G-1):1,Se=[];Se[0]=i(i(g,b,oe),P,U),Se[1]=i(i(g,b,pe),P,U),Se[2]=i(i(g,b,Q),P,ee);for(let qe=0;qe<3;qe++){const $e=Pu.length(Se[qe]);for(let Xe=0;Xe<3;Xe++)Se[qe][Xe]/=$e}if(R.push(Se[0],Se[1],Se[2]),M.push([F,F+1,F+2]),F+=3,L<p-G-1){const qe=p-G-1?(L+1)/(p-G-1):1;Se[0]=i(i(g,b,pe),P,U),Se[1]=i(i(g,b,qe),P,ee),Se[2]=i(i(g,b,Q),P,ee);for(let $e=0;$e<3;$e++){const Xe=Pu.length(Se[$e]);for(let Ne=0;Ne<3;Ne++)Se[$e][Ne]/=Xe}R.push(Se[0],Se[1],Se[2]),M.push([F,F+1,F+2]),F+=3}}return{points:R,triangles:M,offset:F}},i=(h,p,E)=>{const g=1-E,b=[];for(let P=0;P<3;P++)b[P]=h[P]*g+p[P]*E;return b};let c=[],l=[],u=0;for(let h=0;h<o.length;h++){const p=a([s[o[h][0]],s[o[h][1]],s[o[h][2]]],n,u);c=c.concat(p.points),l=l.concat(p.triangles),u=p.offset}let d=UT({points:c,faces:l,orientation:"inward"});return r!==1&&(d=VT.transform(Su.fromScaling(Su.create(),[r,r,r]),d)),d};var HT=jT;const YT=lt,ZT=e=>{if(!Array.isArray(e))throw new Error("points must be an array");return YT.fromPoints({},e)};var WT=ZT;const nc=Je,QT=e=>{const t={points:[],paths:[]},{points:r,paths:n}=Object.assign({},t,e);if(!(Array.isArray(r)&&Array.isArray(n)))throw new Error("points and paths must be arrays");let s=r;Array.isArray(r[0])&&(Array.isArray(r[0][0])||(s=[r])),s.forEach((c,l)=>{if(!Array.isArray(c))throw new Error("list of points "+l+" must be an array");if(c.length<3)throw new Error("list of points "+l+" must contain three or more points");c.forEach((u,d)=>{if(!Array.isArray(u))throw new Error("list of points "+l+", point "+d+" must be an array");if(u.length<2)throw new Error("list of points "+l+", point "+d+" must contain by X and Y values")})});let o=n;if(n.length===0){let c=0;o=s.map(l=>l.map(u=>c++))}const a=[];s.forEach(c=>c.forEach(l=>a.push(l)));let i=[];return o.forEach(c=>{const l=c.map(d=>a[d]),u=nc.fromPoints(l);i=i.concat(nc.toSides(u))}),nc.create(i)};var KT=QT;const Yr=rt,JT=Je,{isNumberArray:Cu}=Gt,eS=e=>{const t={center:[0,0],size:[2,2]},{center:r,size:n}=Object.assign({},t,e);if(!Cu(r,2))throw new Error("center must be an array of X and Y values");if(!Cu(n,2))throw new Error("size must be an array of X and Y values");if(!n.every(i=>i>0))throw new Error("size values must be greater than zero");const s=[n[0]/2,n[1]/2],o=[s[0],-s[1]],a=[Yr.subtract(Yr.create(),r,s),Yr.add(Yr.create(),r,o),Yr.add(Yr.create(),r,s),Yr.subtract(Yr.create(),r,o)];return JT.fromPoints(a)};var Jh=eS;const{EPS:ca,TAU:Ns}=it,sc=rt,Pt=ze,tS=et,ls=st,{sin:rS,cos:nS}=Ut,{isGT:sS,isGTE:oS,isNumberArray:Mu}=Gt,Ou=(e,t,r,n,s,o)=>{const a=Ns/4*s/n,i=nS(a),c=rS(a),l=n-s;let u=r*i,d=t[2]-(r-r*c);o||(d=r-r*c-t[2]),u=u>ca?u:0;const h=Pt.add(Pt.create(),e,[t[0]-r,t[1]-r,d]),p=Pt.add(Pt.create(),e,[r-t[0],t[1]-r,d]),E=Pt.add(Pt.create(),e,[r-t[0],r-t[1],d]),g=Pt.add(Pt.create(),e,[t[0]-r,r-t[1],d]),b=[],P=[],F=[],R=[];for(let M=0;M<=l;M++){const G=l>0?Ns/4*M/l:0,L=sc.fromAngleRadians(sc.create(),G);sc.scale(L,L,u);const U=Pt.fromVec2(Pt.create(),L);b.push(Pt.add(Pt.create(),h,U)),Pt.rotateZ(U,U,[0,0,0],Ns/4),P.push(Pt.add(Pt.create(),p,U)),Pt.rotateZ(U,U,[0,0,0],Ns/4),F.push(Pt.add(Pt.create(),E,U)),Pt.rotateZ(U,U,[0,0,0],Ns/4),R.push(Pt.add(Pt.create(),g,U))}return o?[b,P,F,R]:(b.reverse(),P.reverse(),F.reverse(),R.reverse(),[R,F,P,b])},Ru=(e,t)=>{const r=[];for(let n=0;n<e.length;n++){const s=e[n],o=t[n];for(let a=0;a<s.length-1;a++)r.push(ls.create([s[a],s[a+1],o[a]])),a<o.length-1&&r.push(ls.create([o[a],s[a+1],o[a+1]]))}return r},Lu=(e,t)=>{const r=[];for(let n=0;n<e.length;n++){let s=e[n],o=t[n];const a=s[s.length-1],i=o[o.length-1],c=(n+1)%e.length;s=e[c],o=t[c];const l=s[0],u=o[0];r.push(ls.create([a,l,u,i]))}return r},aS=(e,t)=>{e=[e[3],e[2],e[1],e[0]],e=e.map(o=>o.slice().reverse());const r=[];e.forEach(o=>{o.forEach(a=>r.push(a))});const n=[];t.forEach(o=>{o.forEach(a=>n.push(a))});const s=[];for(let o=0;o<n.length;o++){const a=(o+1)%n.length;s.push(ls.create([r[o],r[a],n[a],n[o]]))}return s},iS=e=>{const t={center:[0,0,0],size:[2,2,2],roundRadius:.2,segments:32};let{center:r,size:n,roundRadius:s,segments:o}=Object.assign({},t,e);if(!Mu(r,3))throw new Error("center must be an array of X, Y and Z values");if(!Mu(n,3))throw new Error("size must be an array of X, Y and Z values");if(!n.every(l=>l>0))throw new Error("size values must be greater than zero");if(!sS(s,0))throw new Error("roundRadius must be greater than zero");if(!oS(o,4))throw new Error("segments must be four or more");if(n=n.map(l=>l/2),s>n[0]-ca||s>n[1]-ca||s>n[2]-ca)throw new Error("roundRadius must be smaller then the radius of all dimensions");o=Math.floor(o/4);let a=null,i=null,c=[];for(let l=0;l<=o;l++){const u=Ou(r,n,s,o,l,!0),d=Ou(r,n,s,o,l,!1);if(l===0&&(c=c.concat(aS(d,u))),a&&(c=c.concat(Ru(a,u),Lu(a,u))),i&&(c=c.concat(Ru(i,d),Lu(i,d))),l===o){let h=u.map(p=>p[0]);c.push(ls.create(h)),h=d.map(p=>p[0]),c.push(ls.create(h))}a=u,i=d}return tS.create(c)};var cS=iS;const{EPS:Fu,TAU:Gu}=it,Re=ze,lS=et,fS=st,{sin:Nu,cos:Du}=Ut,{isGT:oc,isGTE:uS,isNumberArray:dS}=Gt,hS=e=>{const t={center:[0,0,0],height:2,radius:1,roundRadius:.2,segments:32},{center:r,height:n,radius:s,roundRadius:o,segments:a}=Object.assign({},t,e);if(!dS(r,3))throw new Error("center must be an array of X, Y and Z values");if(!oc(n,0))throw new Error("height must be greater then zero");if(!oc(s,0))throw new Error("radius must be greater then zero");if(!oc(o,0))throw new Error("roundRadius must be greater then zero");if(o>s-Fu)throw new Error("roundRadius must be smaller then the radius");if(!uS(a,4))throw new Error("segments must be four or more");const i=[0,0,-(n/2)],c=[0,0,n/2],l=Re.subtract(Re.create(),c,i),u=Re.length(l);if(2*o>u-Fu)throw new Error("height must be larger than twice roundRadius");let d;Math.abs(l[0])>Math.abs(l[1])?d=Re.fromValues(0,1,0):d=Re.fromValues(1,0,0);const h=Re.scale(Re.create(),Re.normalize(Re.create(),l),o),p=Re.scale(Re.create(),Re.normalize(Re.create(),Re.cross(Re.create(),h,d)),s),E=Re.scale(Re.create(),Re.normalize(Re.create(),Re.cross(Re.create(),p,h)),s);Re.add(i,i,h),Re.subtract(c,c,h);const g=Math.floor(.25*a),b=L=>{const U=L.map(ee=>Re.add(ee,ee,r));return fS.create(U)},P=[],F=Re.create(),R=Re.create();let M;for(let L=0;L<=a;L++){const U=Gu*L/a,ee=Re.add(Re.create(),Re.scale(F,p,Du(U)),Re.scale(R,E,Nu(U)));if(L>0){let oe=[];oe.push(Re.add(Re.create(),i,ee)),oe.push(Re.add(Re.create(),i,M)),oe.push(Re.add(Re.create(),c,M)),oe.push(Re.add(Re.create(),c,ee)),P.push(b(oe));let pe,Q;for(let Se=0;Se<=g;Se++){const qe=Gu/4*Se/g,$e=Du(qe),Xe=Nu(qe);if(Se>0){oe=[];let Ne;Ne=Re.add(Re.create(),i,Re.subtract(F,Re.scale(F,M,pe),Re.scale(R,h,Q))),oe.push(Ne),Ne=Re.add(Re.create(),i,Re.subtract(F,Re.scale(F,ee,pe),Re.scale(R,h,Q))),oe.push(Ne),Se<g&&(Ne=Re.add(Re.create(),i,Re.subtract(F,Re.scale(F,ee,$e),Re.scale(R,h,Xe))),oe.push(Ne)),Ne=Re.add(Re.create(),i,Re.subtract(F,Re.scale(F,M,$e),Re.scale(R,h,Xe))),oe.push(Ne),P.push(b(oe)),oe=[],Ne=Re.add(Re.create(),Re.scale(F,M,pe),Re.scale(R,h,Q)),Re.add(Ne,Ne,c),oe.push(Ne),Ne=Re.add(Re.create(),Re.scale(F,ee,pe),Re.scale(R,h,Q)),Re.add(Ne,Ne,c),oe.push(Ne),Se<g&&(Ne=Re.add(Re.create(),Re.scale(F,ee,$e),Re.scale(R,h,Xe)),Re.add(Ne,Ne,c),oe.push(Ne)),Ne=Re.add(Re.create(),Re.scale(F,M,$e),Re.scale(R,h,Xe)),Re.add(Ne,Ne,c),oe.push(Ne),oe.reverse(),P.push(b(oe))}pe=$e,Q=Xe}}M=ee}return lS.create(P)};var mS=hS;const{EPS:ku,TAU:Vo}=it,vt=rt,pS=Je,{isGT:vS,isGTE:gS,isNumberArray:Bu}=Gt,yS=e=>{const t={center:[0,0],size:[2,2],roundRadius:.2,segments:32};let{center:r,size:n,roundRadius:s,segments:o}=Object.assign({},t,e);if(!Bu(r,2))throw new Error("center must be an array of X and Y values");if(!Bu(n,2))throw new Error("size must be an array of X and Y values");if(!n.every(g=>g>0))throw new Error("size values must be greater than zero");if(!vS(s,0))throw new Error("roundRadius must be greater than zero");if(!gS(o,4))throw new Error("segments must be four or more");if(n=n.map(g=>g/2),s>n[0]-ku||s>n[1]-ku)throw new Error("roundRadius must be smaller then the radius of all dimensions");const a=Math.floor(o/4),i=vt.add(vt.create(),r,[n[0]-s,n[1]-s]),c=vt.add(vt.create(),r,[s-n[0],n[1]-s]),l=vt.add(vt.create(),r,[s-n[0],s-n[1]]),u=vt.add(vt.create(),r,[n[0]-s,s-n[1]]),d=[],h=[],p=[],E=[];for(let g=0;g<=a;g++){const b=Vo/4*g/a,P=vt.fromAngleRadians(vt.create(),b);vt.scale(P,P,s),d.push(vt.add(vt.create(),i,P)),vt.rotate(P,P,vt.create(),Vo/4),h.push(vt.add(vt.create(),c,P)),vt.rotate(P,P,vt.create(),Vo/4),p.push(vt.add(vt.create(),l,P)),vt.rotate(P,P,vt.create(),Vo/4),E.push(vt.add(vt.create(),u,P))}return pS.fromPoints(d.concat(h,p,E))};var bS=yS;const wS=Qh,{isGT:_S}=Gt,xS=e=>{const t={center:[0,0,0],radius:1,segments:32,axes:[[1,0,0],[0,-1,0],[0,0,1]]};let{center:r,radius:n,segments:s,axes:o}=Object.assign({},t,e);if(!_S(n,0))throw new Error("radius must be greater than zero");return n=[n,n,n],wS({center:r,radius:n,segments:s,axes:o})};var em=xS;const ES=Jh,{isGT:$S}=Gt,AS=e=>{const t={center:[0,0],size:2};let{center:r,size:n}=Object.assign({},t,e);if(!$S(n,0))throw new Error("size must be greater than zero");return n=[n,n],ES({center:r,size:n})};var TS=AS;const{TAU:tm}=it,qs=rt,SS=Je,{isGT:PS,isGTE:Uo,isNumberArray:CS}=Gt,MS=(e,t)=>e>0&&t>1&&t<e/2?Math.cos(Math.PI*t/e)/Math.cos(Math.PI*(t-1)/e):0,Iu=(e,t,r,n)=>{const s=tm/e,o=[];for(let a=0;a<e;a++){const i=qs.fromAngleRadians(qs.create(),s*a+r);qs.scale(i,i,t),qs.add(i,n,i),o.push(i)}return o},OS=e=>{const t={center:[0,0],vertices:5,outerRadius:1,innerRadius:0,density:2,startAngle:0};let{center:r,vertices:n,outerRadius:s,innerRadius:o,density:a,startAngle:i}=Object.assign({},t,e);if(!CS(r,2))throw new Error("center must be an array of X and Y values");if(!Uo(n,2))throw new Error("vertices must be two or more");if(!PS(s,0))throw new Error("outerRadius must be greater than zero");if(!Uo(o,0))throw new Error("innerRadius must be greater than zero");if(!Uo(i,0))throw new Error("startAngle must be greater than zero");if(n=Math.floor(n),a=Math.floor(a),i=i%tm,o===0){if(!Uo(a,2))throw new Error("density must be two or more");o=s*MS(n,a)}const c=qs.clone(r),l=Iu(n,s,i,c),u=Iu(n,o,i+Math.PI/n,c),d=[];for(let h=0;h<n;h++)d.push(l[h]),d.push(u[h]);return SS.fromPoints(d)};var RS=OS;const LS=Ze,zu=dt,Vu=Pr,Uu=Je,qu=et,Xu=lt,Oa=(e,...t)=>{const r={origin:[0,0,0],normal:[0,0,1]},{origin:n,normal:s}=Object.assign({},r,e);if(t=LS(t),t.length===0)throw new Error("wrong number of arguments");const o=Vu.fromNormalAndPoint(Vu.create(),s,n);if(Number.isNaN(o[0]))throw new Error("the given origin and normal do not define a proper plane");const a=zu.mirrorByPlane(zu.create(),o),i=t.map(c=>Xu.isA(c)?Xu.transform(a,c):Uu.isA(c)?Uu.transform(a,c):qu.isA(c)?qu.transform(a,c):c);return i.length===1?i[0]:i},FS=(...e)=>Oa({normal:[1,0,0]},e),GS=(...e)=>Oa({normal:[0,1,0]},e),NS=(...e)=>Oa({normal:[0,0,1]},e);var Xs={mirror:Oa,mirrorX:FS,mirrorY:GS,mirrorZ:NS};const ju=Pr,xn=ze,DS=e=>{const t=e.edges;if(t.length<3)throw new Error("slices must have 3 or more edges to calculate a plane");const r=t.reduce((a,i)=>xn.add(xn.create(),a,i[0]),xn.create());xn.scale(r,r,1/t.length);let n,s=0;t.forEach(a=>{if(!xn.equals(a[0],a[1])){const i=xn.squaredDistance(r,a[0]);i>s&&(n=a,s=i)}});const o=t.find(a=>xn.equals(a[1],n[0]));return ju.fromPoints(ju.create(),o[0],n[0],n[1])};var rm=DS;const kS=e=>(e||(e=[]),{edges:e});var Mn=kS;const BS=Mn,Hu=ze,IS=(...e)=>{let t,r;return e.length===1?(t=BS(),r=e[0]):(t=e[0],r=e[1]),t.edges=r.edges.map(n=>[Hu.clone(n[0]),Hu.clone(n[1])]),t};var zS=IS;const VS=ze,US=(e,t)=>{const r=e.edges,n=t.edges;return r.length!==n.length?!1:r.reduce((o,a,i)=>{const c=n[i],l=VS.squaredDistance(a[0],c[0]);return o&&l<Number.EPSILON},!0)};var qS=US;const qo=ze,XS=Mn,jS=e=>{if(!Array.isArray(e))throw new Error("the given points must be an array");if(e.length<3)throw new Error("the given points must contain THREE or more points");const t=[];let r=e[e.length-1];return e.forEach(n=>{n.length===2&&t.push([qo.fromVec2(qo.create(),r),qo.fromVec2(qo.create(),n)]),n.length===3&&t.push([r,n]),r=n}),XS(t)};var HS=jS;const Xo=ze,YS=Mn,ZS=e=>{if(!Array.isArray(e))throw new Error("the given sides must be an array");const t=[];return e.forEach(r=>{t.push([Xo.fromVec2(Xo.create(),r[0]),Xo.fromVec2(Xo.create(),r[1])])}),YS(t)};var WS=ZS;const QS=e=>!!(e&&typeof e=="object"&&"edges"in e&&Array.isArray(e.edges));var KS=QS;const JS=Mn,eP=(...e)=>{let t,r;return e.length===1?(t=JS(),r=e[0]):(t=e[0],r=e[1]),t.edges=r.edges.map(n=>[n[1],n[0]]),t};var tP=eP;const rP=e=>e.edges;var nP=rP;const sP=(e,t)=>{let r,n,s,o,a,i=1;do{n=e,e=null;let c=null;for(a=0;n;){a++,s=n;let l=0;for(r=0;r<i&&(l++,s=s.nextZ,!!s);r++);let u=i;for(;l>0||u>0&&s;)l!==0&&(u===0||!s||t(n)<=t(s))?(o=n,n=n.nextZ,l--):(o=s,s=s.nextZ,u--),c?c.nextZ=o:e=o,o.prevZ=c,c=o;n=s}c.nextZ=null,i*=2}while(a>1);return e};var oP=sP;const aP=oP;class nm{constructor(t,r,n){this.i=t,this.x=r,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}}const iP=(e,t,r,n)=>{const s=new nm(e,t,r);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s},cP=e=>{e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)};var sm={Node:nm,insertNode:iP,removeNode:cP,sortLinked:aP};const lP=(e,t,r,n,s,o,a,i)=>(s-a)*(t-i)-(e-a)*(o-i)>=0&&(e-a)*(n-i)-(r-a)*(t-i)>=0&&(r-a)*(o-i)-(s-a)*(n-i)>=0,fP=(e,t,r)=>(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y);var bl={area:fP,pointInTriangle:lP};const{Node:Yu,insertNode:Zu,removeNode:ha}=sm,{area:er}=bl,uP=(e,t,r,n,s)=>{let o;if(s===gP(e,t,r,n)>0)for(let a=t;a<r;a+=n)o=Zu(a,e[a],e[a+1],o);else for(let a=r-n;a>=t;a-=n)o=Zu(a,e[a],e[a+1],o);return o&&Ra(o,o.next)&&(ha(o),o=o.next),o},om=(e,t)=>{if(!e)return e;t||(t=e);let r=e,n;do if(n=!1,!r.steiner&&(Ra(r,r.next)||er(r.prev,r,r.next)===0)){if(ha(r),r=t=r.prev,r===r.next)break;n=!0}else r=r.next;while(n||r!==t);return t},dP=(e,t,r)=>{let n=e;do{const s=n.prev,o=n.next.next;!Ra(s,o)&&am(s,n,n.next,o)&&Zs(s,o)&&Zs(o,s)&&(t.push(s.i/r),t.push(n.i/r),t.push(o.i/r),ha(n),ha(n.next),n=e=o),n=n.next}while(n!==e);return om(n)},hP=(e,t)=>{let r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&am(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1},Zs=(e,t)=>er(e.prev,e,e.next)<0?er(e,t,e.next)>=0&&er(e,e.prev,t)>=0:er(e,t,e.prev)<0||er(e,e.next,t)<0,mP=(e,t)=>{let r=e,n=!1;const s=(e.x+t.x)/2,o=(e.y+t.y)/2;do r.y>o!=r.next.y>o&&r.next.y!==r.y&&s<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==e);return n},pP=(e,t)=>{const r=new Yu(e.i,e.x,e.y),n=new Yu(t.i,t.x,t.y),s=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=s,s.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n},vP=(e,t)=>e.next.i!==t.i&&e.prev.i!==t.i&&!hP(e,t)&&(Zs(e,t)&&Zs(t,e)&&mP(e,t)&&(er(e.prev,e,t.prev)||er(e,t.prev,t))||Ra(e,t)&&er(e.prev,e,e.next)>0&&er(t.prev,t,t.next)>0),am=(e,t,r,n)=>{const s=Math.sign(er(e,t,r)),o=Math.sign(er(e,t,n)),a=Math.sign(er(r,n,e)),i=Math.sign(er(r,n,t));return!!(s!==o&&a!==i||s===0&&jo(e,r,t)||o===0&&jo(e,n,t)||a===0&&jo(r,e,n)||i===0&&jo(r,t,n))},jo=(e,t,r)=>t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y),gP=(e,t,r,n)=>{let s=0;for(let o=t,a=r-n;o<r;o+=n)s+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return s},Ra=(e,t)=>e.x===t.x&&e.y===t.y;var im={cureLocalIntersections:dP,filterPoints:om,isValidDiagonal:vP,linkedPolygon:uP,locallyInside:Zs,splitPolygon:pP};const{filterPoints:Zc,linkedPolygon:yP,locallyInside:bP,splitPolygon:wP}=im,{area:Wu,pointInTriangle:_P}=bl,xP=(e,t,r,n)=>{const s=[];for(let o=0,a=t.length;o<a;o++){const i=t[o]*n,c=o<a-1?t[o+1]*n:e.length,l=yP(e,i,c,n,!1);l===l.next&&(l.steiner=!0),s.push(TP(l))}s.sort((o,a)=>o.x-a.x);for(let o=0;o<s.length;o++)r=EP(s[o],r),r=Zc(r,r.next);return r},EP=(e,t)=>{const r=$P(e,t);if(!r)return t;const n=wP(r,e),s=Zc(r,r.next);return Zc(n,n.next),t===r?s:t},$P=(e,t)=>{let r=t;const n=e.x,s=e.y;let o=-1/0,a;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){const d=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(d<=n&&d>o){if(o=d,d===n){if(s===r.y)return r;if(s===r.next.y)return r.next}a=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!a)return null;if(n===o)return a;const i=a,c=a.x,l=a.y;let u=1/0;r=a;do{if(n>=r.x&&r.x>=c&&n!==r.x&&_P(s<l?n:o,s,c,l,s<l?o:n,s,r.x,r.y)){const d=Math.abs(s-r.y)/(n-r.x);bP(r,e)&&(d<u||d===u&&(r.x>a.x||r.x===a.x&&AP(a,r)))&&(a=r,u=d)}r=r.next}while(r!==i);return a},AP=(e,t)=>Wu(e.prev,e,t.prev)<0&&Wu(t.next,e,e.next)<0,TP=e=>{let t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r};var SP=xP;const PP=SP,{removeNode:CP,sortLinked:MP}=sm,{cureLocalIntersections:OP,filterPoints:ma,isValidDiagonal:RP,linkedPolygon:LP,splitPolygon:FP}=im,{area:$n,pointInTriangle:js}=bl,GP=(e,t,r=2)=>{const n=t&&t.length,s=n?t[0]*r:e.length;let o=LP(e,0,s,r,!0);const a=[];if(!o||o.next===o.prev)return a;let i,c,l,u,d;if(n&&(o=PP(e,t,o,r)),e.length>80*r){i=l=e[0],c=u=e[1];for(let h=r;h<s;h+=r){const p=e[h],E=e[h+1];p<i&&(i=p),E<c&&(c=E),p>l&&(l=p),E>u&&(u=E)}d=Math.max(l-i,u-c),d=d!==0?1/d:0}return Ws(o,a,r,i,c,d),a},Ws=(e,t,r,n,s,o,a)=>{if(!e)return;!a&&o&&BP(e,n,s,o);let i=e,c,l;for(;e.prev!==e.next;){if(c=e.prev,l=e.next,o?DP(e,n,s,o):NP(e)){t.push(c.i/r),t.push(e.i/r),t.push(l.i/r),CP(e),e=l.next,i=l.next;continue}if(e=l,e===i){a?a===1?(e=OP(ma(e),t,r),Ws(e,t,r,n,s,o,2)):a===2&&kP(e,t,r,n,s,o):Ws(ma(e),t,r,n,s,o,1);break}}},NP=e=>{const t=e.prev,r=e,n=e.next;if($n(t,r,n)>=0)return!1;let s=e.next.next;for(;s!==e.prev;){if(js(t.x,t.y,r.x,r.y,n.x,n.y,s.x,s.y)&&$n(s.prev,s,s.next)>=0)return!1;s=s.next}return!0},DP=(e,t,r,n)=>{const s=e.prev,o=e,a=e.next;if($n(s,o,a)>=0)return!1;const i=s.x<o.x?s.x<a.x?s.x:a.x:o.x<a.x?o.x:a.x,c=s.y<o.y?s.y<a.y?s.y:a.y:o.y<a.y?o.y:a.y,l=s.x>o.x?s.x>a.x?s.x:a.x:o.x>a.x?o.x:a.x,u=s.y>o.y?s.y>a.y?s.y:a.y:o.y>a.y?o.y:a.y,d=Wc(i,c,t,r,n),h=Wc(l,u,t,r,n);let p=e.prevZ,E=e.nextZ;for(;p&&p.z>=d&&E&&E.z<=h;){if(p!==e.prev&&p!==e.next&&js(s.x,s.y,o.x,o.y,a.x,a.y,p.x,p.y)&&$n(p.prev,p,p.next)>=0||(p=p.prevZ,E!==e.prev&&E!==e.next&&js(s.x,s.y,o.x,o.y,a.x,a.y,E.x,E.y)&&$n(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;p&&p.z>=d;){if(p!==e.prev&&p!==e.next&&js(s.x,s.y,o.x,o.y,a.x,a.y,p.x,p.y)&&$n(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;E&&E.z<=h;){if(E!==e.prev&&E!==e.next&&js(s.x,s.y,o.x,o.y,a.x,a.y,E.x,E.y)&&$n(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0},kP=(e,t,r,n,s,o)=>{let a=e;do{let i=a.next.next;for(;i!==a.prev;){if(a.i!==i.i&&RP(a,i)){let c=FP(a,i);a=ma(a,a.next),c=ma(c,c.next),Ws(a,t,r,n,s,o),Ws(c,t,r,n,s,o);return}i=i.next}a=a.next}while(a!==e)},BP=(e,t,r,n)=>{let s=e;do s.z===null&&(s.z=Wc(s.x,s.y,t,r,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,MP(s,o=>o.z)},Wc=(e,t,r,n,s)=>(e=32767*(e-r)*s,t=32767*(t-n)*s,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1);var IP=GP;const{area:zP}=eo,{toOutlines:VP}=Je,{arePointsInside:UP}=ul,qP=e=>{const t=VP(e),r=[],n=[];t.forEach((a,i)=>{const c=zP(a);c<0?n.push(i):c>0&&r.push(i)});const s=[],o=[];return r.forEach((a,i)=>{const c=t[a];s[i]=[],n.forEach((l,u)=>{const d=t[l];UP([d[0]],{vertices:c})&&(s[i].push(l),o[u]||(o[u]=[]),o[u].push(i))})}),n.forEach((a,i)=>{if(o[i]&&o[i].length>1){const c=XP(o[i],l=>s[l].length);o[i].forEach((l,u)=>{u!==c&&(s[l]=s[l].filter(d=>d!==a))})}}),s.map((a,i)=>({solid:t[r[i]],holes:a.map(c=>t[c])}))},XP=(e,t)=>{let r,n;return e.forEach((s,o)=>{const a=t(s);(n===void 0||a<n)&&(r=o,n=a)}),r};var jP=qP;const HP=Je,Qu=Pr,YP=rt,Vt=ze,ZP=rm,WP=jP;class QP{constructor(t){this.plane=ZP(t);const r=Vt.orthogonal(Vt.create(),this.plane),n=Vt.cross(Vt.create(),this.plane,r);this.v=Vt.normalize(n,n),this.u=Vt.cross(Vt.create(),this.v,this.plane),this.basisMap=new Map;const s=t.edges.map(a=>a.map(i=>this.to2D(i))),o=HP.create(s);this.roots=WP(o)}to2D(t){const r=YP.fromValues(Vt.dot(t,this.u),Vt.dot(t,this.v));return this.basisMap.set(r,t),r}to3D(t){const r=this.basisMap.get(t);if(r)return r;{console.log("Warning: point not in original slice");const n=Vt.scale(Vt.create(),this.u,t[0]),s=Vt.scale(Vt.create(),this.v,t[1]),o=Vt.scale(Vt.create(),Qu,Qu[3]),a=Vt.add(n,n,o);return Vt.add(s,s,a)}}}var KP=QP;const JP=st,e8=IP,t8=KP,r8=e=>{const t=new t8(e),r=[];return t.roots.forEach(({solid:n,holes:s})=>{let o=n.length;const a=[];s.forEach((d,h)=>{a.push(o),o+=d.length});const i=[n,...s].flat(),c=i.flat(),l=d=>t.to3D(i[d]),u=e8(c,a);for(let d=0;d<u.length;d+=3){const h=u.slice(d,d+3).map(l);r.push(JP.fromPointsAndPlane(h,t.plane))}}),r};var n8=r8;const Ku=ze,s8=e=>e.reduce((t,r)=>t+=`[${Ku.toString(r[0])}, ${Ku.toString(r[1])}], `,""),o8=e=>`[${s8(e.edges)}]`;var a8=o8;const Ho=ze,i8=Mn,c8=(e,t)=>{const r=t.edges.map(n=>[Ho.transform(Ho.create(),n[0],e),Ho.transform(Ho.create(),n[1],e)]);return i8(r)};var l8=c8,ro={calculatePlane:rm,clone:zS,create:Mn,equals:qS,fromPoints:HS,fromSides:WS,isA:KS,reverse:tP,toEdges:nP,toPolygons:n8,toString:a8,transform:l8};const Ju=ze,f8=Mn,u8=e=>{if(!e.edges)return e;let t=e.edges;const r=new Map,n=new Map;t=t.filter(a=>!Ju.equals(a[0],a[1])),t.forEach(a=>{const i=a[0].toString(),c=a[1].toString();r.set(i,a[0]),r.set(c,a[1]),n.set(i,(n.get(i)||0)+1),n.set(c,(n.get(c)||0)-1)});const s=[],o=[];return n.forEach((a,i)=>{a<0&&s.push(i),a>0&&o.push(i)}),s.forEach(a=>{const i=r.get(a);let c=1/0,l;o.forEach(u=>{const d=r.get(u),h=Ju.distance(i,d);h<c&&(c=h,l=d)}),console.warn(`slice.repair: repairing vertex gap ${i} to ${l} distance ${c}`),t=t.map(u=>u[0].toString()===a?[l,u[1]]:u[1].toString()===a?[u[0],l]:u)}),f8(t)};var d8=u8;const{EPS:e0}=it,Zn=ze,Yo=st,t0=ro,Qc=(e,t)=>e===t?e:e<t?Qc(t,e):t===1?1:t===0?e:Qc(t,e%t),h8=(e,t)=>e*t/Qc(e,t),r0=(e,t)=>{const r=e/t.length;if(r===1)return t;const n=Zn.fromValues(r,r,r),s=[];return t.forEach(o=>{const a=Zn.subtract(Zn.create(),o[1],o[0]);Zn.divide(a,a,n);let i=o[0];for(let c=1;c<=r;++c){const l=Zn.add(Zn.create(),i,a);s.push([i,l]),i=l}}),s},n0=e0*e0/2*Math.sin(Math.PI/3),m8=(e,t)=>{let r=t0.toEdges(e),n=t0.toEdges(t);if(r.length!==n.length){const o=h8(r.length,n.length);o!==r.length&&(r=r0(o,r)),o!==n.length&&(n=r0(o,n))}const s=[];return r.forEach((o,a)=>{const i=n[a],c=Yo.create([o[0],o[1],i[1]]),l=Yo.measureArea(c);Number.isFinite(l)&&l>n0&&s.push(c);const u=Yo.create([o[0],i[1],i[0]]),d=Yo.measureArea(u);Number.isFinite(d)&&d>n0&&s.push(u)}),s};var p8=m8;const s0=dt,o0=Je,v8=et,Kc=st,tn=ro,g8=d8,a0=p8,y8=(e,t,r)=>{let n=null;return o0.isA(r)&&(n=tn.fromSides(o0.toSides(r))),Kc.isA(r)&&(n=tn.fromPoints(Kc.toPoints(r))),e===0||e===1?tn.transform(s0.fromTranslation(s0.create(),[0,0,e]),n):null},b8=(e,t)=>{const r={numberOfSlices:2,capStart:!0,capEnd:!0,close:!1,repair:!0,callback:y8},{numberOfSlices:n,capStart:s,capEnd:o,close:a,repair:i,callback:c}=Object.assign({},r,e);if(n<2)throw new Error("numberOfSlices must be 2 or more");i&&(t=g8(t));const l=n-1;let u=null,d=null,h=null,p=[];for(let E=0;E<n;E++){const g=c(E/l,E,t);if(g){if(!tn.isA(g))throw new Error("the callback function must return slice objects");if(tn.toEdges(g).length===0)throw new Error("the callback function must return slices with one or more edges");h&&(p=p.concat(a0(h,g))),E===0&&(u=g),E===n-1&&(d=g),h=g}}if(o){const E=tn.toPolygons(d);p=p.concat(E)}if(s){const E=tn.toPolygons(u).map(Kc.invert);p=p.concat(E)}return!s&&!o&&a&&!tn.equals(d,u)&&(p=p.concat(a0(d,u))),v8.create(p)};var wl=b8;const{TAU:ir}=it,Ds=dt,{mirrorX:w8}=Xs,ks=Je,ac=ro,_8=wl,x8=(e,t)=>{const r={segments:12,startAngle:0,angle:ir,overflow:"cap"};let{segments:n,startAngle:s,angle:o,overflow:a}=Object.assign({},r,e);if(n<3)throw new Error("segments must be greater then 3");s=Math.abs(s)>ir?s%ir:s,o=Math.abs(o)>ir?o%ir:o;let i=s+o;if(i=Math.abs(i)>ir?i%ir:i,i<s){const F=s;s=i,i=F}let c=i-s;if(c<=0&&(c=ir),Math.abs(c)<ir){const F=ir/n;n=Math.floor(Math.abs(c)/F),Math.abs(c)>n*F&&n++}let l=ks.toSides(t);if(l.length===0)throw new Error("the given geometry cannot be empty");const u=l.filter(F=>F[0][0]<0),d=l.filter(F=>F[0][0]>=0);u.length>0&&d.length>0&&a==="cap"&&(u.length>d.length?(l=l.map(F=>{let R=F[0],M=F[1];return R=[Math.min(R[0],0),R[1]],M=[Math.min(M[0],0),M[1]],[R,M]}),t=ks.reverse(ks.create(l)),t=w8(t)):d.length>=u.length&&(l=l.map(F=>{let R=F[0],M=F[1];return R=[Math.max(R[0],0),R[1]],M=[Math.max(M[0],0),M[1]],[R,M]}),t=ks.create(l)));const p=c/n,E=Math.abs(c)<ir,g=ac.fromSides(ks.toSides(t));ac.reverse(g,g);const b=Ds.create(),P=(F,R,M)=>{let G=p*R+s;return c===ir&&R===n&&(G=s),Ds.multiply(b,Ds.fromZRotation(b,G),Ds.fromXRotation(Ds.create(),ir/4)),ac.transform(b,M)};return e={numberOfSlices:n+1,capStart:E,capEnd:E,close:!E,callback:P},_8(e,g)};var cm=x8;const E8=Ze,i0=dt,c0=Je,l0=et,f0=lt,La=(e,...t)=>{if(!Array.isArray(e))throw new Error("angles must be an array");if(t=E8(t),t.length===0)throw new Error("wrong number of arguments");for(e=e.slice();e.length<3;)e.push(0);const r=e[2],n=e[1],s=e[0],o=i0.fromTaitBryanRotation(i0.create(),r,n,s),a=t.map(i=>f0.isA(i)?f0.transform(o,i):c0.isA(i)?c0.transform(o,i):l0.isA(i)?l0.transform(o,i):i);return a.length===1?a[0]:a},$8=(e,...t)=>La([e,0,0],t),A8=(e,...t)=>La([0,e,0],t),T8=(e,...t)=>La([0,0,e],t);var Hs={rotate:La,rotateX:$8,rotateY:A8,rotateZ:T8};const S8=Ze,u0=dt,d0=Je,h0=et,m0=lt,Fa=(e,...t)=>{if(!Array.isArray(e))throw new Error("offset must be an array");if(t=S8(t),t.length===0)throw new Error("wrong number of arguments");for(e=e.slice();e.length<3;)e.push(0);const r=u0.fromTranslation(u0.create(),e),n=t.map(s=>m0.isA(s)?m0.transform(r,s):d0.isA(s)?d0.transform(r,s):h0.isA(s)?h0.transform(r,s):s);return n.length===1?n[0]:n},P8=(e,...t)=>Fa([e,0,0],t),C8=(e,...t)=>Fa([0,e,0],t),M8=(e,...t)=>Fa([0,0,e],t);var Tn={translate:Fa,translateX:P8,translateY:C8,translateZ:M8};const{TAU:O8}=it,R8=cm,{rotate:L8}=Hs,{translate:F8}=Tn,G8=Yh,{isGT:ic,isGTE:cc}=Gt,N8=e=>{const t={innerRadius:1,innerSegments:32,outerRadius:4,outerSegments:32,innerRotation:0,startAngle:0,outerRotation:O8},{innerRadius:r,innerSegments:n,outerRadius:s,outerSegments:o,innerRotation:a,startAngle:i,outerRotation:c}=Object.assign({},t,e);if(!ic(r,0))throw new Error("innerRadius must be greater than zero");if(!cc(n,3))throw new Error("innerSegments must be three or more");if(!ic(s,0))throw new Error("outerRadius must be greater than zero");if(!cc(o,3))throw new Error("outerSegments must be three or more");if(!cc(i,0))throw new Error("startAngle must be positive");if(!ic(c,0))throw new Error("outerRotation must be greater than zero");if(r>=s)throw new Error("inner circle is two large to rotate about the outer circle");let l=G8({radius:r,segments:n});return a!==0&&(l=L8([0,0,a],l)),l=F8([s,0],l),R8({startAngle:i,angle:c,segments:o},l)};var D8=N8;const{NEPS:fs}=it,Bs=rt,k8=Je,{isNumberArray:B8}=Gt,Jc=(e,t,r)=>Math.acos((e*e+t*t-r*r)/(2*e*t)),I8=(e,t,r)=>t>fs?Math.sqrt(e*e+r*r-2*e*r*Math.cos(t)):Math.sqrt((e-r)*(e-r)+e*r*t*t*(1-t*t/12)),z8=e=>{if(Math.abs(e[0]+e[1]+e[2]-Math.PI)>fs)throw new Error("AAA triangles require angles that sum to PI");const r=e[0],n=e[1],s=Math.PI-r-n,o=1,a=o/Math.sin(s)*Math.sin(r),i=o/Math.sin(s)*Math.sin(n);return hs(r,n,s,a,i,o)},V8=e=>{const t=e[0],r=e[1],n=Math.PI+fs-t-r;if(n<fs)throw new Error("AAS triangles require angles that sum to PI");const s=e[2],o=s/Math.sin(t)*Math.sin(r),a=s/Math.sin(t)*Math.sin(n);return hs(t,r,n,s,o,a)},U8=e=>{const t=e[0],r=e[2],n=Math.PI+fs-t-r;if(n<fs)throw new Error("ASA triangles require angles that sum to PI");const s=e[1],o=s/Math.sin(n)*Math.sin(t),a=s/Math.sin(n)*Math.sin(r);return hs(t,r,n,o,a,s)},q8=e=>{const t=e[0],r=e[1],n=e[2],s=I8(t,r,n),o=Jc(s,t,n),a=Math.PI-o-r;return hs(o,r,a,n,s,t)},X8=e=>{const t=e[0],r=e[1],n=e[2],s=Math.asin(r*Math.sin(n)/t),o=Math.PI-s-n,a=t/Math.sin(n)*Math.sin(o);return hs(s,o,n,r,a,t)},j8=e=>{const t=e[1],r=e[2],n=e[0];if(t+r<=n||r+n<=t||n+t<=r)throw new Error("SSS triangle is incorrect, as the longest side is longer than the sum of the other sides");const s=Jc(r,n,t),o=Jc(n,t,r),a=Math.PI-s-o;return hs(s,o,a,t,r,n)},hs=(e,t,r,n,s,o)=>{const a=Bs.fromValues(0,0),i=Bs.fromValues(o,0),c=Bs.fromValues(n,0);return Bs.add(c,Bs.rotate(c,c,[0,0],Math.PI-t),i),k8.fromPoints([a,i,c])},H8=e=>{const t={type:"SSS",values:[1,1,1]};let{type:r,values:n}=Object.assign({},t,e);if(typeof r!="string")throw new Error("triangle type must be a string");if(r=r.toUpperCase(),!((r[0]==="A"||r[0]==="S")&&(r[1]==="A"||r[1]==="S")&&(r[2]==="A"||r[2]==="S")))throw new Error("triangle type must contain three letters; A or S");if(!B8(n,3))throw new Error("triangle values must contain three values");if(!n.every(s=>s>0))throw new Error("triangle values must be greater than zero");switch(r){case"AAA":return z8(n);case"AAS":return V8(n);case"ASA":return U8(n);case"SAS":return q8(n);case"SSA":return X8(n);case"SSS":return j8(n);default:throw new Error("invalid triangle type, try again")}};var Y8=H8,lm={arc:fT,circle:Yh,cube:AT,cuboid:Zh,cylinder:GT,cylinderElliptic:Wh,ellipse:Hh,ellipsoid:Qh,geodesicSphere:HT,line:WT,polygon:KT,polyhedron:Kh,rectangle:Jh,roundedCuboid:cS,roundedCylinder:mS,roundedRectangle:bS,sphere:em,square:TS,star:RS,torus:D8,triangle:Y8},Z8={height:14,32:[16],33:[10,5,21,5,7,void 0,5,2,4,1,5,0,6,1,5,2],34:[16,4,21,4,14,void 0,12,21,12,14],35:[21,11,25,4,-7,void 0,17,25,10,-7,void 0,4,12,18,12,void 0,3,6,17,6],36:[20,8,25,8,-4,void 0,12,25,12,-4,void 0,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3],37:[24,21,21,3,0,void 0,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,void 0,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7],38:[26,23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2],39:[10,5,19,4,20,5,21,6,20,6,18,5,16,4,15],40:[14,11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7],41:[14,3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7],42:[16,8,21,8,9,void 0,3,18,13,12,void 0,13,18,3,12],43:[26,13,18,13,0,void 0,4,9,22,9],44:[10,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4],45:[26,4,9,22,9],46:[10,5,2,4,1,5,0,6,1,5,2],47:[22,20,25,2,-7],48:[20,9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21],49:[20,6,17,8,18,11,21,11,0],50:[20,4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0],51:[20,5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4],52:[20,13,21,3,7,18,7,void 0,13,21,13,0],53:[20,15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4],54:[20,16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7],55:[20,17,21,7,0,void 0,3,21,17,21],56:[20,8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21],57:[20,16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3],58:[10,5,14,4,13,5,12,6,13,5,14,void 0,5,2,4,1,5,0,6,1,5,2],59:[10,5,14,4,13,5,12,6,13,5,14,void 0,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4],60:[24,20,18,4,9,20,0],61:[26,4,12,22,12,void 0,4,6,22,6],62:[24,4,18,20,9,4,0],63:[18,3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,void 0,9,2,8,1,9,0,10,1,9,2],64:[27,18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,void 0,12,16,10,14,9,11,9,8,10,6,11,5,void 0,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,void 0,19,16,18,8,18,6,19,5],65:[18,9,21,1,0,void 0,9,21,17,0,void 0,4,7,14,7],66:[21,4,21,4,0,void 0,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,void 0,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0],67:[21,18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5],68:[21,4,21,4,0,void 0,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0],69:[19,4,21,4,0,void 0,4,21,17,21,void 0,4,11,12,11,void 0,4,0,17,0],70:[18,4,21,4,0,void 0,4,21,17,21,void 0,4,11,12,11],71:[21,18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,void 0,13,8,18,8],72:[22,4,21,4,0,void 0,18,21,18,0,void 0,4,11,18,11],73:[8,4,21,4,0],74:[16,12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7],75:[21,4,21,4,0,void 0,18,21,4,7,void 0,9,12,18,0],76:[17,4,21,4,0,void 0,4,0,16,0],77:[24,4,21,4,0,void 0,4,21,12,0,void 0,20,21,12,0,void 0,20,21,20,0],78:[22,4,21,4,0,void 0,4,21,18,0,void 0,18,21,18,0],79:[22,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21],80:[21,4,21,4,0,void 0,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10],81:[22,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,void 0,12,4,18,-2],82:[21,4,21,4,0,void 0,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,void 0,11,11,18,0],83:[20,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3],84:[16,8,21,8,0,void 0,1,21,15,21],85:[22,4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21],86:[18,1,21,9,0,void 0,17,21,9,0],87:[24,2,21,7,0,void 0,12,21,7,0,void 0,12,21,17,0,void 0,22,21,17,0],88:[20,3,21,17,0,void 0,17,21,3,0],89:[18,1,21,9,11,9,0,void 0,17,21,9,11],90:[20,17,21,3,0,void 0,3,21,17,21,void 0,3,0,17,0],91:[14,4,25,4,-7,void 0,5,25,5,-7,void 0,4,25,11,25,void 0,4,-7,11,-7],92:[14,0,21,14,-3],93:[14,9,25,9,-7,void 0,10,25,10,-7,void 0,3,25,10,25,void 0,3,-7,10,-7],94:[16,6,15,8,18,10,15,void 0,3,12,8,17,13,12,void 0,8,17,8,0],95:[16,0,-2,16,-2],96:[10,6,21,5,20,4,18,4,16,5,15,6,16,5,17],97:[19,15,14,15,0,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],98:[19,4,21,4,0,void 0,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3],99:[18,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],100:[19,15,21,15,0,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],101:[18,3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],102:[12,10,21,8,21,6,20,5,17,5,0,void 0,2,14,9,14],103:[19,15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],104:[19,4,21,4,0,void 0,4,10,7,13,9,14,12,14,14,13,15,10,15,0],105:[8,3,21,4,20,5,21,4,22,3,21,void 0,4,14,4,0],106:[10,5,21,6,20,7,21,6,22,5,21,void 0,6,14,6,-3,5,-6,3,-7,1,-7],107:[17,4,21,4,0,void 0,14,14,4,4,void 0,8,8,15,0],108:[8,4,21,4,0],109:[30,4,14,4,0,void 0,4,10,7,13,9,14,12,14,14,13,15,10,15,0,void 0,15,10,18,13,20,14,23,14,25,13,26,10,26,0],110:[19,4,14,4,0,void 0,4,10,7,13,9,14,12,14,14,13,15,10,15,0],111:[19,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14],112:[19,4,14,4,-7,void 0,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3],113:[19,15,14,15,-7,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],114:[13,4,14,4,0,void 0,4,8,5,11,7,13,9,14,12,14],115:[17,14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3],116:[12,5,21,5,4,6,1,8,0,10,0,void 0,2,14,9,14],117:[19,4,14,4,4,5,1,7,0,10,0,12,1,15,4,void 0,15,14,15,0],118:[16,2,14,8,0,void 0,14,14,8,0],119:[22,3,14,7,0,void 0,11,14,7,0,void 0,11,14,15,0,void 0,19,14,15,0],120:[17,3,14,14,0,void 0,14,14,3,0],121:[16,2,14,8,0,void 0,14,14,8,0,6,-4,4,-6,2,-7,1,-7],122:[17,14,14,3,0,void 0,3,14,14,14,void 0,3,0,14,0],123:[14,9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,void 0,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,void 0,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7],124:[8,4,25,4,-7],125:[14,5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,void 0,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,void 0,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7],126:[24,3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,void 0,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]};const W8=Z8,Q8={xOffset:0,yOffset:0,input:"?",align:"left",font:W8,height:14,lineSpacing:2.142857142857143,letterSpacing:1,extrudeOffset:0},K8=(e,t)=>{!t&&typeof e=="string"&&(e={input:e}),e=e||{};const r=Object.assign({},Q8,e);return r.input=t||r.input,r};var fm=K8;const J8=fm,e6=(e,t)=>{const{xOffset:r,yOffset:n,input:s,font:o,height:a,extrudeOffset:i}=J8(e,t);let c=s.charCodeAt(0);(!c||!o[c])&&(c=63);const l=[].concat(o[c]),u=(a-i)/o.height,d=i/2,h=l.shift()*u,p=[];let E=[];for(let g=0,b=l.length;g<b;g+=2){const P=u*l[g]+r,F=u*l[g+1]+n+d;if(l[g]!==void 0){E.push([P,F]);continue}p.push(E),E=[],g--}return E.length&&p.push(E),{width:h,height:a,segments:p}};var um=e6;const t6=um,r6=fm,p0=(e,t)=>{const{x:r,y:n}=Object.assign({x:0,y:0},e||{}),s=t.segments;let o=null,a=null;for(let i=0,c=s.length;i<c;i++){o=s[i];for(let l=0,u=o.length;l<u;l++)a=o[l],o[l]=[a[0]+r,a[1]+n]}return t},n6=(e,t)=>{const{xOffset:r,yOffset:n,input:s,font:o,height:a,align:i,extrudeOffset:c,lineSpacing:l,letterSpacing:u}=r6(e,t);let[d,h]=[r,n],p,E,g,b,P,F,R={width:0,segments:[]};const M=[];let G=[],L=0;const U=d,ee=()=>{M.push(R),L=Math.max(L,R.width),R={width:0,segments:[]}};for(p=0,E=s.length;p<E;p++){if(g=s[p],b=t6({xOffset:d,yOffset:h,font:o,height:a,extrudeOffset:c},g),g===`
`){d=U,h-=b.height*l,ee();continue}P=b.width*u,R.width+=P,d+=P,g!==" "&&(R.segments=R.segments.concat(b.segments))}for(R.segments.length&&ee(),p=0,E=M.length;p<E;p++)R=M[p],L>R.width&&(F=L-R.width,i==="right"?R=p0({x:F},R):i==="center"&&(R=p0({x:F/2},R))),G=G.concat(R.segments);return G};var s6=n6,o6={vectorChar:um,vectorText:s6};const a6=Je,i6=et,c6=lt,l6=e=>{let t;for(const r of e){let n=0;if(a6.isA(r)&&(n=1),i6.isA(r)&&(n=2),c6.isA(r)&&(n=3),t&&n!==t)return!1;t=n}return!0};var no=l6;const f6=e=>e*.017453292519943295;var u6=f6;const d6=(e,t)=>e-t;var dm=d6;const h6=(e,t,r)=>{let n=0,s=e.length;for(;s>n;){const o=Math.floor((n+s)/2),a=e[o];r(t,a)>0?n=o+1:s=o}e.splice(n,0,t)};var m6=h6;const{TAU:v0}=it,p6=(e,t,r)=>{const n=t>0?e*v0/t:0,s=r>0?v0/r:0;return Math.ceil(Math.max(n,s,4))};var v6=p6;const g6=e=>e*57.29577951308232;var y6=g6,Ct={areAllShapesTheSameType:no,degToRad:u6,flatten:Ze,fnNumberSort:dm,insertSorted:m6,radiusToSegments:v6,radToDeg:y6};const g0=rt,b6=Je,w6=(e,t)=>{if(t.vertices.length<4)return null;const r=[],n=t.vertices.filter((a,i)=>a[2]>0?(r.push(i),!0):!1);if(n.length!==2)throw new Error("Assertion failed: fromFakePolygon: not enough points found");const s=n.map(a=>{const i=Math.round(a[0]/e)*e+0,c=Math.round(a[1]/e)*e+0;return g0.fromValues(i,c)});if(g0.equals(s[0],s[1]))return null;const o=r[1]-r[0];if(o===1||o===3)o===1&&s.reverse();else throw new Error("Assertion failed: fromFakePolygon: unknown index ordering");return s},_6=(e,t)=>{const r=t.map(n=>w6(e,n)).filter(n=>n!==null);return b6.create(r)};var _l=_6;const Zr=ze,x6=Je,E6=et,$6=st,A6=(e,t,r)=>{const n=[Zr.fromVec2(Zr.create(),r[0],e),Zr.fromVec2(Zr.create(),r[1],e),Zr.fromVec2(Zr.create(),r[1],t),Zr.fromVec2(Zr.create(),r[0],t)];return $6.create(n)},T6=(e,t)=>{const n=x6.toSides(t).map(o=>A6(e.z0,e.z1,o));return E6.create(n)};var xl=T6;const y0=dt,S6=rt,Rt=ze,Pn=function(e,t){arguments.length<2&&(t=Rt.orthogonal(Rt.create(),e)),this.v=Rt.normalize(Rt.create(),Rt.cross(Rt.create(),e,t)),this.u=Rt.cross(Rt.create(),this.v,e),this.plane=e,this.planeorigin=Rt.scale(Rt.create(),e,e[3])};Pn.GetCartesian=function(e,t){const r=e+"/"+t;let n,s;if(r==="X/Y")n=[0,0,1],s=[1,0,0];else if(r==="Y/-X")n=[0,0,1],s=[0,1,0];else if(r==="-X/-Y")n=[0,0,1],s=[-1,0,0];else if(r==="-Y/X")n=[0,0,1],s=[0,-1,0];else if(r==="-X/Y")n=[0,0,-1],s=[-1,0,0];else if(r==="-Y/-X")n=[0,0,-1],s=[0,-1,0];else if(r==="X/-Y")n=[0,0,-1],s=[1,0,0];else if(r==="Y/X")n=[0,0,-1],s=[0,1,0];else if(r==="X/Z")n=[0,-1,0],s=[1,0,0];else if(r==="Z/-X")n=[0,-1,0],s=[0,0,1];else if(r==="-X/-Z")n=[0,-1,0],s=[-1,0,0];else if(r==="-Z/X")n=[0,-1,0],s=[0,0,-1];else if(r==="-X/Z")n=[0,1,0],s=[-1,0,0];else if(r==="-Z/-X")n=[0,1,0],s=[0,0,-1];else if(r==="X/-Z")n=[0,1,0],s=[1,0,0];else if(r==="Z/X")n=[0,1,0],s=[0,0,1];else if(r==="Y/Z")n=[1,0,0],s=[0,1,0];else if(r==="Z/-Y")n=[1,0,0],s=[0,0,1];else if(r==="-Y/-Z")n=[1,0,0],s=[0,-1,0];else if(r==="-Z/Y")n=[1,0,0],s=[0,0,-1];else if(r==="-Y/Z")n=[-1,0,0],s=[0,-1,0];else if(r==="-Z/-Y")n=[-1,0,0],s=[0,0,-1];else if(r==="Y/-Z")n=[-1,0,0],s=[0,1,0];else if(r==="Z/Y")n=[-1,0,0],s=[0,0,1];else throw new Error("OrthoNormalBasis.GetCartesian: invalid combination of axis identifiers. Should pass two string arguments from [X,Y,Z,-X,-Y,-Z], being two different axes.");return new Pn(new Plane(new Vector3D(n),0),new Vector3D(s))};Pn.Z0Plane=function(){const e=new Plane(new Vector3D([0,0,1]),0);return new Pn(e,new Vector3D([1,0,0]))};Pn.prototype={getProjectionMatrix:function(){return y0.fromValues(this.u[0],this.v[0],this.plane[0],0,this.u[1],this.v[1],this.plane[1],0,this.u[2],this.v[2],this.plane[2],0,0,0,-this.plane[3],1)},getInverseProjectionMatrix:function(){const e=Rt.scale(Rt.create(),this.plane,this.plane[3]);return y0.fromValues(this.u[0],this.u[1],this.u[2],0,this.v[0],this.v[1],this.v[2],0,this.plane[0],this.plane[1],this.plane[2],0,e[0],e[1],e[2],1)},to2D:function(e){return S6.fromValues(Rt.dot(e,this.u),Rt.dot(e,this.v))},to3D:function(e){const t=Rt.scale(Rt.create(),this.u,e[0]),r=Rt.scale(Rt.create(),this.v,e[1]),n=Rt.add(t,t,this.planeorigin);return Rt.add(r,r,n)},line3Dto2D:function(e){const t=e.point,r=e.direction.plus(t),n=this.to2D(t),s=this.to2D(r);return Line2D.fromPoints(n,s)},line2Dto3D:function(e){const t=e.origin(),r=e.direction().plus(t),n=this.to3D(t),s=this.to3D(r);return Line3D.fromPoints(n,s)},transform:function(e){const t=this.plane.transform(e),r=this.u.transform(e),n=new Vector3D(0,0,0).transform(e),s=r.minus(n);return new Pn(t,s)}};var P6=Pn;const{EPS:Fr}=it,Wr=pl,pr=rt,C6=P6,Wn=Ph,{insertSorted:M6,fnNumberSort:O6}=Ct,b0=st,R6=e=>{if(e.length<2)return e;const t=[],r=e.length,n=b0.plane(e[0]),s=new C6(n),o=[],a=[],i=new Map,c=new Map,l=new Map,u=10/Fr;for(let E=0;E<r;E++){const g=e[E];let b=[],P=g.vertices.length,F=-1;if(P>0){let R,M;for(let G=0;G<P;G++){let L=s.to2D(g.vertices[G]);const U=Math.floor(L[1]*u);let ee;l.has(U)?ee=l.get(U):l.has(U+1)?ee=l.get(U+1):l.has(U-1)?ee=l.get(U-1):(ee=L[1],l.set(U,L[1])),L=pr.fromValues(L[0],ee),b.push(L);const oe=L[1];(G===0||oe<R)&&(R=oe,F=G),(G===0||oe>M)&&(M=oe);let pe=c.get(oe);pe||(pe={},c.set(oe,pe)),pe[E]=!0}if(R>=M)b=[],P=0,F=-1;else{let G=i.get(R);G||(G=[],i.set(R,G)),G.push(E)}}b.reverse(),F=P-F-1,o.push(b),a.push(F)}const d=[];c.forEach((E,g)=>d.push(g)),d.sort(O6);let h=[],p=[];for(let E=0;E<d.length;E++){const g=[],b=d[E],P=c.get(b);for(let R=0;R<h.length;++R){const M=h[R],G=M.polygonindex;if(P[G]){const L=o[G],U=L.length;let ee=M.leftvertexindex,oe=M.rightvertexindex;for(;;){let Q=ee+1;if(Q>=U&&(Q=0),L[Q][1]!==b)break;ee=Q}let pe=oe-1;if(pe<0&&(pe=U-1),L[pe][1]===b&&(oe=pe),ee!==M.leftvertexindex&&ee===oe)h.splice(R,1),--R;else{M.leftvertexindex=ee,M.rightvertexindex=oe,M.topleft=L[ee],M.topright=L[oe];let Q=ee+1;Q>=U&&(Q=0),M.bottomleft=L[Q];let Se=oe-1;Se<0&&(Se=U-1),M.bottomright=L[Se]}}}let F;if(E>=d.length-1)h=[],F=null;else{F=Number(d[E+1]);const R=.5*(b+F),M=i.get(b);for(const G in M){const L=M[G],U=o[L],ee=U.length,oe=a[L];let pe=oe;for(;;){let Xe=pe+1;if(Xe>=ee&&(Xe=0),U[Xe][1]!==b||Xe===oe)break;pe=Xe}let Q=oe;for(;;){let Xe=Q-1;if(Xe<0&&(Xe=ee-1),U[Xe][1]!==b||Xe===pe)break;Q=Xe}let Se=pe+1;Se>=ee&&(Se=0);let qe=Q-1;qe<0&&(qe=ee-1);const $e={polygonindex:L,leftvertexindex:pe,rightvertexindex:Q,topleft:U[pe],topright:U[Q],bottomleft:U[Se],bottomright:U[qe]};M6(h,$e,(Xe,Ne)=>{const Lt=Wn(Xe.topleft,Xe.bottomleft,R),Nt=Wn(Ne.topleft,Ne.bottomleft,R);return Lt>Nt?1:Lt<Nt?-1:0})}}for(const R in h){const M=h[R];let G=Wn(M.topleft,M.bottomleft,b);const L=pr.fromValues(G,b);G=Wn(M.topright,M.bottomright,b);const U=pr.fromValues(G,b);G=Wn(M.topleft,M.bottomleft,F);const ee=pr.fromValues(G,F);G=Wn(M.topright,M.bottomright,F);const oe=pr.fromValues(G,F),pe={topleft:L,topright:U,bottomleft:ee,bottomright:oe,leftline:Wr.fromPoints(Wr.create(),L,ee),rightline:Wr.fromPoints(Wr.create(),oe,U)};if(g.length>0){const Q=g[g.length-1],Se=pr.distance(pe.topleft,Q.topright),qe=pr.distance(pe.bottomleft,Q.bottomright);Se<Fr&&qe<Fr&&(pe.topleft=Q.topleft,pe.leftline=Q.leftline,pe.bottomleft=Q.bottomleft,g.splice(g.length-1,1))}g.push(pe)}if(E>0){const R=new Set,M=new Set;for(let G=0;G<g.length;G++){const L=g[G];for(let U=0;U<p.length;U++)if(!M.has(U)){const ee=p[U];if(pr.distance(ee.bottomleft,L.topleft)<Fr&&pr.distance(ee.bottomright,L.topright)<Fr){M.add(U);const oe=Wr.direction(L.leftline),pe=Wr.direction(ee.leftline),Q=oe[0]-pe[0],Se=Wr.direction(L.rightline),qe=Wr.direction(ee.rightline),$e=Se[0]-qe[0],Xe=Math.abs(Q)<Fr,Ne=Math.abs($e)<Fr,Lt=Xe||Q>=0,Nt=Ne||$e>=0;Lt&&Nt&&(L.outpolygon=ee.outpolygon,L.leftlinecontinues=Xe,L.rightlinecontinues=Ne,R.add(U));break}}}for(let G=0;G<p.length;G++)if(!R.has(G)){const L=p[G];L.outpolygon.rightpoints.push(L.bottomright),pr.distance(L.bottomright,L.bottomleft)>Fr&&L.outpolygon.leftpoints.push(L.bottomleft),L.outpolygon.leftpoints.reverse();const ee=L.outpolygon.rightpoints.concat(L.outpolygon.leftpoints).map(pe=>s.to3D(pe)),oe=b0.fromPointsAndPlane(ee,n);oe.vertices.length&&t.push(oe)}}for(let R=0;R<g.length;R++){const M=g[R];M.outpolygon?(M.leftlinecontinues||M.outpolygon.leftpoints.push(M.topleft),M.rightlinecontinues||M.outpolygon.rightpoints.push(M.topright)):(M.outpolygon={leftpoints:[],rightpoints:[]},M.outpolygon.leftpoints.push(M.topleft),pr.distance(M.topleft,M.topright)>Fr&&M.outpolygon.rightpoints.push(M.topright))}p=g}return t};var L6=R6;const w0=et,_0=st,F6=Ma,G6=L6,N6=(e,t)=>Math.abs(e[3]-t[3])<15e-8?F6(e,t):!1,D6=e=>{if(e.isRetesselated)return e;const t=w0.toPolygons(e),r=[];t.forEach(o=>{const a=r.find(i=>N6(i[0],_0.plane(o)));a?a[1].push(o):r.push([_0.plane(o),[o]])});let n=[];r.forEach(o=>{const a=o[1],i=G6(a);n=n.concat(i)});const s=w0.create(n);return s.isRetesselated=!0,s};var Ga=D6;const{EPS:Qn}=it,x0=Cn,k6=(e,t)=>{if(e.polygons.length===0||t.polygons.length===0)return!1;const r=x0(e),n=r[0],s=r[1],o=x0(t),a=o[0],i=o[1];return!(a[0]-s[0]>Qn||n[0]-i[0]>Qn||a[1]-s[1]>Qn||n[1]-i[1]>Qn||a[2]-s[2]>Qn||n[2]-i[2]>Qn)};var El=k6;const E0=Pr,B6=st;class pa{constructor(t){this.plane=null,this.front=null,this.back=null,this.polygontreenodes=[],this.parent=t}invert(){const t=[this];let r;for(let n=0;n<t.length;n++){r=t[n],r.plane&&(r.plane=E0.flip(E0.create(),r.plane)),r.front&&t.push(r.front),r.back&&t.push(r.back);const s=r.front;r.front=r.back,r.back=s}}clipPolygons(t,r){let n={node:this,polygontreenodes:t},s;const o=[];do{if(s=n.node,t=n.polygontreenodes,s.plane){const a=s.plane,i=[],c=[],l=r?i:c,u=t.length;for(let h=0;h<u;h++){const p=t[h];p.isRemoved()||p.splitByPlane(a,l,i,c,i)}s.front&&c.length>0&&o.push({node:s.front,polygontreenodes:c});const d=i.length;if(s.back&&d>0)o.push({node:s.back,polygontreenodes:i});else for(let h=0;h<d;h++)i[h].remove()}n=o.pop()}while(n!==void 0)}clipTo(t,r){let n=this;const s=[];do n.polygontreenodes.length>0&&t.rootnode.clipPolygons(n.polygontreenodes,r),n.front&&s.push(n.front),n.back&&s.push(n.back),n=s.pop();while(n!==void 0)}addPolygonTreeNodes(t){let r={node:this,polygontreenodes:t};const n=[];do{const s=r.node,o=r.polygontreenodes;if(o.length===0){r=n.pop();continue}if(!s.plane){let l=0;l=Math.floor(o.length/2);const u=o[l].getPolygon();s.plane=B6.plane(u)}const a=[],i=[],c=o.length;for(let l=0;l<c;++l)o[l].splitByPlane(s.plane,s.polygontreenodes,i,a,i);a.length>0&&(s.front||(s.front=new pa(s)),c===a.length&&i.length===0?s.front.polygontreenodes=a:n.push({node:s.front,polygontreenodes:a})),i.length>0&&(s.back||(s.back=new pa(s)),c===i.length&&a.length===0?s.back.polygontreenodes=i:n.push({node:s.back,polygontreenodes:i})),r=n.pop()}while(r!==void 0)}}var I6=pa;const Kn=ze,z6=(e,t,r)=>{const n=Kn.subtract(Kn.create(),r,t);let s=(e[3]-Kn.dot(e,t))/Kn.dot(e,n);return Number.isNaN(s)&&(s=0),s>1&&(s=1),s<0&&(s=0),Kn.scale(n,n,s),Kn.add(n,t,n),n};var V6=z6;const{EPS:Zo}=it,U6=Pr,Wo=ze,lc=st,q6=V6,X6=(e,t)=>{const r={type:null,front:null,back:null},n=t.vertices,s=n.length,o=lc.plane(t);if(U6.equals(o,e))r.type=0;else{let a=!1,i=!1;const c=[],l=-Zo;for(let u=0;u<s;u++){const d=Wo.dot(e,n[u])-e[3],h=d<l;c.push(h),d>Zo&&(a=!0),d<l&&(i=!0)}if(!a&&!i){const u=Wo.dot(e,o);r.type=u>=0?0:1}else if(!i)r.type=2;else if(!a)r.type=3;else{r.type=4;const u=[],d=[];let h=c[0];for(let E=0;E<s;E++){const g=n[E];let b=E+1;b>=s&&(b=0);const P=c[b];if(h===P)h?d.push(g):u.push(g);else{const F=n[b],R=q6(e,g,F);h?(d.push(g),d.push(R),u.push(R)):(u.push(g),u.push(R),d.push(R))}h=P}const p=Zo*Zo;if(d.length>=3){let E=d[d.length-1];for(let g=0;g<d.length;g++){const b=d[g];Wo.squaredDistance(b,E)<p&&(d.splice(g,1),g--),E=b}}if(u.length>=3){let E=u[u.length-1];for(let g=0;g<u.length;g++){const b=u[g];Wo.squaredDistance(b,E)<p&&(u.splice(g,1),g--),E=b}}u.length>=3&&(r.front=lc.fromPointsAndPlane(u,o)),d.length>=3&&(r.back=lc.fromPointsAndPlane(d,o))}}return r};var j6=X6;const{EPS:H6}=it,Y6=ze,$0=st,Z6=j6;class $l{constructor(t,r){this.parent=t,this.children=[],this.polygon=r,this.removed=!1}addPolygons(t){if(!this.isRootNode())throw new Error("Assertion failed");const r=this;t.forEach(n=>{r.addChild(n)})}remove(){if(!this.removed){this.removed=!0,this.polygon=null;const t=this.parent.children,r=t.indexOf(this);if(r<0)throw new Error("Assertion failed");t.splice(r,1),this.parent.recursivelyInvalidatePolygon()}}isRemoved(){return this.removed}isRootNode(){return!this.parent}invert(){if(!this.isRootNode())throw new Error("Assertion failed");this.invertSub()}getPolygon(){if(!this.polygon)throw new Error("Assertion failed");return this.polygon}getPolygons(t){let r=[this];const n=[r];let s,o,a,i;for(s=0;s<n.length;++s)for(r=n[s],o=0,a=r.length;o<a;o++)i=r[o],i.polygon?t.push(i.polygon):i.children.length>0&&n.push(i.children)}splitByPlane(t,r,n,s,o){if(this.children.length){const a=[this.children];let i,c,l,u,d;for(i=0;i<a.length;i++)for(d=a[i],c=0,l=d.length;c<l;c++)u=d[c],u.children.length>0?a.push(u.children):u._splitByPlane(t,r,n,s,o)}else this._splitByPlane(t,r,n,s,o)}_splitByPlane(t,r,n,s,o){const a=this.polygon;if(a){const i=$0.measureBoundingSphere(a),c=i[3]+H6,l=i,u=Y6.dot(t,l)-t[3];if(u>c)s.push(this);else if(u<-c)o.push(this);else{const d=Z6(t,a);switch(d.type){case 0:r.push(this);break;case 1:n.push(this);break;case 2:s.push(this);break;case 3:o.push(this);break;case 4:if(d.front){const h=this.addChild(d.front);s.push(h)}if(d.back){const h=this.addChild(d.back);o.push(h)}break}}}}addChild(t){const r=new $l(this,t);return this.children.push(r),r}invertSub(){let t=[this];const r=[t];let n,s,o,a;for(n=0;n<r.length;n++)for(t=r[n],s=0,o=t.length;s<o;s++)a=t[s],a.polygon&&(a.polygon=$0.invert(a.polygon)),a.children.length>0&&r.push(a.children)}recursivelyInvalidatePolygon(){this.polygon=null,this.parent&&this.parent.recursivelyInvalidatePolygon()}clear(){let t=[this];const r=[t];for(let n=0;n<r.length;++n){t=r[n];const s=t.length;for(let o=0;o<s;o++){const a=t[o];a.polygon&&(a.polygon=null),a.parent&&(a.parent=null),a.children.length>0&&r.push(a.children),a.children=[]}}}toString(){let t="",r=[this];const n=[r];let s,o,a,i;for(s=0;s<n.length;++s){r=n[s];const c=" ".repeat(s);for(o=0,a=r.length;o<a;o++)i=r[o],t+=`${c}PolygonTreeNode (${i.isRootNode()}): ${i.children.length}`,i.polygon?t+=`
 ${c}polygon: ${i.polygon.vertices}
`:t+=`
`,i.children.length>0&&n.push(i.children)}return t}}var W6=$l;const Q6=I6,K6=W6;class J6{constructor(t){this.polygonTree=new K6,this.rootnode=new Q6(null),t&&this.addPolygons(t)}invert(){this.polygonTree.invert(),this.rootnode.invert()}clipTo(t,r=!1){this.rootnode.clipTo(t,r)}allPolygons(){const t=[];return this.polygonTree.getPolygons(t),t}addPolygons(t){const r=new Array(t.length);for(let n=0;n<t.length;n++)r[n]=this.polygonTree.addChild(t[n]);this.rootnode.addPolygonTreeNodes(r)}clear(){this.polygonTree.clear()}toString(){return"Tree: "+this.polygonTree.toString("")}}var eC=J6,Al={Tree:eC};const Qo=et,tC=El,{Tree:A0}=Al,rC=(e,t)=>{if(!tC(e,t))return Qo.create();const r=new A0(Qo.toPolygons(e)),n=new A0(Qo.toPolygons(t));r.invert(),n.clipTo(r),n.invert(),r.clipTo(n),n.clipTo(r),r.addPolygons(n.allPolygons()),r.invert();const s=r.allPolygons();return Qo.create(s)};var nC=rC;const sC=Ze,oC=Ga,aC=nC,iC=(...e)=>{e=sC(e);let t=e.shift();return e.forEach(r=>{t=aC(t,r)}),t=oC(t),t};var hm=iC;const cC=Ze,lC=et,fC=rn,uC=_l,dC=xl,hC=hm,mC=(...e)=>{e=cC(e);const t=e.map(s=>dC({z0:-1,z1:1},s)),r=hC(t),n=fC(r);return uC(n,lC.toPolygons(r))};var pC=mC;const vC=Ze,gC=no,yC=Je,bC=et,wC=pC,_C=hm,xC=(...e)=>{if(e=vC(e),e.length===0)throw new Error("wrong number of arguments");if(!gC(e))throw new Error("only intersect of the types are supported");const t=e[0];return yC.isA(t)?wC(e):bC.isA(t)?_C(e):t};var EC=xC;const fc=ze,$C=rn,T0=et,AC=e=>e.sort((t,r)=>t-r).filter((t,r,n)=>!r||t!==n[r-1]),TC=(e,t,r)=>{const n=`${t}`,s=e.get(n);s===void 0?e.set(n,[r]):s.push(r)},SC=(e,t)=>{const r=`${t}`;return e.get(r)},PC=e=>{const t=$C(e),r=T0.toPolygons(e),n=r.length,s=new Map,o=fc.create();r.forEach((u,d)=>{u.vertices.forEach(h=>{TC(s,fc.snap(o,h,t),d)})});const a=r.map(u=>{let d=[];return u.vertices.forEach(h=>{d=d.concat(SC(s,fc.snap(o,h,t)))}),{e:1,d:AC(d)}});s.clear();let i=0;const c=a.length;for(let u=0;u<c;u++){const d=a[u];if(d.e>0){const h=new Array(n);h[u]=!0;do i=0,h.forEach((p,E)=>{const g=a[E];if(g.e>0){g.e=-1;for(let b=0;b<g.d.length;b++)h[g.d[b]]=!0;i++}});while(i>0);d.indexes=h}}const l=[];for(let u=0;u<c;u++)if(a[u].indexes){const d=[];a[u].indexes.forEach((h,p)=>d.push(r[p])),l.push(T0.create(d))}return l};var CC=PC;const MC=Ze,OC=et,RC=CC,LC=(...e)=>{if(e=MC(e),e.length===0)throw new Error("wrong number of arguments");const t=e.map(r=>OC.isA(r)?RC(r):r);return t.length===1?t[0]:t};var FC=LC;const Ko=et,GC=El,{Tree:S0}=Al,NC=(e,t)=>{if(!GC(e,t))return Ko.clone(e);const r=new S0(Ko.toPolygons(e)),n=new S0(Ko.toPolygons(t));r.invert(),r.clipTo(n),n.clipTo(r,!0),r.addPolygons(n.allPolygons()),r.invert();const s=r.allPolygons();return Ko.create(s)};var DC=NC;const kC=Ze,BC=Ga,IC=DC,zC=(...e)=>{e=kC(e);let t=e.shift();return e.forEach(r=>{t=IC(t,r)}),t=BC(t),t};var mm=zC;const VC=Ze,UC=et,qC=rn,XC=_l,jC=xl,HC=mm,YC=(...e)=>{e=VC(e);const t=e.map(s=>jC({z0:-1,z1:1},s)),r=HC(t),n=qC(r);return XC(n,UC.toPolygons(r))};var ZC=YC;const WC=Ze,QC=no,KC=Je,JC=et,eM=ZC,tM=mm,rM=(...e)=>{if(e=WC(e),e.length===0)throw new Error("wrong number of arguments");if(!QC(e))throw new Error("only subtract of the types are supported");const t=e[0];return KC.isA(t)?eM(e):JC.isA(t)?tM(e):t};var nM=rM;const os=et,sM=El,{Tree:P0}=Al,oM=(e,t)=>{if(!sM(e,t))return aM(e,t);const r=new P0(os.toPolygons(e)),n=new P0(os.toPolygons(t));r.clipTo(n,!1),n.clipTo(r),n.invert(),n.clipTo(r),n.invert();const s=r.allPolygons().concat(n.allPolygons());return os.create(s)},aM=(e,t)=>{let r=os.toPolygons(e);return r=r.concat(os.toPolygons(t)),os.create(r)};var pm=oM;const iM=Ze,cM=Ga,lM=pm,fM=(...e)=>{e=iM(e);let t;for(t=1;t<e.length;t+=2)e.push(lM(e[t-1],e[t]));let r=e[t-1];return r=cM(r),r};var vm=fM;const uM=Ze,dM=et,hM=rn,mM=_l,pM=xl,vM=vm,gM=(...e)=>{e=uM(e);const t=e.map(s=>pM({z0:-1,z1:1},s)),r=vM(t),n=hM(r);return mM(n,dM.toPolygons(r))};var gm=gM;const yM=Ze,bM=no,wM=Je,_M=et,xM=gm,EM=vm,$M=(...e)=>{if(e=yM(e),e.length===0)throw new Error("wrong number of arguments");if(!bM(e))throw new Error("only unions of the same type are supported");const t=e[0];return wM.isA(t)?xM(e):_M.isA(t)?EM(e):t};var Tl=$M,Na={intersect:EC,scission:FC,subtract:nM,union:Tl};const{EPS:AM,TAU:TM}=it,C0=Ch,Is=pl,bt=rt,SM=Pa,PM=(e,t)=>{const r={delta:1,corners:"edge",closed:!1,segments:16};let{delta:n,corners:s,closed:o,segments:a}=Object.assign({},r,e);if(Math.abs(n)<AM)return t;let i=e.closed?SM(t):1;i===0&&(i=1);const c=i>0&&n>=0||i<0&&n<0;n=Math.abs(n);let l=null,u=[];const d=[],h=bt.create(),p=t.length;for(let E=0;E<p;E++){const g=(E+1)%p,b=t[E],P=t[g];c?bt.subtract(h,b,P):bt.subtract(h,P,b),bt.normal(h,h),bt.normalize(h,h),bt.scale(h,h,n);const F=bt.add(bt.create(),b,h),R=bt.add(bt.create(),P,h),M=[F,R];if(l!=null&&(o||!o&&g!==0)){const G=C0(l[0],l[1],M[0],M[1]);G?(u.pop(),M[0]=G):d.push({c:b,s0:l,s1:M})}l=[F,R],!(g===0&&!o)&&(u.push(M[0]),u.push(M[1]))}if(o&&l!=null){const E=u[0],g=u[1],b=C0(l[0],l[1],E,g);if(b)u[0]=b,u.pop();else{const P=t[0],F=[E,g];d.push({c:P,s0:l,s1:F})}}if(s==="edge"){const E=new Map;u.forEach((P,F)=>E.set(P,F));const g=Is.create(),b=Is.create();d.forEach(P=>{Is.fromPoints(g,P.s0[0],P.s0[1]),Is.fromPoints(b,P.s1[0],P.s1[1]);const F=Is.intersectPointOfLines(g,b);if(Number.isFinite(F[0])&&Number.isFinite(F[1])){const R=P.s0[1],M=E.get(R);u[M]=F,u[(M+1)%u.length]=void 0}else{const R=P.s1[0],M=E.get(R);u[M]=void 0}}),u=u.filter(P=>P!==void 0)}if(s==="round"){let E=Math.floor(a/4);const g=bt.create();d.forEach(b=>{let P=bt.angle(bt.subtract(g,b.s1[0],b.c));if(P-=bt.angle(bt.subtract(g,b.s0[1],b.c)),c&&P<0&&(P=P+Math.PI,P<0&&(P=P+Math.PI)),!c&&P>0&&(P=P-Math.PI,P>0&&(P=P-Math.PI)),P!==0){E=Math.floor(a*(Math.abs(P)/TM));const F=P/E,R=bt.angle(bt.subtract(g,b.s0[1],b.c)),M=[];for(let G=1;G<E;G++){const L=R+F*G,U=bt.fromAngleRadians(bt.create(),L);bt.scale(U,U,n),bt.add(U,U,b.c),M.push(U)}if(M.length>0){const G=b.s0[1];let L=u.findIndex(U=>bt.equals(G,U));L=(L+1)%u.length,u.splice(L,0,...M)}}else{const F=b.s1[0],R=u.findIndex(M=>bt.equals(F,M));u.splice(R,1)}})}return u};var Da=PM;const Jo=Je,CM=Da,MM=(e,t)=>{const r={delta:1,corners:"edge",segments:16},{delta:n,corners:s,segments:o}=Object.assign({},r,e);if(!(s==="edge"||s==="chamfer"||s==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');const c=Jo.toOutlines(t).map(l=>(e={delta:n,corners:s,closed:!0,segments:o},CM(e,l))).reduce((l,u)=>l.concat(Jo.toSides(Jo.fromPoints(u))),[]);return Jo.create(c)};var OM=MM;const M0=dt,RM=ze,LM=et,zs=st,FM=(e,t)=>{RM.dot(zs.plane(t),e)>0&&(t=zs.invert(t));const n=[t],s=zs.transform(M0.fromTranslation(M0.create(),e),t),o=t.vertices.length;for(let a=0;a<o;a++){const i=a<o-1?a+1:0,c=zs.create([t.vertices[a],s.vertices[a],s.vertices[i],t.vertices[i]]);n.push(c)}return n.push(zs.invert(s)),LM.create(n)};var GM=FM;const{EPS:NM,TAU:uc}=it,O0=dt,ut=ze,DM=dm,dc=et,En=st,kM=em,BM=Ga,hc=pm,IM=GM,zM=(e,t,r)=>{const n=t.toString();if(e.has(n))e.get(n)[1].push(r);else{const s=[t,[r]];e.set(n,s)}},VM=(e,t,r)=>{const n=t[0].toString(),s=t[1].toString(),o=n<s?`${n},${s}`:`${s},${n}`;if(e.has(o))e.get(o)[1].push(r);else{const a=[t,[r]];e.set(o,a)}},mc=(e,t)=>{e.findIndex(n=>n===t)<0&&e.push(t)},UM=(e,t)=>{const r={delta:1,segments:12},{delta:n,segments:s}=Object.assign({},r,e);let o=dc.create();const a=new Map,i=new Map,c=ut.create(),l=ut.create();return dc.toPolygons(t).forEach((d,h)=>{const p=ut.scale(ut.create(),En.plane(d),2*n),E=En.transform(O0.fromTranslation(O0.create(),ut.scale(ut.create(),p,-.5)),d),g=IM(p,E);o=hc(o,g);const b=d.vertices;for(let P=0;P<b.length;P++){zM(a,b[P],En.plane(d));const F=(P+1)%b.length,R=[b[P],b[F]];VM(i,R,En.plane(d))}}),i.forEach(d=>{const h=d[0],p=d[1],E=h[0],g=h[1],b=ut.subtract(ut.create(),g,E);ut.normalize(b,b);const P=p[0],F=ut.cross(ut.create(),P,b);let R=[];for(let Q=0;Q<s;Q++)mc(R,Q*uc/s);for(let Q=0,Se=p.length;Q<Se;Q++){const qe=p[Q],$e=ut.dot(F,qe),Xe=ut.dot(P,qe);let Ne=Math.atan2($e,Xe);Ne<0&&(Ne+=uc),mc(R,Ne),Ne=Math.atan2(-$e,-Xe),Ne<0&&(Ne+=uc),mc(R,Ne)}R=R.sort(DM);const M=R.length;let G,L;const U=[],ee=[],oe=[];for(let Q=-1;Q<M;Q++){const Se=R[Q<0?Q+M:Q],qe=Math.sin(Se),$e=Math.cos(Se);ut.scale(c,P,$e*n),ut.scale(l,F,qe*n),ut.add(c,c,l);const Xe=ut.add(ut.create(),E,c),Ne=ut.add(ut.create(),g,c);let Lt=!1;if(Q>=0&&ut.distance(Xe,G)<NM&&(Lt=!0),!Lt){if(Q>=0){U.push(Xe),ee.push(Ne);const Nt=[L,Ne,Xe,G],Nr=En.create(Nt);oe.push(Nr)}G=Xe,L=Ne}}ee.reverse(),oe.push(En.create(U)),oe.push(En.create(ee));const pe=dc.create(oe);o=hc(o,pe)}),a.forEach(d=>{const h=d[0],p=d[1],E=p[0];let g=null,b=0;for(let M=1;M<p.length;M++){const G=p[M],L=ut.cross(c,E,G),U=ut.length(L);U>.05&&U>b&&(b=U,g=G)}g||(g=ut.orthogonal(c,E));const P=ut.cross(c,E,g);ut.normalize(P,P);const F=ut.cross(l,P,E),R=kM({center:[h[0],h[1],h[2]],radius:n,segments:s,axes:[E,P,F]});o=hc(o,R)}),BM(o)};var qM=UM;const XM=et,jM=Tl,HM=qM,YM=(e,t)=>{const r={delta:1,corners:"round",segments:12},{delta:n,corners:s,segments:o}=Object.assign({},r,e);if(s!=="round")throw new Error('corners must be "round" for 3D geometries');if(XM.toPolygons(t).length===0)throw new Error("the given geometry cannot be empty");e={delta:n,corners:s,segments:o};const i=HM(e,t);return jM(t,i)};var ZM=YM;const WM=Pa,Kt=rt,rs=Je,Ys=lt,R0=Da,QM=e=>{let{external:t,internal:r}=e;WM(t)<0?t=t.reverse():r=r.reverse();const n=Ys.fromPoints({closed:!0},t),s=Ys.fromPoints({closed:!0},r),o=rs.toSides(rs.fromPoints(Ys.toPoints(n))),a=rs.toSides(rs.fromPoints(Ys.toPoints(s)));return o.push(...a),rs.create(o)},KM=(e,t,r,n)=>{const{points:s,external:o,internal:a}=e,i=Math.floor(t/2),c=[],l=[];if(r==="round"&&i>0){const d=Math.PI/i,h=s[s.length-1],p=Kt.angle(Kt.subtract(Kt.create(),o[o.length-1],h)),E=s[0],g=Kt.angle(Kt.subtract(Kt.create(),a[0],E));for(let b=1;b<i;b++){let P=p+d*b,F=Kt.fromAngleRadians(Kt.create(),P);Kt.scale(F,F,n),Kt.add(F,F,h),c.push(F),P=g+d*b,F=Kt.fromAngleRadians(Kt.create(),P),Kt.scale(F,F,n),Kt.add(F,F,E),l.push(F)}}const u=[];return u.push(...o,...c,...a.reverse(),...l),rs.fromPoints(u)},JM=(e,t)=>{e=Object.assign({},{delta:1,corners:"edge",segments:16},e);const{delta:n,corners:s,segments:o}=e;if(n<=0)throw new Error("the given delta must be positive for paths");if(!(s==="edge"||s==="chamfer"||s==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');const a=t.isClosed,i=Ys.toPoints(t);if(i.length===0)throw new Error("the given geometry cannot be empty");const c={points:i,external:R0({delta:n,corners:s,segments:o,closed:a},i),internal:R0({delta:-n,corners:s,segments:o,closed:a},i)};return t.isClosed?QM(c):KM(c,o,s,n)};var eO=JM;const tO=Ze,rO=Je,nO=et,sO=lt,oO=OM,aO=ZM,iO=eO,cO=(e,...t)=>{if(t=tO(t),t.length===0)throw new Error("wrong number of arguments");const r=t.map(n=>sO.isA(n)?iO(e,n):rO.isA(n)?oO(e,n):nO.isA(n)?aO(e,n):n);return r.length===1?r[0]:r};var Sl=cO;const ea=Je,L0=ul,lO=Da,fO=(e,t)=>{const r={delta:1,corners:"edge",segments:0},{delta:n,corners:s,segments:o}=Object.assign({},r,e);if(!(s==="edge"||s==="chamfer"||s==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');const a=ea.toOutlines(t),c=a.map(l=>(e={delta:a.reduce((h,p)=>h+L0.arePointsInside(l,L0.create(p)),0)%2===0?n:-n,corners:s,closed:!0,segments:o},lO(e,l))).reduce((l,u)=>l.concat(ea.toSides(ea.fromPoints(u))),[]);return ea.create(c)};var uO=fO;const F0=lt,dO=Da,hO=(e,t)=>{const r={delta:1,corners:"edge",closed:t.isClosed,segments:16},{delta:n,corners:s,closed:o,segments:a}=Object.assign({},r,e);if(!(s==="edge"||s==="chamfer"||s==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');e={delta:n,corners:s,closed:o,segments:a};const i=dO(e,F0.toPoints(t));return F0.fromPoints({closed:o},i)};var mO=hO;const pO=Ze,vO=Je,gO=lt,yO=uO,bO=mO,wO=(e,...t)=>{if(t=pO(t),t.length===0)throw new Error("wrong number of arguments");const r=t.map(n=>gO.isA(n)?bO(e,n):vO.isA(n)?yO(e,n):n);return r.length===1?r[0]:r};var _O=wO,xO={expand:Sl,offset:_O};const Vs=dt,pc=ze,EO=Je,vc=ro,$O=wl,AO=(e,t)=>{const r={offset:[0,0,1],twistAngle:0,twistSteps:12,repair:!0};let{offset:n,twistAngle:s,twistSteps:o,repair:a}=Object.assign({},r,e);if(o<1)throw new Error("twistSteps must be 1 or more");s===0&&(o=1);const i=pc.clone(n),c=EO.toSides(t);if(c.length===0)throw new Error("the given geometry cannot be empty");const l=vc.fromSides(c);i[2]<0&&vc.reverse(l,l);const u=Vs.create(),d=(h,p,E)=>{const g=p/o*s,b=pc.scale(pc.create(),i,p/o);return Vs.multiply(u,Vs.fromZRotation(u,g),Vs.fromTranslation(Vs.create(),b)),vc.transform(u,E)};return e={numberOfSlices:o+1,capStart:!0,capEnd:!0,repair:a,callback:d},$O(e,l)};var ka=AO;const TO=Je,SO=lt,PO=ka,CO=(e,t)=>{if(!t.isClosed)throw new Error("extruded path must be closed");const r=SO.toPoints(t),n=TO.fromPoints(r);return PO(e,n)};var MO=CO;const OO=Ze,RO=Je,LO=lt,FO=ka,GO=MO,NO=(e,...t)=>{const r={height:1,twistAngle:0,twistSteps:1,repair:!0},{height:n,twistAngle:s,twistSteps:o,repair:a}=Object.assign({},r,e);if(t=OO(t),t.length===0)throw new Error("wrong number of arguments");e={offset:[0,0,n],twistAngle:s,twistSteps:o,repair:a};const i=t.map(c=>LO.isA(c)?GO(e,c):RO.isA(c)?FO(e,c):c);return i.length===1?i[0]:i};var DO=NO;const kO=lt,BO=Sl,IO=ka,zO=(e,t)=>{const r={size:1,height:1},{size:n,height:s}=Object.assign({},r,e);if(e.delta=n,e.offset=[0,0,s],kO.toPoints(t).length===0)throw new Error("the given geometry cannot be empty");const a=BO(e,t);return IO(e,a)};var VO=zO;const{area:UO}=eo,gc=Je,qO=lt,XO=Sl,jO=ka,HO=(e,t)=>{const r={size:1,height:1},{size:n,height:s}=Object.assign({},r,e);e.delta=n,e.offset=[0,0,s];const o=gc.toOutlines(t);if(o.length===0)throw new Error("the given geometry cannot be empty");const i=o.map(l=>(UO(l)<0&&l.reverse(),XO(e,qO.fromPoints({closed:!0},l)))).reduce((l,u)=>l.concat(gc.toSides(u)),[]),c=gc.create(i);return jO(e,c)};var YO=HO;const ZO=Ze,WO=Je,QO=lt,KO=VO,JO=YO,eR=(e,...t)=>{const r={size:1,height:1},{size:n,height:s}=Object.assign({},r,e);if(t=ZO(t),t.length===0)throw new Error("wrong number of arguments");if(n<=0)throw new Error("size must be positive");if(s<=0)throw new Error("height must be positive");const o=t.map(a=>QO.isA(a)?KO(e,a):WO.isA(a)?JO(e,a):a);return o.length===1?o[0]:o};var tR=eR;const rR=Ze,G0=Ma,yc=Pr,N0=dt,D0=Je,ym=et,Jn=st,nR=rn,sR=gm,oR=(e,t)=>{const r=yc.fromNormalAndPoint(yc.create(),e.axis,e.origin);if(Number.isNaN(r[0])||Number.isNaN(r[1])||Number.isNaN(r[2])||Number.isNaN(r[3]))throw new Error("project: invalid axis or origin");const n=nR(t),s=n*n*Math.sqrt(3)/4;if(n===0)return D0.create();const o=ym.toPolygons(t);let a=[];for(let c=0;c<o.length;c++){const l=o[c].vertices.map(h=>yc.projectionOfPoint(r,h)),u=Jn.create(l),d=Jn.plane(u);!G0(r,d)||Jn.measureArea(u)<s||a.push(u)}if(!G0(r,[0,0,1])){const c=N0.fromVectorRotation(N0.create(),r,[0,0,1]);a=a.map(l=>Jn.transform(c,l))}a=a.sort((c,l)=>Jn.measureArea(l)-Jn.measureArea(c));const i=a.map(c=>D0.fromPoints(c.vertices));return sR(i)},aR=(e,...t)=>{const r={axis:[0,0,1],origin:[0,0,0]},{axis:n,origin:s}=Object.assign({},r,e);if(t=rR(t),t.length===0)throw new Error("wrong number of arguments");e={axis:n,origin:s};const o=t.map(a=>ym.isA(a)?oR(e,a):a);return o.length===1?o[0]:o};var iR=aR,cR={extrudeFromSlices:wl,extrudeLinear:DO,extrudeRectangular:tR,extrudeRotate:cm,project:iR,slice:ro};const k0=rt,lR=e=>{let t=k0.fromValues(1/0,1/0);e.forEach(s=>{(s[1]<t[1]||s[1]===t[1]&&s[0]<t[0])&&(t=s)});const r=[];e.forEach(s=>{const o=uR(s[1]-t[1],s[0]-t[0]),a=k0.squaredDistance(s,t);r.push({point:s,angle:o,distSq:a})}),r.sort((s,o)=>s.angle<o.angle?-1:s.angle>o.angle?1:s.distSq<o.distSq?-1:s.distSq>o.distSq?1:0);const n=[];return r.forEach(s=>{let o=n.length;for(;o>1&&fR(n[o-2],n[o-1],s.point)<=Number.EPSILON;)n.pop(),o=n.length;n.push(s.point)}),n},fR=(e,t,r)=>(t[0]-e[0])*(r[1]-e[1])-(t[1]-e[1])*(r[0]-e[0]),uR=(e,t)=>e===0&&t===0?-1/0:-t/e;var bm=lR;const B0=Je,I0=et,z0=lt,dR=e=>{const t=new Set,r=[],n=s=>{const o=s.toString();t.has(o)||(r.push(s),t.add(o))};return e.forEach(s=>{B0.isA(s)?B0.toPoints(s).forEach(n):I0.isA(s)?I0.toPoints(s).forEach(o=>o.forEach(n)):z0.isA(s)&&z0.toPoints(s).forEach(n)}),r};var Pl=dR;const hR=Ze,mR=lt,pR=bm,vR=Pl,gR=(...e)=>{e=hR(e);const t=vR(e),r=pR(t);return mR.fromPoints({closed:!0},r)};var yR=gR;const bR=Ze,V0=Je,wR=bm,_R=Pl,xR=(...e)=>{e=bR(e);const t=_R(e),r=wR(t);return r.length<3?V0.create():V0.fromPoints(r)};var ER=xR;const $R=Ks,U0=_a,q0=Hd,AR=(e,t,r)=>{const n=[],s=[],o=[];U0(n,r,t),U0(s,e,t);const a=q0($R(o,s,n)),i=q0(n);if(i===0)throw Error("a and b are the same point");return a/i},TR=(e,t,r)=>Math.sqrt(AR(e,t,r));var SR=TR;const PR=Ks,CR=al,X0=_a,MR=(e,t,r,n)=>{const s=[0,0,0];return X0(e,t,r),X0(s,r,n),PR(e,e,s),CR(e,e)};var OR=MR;class RR{constructor(){this.head=null,this.tail=null}clear(){this.head=this.tail=null}insertBefore(t,r){r.prev=t.prev,r.next=t,r.prev?r.prev.next=r:this.head=r,t.prev=r}insertAfter(t,r){r.prev=t,r.next=t.next,r.next?r.next.prev=r:this.tail=r,t.next=r}add(t){this.head?this.tail.next=t:this.head=t,t.prev=this.tail,t.next=null,this.tail=t}addAll(t){for(this.head?this.tail.next=t:this.head=t,t.prev=this.tail;t.next;)t=t.next;this.tail=t}remove(t){t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev}removeChain(t,r){t.prev?t.prev.next=r.next:this.head=r.next,r.next?r.next.prev=t.prev:this.tail=t.prev}first(){return this.head}isEmpty(){return!this.head}}var LR=RR;class FR{constructor(t,r){this.point=t,this.index=r,this.next=null,this.prev=null,this.face=null}}var GR=FR;const NR=zd,DR=jd;class kR{constructor(t,r){this.vertex=t,this.face=r,this.next=null,this.prev=null,this.opposite=null}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){return this.tail()?NR(this.tail().point,this.head().point):-1}lengthSquared(){return this.tail()?DR(this.tail().point,this.head().point):-1}setOpposite(t){this.opposite=t,t.opposite=this}}var BR=kR;const bc=Bd,IR=Id,zR=Ks,wc=ba,VR=Vd,UR=al,ta=Xd,_c=_a,xc=BR,wm=0,qR=1,el=2;class Cl{constructor(){this.normal=[],this.centroid=[],this.offset=0,this.outside=null,this.mark=wm,this.edge=null,this.nVertices=0}getEdge(t){if(typeof t!="number")throw Error("requires a number");let r=this.edge;for(;t>0;)r=r.next,t-=1;for(;t<0;)r=r.prev,t+=1;return r}computeNormal(){const t=this.edge,r=t.next;let n=r.next;const s=_c([],r.head().point,t.head().point),o=[],a=[];for(this.nVertices=2,this.normal=[0,0,0];n!==t;)IR(a,s),_c(s,n.head().point,t.head().point),bc(this.normal,this.normal,zR(o,a,s)),n=n.next,this.nVertices+=1;this.area=VR(this.normal),this.normal=ta(this.normal,this.normal,1/this.area)}computeNormalMinArea(t){if(this.computeNormal(),this.area<t){let r,n=0,s=this.edge;do{const u=s.lengthSquared();u>n&&(r=s,n=u),s=s.next}while(s!==this.edge);const o=r.tail().point,a=r.head().point,i=_c([],a,o),c=Math.sqrt(n);ta(i,i,1/c);const l=wc(this.normal,i);ta(i,i,-l),bc(this.normal,this.normal,i),UR(this.normal,this.normal)}}computeCentroid(){this.centroid=[0,0,0];let t=this.edge;do bc(this.centroid,this.centroid,t.head().point),t=t.next;while(t!==this.edge);ta(this.centroid,this.centroid,1/this.nVertices)}computeNormalAndCentroid(t){typeof t<"u"?this.computeNormalMinArea(t):this.computeNormal(),this.computeCentroid(),this.offset=wc(this.normal,this.centroid)}distanceToPlane(t){return wc(this.normal,t)-this.offset}connectHalfEdges(t,r){let n;if(t.opposite.face===r.opposite.face){const s=r.opposite.face;let o;t===this.edge&&(this.edge=r),s.nVertices===3?(o=r.opposite.prev.opposite,s.mark=el,n=s):(o=r.opposite.next,s.edge===o.prev&&(s.edge=o),o.prev=o.prev.prev,o.prev.next=o),r.prev=t.prev,r.prev.next=r,r.setOpposite(o),s.computeNormalAndCentroid()}else t.next=r,r.prev=t;return n}mergeAdjacentFaces(t,r){const n=t.opposite,s=n.face;r.push(s),s.mark=el;let o=t.prev,a=t.next,i=n.prev,c=n.next;for(;o.opposite.face===s;)o=o.prev,c=c.next;for(;a.opposite.face===s;)a=a.next,i=i.prev;let l;for(l=c;l!==i.next;l=l.next)l.face=this;this.edge=a;let u;return u=this.connectHalfEdges(i,a),u&&r.push(u),u=this.connectHalfEdges(o,c),u&&r.push(u),this.computeNormalAndCentroid(),r}collectIndices(){const t=[];let r=this.edge;do t.push(r.head().index),r=r.next;while(r!==this.edge);return t}static createTriangle(t,r,n,s=0){const o=new Cl,a=new xc(t,o),i=new xc(r,o),c=new xc(n,o);return a.next=c.prev=i,i.next=a.prev=c,c.next=i.prev=a,o.edge=a,o.computeNormalAndCentroid(s),o}}var XR={VISIBLE:wm,NON_CONVEX:qR,DELETED:el,Face:Cl};const Ec=ba,jR=SR,HR=OR,j0=LR,YR=GR,{Face:Gr,VISIBLE:es,NON_CONVEX:H0,DELETED:ZR}=XR,WR=1,Y0=2;class QR{constructor(t){if(!Array.isArray(t))throw TypeError("input is not a valid array");if(t.length<4)throw Error("cannot build a simplex out of <4 points");this.tolerance=-1,this.nFaces=0,this.nPoints=t.length,this.faces=[],this.newFaces=[],this.claimed=new j0,this.unclaimed=new j0,this.vertices=[];for(let r=0;r<t.length;r+=1)this.vertices.push(new YR(t[r],r));this.discardedFaces=[],this.vertexPointIndices=[]}addVertexToFace(t,r){t.face=r,r.outside?this.claimed.insertBefore(r.outside,t):this.claimed.add(t),r.outside=t}removeVertexFromFace(t,r){t===r.outside&&(t.next&&t.next.face===r?r.outside=t.next:r.outside=null),this.claimed.remove(t)}removeAllVerticesFromFace(t){if(t.outside){let r=t.outside;for(;r.next&&r.next.face===t;)r=r.next;return this.claimed.removeChain(t.outside,r),r.next=null,t.outside}}deleteFaceVertices(t,r){const n=this.removeAllVerticesFromFace(t);if(n)if(!r)this.unclaimed.addAll(n);else{let s;for(let o=n;o;o=s)s=o.next,r.distanceToPlane(o.point)>this.tolerance?this.addVertexToFace(o,r):this.unclaimed.add(o)}}resolveUnclaimedPoints(t){let r=this.unclaimed.first();for(let n=r;n;n=r){r=n.next;let s=this.tolerance,o;for(let a=0;a<t.length;a+=1){const i=t[a];if(i.mark===es){const c=i.distanceToPlane(n.point);if(c>s&&(s=c,o=i),s>1e3*this.tolerance)break}}o&&this.addVertexToFace(n,o)}}computeExtremes(){const t=[],r=[],n=[],s=[];let o,a;for(o=0;o<3;o+=1)n[o]=s[o]=this.vertices[0];for(o=0;o<3;o+=1)t[o]=r[o]=this.vertices[0].point[o];for(o=1;o<this.vertices.length;o+=1){const i=this.vertices[o],c=i.point;for(a=0;a<3;a+=1)c[a]<t[a]&&(t[a]=c[a],n[a]=i);for(a=0;a<3;a+=1)c[a]>r[a]&&(r[a]=c[a],s[a]=i)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(t[0]),Math.abs(r[0]))+Math.max(Math.abs(t[1]),Math.abs(r[1]))+Math.max(Math.abs(t[2]),Math.abs(r[2]))),[n,s]}createInitialSimplex(){const t=this.vertices,[r,n]=this.computeExtremes();let s,o,a,i,c=0,l=0;for(a=0;a<3;a+=1){const g=n[a].point[a]-r[a].point[a];g>c&&(c=g,l=a)}const u=r[l],d=n[l];for(c=0,a=0;a<this.vertices.length;a+=1){const g=this.vertices[a];if(g!==u&&g!==d){const b=jR(g.point,u.point,d.point);b>c&&(c=b,s=g)}}const h=HR([],u.point,d.point,s.point),p=Ec(u.point,h);for(c=-1,a=0;a<this.vertices.length;a+=1){const g=this.vertices[a];if(g!==u&&g!==d&&g!==s){const b=Math.abs(Ec(h,g.point)-p);b>c&&(c=b,o=g)}}const E=[];if(Ec(o.point,h)-p<0)for(E.push(Gr.createTriangle(u,d,s),Gr.createTriangle(o,d,u),Gr.createTriangle(o,s,d),Gr.createTriangle(o,u,s)),a=0;a<3;a+=1){const g=(a+1)%3;E[a+1].getEdge(2).setOpposite(E[0].getEdge(g)),E[a+1].getEdge(1).setOpposite(E[g+1].getEdge(0))}else for(E.push(Gr.createTriangle(u,s,d),Gr.createTriangle(o,u,d),Gr.createTriangle(o,d,s),Gr.createTriangle(o,s,u)),a=0;a<3;a+=1){const g=(a+1)%3;E[a+1].getEdge(2).setOpposite(E[0].getEdge((3-a)%3)),E[a+1].getEdge(0).setOpposite(E[g+1].getEdge(1))}for(a=0;a<4;a+=1)this.faces.push(E[a]);for(a=0;a<t.length;a+=1){const g=t[a];if(g!==u&&g!==d&&g!==s&&g!==o){c=this.tolerance;let b;for(i=0;i<4;i+=1){const P=E[i].distanceToPlane(g.point);P>c&&(c=P,b=E[i])}b&&this.addVertexToFace(g,b)}}}reindexFaceAndVertices(){const t=[];for(let r=0;r<this.faces.length;r+=1){const n=this.faces[r];n.mark===es&&t.push(n)}this.faces=t}collectFaces(t){const r=[];for(let n=0;n<this.faces.length;n+=1){if(this.faces[n].mark!==es)throw Error("attempt to include a destroyed face in the hull");const s=this.faces[n].collectIndices();if(t)r.push(s);else for(let o=0;o<s.length-2;o+=1)r.push([s[0],s[o+1],s[o+2]])}return r}nextVertexToAdd(){if(!this.claimed.isEmpty()){let t,r,n=0;const s=this.claimed.first().face;for(r=s.outside;r&&r.face===s;r=r.next){const o=s.distanceToPlane(r.point);o>n&&(n=o,t=r)}return t}}computeHorizon(t,r,n,s){this.deleteFaceVertices(n),n.mark=ZR;let o;r?o=r.next:o=r=n.getEdge(0);do{const a=o.opposite,i=a.face;i.mark===es&&(i.distanceToPlane(t)>this.tolerance?this.computeHorizon(t,a,i,s):s.push(o)),o=o.next}while(o!==r)}addAdjoiningFace(t,r){const n=Gr.createTriangle(t,r.tail(),r.head());return this.faces.push(n),n.getEdge(-1).setOpposite(r.opposite),n.getEdge(0)}addNewFaces(t,r){this.newFaces=[];let n,s;for(let o=0;o<r.length;o+=1){const a=r[o],i=this.addAdjoiningFace(t,a);n?i.next.setOpposite(s):n=i,this.newFaces.push(i.face),s=i}n.next.setOpposite(s)}oppositeFaceDistance(t){return t.face.distanceToPlane(t.opposite.face.centroid)}doAdjacentMerge(t,r){let n=t.edge,s=!0,o=0;do{if(o>=t.nVertices)throw Error("merge recursion limit exceeded");const a=n.opposite.face;let i=!1;if(r===Y0?(this.oppositeFaceDistance(n)>-this.tolerance||this.oppositeFaceDistance(n.opposite)>-this.tolerance)&&(i=!0):t.area>a.area?this.oppositeFaceDistance(n)>-this.tolerance?i=!0:this.oppositeFaceDistance(n.opposite)>-this.tolerance&&(s=!1):this.oppositeFaceDistance(n.opposite)>-this.tolerance?i=!0:this.oppositeFaceDistance(n)>-this.tolerance&&(s=!1),i){const c=t.mergeAdjacentFaces(n,[]);for(let l=0;l<c.length;l+=1)this.deleteFaceVertices(c[l],t);return!0}n=n.next,o+=1}while(n!==t.edge);return s||(t.mark=H0),!1}addVertexToHull(t){const r=[];this.unclaimed.clear(),this.removeVertexFromFace(t,t.face),this.computeHorizon(t.point,null,t.face,r),this.addNewFaces(t,r);for(let n=0;n<this.newFaces.length;n+=1){const s=this.newFaces[n];if(s.mark===es)for(;this.doAdjacentMerge(s,WR););}for(let n=0;n<this.newFaces.length;n+=1){const s=this.newFaces[n];if(s.mark===H0)for(s.mark=es;this.doAdjacentMerge(s,Y0););}this.resolveUnclaimedPoints(this.newFaces)}build(){let t;for(this.createInitialSimplex();t=this.nextVertexToAdd();)this.addVertexToHull(t);this.reindexFaceAndVertices()}}var KR=QR;const JR=KR,eL=(e,t={})=>{const r=new JR(e);return r.build(),r.collectFaces(t.skipTriangulation)};var tL=eL;const rL=Ze,nL=et,sL=st,oL=tL,aL=Pl,iL=(...e)=>{if(e=rL(e),e.length===1)return e[0];const t=aL(e),n=oL(t,{skipTriangulation:!0}).map(s=>{const o=s.map(a=>t[a]);return sL.create(o)});return nL.create(n)};var cL=iL;const lL=Ze,fL=no,uL=Je,dL=et,hL=lt,mL=yR,pL=ER,vL=cL,gL=(...e)=>{if(e=lL(e),e.length===0)throw new Error("wrong number of arguments");if(!fL(e))throw new Error("only hulls of the same type are supported");const t=e[0];return hL.isA(t)?mL(e):uL.isA(t)?pL(e):dL.isA(t)?vL(e):t};var _m=gL;const yL=Ze,bL=Tl,wL=_m,_L=(...e)=>{if(e=yL(e),e.length<2)throw new Error("wrong number of arguments");const t=[];for(let r=1;r<e.length;r++)t.push(wL(e[r-1],e[r]));return bL(t)};var xL=_L,xm={hull:_m,hullChain:xL};const $c=ze,Em=st,EL=(e,t)=>{const r=Math.abs(Em.measureArea(t));return Number.isFinite(r)&&r>e},$L=(e,t)=>{let r=t.map(s=>{const o=s.vertices.map(c=>$c.snap($c.create(),c,e)),a=[];for(let c=0;c<o.length;c++){const l=(c+1)%o.length;$c.equals(o[c],o[l])||a.push(o[c])}const i=Em.create(a);return s.color&&(i.color=s.color),i});const n=e*e*Math.sqrt(3)/4;return r=r.filter(s=>EL(n,s)),r};var $m=$L;const AL=Ma,ns=ze,va=st,TL=e=>{const t=va.toPoints(e),r=[];for(let n=0;n<t.length;n++){const s=(n+1)%t.length,o={v1:t[n],v2:t[s]};r.push(o)}for(let n=0;n<r.length;n++){const s=(n+1)%t.length;r[n].next=r[s],r[s].prev=r[n]}return r},SL=(e,t)=>{const r=`${t.v1}:${t.v2}`;e.set(r,t)},Ac=(e,t)=>{const r=`${t.v1}:${t.v2}`;e.delete(r)},PL=(e,t)=>{const r=`${t.v2}:${t.v1}`;return e.get(r)},CL=(e,t,r)=>{let n=e.prev.v1,s=e.prev.v2,o=t.next.v2;const a=Z0(n,s,o,r);n=t.prev.v1,s=t.prev.v2,o=e.next.v2;const i=Z0(n,s,o,r);return[a,i]},ML=ns.create(),OL=ns.create(),Z0=(e,t,r,n)=>{const s=ns.subtract(ML,t,e),o=ns.subtract(OL,r,t);return ns.cross(s,s,o),ns.dot(s,n)},RL=e=>{let t;const r=[];for(;e.next;){const n=e.next;r.push(e.v1),e.v1=null,e.v2=null,e.next=null,e.prev=null,e=n}return r.length>0&&(t=va.create(r)),t},LL=e=>{if(e.length<2)return e;const t=e[0].plane,r=e.slice(),n=new Map;for(;r.length>0;){const o=r.shift(),a=TL(o);for(let i=0;i<a.length;i++){const c=a[i],l=PL(n,c);if(l){const u=CL(c,l,t);if(u[0]>=0&&u[1]>=0){const d=l.next,h=c.next;c.prev.next=l.next,c.next.prev=l.prev,l.prev.next=c.next,l.next.prev=c.prev,c.v1=null,c.v2=null,c.next=null,c.prev=null,Ac(n,l),l.v1=null,l.v2=null,l.next=null,l.prev=null;const p=(E,g,b)=>{const P={v1:b.v1,v2:g.v2,next:g.next,prev:b.prev};b.prev.next=P,g.next.prev=P,Ac(E,g),g.v1=null,g.v2=null,g.next=null,g.prev=null,Ac(E,b),b.v1=null,b.v2=null,b.next=null,b.prev=null};u[0]===0&&p(n,d,d.prev),u[1]===0&&p(n,h,h.prev)}}else c.next&&SL(n,c)}}const s=[];return n.forEach(o=>{const a=RL(o);a&&s.push(a)}),n.clear(),s},FL=(e,t)=>Math.abs(e[3]-t[3])<15e-8?AL(e,t):!1,GL=(e,t)=>{const r=[];t.forEach(s=>{const o=r.find(a=>FL(a[0],va.plane(s)));o?o[1].push(s):r.push([va.plane(s),[s]])});let n=[];return r.forEach(s=>{const o=s[1],a=LL(o);n=n.concat(a)}),n};var NL=GL;const W0=it,Ar=ze,DL=st,Ht=e=>`${e}`,Q0=(e,t,r,n,s,o)=>{const a=Ht(n),i=Ht(s),c=`${a}/${i}`,l=`${i}/${a}`;if(e.has(l))return la(e,t,r,s,n,null),null;const u={vertex0:n,vertex1:s,polygonindex:o};return e.has(c)?e.get(c).push(u):e.set(c,[u]),t.has(a)?t.get(a).push(c):t.set(a,[c]),r.has(i)?r.get(i).push(c):r.set(i,[c]),c},la=(e,t,r,n,s,o)=>{const a=Ht(n),i=Ht(s),c=`${a}/${i}`;let l=-1;const u=e.get(c);for(let d=0;d<u.length;d++){const h=u[d];let p=Ht(h.vertex0);if(p===a&&(p=Ht(h.vertex1),p===i&&!(o!==null&&h.polygonindex!==o))){l=d;break}}u.splice(l,1),u.length===0&&e.delete(c),l=t.get(a).indexOf(c),t.get(a).splice(l,1),t.get(a).length===0&&t.delete(a),l=r.get(i).indexOf(c),r.get(i).splice(l,1),r.get(i).length===0&&r.delete(i)},kL=e=>{const t=new Map;for(let r=0;r<e.length;r++){const n=e[r],s=n.vertices.length;if(s>=3){let o=n.vertices[0],a=Ht(o);for(let i=0;i<s;i++){let c=i+1;c===s&&(c=0);const l=n.vertices[c],u=Ht(l),d=`${a}/${u}`,h=`${u}/${a}`;if(t.has(h)){const p=t.get(h);p.splice(-1,1),p.length===0&&t.delete(h)}else{const p={vertex0:o,vertex1:l,polygonindex:r};t.has(d)?t.get(d).push(p):t.set(d,[p])}o=l,a=u}}else console.warn("warning: invalid polygon found during insertTjunctions")}if(t.size>0){const r=new Map,n=new Map,s=new Map;for(const[a,i]of t)s.set(a,!0),i.forEach(c=>{const l=Ht(c.vertex0),u=Ht(c.vertex1);r.has(l)?r.get(l).push(a):r.set(l,[a]),n.has(u)?n.get(u).push(a):n.set(u,[a])});const o=e.slice(0);for(;t.size!==0;){for(const i of t.keys())s.set(i,!0);let a=!1;for(;;){const i=Array.from(s.keys());if(i.length===0)break;const c=i[0];let l=!0;if(t.has(c)){const d=t.get(c)[0];for(let h=0;h<2;h++){const p=h===0?d.vertex0:d.vertex1,E=h===0?d.vertex1:d.vertex0,g=Ht(p),b=Ht(E);let P=[];h===0?n.has(g)&&(P=n.get(g)):r.has(g)&&(P=r.get(g));for(let F=0;F<P.length;F++){const R=P[F],M=t.get(R)[0],G=h===0?M.vertex0:M.vertex1;if(h===0?M.vertex1:M.vertex0,Ht(G)===b){la(t,r,n,p,E,null),la(t,r,n,E,p,null),l=!1,h=2,a=!0;break}else{const U=p,ee=E,oe=G,pe=Ar.subtract(Ar.create(),oe,U),Q=Ar.dot(Ar.subtract(Ar.create(),ee,U),pe)/Ar.dot(pe,pe);if(Q>0&&Q<1){const Se=Ar.scale(Ar.create(),pe,Q);if(Ar.add(Se,Se,U),Ar.squaredDistance(Se,ee)<W0.EPS*W0.EPS){const $e=M.polygonindex,Xe=o[$e],Ne=Ht(M.vertex1);let Lt=-1;for(let br=0;br<Xe.vertices.length;br++)if(Ht(Xe.vertices[br])===Ne){Lt=br;break}const Nt=Xe.vertices.slice(0);Nt.splice(Lt,0,E);const Nr=DL.create(Nt);o[$e]=Nr,la(t,r,n,M.vertex0,M.vertex1,$e);const yr=Q0(t,r,n,M.vertex0,E,$e),Dr=Q0(t,r,n,E,M.vertex1,$e);yr!==null&&s.set(yr,!0),Dr!==null&&s.set(Dr,!0),l=!1,h=2,a=!0;break}}}}}}l&&s.delete(c)}if(!a)break}e=o}return t.clear(),e};var BL=kL;const Tc=ze,Sc=st,IL=(e,t,r)=>{const n=t.vertices.length;if(n>3){if(n>4){const a=[0,0,0];t.vertices.forEach(i=>Tc.add(a,a,i)),Tc.snap(a,Tc.divide(a,a,[n,n,n]),e);for(let i=0;i<n;i++){const c=Sc.create([a,t.vertices[i],t.vertices[(i+1)%n]]);t.color&&(c.color=t.color),r.push(c)}return}const s=Sc.create([t.vertices[0],t.vertices[1],t.vertices[2]]),o=Sc.create([t.vertices[0],t.vertices[2],t.vertices[3]]);t.color&&(s.color=t.color,o.color=t.color),r.push(s,o);return}r.push(t)},zL=(e,t)=>{const r=[];return t.forEach(n=>{IL(e,n,r)}),r};var VL=zL;const UL=Ze,qL=rn,XL=Je,Am=et,jL=lt,HL=$m,YL=NL,ZL=BL,WL=VL,QL=(e,t)=>t,KL=(e,t)=>t,JL=(e,t)=>{const r={snap:!1,simplify:!1,triangulate:!1},{snap:n,simplify:s,triangulate:o}=Object.assign({},r,e),a=qL(t);let i=Am.toPolygons(t);n&&(i=HL(a,i)),s&&(i=YL(a,i)),o&&(i=ZL(i),i=WL(a,i));const c=Object.assign({},t);return c.polygons=i,c},eF=(e,...t)=>{if(t=UL(t),t.length===0)throw new Error("wrong number of arguments");const r=t.map(n=>{if(jL.isA(n))return QL(e,n);if(XL.isA(n))return KL(e,n);if(Am.isA(n))return JL(e,n);throw new Error("invalid geometry")});return r.length===1?r[0]:r};var tF=eF;const rF=Ze,An=rt,tl=Je,rl=et,nl=lt,Ml=rn,nF=$m,sF=e=>{const t=Ml(e),n=nl.toPoints(e).map(s=>An.snap(An.create(),s,t));return nl.create(n)},oF=e=>{const t=Ml(e);let n=tl.toSides(e).map(s=>[An.snap(An.create(),s[0],t),An.snap(An.create(),s[1],t)]);return n=n.filter(s=>!An.equals(s[0],s[1])),tl.create(n)},aF=e=>{const t=Ml(e),r=rl.toPolygons(e),n=nF(t,r);return rl.create(n)},iF=(...e)=>{if(e=rF(e),e.length===0)throw new Error("wrong number of arguments");const t=e.map(r=>nl.isA(r)?sF(r):tl.isA(r)?oF(r):rl.isA(r)?aF(r):r);return t.length===1?t[0]:t};var cF=iF,lF={generalize:tF,snap:cF};const fF=(e,t,r)=>{for(e=e.slice();e.length<r;)e.push(t);return e};var uF=fF;const dF=Ze,K0=uF,Tm=vl,{translate:hF}=Tn,mF=e=>{if(!Array.isArray(e.modes)||e.modes.length>3)throw new Error("align(): modes must be an array of length <= 3");if(e.modes=K0(e.modes,"none",3),e.modes.filter(t=>["center","max","min","none"].includes(t)).length!==3)throw new Error('align(): all modes must be one of "center", "max" or "min"');if(!Array.isArray(e.relativeTo)||e.relativeTo.length>3)throw new Error("align(): relativeTo must be an array of length <= 3");if(e.relativeTo=K0(e.relativeTo,0,3),e.relativeTo.filter(t=>Number.isFinite(t)||t==null).length!==3)throw new Error("align(): all relativeTo values must be a number, or null.");if(typeof e.grouped!="boolean")throw new Error("align(): grouped must be a boolean value.");return e},pF=(e,t,r)=>{for(let n=0;n<3;n++)e[n]==null&&(t[n]==="center"?e[n]=(r[0][n]+r[1][n])/2:t[n]==="max"?e[n]=r[1][n]:t[n]==="min"&&(e[n]=r[0][n]));return e},J0=(e,t,r)=>{const n=Tm(e),s=[0,0,0];for(let o=0;o<3;o++)t[o]==="center"?s[o]=r[o]-(n[0][o]+n[1][o])/2:t[o]==="max"?s[o]=r[o]-n[1][o]:t[o]==="min"&&(s[o]=r[o]-n[0][o]);return hF(s,e)},vF=(e,...t)=>{e=Object.assign({},{modes:["center","center","min"],relativeTo:[0,0,0],grouped:!1},e),e=mF(e);let{modes:n,relativeTo:s,grouped:o}=e;if(t=dF(t),t.length===0)throw new Error("align(): No geometries were provided to act upon");if(s.filter(a=>a==null).length){const a=Tm(t);s=pF(s,n,a)}return o?t=J0(t,n,s):t=t.map(a=>J0(a,n,s)),t.length===1?t[0]:t};var gF=vF;const yF=Ze,bF=Je,wF=et,_F=lt,xF=Cn,{translate:EF}=Tn,Pc=(e,t)=>{const r={axes:[!0,!0,!0],relativeTo:[0,0,0]},{axes:n,relativeTo:s}=Object.assign({},r,e),o=xF(t),a=[0,0,0];return n[0]&&(a[0]=s[0]-(o[0][0]+(o[1][0]-o[0][0])/2)),n[1]&&(a[1]=s[1]-(o[0][1]+(o[1][1]-o[0][1])/2)),n[2]&&(a[2]=s[2]-(o[0][2]+(o[1][2]-o[0][2])/2)),EF(a,t)},Ba=(e,...t)=>{const r={axes:[!0,!0,!0],relativeTo:[0,0,0]},{axes:n,relativeTo:s}=Object.assign({},r,e);if(t=yF(t),t.length===0)throw new Error("wrong number of arguments");if(s.length!==3)throw new Error("relativeTo must be an array of length 3");e={axes:n,relativeTo:s};const o=t.map(a=>_F.isA(a)||bF.isA(a)||wF.isA(a)?Pc(e,a):a);return o.length===1?o[0]:o},$F=(...e)=>Ba({axes:[!0,!1,!1]},e),AF=(...e)=>Ba({axes:[!1,!0,!1]},e),TF=(...e)=>Ba({axes:[!1,!1,!0]},e);var ra={center:Ba,centerX:$F,centerY:AF,centerZ:TF};const SF=Ze,ed=dt,td=Je,rd=et,nd=lt,Ia=(e,...t)=>{if(!Array.isArray(e))throw new Error("factors must be an array");if(t=SF(t),t.length===0)throw new Error("wrong number of arguments");for(e=e.slice();e.length<3;)e.push(1);if(e[0]<=0||e[1]<=0||e[2]<=0)throw new Error("factors must be positive");const r=ed.fromScaling(ed.create(),e),n=t.map(s=>nd.isA(s)?nd.transform(r,s):td.isA(s)?td.transform(r,s):rd.isA(s)?rd.transform(r,s):s);return n.length===1?n[0]:n},PF=(e,...t)=>Ia([e,1,1],t),CF=(e,...t)=>Ia([1,e,1],t),MF=(e,...t)=>Ia([1,1,e],t);var na={scale:Ia,scaleX:PF,scaleY:CF,scaleZ:MF};const OF=Ze,sd=Je,od=et,ad=lt,RF=(e,...t)=>{if(t=OF(t),t.length===0)throw new Error("wrong number of arguments");const r=t.map(n=>ad.isA(n)?ad.transform(e,n):sd.isA(n)?sd.transform(e,n):od.isA(n)?od.transform(e,n):n);return r.length===1?r[0]:r};var LF=RF,$t={align:gF,center:ra.center,centerX:ra.centerX,centerY:ra.centerY,centerZ:ra.centerZ,mirror:Xs.mirror,mirrorX:Xs.mirrorX,mirrorY:Xs.mirrorY,mirrorZ:Xs.mirrorZ,rotate:Hs.rotate,rotateX:Hs.rotateX,rotateY:Hs.rotateY,rotateZ:Hs.rotateZ,scale:na.scale,scaleX:na.scaleX,scaleY:na.scaleY,scaleZ:na.scaleZ,transform:LF,translate:Tn.translate,translateX:Tn.translateX,translateY:Tn.translateY,translateZ:Tn.translateZ},gr={colors:YE,curves:n$,geometries:dl,maths:BA,measurements:rT,primitives:lm,text:o6,utils:Ct,booleans:Na,expansions:xO,extrusions:cR,hulls:xm,modifiers:lF,transforms:$t};const Sm=e=>e.reduce((t,r)=>Array.isArray(r)?t.concat(Sm(r)):t.concat(r),[]);var FF=Sm;const GF=(e,t)=>e-t;var NF=GF;const DF=e=>{if(!(!Array.isArray(e)||e.length===0))return e[0]};var kF=DF;const BF=(e,t,r)=>{let n=0,s=e.length;for(;s>n;){const o=Math.floor((n+s)/2),a=e[o];r(t,a)>0?n=o+1:s=o}return e.splice(n,0,t),e};var IF=BF;const zF=(e,t)=>{if(!(!Array.isArray(e)||e.length<t))return e[t]};var VF=zF;const UF=(e,t,r)=>{for(e=e.slice();e.length<r;)e.push(t);return e};var qF=UF;const XF=e=>Array.isArray(e)?e:e==null?[]:[e];var jF=XF,Ol={flatten:FF,fnNumberSort:NF,head:kF,insertSorted:IF,nth:VF,padToLength:qF,toArray:jF};const{geometries:Cc}=gr,HF=(e,t)=>{t.statusCallback&&t.statusCallback({progress:0});const r=new ArrayBuffer(4),n=new Int32Array(r,0,1),s=new Int8Array(r,0,4);if(n[0]=287454020,s[0]!==68)throw new Error("Binary STL output is currently only supported on little-endian (Intel) processors");let o=0,a=0;e.forEach((b,P)=>{Cc.geom3.toPolygons(b).forEach(R=>{const M=R.vertices.length;o+=M>=3?M-2:0,a+=1})});const i=new Uint8Array(80);for(let b=0;b<80;b++)i[b]=65;const c=new Uint32Array(1);c[0]=o;const l=new ArrayBuffer(50*o),u=new Int8Array(l),d=new ArrayBuffer(50),h=new Int8Array(d),p=new Float32Array(d,0,12),E=new Uint16Array(d,48,1);let g=0;return e.forEach(b=>{Cc.geom3.toPolygons(b).forEach((F,R)=>{const M=F.vertices,G=M.length,L=Cc.poly3.plane(F);for(let U=0;U<G-2;U++){p[0]=L[0],p[1]=L[1],p[2]=L[2];let ee=3;for(let oe=0;oe<3;oe++){const pe=oe+(oe>0?U:0),Q=M[pe];p[ee++]=Q[0],p[ee++]=Q[1],p[ee++]=Q[2]}E[0]=0,u.set(h,g),g+=50}t.statusCallback&&t.statusCallback({progress:100*R/a})})}),t.statusCallback&&t.statusCallback({progress:100}),[i.buffer,c.buffer,l]};var YF={serializeBinary:HF};const{geometries:Pm}=gr,ZF=(e,t)=>{t.statusCallback&&t.statusCallback({progress:0});const r=`solid JSCAD
${WF(e,t)}
endsolid JSCAD
`;return t.statusCallback&&t.statusCallback({progress:100}),[r]},WF=(e,t)=>{const r=[];return e.forEach((n,s)=>{r.push(QF(n)),t.statusCallback&&t.statusCallback({progress:100*s/e.length})}),r.join(`
`)},QF=(e,t)=>{const r=[];return Pm.geom3.toPolygons(e).forEach((s,o)=>{r.push(KF(s))}),r.join(`
`)},Cm=e=>`${e[0]} ${e[1]} ${e[2]}`,Mc=e=>`vertex ${Cm(e)}`,KF=e=>{const t=[];if(e.vertices.length>=3){const r=Mc(e.vertices[0]);for(let n=0;n<e.vertices.length-2;n++){const s=`facet normal ${Cm(Pm.poly3.plane(e))}
outer loop
${r}
${Mc(e.vertices[n+1])}
${Mc(e.vertices[n+2])}
endloop
endfacet`;t.push(s)}}return t.join(`
`)};var JF={serializeText:ZF};const{geometries:eG,modifiers:tG}=gr,{flatten:rG,toArray:nG}=Ol,{serializeBinary:sG}=YF,{serializeText:oG}=JF,aG="application/sla",iG=(e,...t)=>{e=Object.assign({},{binary:!0,statusCallback:null},e),t=rG(t);let n=t.filter(s=>eG.geom3.isA(s));if(n.length===0)throw new Error("only 3D geometries can be serialized to STL");return t.length!==n.length&&console.warn("some objects could not be serialized to STL"),n=nG(tG.generalize({snap:!0,triangulate:!0},n)),e.binary?sG(n,e):oG(n,e)};var cG={mimeType:aG,serialize:iG};const{cylinder:id,cuboid:QD,polygon:KD}=gr.primitives,{translateZ:JD,translate:cd,translateY:ek,translateX:tk,rotateZ:rk,rotate:nk}=gr.transforms,{subtract:lG,intersect:sk,union:fG}=gr.booleans,uG=({radius:e,height:t,wallThickness:r})=>lG([id({height:t,radius:e+r,segments:6}),id({height:t,radius:e-r,segments:6})]),dG=({size:e,height:t,wallThickness:r,rows:n,cols:s})=>{const o=[],a=hG(e),i=e*2;for(let c=0;c<n;c++){const l=i*c*.75;for(let u=0;u<s;u++){const d=a/2*(c%2)+u*a;o.push(cd([l,d,0],uG({radius:e,height:t,wallThickness:r})))}}return cd([0,0,t/2],fG(o))},hG=e=>Math.sqrt(3)*e,{translate:wt,scale:mG,mirrorX:ok,rotateX:ss}=gr.transforms,{cylinder:Zt,cuboid:ct,triangle:Mm}=gr.primitives,{hull:pG}=gr.hulls,{subtract:vr,union:ur}=gr.booleans,{extrudeLinear:Om}=gr.extrusions,ld=()=>$t.translateY(1,ss(Ct.degToRad(90),Om({height:2},Mm({type:"AAS",values:[Ct.degToRad(90),Ct.degToRad(60),24]})))),fd=()=>vr(ur(wt([1,0,6],ct({size:[2,10,22]})),wt([2,4,-4],ld()),wt([2,-4,-4],ld())),ct({size:[10,3,5.5],center:[0,0,12]})),Oc=e=>$t.rotateZ(Ct.degToRad(90),ur($t.translateZ(e/2,Zt({height:e,radius:11,segments:32})),ct({size:[30,25,e],center:[0,-7.5,e/2]}))),ud=(e=22,t=8,r=18,n=18.5)=>$t.translateZ(r/2,ur(vr(ct({size:[t,e,r]}),Na.intersect($t.rotateY(Ct.degToRad(90),Zt({segments:32,height:t,radius:10})),ct({size:[t,n,e]})),$t.translateZ(12,ct({size:[t,n,r]})),wt([-2.5/2,0,2.5],ct({size:[3.5,25,5.5]})),wt([-t/2,0,-t/2+2],$t.rotate([Ct.degToRad(90),Ct.degToRad(-45),Ct.degToRad(90)],Om({height:t},Mm({type:"AAS",values:[Ct.degToRad(90),Ct.degToRad(45),e]}))))))),dd=()=>ur(ct({size:[Math.sqrt(2.5*2.5*2),10,1]}),vr($t.translateZ(.5,$t.rotateY(Ct.degToRad(45),ct({size:[2.5,10,2.5]}))),$t.translateZ(-1,ct({size:[Math.sqrt(2.5*2.5*2),10,1]})))),sa=()=>{const n=[];for(let s=0;s<6;s++)n.push(wt([0,-2.5,-5+s*2],$t.rotate([Ct.degToRad(45),0,0],ct({size:[50,2,2]}))));return wt([0,0,7.5],ur(vr(ct({size:[8.5,5,15+2],center:[0,0,-1]}),ct({size:[8.5-2*2,5-2,15],center:[0,-1,0]}),...n,$t.translateZ(3,dd()),$t.translateZ(-5,dd()))))},vG=()=>ur(Zt({height:25,radius:5,center:[5,0,12.5]}),ct({center:[2.5,0,10],size:[5,10,20]}),ss(Ct.degToRad(90),Na.intersect(Zt({height:10,radius:20,segments:20}),ct({size:[40,40,40],center:[-20,20,0]}))),lm.sphere({radius:5,center:[5,0,25]})),gG=(e,t=12,r=3)=>vr(ct({size:[t+2*r,e+6*r,r],center:[0,0,r/2]}),ct({size:[t,e,r],center:[0,0,r/2]}),ct({size:[t,r,r],center:[0,e/2+1.5*r,r/2]}),ct({size:[t,r,r],center:[0,-e/2-1.5*r,r/2]})),yG=()=>{const c=[[-14,22.5],[-66.2,27.5],[-66.2,55.5],[-15.5,71],[-96.7,22.5],[-90.4,71],[-128.5,61.5]];return[ur(wt([2,0,2],vr(ur(wt([-16,25/2+1,1.5],ss(Ct.degToRad(15),fd())),wt([-16,93.5-25/2-1,1.5],ss(Ct.degToRad(-15),fd())),wt([-13-44.25,25/2,2.5],ss(Ct.degToRad(15),ur(ud(25,8.5),$t.translateZ(-5,ct({size:[8.5,25,10]}))))),wt([-13-44.25,93.5-25/2,2.5],ss(Ct.degToRad(-15),ur(ud(25,8.5),$t.translateZ(-5,ct({size:[8.5,25,10]}))))),ct({size:[16,21,2],center:[-10,10.5,-2/2]}),ct({size:[16,21,2],center:[-10,93.5-10.5,-2/2]}),ct({size:[14,25+8,2],center:[-57,(25+8)/2,-2/2]}),ct({size:[14,25+8,2],center:[-57,93.5-(25+8)/2,-2/2]}),ct({size:[12,20,2],center:[-8.5,21,-2/2]}),ct({size:[12,20,2],center:[-8.5,93.5-21,-2/2]})),ct({size:[134,93.5,10],center:[-134/2,93.5/2,-7]}))),...c.map(([l,u])=>bG(l,u,2)),vr(ur(vr($t.translateZ(2,Rc(60,93.5,2)),wt([-2,2,2],Rc(60-2,93.5-4,2))),vr(Na.intersect(wt([-134*1.5-6,10,0],dG({cols:20,rows:40,height:2,size:8.445,wallThickness:1})),ur($t.translateZ(2,Rc(60,93.5,2)),$t.translateZ(2/2,wG(134,93.5,2))))),$t.translateZ(2/2,_G(134,93.5,2))),wt([-12,93.5/2,0],Oc(2)),...c.map(([l,u])=>Zt({height:2,radius:5,segments:6,center:[l,u,2/2]}))),vr(mG([1.1,1.1,1],wt([-12,93.5*1/1.1/2,0],Oc(2))),wt([-12,93.5/2,0],Oc(2)),ct({size:[10,50,10],center:[5,93.5/2,0]})),wt([-11-44.25,29,2],sa()),wt([-11-44.25,93.5-29,2],$t.rotateZ(Ct.degToRad(180),sa())),wt([-16,28,2],sa()),wt([-16,93.5-28,2],$t.rotateZ(Ct.degToRad(180),sa())),wt([-134+20,93.5/2,0],vG()),wt([-134+20,93.5/2,0],gG(63.5)))]},Rc=(e,t,r)=>ct({size:[e,t,r],center:[-e/2,t/2,-r/2]}),bG=(e,t,r)=>vr(Zt({height:r,radius:5,segments:6,center:[e,t,r/2]}),Zt({height:r,radius:1.25,segments:32,center:[e,t,r/2]})),wG=(e,t,r)=>pG(Zt({height:r,radius:5,segments:6,center:[-60,5,0]}),Zt({height:r,radius:5,segments:6,center:[-60,t-5,0]}),Zt({height:r,radius:5,segments:6,center:[-e+5,29,0]}),Zt({height:r,radius:5,segments:6,center:[-e+5,t-29,0]})),_G=(e,t,r)=>xm.hullChain(Zt({height:r,radius:1,segments:32,center:[-62,t-1,0]}),Zt({height:r,radius:1,segments:32,center:[-e+1,t-25,0]}),Zt({height:r,radius:1,segments:32,center:[-e+1,25,0]}),Zt({height:r,radius:1,segments:32,center:[-62,1,0]}));var xG=EG;function EG(){var e=new Float32Array(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var $G=AG;function AG(e){var t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}var TG=SG;function SG(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}var Rm=PG;function PG(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var CG=MG;function MG(e,t){if(e===t){var r=t[1],n=t[2],s=t[3],o=t[6],a=t[7],i=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=o,e[11]=t[14],e[12]=s,e[13]=a,e[14]=i}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}var OG=RG;function RG(e,t){var r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],i=t[5],c=t[6],l=t[7],u=t[8],d=t[9],h=t[10],p=t[11],E=t[12],g=t[13],b=t[14],P=t[15],F=r*i-n*a,R=r*c-s*a,M=r*l-o*a,G=n*c-s*i,L=n*l-o*i,U=s*l-o*c,ee=u*g-d*E,oe=u*b-h*E,pe=u*P-p*E,Q=d*b-h*g,Se=d*P-p*g,qe=h*P-p*b,$e=F*qe-R*Se+M*Q+G*pe-L*oe+U*ee;return $e?($e=1/$e,e[0]=(i*qe-c*Se+l*Q)*$e,e[1]=(s*Se-n*qe-o*Q)*$e,e[2]=(g*U-b*L+P*G)*$e,e[3]=(h*L-d*U-p*G)*$e,e[4]=(c*pe-a*qe-l*oe)*$e,e[5]=(r*qe-s*pe+o*oe)*$e,e[6]=(b*M-E*U-P*R)*$e,e[7]=(u*U-h*M+p*R)*$e,e[8]=(a*Se-i*pe+l*ee)*$e,e[9]=(n*pe-r*Se-o*ee)*$e,e[10]=(E*L-g*M+P*F)*$e,e[11]=(d*M-u*L-p*F)*$e,e[12]=(i*oe-a*Q-c*ee)*$e,e[13]=(r*Q-n*oe+s*ee)*$e,e[14]=(g*R-E*G-b*F)*$e,e[15]=(u*G-d*R+h*F)*$e,e):null}var LG=FG;function FG(e,t){var r=t[0],n=t[1],s=t[2],o=t[3],a=t[4],i=t[5],c=t[6],l=t[7],u=t[8],d=t[9],h=t[10],p=t[11],E=t[12],g=t[13],b=t[14],P=t[15];return e[0]=i*(h*P-p*b)-d*(c*P-l*b)+g*(c*p-l*h),e[1]=-(n*(h*P-p*b)-d*(s*P-o*b)+g*(s*p-o*h)),e[2]=n*(c*P-l*b)-i*(s*P-o*b)+g*(s*l-o*c),e[3]=-(n*(c*p-l*h)-i*(s*p-o*h)+d*(s*l-o*c)),e[4]=-(a*(h*P-p*b)-u*(c*P-l*b)+E*(c*p-l*h)),e[5]=r*(h*P-p*b)-u*(s*P-o*b)+E*(s*p-o*h),e[6]=-(r*(c*P-l*b)-a*(s*P-o*b)+E*(s*l-o*c)),e[7]=r*(c*p-l*h)-a*(s*p-o*h)+u*(s*l-o*c),e[8]=a*(d*P-p*g)-u*(i*P-l*g)+E*(i*p-l*d),e[9]=-(r*(d*P-p*g)-u*(n*P-o*g)+E*(n*p-o*d)),e[10]=r*(i*P-l*g)-a*(n*P-o*g)+E*(n*l-o*i),e[11]=-(r*(i*p-l*d)-a*(n*p-o*d)+u*(n*l-o*i)),e[12]=-(a*(d*b-h*g)-u*(i*b-c*g)+E*(i*h-c*d)),e[13]=r*(d*b-h*g)-u*(n*b-s*g)+E*(n*h-s*d),e[14]=-(r*(i*b-c*g)-a*(n*b-s*g)+E*(n*c-s*i)),e[15]=r*(i*h-c*d)-a*(n*h-s*d)+u*(n*c-s*i),e}var GG=NG;function NG(e){var t=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],i=e[6],c=e[7],l=e[8],u=e[9],d=e[10],h=e[11],p=e[12],E=e[13],g=e[14],b=e[15],P=t*a-r*o,F=t*i-n*o,R=t*c-s*o,M=r*i-n*a,G=r*c-s*a,L=n*c-s*i,U=l*E-u*p,ee=l*g-d*p,oe=l*b-h*p,pe=u*g-d*E,Q=u*b-h*E,Se=d*b-h*g;return P*Se-F*Q+R*pe+M*oe-G*ee+L*U}var DG=kG;function kG(e,t,r){var n=t[0],s=t[1],o=t[2],a=t[3],i=t[4],c=t[5],l=t[6],u=t[7],d=t[8],h=t[9],p=t[10],E=t[11],g=t[12],b=t[13],P=t[14],F=t[15],R=r[0],M=r[1],G=r[2],L=r[3];return e[0]=R*n+M*i+G*d+L*g,e[1]=R*s+M*c+G*h+L*b,e[2]=R*o+M*l+G*p+L*P,e[3]=R*a+M*u+G*E+L*F,R=r[4],M=r[5],G=r[6],L=r[7],e[4]=R*n+M*i+G*d+L*g,e[5]=R*s+M*c+G*h+L*b,e[6]=R*o+M*l+G*p+L*P,e[7]=R*a+M*u+G*E+L*F,R=r[8],M=r[9],G=r[10],L=r[11],e[8]=R*n+M*i+G*d+L*g,e[9]=R*s+M*c+G*h+L*b,e[10]=R*o+M*l+G*p+L*P,e[11]=R*a+M*u+G*E+L*F,R=r[12],M=r[13],G=r[14],L=r[15],e[12]=R*n+M*i+G*d+L*g,e[13]=R*s+M*c+G*h+L*b,e[14]=R*o+M*l+G*p+L*P,e[15]=R*a+M*u+G*E+L*F,e}var BG=IG;function IG(e,t,r){var n=r[0],s=r[1],o=r[2],a,i,c,l,u,d,h,p,E,g,b,P;return t===e?(e[12]=t[0]*n+t[4]*s+t[8]*o+t[12],e[13]=t[1]*n+t[5]*s+t[9]*o+t[13],e[14]=t[2]*n+t[6]*s+t[10]*o+t[14],e[15]=t[3]*n+t[7]*s+t[11]*o+t[15]):(a=t[0],i=t[1],c=t[2],l=t[3],u=t[4],d=t[5],h=t[6],p=t[7],E=t[8],g=t[9],b=t[10],P=t[11],e[0]=a,e[1]=i,e[2]=c,e[3]=l,e[4]=u,e[5]=d,e[6]=h,e[7]=p,e[8]=E,e[9]=g,e[10]=b,e[11]=P,e[12]=a*n+u*s+E*o+t[12],e[13]=i*n+d*s+g*o+t[13],e[14]=c*n+h*s+b*o+t[14],e[15]=l*n+p*s+P*o+t[15]),e}var zG=VG;function VG(e,t,r){var n=r[0],s=r[1],o=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}var UG=qG;function qG(e,t,r,n){var s=n[0],o=n[1],a=n[2],i=Math.sqrt(s*s+o*o+a*a),c,l,u,d,h,p,E,g,b,P,F,R,M,G,L,U,ee,oe,pe,Q,Se,qe,$e,Xe;return Math.abs(i)<1e-6?null:(i=1/i,s*=i,o*=i,a*=i,c=Math.sin(r),l=Math.cos(r),u=1-l,d=t[0],h=t[1],p=t[2],E=t[3],g=t[4],b=t[5],P=t[6],F=t[7],R=t[8],M=t[9],G=t[10],L=t[11],U=s*s*u+l,ee=o*s*u+a*c,oe=a*s*u-o*c,pe=s*o*u-a*c,Q=o*o*u+l,Se=a*o*u+s*c,qe=s*a*u+o*c,$e=o*a*u-s*c,Xe=a*a*u+l,e[0]=d*U+g*ee+R*oe,e[1]=h*U+b*ee+M*oe,e[2]=p*U+P*ee+G*oe,e[3]=E*U+F*ee+L*oe,e[4]=d*pe+g*Q+R*Se,e[5]=h*pe+b*Q+M*Se,e[6]=p*pe+P*Q+G*Se,e[7]=E*pe+F*Q+L*Se,e[8]=d*qe+g*$e+R*Xe,e[9]=h*qe+b*$e+M*Xe,e[10]=p*qe+P*$e+G*Xe,e[11]=E*qe+F*$e+L*Xe,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}var XG=jG;function jG(e,t,r){var n=Math.sin(r),s=Math.cos(r),o=t[4],a=t[5],i=t[6],c=t[7],l=t[8],u=t[9],d=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*s+l*n,e[5]=a*s+u*n,e[6]=i*s+d*n,e[7]=c*s+h*n,e[8]=l*s-o*n,e[9]=u*s-a*n,e[10]=d*s-i*n,e[11]=h*s-c*n,e}var HG=YG;function YG(e,t,r){var n=Math.sin(r),s=Math.cos(r),o=t[0],a=t[1],i=t[2],c=t[3],l=t[8],u=t[9],d=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*s-l*n,e[1]=a*s-u*n,e[2]=i*s-d*n,e[3]=c*s-h*n,e[8]=o*n+l*s,e[9]=a*n+u*s,e[10]=i*n+d*s,e[11]=c*n+h*s,e}var ZG=WG;function WG(e,t,r){var n=Math.sin(r),s=Math.cos(r),o=t[0],a=t[1],i=t[2],c=t[3],l=t[4],u=t[5],d=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*s+l*n,e[1]=a*s+u*n,e[2]=i*s+d*n,e[3]=c*s+h*n,e[4]=l*s-o*n,e[5]=u*s-a*n,e[6]=d*s-i*n,e[7]=h*s-c*n,e}var QG=KG;function KG(e,t,r){var n,s,o,a=r[0],i=r[1],c=r[2],l=Math.sqrt(a*a+i*i+c*c);return Math.abs(l)<1e-6?null:(l=1/l,a*=l,i*=l,c*=l,n=Math.sin(t),s=Math.cos(t),o=1-s,e[0]=a*a*o+s,e[1]=i*a*o+c*n,e[2]=c*a*o-i*n,e[3]=0,e[4]=a*i*o-c*n,e[5]=i*i*o+s,e[6]=c*i*o+a*n,e[7]=0,e[8]=a*c*o+i*n,e[9]=i*c*o-a*n,e[10]=c*c*o+s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}var JG=eN;function eN(e,t,r){var n=t[0],s=t[1],o=t[2],a=t[3],i=n+n,c=s+s,l=o+o,u=n*i,d=n*c,h=n*l,p=s*c,E=s*l,g=o*l,b=a*i,P=a*c,F=a*l;return e[0]=1-(p+g),e[1]=d+F,e[2]=h-P,e[3]=0,e[4]=d-F,e[5]=1-(u+g),e[6]=E+b,e[7]=0,e[8]=h+P,e[9]=E-b,e[10]=1-(u+p),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}var tN=rN;function rN(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var nN=sN;function sN(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}var oN=aN;function aN(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var iN=cN;function cN(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var lN=fN;function fN(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var uN=dN;function dN(e,t){var r=t[0],n=t[1],s=t[2],o=t[3],a=r+r,i=n+n,c=s+s,l=r*a,u=n*a,d=n*i,h=s*a,p=s*i,E=s*c,g=o*a,b=o*i,P=o*c;return e[0]=1-d-E,e[1]=u+P,e[2]=h-b,e[3]=0,e[4]=u-P,e[5]=1-l-E,e[6]=p+g,e[7]=0,e[8]=h+b,e[9]=p-g,e[10]=1-l-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var hN=mN;function mN(e,t,r,n,s,o,a){var i=1/(r-t),c=1/(s-n),l=1/(o-a);return e[0]=o*2*i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o*2*c,e[6]=0,e[7]=0,e[8]=(r+t)*i,e[9]=(s+n)*c,e[10]=(a+o)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*l,e[15]=0,e}var pN=vN;function vN(e,t,r,n,s){var o=1/Math.tan(t/2),a=1/(n-s);return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(s+n)*a,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*s*n*a,e[15]=0,e}var gN=yN;function yN(e,t,r,n){var s=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),i=Math.tan(t.rightDegrees*Math.PI/180),c=2/(a+i),l=2/(s+o);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-((a-i)*c*.5),e[9]=(s-o)*l*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}var bN=wN;function wN(e,t,r,n,s,o,a){var i=1/(t-r),c=1/(n-s),l=1/(o-a);return e[0]=-2*i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+r)*i,e[13]=(s+n)*c,e[14]=(a+o)*l,e[15]=1,e}var _N=Rm,xN=EN;function EN(e,t,r,n){var s,o,a,i,c,l,u,d,h,p,E=t[0],g=t[1],b=t[2],P=n[0],F=n[1],R=n[2],M=r[0],G=r[1],L=r[2];return Math.abs(E-M)<1e-6&&Math.abs(g-G)<1e-6&&Math.abs(b-L)<1e-6?_N(e):(u=E-M,d=g-G,h=b-L,p=1/Math.sqrt(u*u+d*d+h*h),u*=p,d*=p,h*=p,s=F*h-R*d,o=R*u-P*h,a=P*d-F*u,p=Math.sqrt(s*s+o*o+a*a),p?(p=1/p,s*=p,o*=p,a*=p):(s=0,o=0,a=0),i=d*a-h*o,c=h*s-u*a,l=u*o-d*s,p=Math.sqrt(i*i+c*c+l*l),p?(p=1/p,i*=p,c*=p,l*=p):(i=0,c=0,l=0),e[0]=s,e[1]=i,e[2]=u,e[3]=0,e[4]=o,e[5]=c,e[6]=d,e[7]=0,e[8]=a,e[9]=l,e[10]=h,e[11]=0,e[12]=-(s*E+o*g+a*b),e[13]=-(i*E+c*g+l*b),e[14]=-(u*E+d*g+h*b),e[15]=1,e)}var $N=AN;function AN(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}var dr={create:xG,clone:$G,copy:TG,identity:Rm,transpose:CG,invert:OG,adjoint:LG,determinant:GG,multiply:DG,translate:BG,scale:zG,rotate:UG,rotateX:XG,rotateY:HG,rotateZ:ZG,fromRotation:QG,fromRotationTranslation:JG,fromScaling:tN,fromTranslation:nN,fromXRotation:oN,fromYRotation:iN,fromZRotation:lN,fromQuat:uN,frustum:hN,perspective:pN,perspectiveFromFieldOfView:gN,ortho:bN,lookAt:xN,str:$N};const Lc=dr,TN=(e,t={})=>{const{fbo:r}=t,n={cull:{enable:!0},context:{lightDirection:[.2,.2,1]},uniforms:{view:(s,o)=>o.camera.view,eye:(s,o)=>o.camera.position,projection:(s,o)=>o.camera.projection,camNear:(s,o)=>o.camera.near,camFar:(s,o)=>o.camera.far,invertedView:(s,o)=>Lc.invert([],o.camera.view),lightPosition:(s,o)=>o&&o.rendering&&o.rendering.lightPosition?o.rendering.lightPosition:[100,200,100],lightDirection:(s,o)=>o&&o.rendering&&o.rendering.lightDirection?o.rendering.lightDirection:s.lightDirection||[0,0,0],lightView:s=>Lc.lookAt([],s.lightDirection,[0,0,0],[0,0,1]),lightProjection:Lc.ortho([],-25,-25,-20,20,-25,25),lightColor:(s,o)=>o&&o.rendering&&o.rendering.lightColor?o.rendering.lightColor:[1,.8,0],ambientLightAmount:(s,o)=>o&&o.rendering&&o.rendering.ambientLightAmount?o.rendering.ambientLightAmount:.3,diffuseLightAmount:(s,o)=>o&&o.rendering&&o.rendering.diffuseLightAmount?o&&o.rendering&&o.rendering.diffuseLightAmount:.89,specularLightAmount:(s,o)=>o&&o.rendering&&o.rendering.specularLightAmount?o.rendering.specularLightAmount:.16,uMaterialShininess:(s,o)=>o&&o.rendering&&o.rendering.materialShininess?o.rendering.materialShininess:8,materialAmbient:[.5,.8,.3],materialDiffuse:[.5,.8,.3],materialSpecular:[.5,.8,.3]},framebuffer:r};return e(Object.assign({},n,t.extras))};var SN=TN,za={background:[1,1,1,1],meshColor:[0,.6,1,1],lightColor:[1,1,1,1],lightDirection:[.2,.2,1],lightPosition:[100,200,100],ambientLightAmount:.3,diffuseLightAmount:.89,specularLightAmount:.16,materialShininess:8},Fc={exports:{}},hd;function PN(){return hd||(hd=1,function(e,t){(function(r,n){e.exports=n()})(Pg,function(){var r=function(f){return f instanceof Uint8Array||f instanceof Uint16Array||f instanceof Uint32Array||f instanceof Int8Array||f instanceof Int16Array||f instanceof Int32Array||f instanceof Float32Array||f instanceof Float64Array||f instanceof Uint8ClampedArray},n=function(f,v){for(var T=Object.keys(v),X=0;X<T.length;++X)f[T[X]]=v[T[X]];return f},s=`
`;function o(f){return typeof atob<"u"?atob(f):"base64:"+f}function a(f){var v=new Error("(regl) "+f);throw console.error(v),v}function i(f,v){f||a(v)}function c(f){return f?": "+f:""}function l(f,v,T){f in v||a("unknown parameter ("+f+")"+c(T)+". possible values: "+Object.keys(v).join())}function u(f,v){r(f)||a("invalid parameter type"+c(v)+". must be a typed array")}function d(f,v){switch(v){case"number":return typeof f=="number";case"object":return typeof f=="object";case"string":return typeof f=="string";case"boolean":return typeof f=="boolean";case"function":return typeof f=="function";case"undefined":return typeof f>"u";case"symbol":return typeof f=="symbol"}}function h(f,v,T){d(f,v)||a("invalid parameter type"+c(T)+". expected "+v+", got "+typeof f)}function p(f,v){f>=0&&(f|0)===f||a("invalid parameter type, ("+f+")"+c(v)+". must be a nonnegative integer")}function E(f,v,T){v.indexOf(f)<0&&a("invalid value"+c(T)+". must be one of: "+v)}var g=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function b(f){Object.keys(f).forEach(function(v){g.indexOf(v)<0&&a('invalid regl constructor argument "'+v+'". must be one of '+g)})}function P(f,v){for(f=f+"";f.length<v;)f=" "+f;return f}function F(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function R(f,v){this.number=f,this.line=v,this.errors=[]}function M(f,v,T){this.file=f,this.line=v,this.message=T}function G(){var f=new Error,v=(f.stack||f).toString(),T=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(v);if(T)return T[1];var X=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(v);return X?X[1]:"unknown"}function L(){var f=new Error,v=(f.stack||f).toString(),T=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(v);if(T)return T[1];var X=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(v);return X?X[1]:"unknown"}function U(f,v){var T=f.split(`
`),X=1,J=0,q={unknown:new F,0:new F};q.unknown.name=q[0].name=v||G(),q.unknown.lines.push(new R(0,""));for(var Y=0;Y<T.length;++Y){var ie=T[Y],ae=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(ie);if(ae)switch(ae[1]){case"line":var de=/(\d+)(\s+\d+)?/.exec(ae[2]);de&&(X=de[1]|0,de[2]&&(J=de[2]|0,J in q||(q[J]=new F)));break;case"define":var me=/SHADER_NAME(_B64)?\s+(.*)$/.exec(ae[2]);me&&(q[J].name=me[1]?o(me[2]):me[2]);break}q[J].lines.push(new R(X++,ie))}return Object.keys(q).forEach(function(he){var ge=q[he];ge.lines.forEach(function(ce){ge.index[ce.number]=ce})}),q}function ee(f){var v=[];return f.split(`
`).forEach(function(T){if(!(T.length<5)){var X=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(T);X?v.push(new M(X[1]|0,X[2]|0,X[3].trim())):T.length>0&&v.push(new M("unknown",0,T))}}),v}function oe(f,v){v.forEach(function(T){var X=f[T.file];if(X){var J=X.index[T.line];if(J){J.errors.push(T),X.hasErrors=!0;return}}f.unknown.hasErrors=!0,f.unknown.lines[0].errors.push(T)})}function pe(f,v,T,X,J){if(!f.getShaderParameter(v,f.COMPILE_STATUS)){var q=f.getShaderInfoLog(v),Y=X===f.FRAGMENT_SHADER?"fragment":"vertex";Lt(T,"string",Y+" shader source must be a string",J);var ie=U(T,J),ae=ee(q);oe(ie,ae),Object.keys(ie).forEach(function(de){var me=ie[de];if(!me.hasErrors)return;var he=[""],ge=[""];function ce(ue,k){he.push(ue),ge.push(k||"")}ce("file number "+de+": "+me.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),me.lines.forEach(function(ue){if(ue.errors.length>0){ce(P(ue.number,4)+"|  ","background-color:yellow; font-weight:bold"),ce(ue.line+s,"color:red; background-color:yellow; font-weight:bold");var k=0;ue.errors.forEach(function(H){var fe=H.message,Te=/^\s*'(.*)'\s*:\s*(.*)$/.exec(fe);if(Te){var se=Te[1];switch(fe=Te[2],se){case"assign":se="=";break}k=Math.max(ue.line.indexOf(se,k),0)}else k=0;ce(P("| ",6)),ce(P("^^^",k+3)+s,"font-weight:bold"),ce(P("| ",6)),ce(fe+s,"font-weight:bold")}),ce(P("| ",6)+s)}else ce(P(ue.number,4)+"|  "),ce(ue.line+s,"color:red")}),typeof document<"u"&&!window.chrome?(ge[0]=he.join("%c"),console.log.apply(console,ge)):console.log(he.join(""))}),i.raise("Error compiling "+Y+" shader, "+ie[0].name)}}function Q(f,v,T,X,J){if(!f.getProgramParameter(v,f.LINK_STATUS)){var q=f.getProgramInfoLog(v),Y=U(T,J),ie=U(X,J),ae='Error linking program with vertex shader, "'+ie[0].name+'", and fragment shader "'+Y[0].name+'"';typeof document<"u"?console.log("%c"+ae+s+"%c"+q,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(ae+s+q),i.raise(ae)}}function Se(f){f._commandRef=G()}function qe(f,v,T,X){Se(f);function J(ae){return ae?X.id(ae):0}f._fragId=J(f.static.frag),f._vertId=J(f.static.vert);function q(ae,de){Object.keys(de).forEach(function(me){ae[X.id(me)]=!0})}var Y=f._uniformSet={};q(Y,v.static),q(Y,v.dynamic);var ie=f._attributeSet={};q(ie,T.static),q(ie,T.dynamic),f._hasCount="count"in f.static||"count"in f.dynamic||"elements"in f.static||"elements"in f.dynamic}function $e(f,v){var T=L();a(f+" in command "+(v||G())+(T==="unknown"?"":" called from "+T))}function Xe(f,v,T){f||$e(v,T||G())}function Ne(f,v,T,X){f in v||$e("unknown parameter ("+f+")"+c(T)+". possible values: "+Object.keys(v).join(),X||G())}function Lt(f,v,T,X){d(f,v)||$e("invalid parameter type"+c(T)+". expected "+v+", got "+typeof f,X||G())}function Nt(f){f()}function Nr(f,v,T){f.texture?E(f.texture._texture.internalformat,v,"unsupported texture format for attachment"):E(f.renderbuffer._renderbuffer.format,T,"unsupported renderbuffer format for attachment")}var yr=33071,Dr=9728,br=9984,rp=9985,np=9986,sp=9987,op=5120,ap=5121,ip=5122,cp=5123,lp=5124,fp=5125,Ll=5126,Fl=32819,Gl=32820,Nl=33635,Dl=34042,up=36193,tr={};tr[op]=tr[ap]=1,tr[ip]=tr[cp]=tr[up]=tr[Nl]=tr[Fl]=tr[Gl]=2,tr[lp]=tr[fp]=tr[Ll]=tr[Dl]=4;function kl(f,v){return f===Gl||f===Fl||f===Nl?2:f===Dl?4:tr[f]*v}function oo(f){return!(f&f-1)&&!!f}function dp(f,v,T){var X,J=v.width,q=v.height,Y=v.channels;i(J>0&&J<=T.maxTextureSize&&q>0&&q<=T.maxTextureSize,"invalid texture shape"),(f.wrapS!==yr||f.wrapT!==yr)&&i(oo(J)&&oo(q),"incompatible wrap mode for texture, both width and height must be power of 2"),v.mipmask===1?J!==1&&q!==1&&i(f.minFilter!==br&&f.minFilter!==np&&f.minFilter!==rp&&f.minFilter!==sp,"min filter requires mipmap"):(i(oo(J)&&oo(q),"texture must be a square power of 2 to support mipmapping"),i(v.mipmask===(J<<1)-1,"missing or incomplete mipmap data")),v.type===Ll&&(T.extensions.indexOf("oes_texture_float_linear")<0&&i(f.minFilter===Dr&&f.magFilter===Dr,"filter not supported, must enable oes_texture_float_linear"),i(!f.genMipmaps,"mipmap generation not supported with float textures"));var ie=v.images;for(X=0;X<16;++X)if(ie[X]){var ae=J>>X,de=q>>X;i(v.mipmask&1<<X,"missing mipmap data");var me=ie[X];if(i(me.width===ae&&me.height===de,"invalid shape for mip images"),i(me.format===v.format&&me.internalformat===v.internalformat&&me.type===v.type,"incompatible type for mip image"),!me.compressed)if(me.data){var he=Math.ceil(kl(me.type,Y)*ae/me.unpackAlignment)*me.unpackAlignment;i(me.data.byteLength===he*de,"invalid data for image, buffer size is inconsistent with image format")}else me.element||me.copy}else f.genMipmaps||i((v.mipmask&1<<X)===0,"extra mipmap data");v.compressed&&i(!f.genMipmaps,"mipmap generation for compressed images not supported")}function hp(f,v,T,X){var J=f.width,q=f.height,Y=f.channels;i(J>0&&J<=X.maxTextureSize&&q>0&&q<=X.maxTextureSize,"invalid texture shape"),i(J===q,"cube map must be square"),i(v.wrapS===yr&&v.wrapT===yr,"wrap mode not supported by cube map");for(var ie=0;ie<T.length;++ie){var ae=T[ie];i(ae.width===J&&ae.height===q,"inconsistent cube map face shape"),v.genMipmaps&&(i(!ae.compressed,"can not generate mipmap for compressed textures"),i(ae.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var de=ae.images,me=0;me<16;++me){var he=de[me];if(he){var ge=J>>me,ce=q>>me;i(ae.mipmask&1<<me,"missing mipmap data"),i(he.width===ge&&he.height===ce,"invalid shape for mip images"),i(he.format===f.format&&he.internalformat===f.internalformat&&he.type===f.type,"incompatible type for mip image"),he.compressed||(he.data?i(he.data.byteLength===ge*ce*Math.max(kl(he.type,Y),he.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):he.element||he.copy)}}}}var y=n(i,{optional:Nt,raise:a,commandRaise:$e,command:Xe,parameter:l,commandParameter:Ne,constructor:b,type:h,commandType:Lt,isTypedArray:u,nni:p,oneOf:E,shaderError:pe,linkError:Q,callSite:L,saveCommandRef:Se,saveDrawInfo:qe,framebufferFormat:Nr,guessCommand:G,texture2D:dp,textureCube:hp}),mp=0,pp=0,vp=5,gp=6;function nn(f,v){this.id=mp++,this.type=f,this.data=v}function Bl(f){return f.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function ms(f){if(f.length===0)return[];var v=f.charAt(0),T=f.charAt(f.length-1);if(f.length>1&&v===T&&(v==='"'||v==="'"))return['"'+Bl(f.substr(1,f.length-2))+'"'];var X=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(f);if(X)return ms(f.substr(0,X.index)).concat(ms(X[1])).concat(ms(f.substr(X.index+X[0].length)));var J=f.split(".");if(J.length===1)return['"'+Bl(f)+'"'];for(var q=[],Y=0;Y<J.length;++Y)q=q.concat(ms(J[Y]));return q}function Il(f){return"["+ms(f).join("][")+"]"}function yp(f,v){return new nn(f,Il(v+""))}function bp(f){return typeof f=="function"&&!f._reglType||f instanceof nn}function zl(f,v){if(typeof f=="function")return new nn(pp,f);if(typeof f=="number"||typeof f=="boolean")return new nn(vp,f);if(Array.isArray(f))return new nn(gp,f.map(function(T,X){return zl(T,v+"["+X+"]")}));if(f instanceof nn)return f;y(!1,"invalid option type in uniform "+v)}var rr={DynamicVariable:nn,define:yp,isDynamic:bp,unbox:zl,accessor:Il},Va={next:typeof requestAnimationFrame=="function"?function(f){return requestAnimationFrame(f)}:function(f){return setTimeout(f,16)},cancel:typeof cancelAnimationFrame=="function"?function(f){return cancelAnimationFrame(f)}:clearTimeout},Vl=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function wp(){var f={"":0},v=[""];return{id:function(T){var X=f[T];return X||(X=f[T]=v.length,v.push(T),X)},str:function(T){return v[T]}}}function _p(f,v,T){var X=document.createElement("canvas");n(X.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),f.appendChild(X),f===document.body&&(X.style.position="absolute",n(f.style,{margin:0,padding:0}));function J(){var ie=window.innerWidth,ae=window.innerHeight;if(f!==document.body){var de=X.getBoundingClientRect();ie=de.right-de.left,ae=de.bottom-de.top}X.width=T*ie,X.height=T*ae}var q;f!==document.body&&typeof ResizeObserver=="function"?(q=new ResizeObserver(function(){setTimeout(J)}),q.observe(f)):window.addEventListener("resize",J,!1);function Y(){q?q.disconnect():window.removeEventListener("resize",J),f.removeChild(X)}return J(),{canvas:X,onDestroy:Y}}function xp(f,v){function T(X){try{return f.getContext(X,v)}catch{return null}}return T("webgl")||T("experimental-webgl")||T("webgl-experimental")}function Ep(f){return typeof f.nodeName=="string"&&typeof f.appendChild=="function"&&typeof f.getBoundingClientRect=="function"}function $p(f){return typeof f.drawArrays=="function"||typeof f.drawElements=="function"}function Ul(f){return typeof f=="string"?f.split():(y(Array.isArray(f),"invalid extension array"),f)}function ql(f){return typeof f=="string"?(y(typeof document<"u","not supported outside of DOM"),document.querySelector(f)):f}function Ap(f){var v=f||{},T,X,J,q,Y={},ie=[],ae=[],de=typeof window>"u"?1:window.devicePixelRatio,me=!1,he=function(ue){ue&&y.raise(ue)},ge=function(){};if(typeof v=="string"?(y(typeof document<"u","selector queries only supported in DOM enviroments"),T=document.querySelector(v),y(T,"invalid query string for element")):typeof v=="object"?Ep(v)?T=v:$p(v)?(q=v,J=q.canvas):(y.constructor(v),"gl"in v?q=v.gl:"canvas"in v?J=ql(v.canvas):"container"in v&&(X=ql(v.container)),"attributes"in v&&(Y=v.attributes,y.type(Y,"object","invalid context attributes")),"extensions"in v&&(ie=Ul(v.extensions)),"optionalExtensions"in v&&(ae=Ul(v.optionalExtensions)),"onDone"in v&&(y.type(v.onDone,"function","invalid or missing onDone callback"),he=v.onDone),"profile"in v&&(me=!!v.profile),"pixelRatio"in v&&(de=+v.pixelRatio,y(de>0,"invalid pixel ratio"))):y.raise("invalid arguments to regl"),T&&(T.nodeName.toLowerCase()==="canvas"?J=T:X=T),!q){if(!J){y(typeof document<"u","must manually specify webgl context outside of DOM environments");var ce=_p(X||document.body,he,de);if(!ce)return null;J=ce.canvas,ge=ce.onDestroy}Y.premultipliedAlpha===void 0&&(Y.premultipliedAlpha=!0),q=xp(J,Y)}return q?{gl:q,canvas:J,container:X,extensions:ie,optionalExtensions:ae,pixelRatio:de,profile:me,onDone:he,onDestroy:ge}:(ge(),he("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Tp(f,v){var T={};function X(Y){y.type(Y,"string","extension name must be string");var ie=Y.toLowerCase(),ae;try{ae=T[ie]=f.getExtension(ie)}catch{}return!!ae}for(var J=0;J<v.extensions.length;++J){var q=v.extensions[J];if(!X(q))return v.onDestroy(),v.onDone('"'+q+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return v.optionalExtensions.forEach(X),{extensions:T,restore:function(){Object.keys(T).forEach(function(Y){if(T[Y]&&!X(Y))throw new Error("(regl): error restoring extension "+Y)})}}}function nr(f,v){for(var T=Array(f),X=0;X<f;++X)T[X]=v(X);return T}var Sp=5120,Pp=5121,Cp=5122,Mp=5123,Op=5124,Rp=5125,Lp=5126;function Fp(f){for(var v=16;v<=1<<28;v*=16)if(f<=v)return v;return 0}function Xl(f){var v,T;return v=(f>65535)<<4,f>>>=v,T=(f>255)<<3,f>>>=T,v|=T,T=(f>15)<<2,f>>>=T,v|=T,T=(f>3)<<1,f>>>=T,v|=T,v|f>>1}function jl(){var f=nr(8,function(){return[]});function v(q){var Y=Fp(q),ie=f[Xl(Y)>>2];return ie.length>0?ie.pop():new ArrayBuffer(Y)}function T(q){f[Xl(q.byteLength)>>2].push(q)}function X(q,Y){var ie=null;switch(q){case Sp:ie=new Int8Array(v(Y),0,Y);break;case Pp:ie=new Uint8Array(v(Y),0,Y);break;case Cp:ie=new Int16Array(v(2*Y),0,Y);break;case Mp:ie=new Uint16Array(v(2*Y),0,Y);break;case Op:ie=new Int32Array(v(4*Y),0,Y);break;case Rp:ie=new Uint32Array(v(4*Y),0,Y);break;case Lp:ie=new Float32Array(v(4*Y),0,Y);break;default:return null}return ie.length!==Y?ie.subarray(0,Y):ie}function J(q){T(q.buffer)}return{alloc:v,free:T,allocType:X,freeType:J}}var _t=jl();_t.zero=jl();var Gp=3408,Np=3410,Dp=3411,kp=3412,Bp=3413,Ip=3414,zp=3415,Vp=33901,Up=33902,qp=3379,Xp=3386,jp=34921,Hp=36347,Yp=36348,Zp=35661,Wp=35660,Qp=34930,Kp=36349,Jp=34076,e2=34024,t2=7936,r2=7937,n2=7938,s2=35724,o2=34047,a2=36063,i2=34852,ao=3553,Hl=34067,c2=34069,l2=33984,ps=6408,Ua=5126,Yl=5121,qa=36160,f2=36053,u2=36064,d2=16384,h2=function(f,v){var T=1;v.ext_texture_filter_anisotropic&&(T=f.getParameter(o2));var X=1,J=1;v.webgl_draw_buffers&&(X=f.getParameter(i2),J=f.getParameter(a2));var q=!!v.oes_texture_float;if(q){var Y=f.createTexture();f.bindTexture(ao,Y),f.texImage2D(ao,0,ps,1,1,0,ps,Ua,null);var ie=f.createFramebuffer();if(f.bindFramebuffer(qa,ie),f.framebufferTexture2D(qa,u2,ao,Y,0),f.bindTexture(ao,null),f.checkFramebufferStatus(qa)!==f2)q=!1;else{f.viewport(0,0,1,1),f.clearColor(1,0,0,1),f.clear(d2);var ae=_t.allocType(Ua,4);f.readPixels(0,0,1,1,ps,Ua,ae),f.getError()?q=!1:(f.deleteFramebuffer(ie),f.deleteTexture(Y),q=ae[0]===1),_t.freeType(ae)}}var de=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),me=!0;if(!de){var he=f.createTexture(),ge=_t.allocType(Yl,36);f.activeTexture(l2),f.bindTexture(Hl,he),f.texImage2D(c2,0,ps,3,3,0,ps,Yl,ge),_t.freeType(ge),f.bindTexture(Hl,null),f.deleteTexture(he),me=!f.getError()}return{colorBits:[f.getParameter(Np),f.getParameter(Dp),f.getParameter(kp),f.getParameter(Bp)],depthBits:f.getParameter(Ip),stencilBits:f.getParameter(zp),subpixelBits:f.getParameter(Gp),extensions:Object.keys(v).filter(function(ce){return!!v[ce]}),maxAnisotropic:T,maxDrawbuffers:X,maxColorAttachments:J,pointSizeDims:f.getParameter(Vp),lineWidthDims:f.getParameter(Up),maxViewportDims:f.getParameter(Xp),maxCombinedTextureUnits:f.getParameter(Zp),maxCubeMapSize:f.getParameter(Jp),maxRenderbufferSize:f.getParameter(e2),maxTextureUnits:f.getParameter(Qp),maxTextureSize:f.getParameter(qp),maxAttributes:f.getParameter(jp),maxVertexUniforms:f.getParameter(Hp),maxVertexTextureUnits:f.getParameter(Wp),maxVaryingVectors:f.getParameter(Yp),maxFragmentUniforms:f.getParameter(Kp),glsl:f.getParameter(s2),renderer:f.getParameter(r2),vendor:f.getParameter(t2),version:f.getParameter(n2),readFloat:q,npotTextureCube:me}};function hr(f){return!!f&&typeof f=="object"&&Array.isArray(f.shape)&&Array.isArray(f.stride)&&typeof f.offset=="number"&&f.shape.length===f.stride.length&&(Array.isArray(f.data)||r(f.data))}var sr=function(f){return Object.keys(f).map(function(v){return f[v]})},io={shape:g2,flatten:v2};function m2(f,v,T){for(var X=0;X<v;++X)T[X]=f[X]}function p2(f,v,T,X){for(var J=0,q=0;q<v;++q)for(var Y=f[q],ie=0;ie<T;++ie)X[J++]=Y[ie]}function Zl(f,v,T,X,J,q){for(var Y=q,ie=0;ie<v;++ie)for(var ae=f[ie],de=0;de<T;++de)for(var me=ae[de],he=0;he<X;++he)J[Y++]=me[he]}function Wl(f,v,T,X,J){for(var q=1,Y=T+1;Y<v.length;++Y)q*=v[Y];var ie=v[T];if(v.length-T===4){var ae=v[T+1],de=v[T+2],me=v[T+3];for(Y=0;Y<ie;++Y)Zl(f[Y],ae,de,me,X,J),J+=q}else for(Y=0;Y<ie;++Y)Wl(f[Y],v,T+1,X,J),J+=q}function v2(f,v,T,X){var J=1;if(v.length)for(var q=0;q<v.length;++q)J*=v[q];else J=0;var Y=X||_t.allocType(T,J);switch(v.length){case 0:break;case 1:m2(f,v[0],Y);break;case 2:p2(f,v[0],v[1],Y);break;case 3:Zl(f,v[0],v[1],v[2],Y,0);break;default:Wl(f,v,0,Y,0)}return Y}function g2(f){for(var v=[],T=f;T.length;T=T[0])v.push(T.length);return v}var Xa={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},y2=5120,b2=5122,w2=5124,_2=5121,x2=5123,E2=5125,$2=5126,A2=5126,sn={int8:y2,int16:b2,int32:w2,uint8:_2,uint16:x2,uint32:E2,float:$2,float32:A2},T2=35048,S2=35040,co={dynamic:T2,stream:S2,static:35044},ja=io.flatten,Ql=io.shape,Kl=35044,P2=35040,Ha=5121,Ya=5126,kr=[];kr[5120]=1,kr[5122]=2,kr[5124]=4,kr[5121]=1,kr[5123]=2,kr[5125]=4,kr[5126]=4;function lo(f){return Xa[Object.prototype.toString.call(f)]|0}function Jl(f,v){for(var T=0;T<v.length;++T)f[T]=v[T]}function ef(f,v,T,X,J,q,Y){for(var ie=0,ae=0;ae<T;++ae)for(var de=0;de<X;++de)f[ie++]=v[J*ae+q*de+Y]}function C2(f,v,T,X){var J=0,q={};function Y(k){this.id=J++,this.buffer=f.createBuffer(),this.type=k,this.usage=Kl,this.byteLength=0,this.dimension=1,this.dtype=Ha,this.persistentData=null,T.profile&&(this.stats={size:0})}Y.prototype.bind=function(){f.bindBuffer(this.type,this.buffer)},Y.prototype.destroy=function(){ge(this)};var ie=[];function ae(k,H){var fe=ie.pop();return fe||(fe=new Y(k)),fe.bind(),he(fe,H,P2,0,1,!1),fe}function de(k){ie.push(k)}function me(k,H,fe){k.byteLength=H.byteLength,f.bufferData(k.type,H,fe)}function he(k,H,fe,Te,se,Ee){var _e;if(k.usage=fe,Array.isArray(H)){if(k.dtype=Te||Ya,H.length>0){var Ge;if(Array.isArray(H[0])){_e=Ql(H);for(var te=1,K=1;K<_e.length;++K)te*=_e[K];k.dimension=te,Ge=ja(H,_e,k.dtype),me(k,Ge,fe),Ee?k.persistentData=Ge:_t.freeType(Ge)}else if(typeof H[0]=="number"){k.dimension=se;var Me=_t.allocType(k.dtype,H.length);Jl(Me,H),me(k,Me,fe),Ee?k.persistentData=Me:_t.freeType(Me)}else r(H[0])?(k.dimension=H[0].length,k.dtype=Te||lo(H[0])||Ya,Ge=ja(H,[H.length,H[0].length],k.dtype),me(k,Ge,fe),Ee?k.persistentData=Ge:_t.freeType(Ge)):y.raise("invalid buffer data")}}else if(r(H))k.dtype=Te||lo(H),k.dimension=se,me(k,H,fe),Ee&&(k.persistentData=new Uint8Array(new Uint8Array(H.buffer)));else if(hr(H)){_e=H.shape;var ye=H.stride,le=H.offset,be=0,we=0,je=0,Ue=0;_e.length===1?(be=_e[0],we=1,je=ye[0],Ue=0):_e.length===2?(be=_e[0],we=_e[1],je=ye[0],Ue=ye[1]):y.raise("invalid shape"),k.dtype=Te||lo(H.data)||Ya,k.dimension=we;var xe=_t.allocType(k.dtype,be*we);ef(xe,H.data,be,we,je,Ue,le),me(k,xe,fe),Ee?k.persistentData=xe:_t.freeType(xe)}else H instanceof ArrayBuffer?(k.dtype=Ha,k.dimension=se,me(k,H,fe),Ee&&(k.persistentData=new Uint8Array(new Uint8Array(H)))):y.raise("invalid buffer data")}function ge(k){v.bufferCount--,X(k);var H=k.buffer;y(H,"buffer must not be deleted already"),f.deleteBuffer(H),k.buffer=null,delete q[k.id]}function ce(k,H,fe,Te){v.bufferCount++;var se=new Y(H);q[se.id]=se;function Ee(te){var K=Kl,Me=null,ye=0,le=0,be=1;return Array.isArray(te)||r(te)||hr(te)||te instanceof ArrayBuffer?Me=te:typeof te=="number"?ye=te|0:te&&(y.type(te,"object","buffer arguments must be an object, a number or an array"),"data"in te&&(y(Me===null||Array.isArray(Me)||r(Me)||hr(Me),"invalid data for buffer"),Me=te.data),"usage"in te&&(y.parameter(te.usage,co,"invalid buffer usage"),K=co[te.usage]),"type"in te&&(y.parameter(te.type,sn,"invalid buffer type"),le=sn[te.type]),"dimension"in te&&(y.type(te.dimension,"number","invalid dimension"),be=te.dimension|0),"length"in te&&(y.nni(ye,"buffer length must be a nonnegative integer"),ye=te.length|0)),se.bind(),Me?he(se,Me,K,le,be,Te):(ye&&f.bufferData(se.type,ye,K),se.dtype=le||Ha,se.usage=K,se.dimension=be,se.byteLength=ye),T.profile&&(se.stats.size=se.byteLength*kr[se.dtype]),Ee}function _e(te,K){y(K+te.byteLength<=se.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+te.byteLength+" starting from offset "+K+" to a buffer of size "+se.byteLength),f.bufferSubData(se.type,K,te)}function Ge(te,K){var Me=(K||0)|0,ye;if(se.bind(),r(te)||te instanceof ArrayBuffer)_e(te,Me);else if(Array.isArray(te)){if(te.length>0)if(typeof te[0]=="number"){var le=_t.allocType(se.dtype,te.length);Jl(le,te),_e(le,Me),_t.freeType(le)}else if(Array.isArray(te[0])||r(te[0])){ye=Ql(te);var be=ja(te,ye,se.dtype);_e(be,Me),_t.freeType(be)}else y.raise("invalid buffer data")}else if(hr(te)){ye=te.shape;var we=te.stride,je=0,Ue=0,xe=0,Ae=0;ye.length===1?(je=ye[0],Ue=1,xe=we[0],Ae=0):ye.length===2?(je=ye[0],Ue=ye[1],xe=we[0],Ae=we[1]):y.raise("invalid shape");var ke=Array.isArray(te.data)?se.dtype:lo(te.data),He=_t.allocType(ke,je*Ue);ef(He,te.data,je,Ue,xe,Ae,te.offset),_e(He,Me),_t.freeType(He)}else y.raise("invalid data for buffer subdata");return Ee}return fe||Ee(k),Ee._reglType="buffer",Ee._buffer=se,Ee.subdata=Ge,T.profile&&(Ee.stats=se.stats),Ee.destroy=function(){ge(se)},Ee}function ue(){sr(q).forEach(function(k){k.buffer=f.createBuffer(),f.bindBuffer(k.type,k.buffer),f.bufferData(k.type,k.persistentData||k.byteLength,k.usage)})}return T.profile&&(v.getTotalBufferSize=function(){var k=0;return Object.keys(q).forEach(function(H){k+=q[H].stats.size}),k}),{create:ce,createStream:ae,destroyStream:de,clear:function(){sr(q).forEach(ge),ie.forEach(ge)},getBuffer:function(k){return k&&k._buffer instanceof Y?k._buffer:null},restore:ue,_initBuffer:he}}var M2=0,O2=0,R2=1,L2=1,F2=4,G2=4,Br={points:M2,point:O2,lines:R2,line:L2,triangles:F2,triangle:G2,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},N2=0,D2=1,vs=4,k2=5120,On=5121,tf=5122,Rn=5123,rf=5124,on=5125,Za=34963,B2=35040,I2=35044;function z2(f,v,T,X){var J={},q=0,Y={uint8:On,uint16:Rn};v.oes_element_index_uint&&(Y.uint32=on);function ie(ue){this.id=q++,J[this.id]=this,this.buffer=ue,this.primType=vs,this.vertCount=0,this.type=0}ie.prototype.bind=function(){this.buffer.bind()};var ae=[];function de(ue){var k=ae.pop();return k||(k=new ie(T.create(null,Za,!0,!1)._buffer)),he(k,ue,B2,-1,-1,0,0),k}function me(ue){ae.push(ue)}function he(ue,k,H,fe,Te,se,Ee){ue.buffer.bind();var _e;if(k){var Ge=Ee;!Ee&&(!r(k)||hr(k)&&!r(k.data))&&(Ge=v.oes_element_index_uint?on:Rn),T._initBuffer(ue.buffer,k,H,Ge,3)}else f.bufferData(Za,se,H),ue.buffer.dtype=_e||On,ue.buffer.usage=H,ue.buffer.dimension=3,ue.buffer.byteLength=se;if(_e=Ee,!Ee){switch(ue.buffer.dtype){case On:case k2:_e=On;break;case Rn:case tf:_e=Rn;break;case on:case rf:_e=on;break;default:y.raise("unsupported type for element array")}ue.buffer.dtype=_e}ue.type=_e,y(_e!==on||!!v.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var te=Te;te<0&&(te=ue.buffer.byteLength,_e===Rn?te>>=1:_e===on&&(te>>=2)),ue.vertCount=te;var K=fe;if(fe<0){K=vs;var Me=ue.buffer.dimension;Me===1&&(K=N2),Me===2&&(K=D2),Me===3&&(K=vs)}ue.primType=K}function ge(ue){X.elementsCount--,y(ue.buffer!==null,"must not double destroy elements"),delete J[ue.id],ue.buffer.destroy(),ue.buffer=null}function ce(ue,k){var H=T.create(null,Za,!0),fe=new ie(H._buffer);X.elementsCount++;function Te(se){if(!se)H(),fe.primType=vs,fe.vertCount=0,fe.type=On;else if(typeof se=="number")H(se),fe.primType=vs,fe.vertCount=se|0,fe.type=On;else{var Ee=null,_e=I2,Ge=-1,te=-1,K=0,Me=0;Array.isArray(se)||r(se)||hr(se)?Ee=se:(y.type(se,"object","invalid arguments for elements"),"data"in se&&(Ee=se.data,y(Array.isArray(Ee)||r(Ee)||hr(Ee),"invalid data for element buffer")),"usage"in se&&(y.parameter(se.usage,co,"invalid element buffer usage"),_e=co[se.usage]),"primitive"in se&&(y.parameter(se.primitive,Br,"invalid element buffer primitive"),Ge=Br[se.primitive]),"count"in se&&(y(typeof se.count=="number"&&se.count>=0,"invalid vertex count for elements"),te=se.count|0),"type"in se&&(y.parameter(se.type,Y,"invalid buffer type"),Me=Y[se.type]),"length"in se?K=se.length|0:(K=te,Me===Rn||Me===tf?K*=2:(Me===on||Me===rf)&&(K*=4))),he(fe,Ee,_e,Ge,te,K,Me)}return Te}return Te(ue),Te._reglType="elements",Te._elements=fe,Te.subdata=function(se,Ee){return H.subdata(se,Ee),Te},Te.destroy=function(){ge(fe)},Te}return{create:ce,createStream:de,destroyStream:me,getElements:function(ue){return typeof ue=="function"&&ue._elements instanceof ie?ue._elements:null},clear:function(){sr(J).forEach(ge)}}}var nf=new Float32Array(1),V2=new Uint32Array(nf.buffer),U2=5123;function sf(f){for(var v=_t.allocType(U2,f.length),T=0;T<f.length;++T)if(isNaN(f[T]))v[T]=65535;else if(f[T]===1/0)v[T]=31744;else if(f[T]===-1/0)v[T]=64512;else{nf[0]=f[T];var X=V2[0],J=X>>>31<<15,q=(X<<1>>>24)-127,Y=X>>13&(1<<10)-1;if(q<-24)v[T]=J;else if(q<-14){var ie=-14-q;v[T]=J+(Y+(1<<10)>>ie)}else q>15?v[T]=J+31744:v[T]=J+(q+15<<10)+Y}return v}function ht(f){return Array.isArray(f)||r(f)}var of=function(f){return!(f&f-1)&&!!f},q2=34467,wr=3553,Wa=34067,fo=34069,an=6408,Qa=6406,uo=6407,gs=6409,ho=6410,af=32854,Ka=32855,cf=36194,X2=32819,j2=32820,H2=33635,Y2=34042,Ja=6402,mo=34041,ei=35904,ti=35906,Ln=36193,ri=33776,ni=33777,si=33778,oi=33779,lf=35986,ff=35987,uf=34798,df=35840,hf=35841,mf=35842,pf=35843,vf=36196,Fn=5121,ai=5123,ii=5125,ys=5126,Z2=10242,W2=10243,Q2=10497,ci=33071,K2=33648,J2=10240,ev=10241,li=9728,tv=9729,fi=9984,gf=9985,yf=9986,ui=9987,rv=33170,po=4352,nv=4353,sv=4354,ov=34046,av=3317,iv=37440,cv=37441,lv=37443,bf=37444,bs=33984,fv=[fi,yf,gf,ui],vo=[0,gs,ho,uo,an],lr={};lr[gs]=lr[Qa]=lr[Ja]=1,lr[mo]=lr[ho]=2,lr[uo]=lr[ei]=3,lr[an]=lr[ti]=4;function Gn(f){return"[object "+f+"]"}var wf=Gn("HTMLCanvasElement"),_f=Gn("OffscreenCanvas"),xf=Gn("CanvasRenderingContext2D"),Ef=Gn("ImageBitmap"),$f=Gn("HTMLImageElement"),Af=Gn("HTMLVideoElement"),uv=Object.keys(Xa).concat([wf,_f,xf,Ef,$f,Af]),Nn=[];Nn[Fn]=1,Nn[ys]=4,Nn[Ln]=2,Nn[ai]=2,Nn[ii]=4;var Dt=[];Dt[af]=2,Dt[Ka]=2,Dt[cf]=2,Dt[mo]=4,Dt[ri]=.5,Dt[ni]=.5,Dt[si]=1,Dt[oi]=1,Dt[lf]=.5,Dt[ff]=1,Dt[uf]=1,Dt[df]=.5,Dt[hf]=.25,Dt[mf]=.5,Dt[pf]=.25,Dt[vf]=.5;function Tf(f){return Array.isArray(f)&&(f.length===0||typeof f[0]=="number")}function Sf(f){if(!Array.isArray(f))return!1;var v=f.length;return!(v===0||!ht(f[0]))}function cn(f){return Object.prototype.toString.call(f)}function Pf(f){return cn(f)===wf}function Cf(f){return cn(f)===_f}function dv(f){return cn(f)===xf}function hv(f){return cn(f)===Ef}function mv(f){return cn(f)===$f}function pv(f){return cn(f)===Af}function di(f){if(!f)return!1;var v=cn(f);return uv.indexOf(v)>=0?!0:Tf(f)||Sf(f)||hr(f)}function Mf(f){return Xa[Object.prototype.toString.call(f)]|0}function vv(f,v){var T=v.length;switch(f.type){case Fn:case ai:case ii:case ys:var X=_t.allocType(f.type,T);X.set(v),f.data=X;break;case Ln:f.data=sf(v);break;default:y.raise("unsupported texture type, must specify a typed array")}}function Of(f,v){return _t.allocType(f.type===Ln?ys:f.type,v)}function Rf(f,v){f.type===Ln?(f.data=sf(v),_t.freeType(v)):f.data=v}function gv(f,v,T,X,J,q){for(var Y=f.width,ie=f.height,ae=f.channels,de=Y*ie*ae,me=Of(f,de),he=0,ge=0;ge<ie;++ge)for(var ce=0;ce<Y;++ce)for(var ue=0;ue<ae;++ue)me[he++]=v[T*ce+X*ge+J*ue+q];Rf(f,me)}function go(f,v,T,X,J,q){var Y;if(typeof Dt[f]<"u"?Y=Dt[f]:Y=lr[f]*Nn[v],q&&(Y*=6),J){for(var ie=0,ae=T;ae>=1;)ie+=Y*ae*ae,ae/=2;return ie}else return Y*T*X}function yv(f,v,T,X,J,q,Y){var ie={"don't care":po,"dont care":po,nice:sv,fast:nv},ae={repeat:Q2,clamp:ci,mirror:K2},de={nearest:li,linear:tv},me=n({mipmap:ui,"nearest mipmap nearest":fi,"linear mipmap nearest":gf,"nearest mipmap linear":yf,"linear mipmap linear":ui},de),he={none:0,browser:bf},ge={uint8:Fn,rgba4:X2,rgb565:H2,"rgb5 a1":j2},ce={alpha:Qa,luminance:gs,"luminance alpha":ho,rgb:uo,rgba:an,rgba4:af,"rgb5 a1":Ka,rgb565:cf},ue={};v.ext_srgb&&(ce.srgb=ei,ce.srgba=ti),v.oes_texture_float&&(ge.float32=ge.float=ys),v.oes_texture_half_float&&(ge.float16=ge["half float"]=Ln),v.webgl_depth_texture&&(n(ce,{depth:Ja,"depth stencil":mo}),n(ge,{uint16:ai,uint32:ii,"depth stencil":Y2})),v.webgl_compressed_texture_s3tc&&n(ue,{"rgb s3tc dxt1":ri,"rgba s3tc dxt1":ni,"rgba s3tc dxt3":si,"rgba s3tc dxt5":oi}),v.webgl_compressed_texture_atc&&n(ue,{"rgb atc":lf,"rgba atc explicit alpha":ff,"rgba atc interpolated alpha":uf}),v.webgl_compressed_texture_pvrtc&&n(ue,{"rgb pvrtc 4bppv1":df,"rgb pvrtc 2bppv1":hf,"rgba pvrtc 4bppv1":mf,"rgba pvrtc 2bppv1":pf}),v.webgl_compressed_texture_etc1&&(ue["rgb etc1"]=vf);var k=Array.prototype.slice.call(f.getParameter(q2));Object.keys(ue).forEach(function($){var j=ue[$];k.indexOf(j)>=0&&(ce[$]=j)});var H=Object.keys(ce);T.textureFormats=H;var fe=[];Object.keys(ce).forEach(function($){var j=ce[$];fe[j]=$});var Te=[];Object.keys(ge).forEach(function($){var j=ge[$];Te[j]=$});var se=[];Object.keys(de).forEach(function($){var j=de[$];se[j]=$});var Ee=[];Object.keys(me).forEach(function($){var j=me[$];Ee[j]=$});var _e=[];Object.keys(ae).forEach(function($){var j=ae[$];_e[j]=$});var Ge=H.reduce(function($,j){var V=ce[j];return V===gs||V===Qa||V===gs||V===ho||V===Ja||V===mo||v.ext_srgb&&(V===ei||V===ti)?$[V]=V:V===Ka||j.indexOf("rgba")>=0?$[V]=an:$[V]=uo,$},{});function te(){this.internalformat=an,this.format=an,this.type=Fn,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=bf,this.width=0,this.height=0,this.channels=0}function K($,j){$.internalformat=j.internalformat,$.format=j.format,$.type=j.type,$.compressed=j.compressed,$.premultiplyAlpha=j.premultiplyAlpha,$.flipY=j.flipY,$.unpackAlignment=j.unpackAlignment,$.colorSpace=j.colorSpace,$.width=j.width,$.height=j.height,$.channels=j.channels}function Me($,j){if(!(typeof j!="object"||!j)){if("premultiplyAlpha"in j&&(y.type(j.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),$.premultiplyAlpha=j.premultiplyAlpha),"flipY"in j&&(y.type(j.flipY,"boolean","invalid texture flip"),$.flipY=j.flipY),"alignment"in j&&(y.oneOf(j.alignment,[1,2,4,8],"invalid texture unpack alignment"),$.unpackAlignment=j.alignment),"colorSpace"in j&&(y.parameter(j.colorSpace,he,"invalid colorSpace"),$.colorSpace=he[j.colorSpace]),"type"in j){var V=j.type;y(v.oes_texture_float||!(V==="float"||V==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),y(v.oes_texture_half_float||!(V==="half float"||V==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),y(v.webgl_depth_texture||!(V==="uint16"||V==="uint32"||V==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),y.parameter(V,ge,"invalid texture type"),$.type=ge[V]}var Ce=$.width,We=$.height,w=$.channels,m=!1;"shape"in j?(y(Array.isArray(j.shape)&&j.shape.length>=2,"shape must be an array"),Ce=j.shape[0],We=j.shape[1],j.shape.length===3&&(w=j.shape[2],y(w>0&&w<=4,"invalid number of channels"),m=!0),y(Ce>=0&&Ce<=T.maxTextureSize,"invalid width"),y(We>=0&&We<=T.maxTextureSize,"invalid height")):("radius"in j&&(Ce=We=j.radius,y(Ce>=0&&Ce<=T.maxTextureSize,"invalid radius")),"width"in j&&(Ce=j.width,y(Ce>=0&&Ce<=T.maxTextureSize,"invalid width")),"height"in j&&(We=j.height,y(We>=0&&We<=T.maxTextureSize,"invalid height")),"channels"in j&&(w=j.channels,y(w>0&&w<=4,"invalid number of channels"),m=!0)),$.width=Ce|0,$.height=We|0,$.channels=w|0;var S=!1;if("format"in j){var D=j.format;y(v.webgl_depth_texture||!(D==="depth"||D==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),y.parameter(D,ce,"invalid texture format");var B=$.internalformat=ce[D];$.format=Ge[B],D in ge&&("type"in j||($.type=ge[D])),D in ue&&($.compressed=!0),S=!0}!m&&S?$.channels=lr[$.format]:m&&!S?$.channels!==vo[$.format]&&($.format=$.internalformat=vo[$.channels]):S&&m&&y($.channels===lr[$.format],"number of channels inconsistent with specified format")}}function ye($){f.pixelStorei(iv,$.flipY),f.pixelStorei(cv,$.premultiplyAlpha),f.pixelStorei(lv,$.colorSpace),f.pixelStorei(av,$.unpackAlignment)}function le(){te.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function be($,j){var V=null;if(di(j)?V=j:j&&(y.type(j,"object","invalid pixel data type"),Me($,j),"x"in j&&($.xOffset=j.x|0),"y"in j&&($.yOffset=j.y|0),di(j.data)&&(V=j.data)),y(!$.compressed||V instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),j.copy){y(!V,"can not specify copy and data field for the same texture");var Ce=J.viewportWidth,We=J.viewportHeight;$.width=$.width||Ce-$.xOffset,$.height=$.height||We-$.yOffset,$.needsCopy=!0,y($.xOffset>=0&&$.xOffset<Ce&&$.yOffset>=0&&$.yOffset<We&&$.width>0&&$.width<=Ce&&$.height>0&&$.height<=We,"copy texture read out of bounds")}else if(!V)$.width=$.width||1,$.height=$.height||1,$.channels=$.channels||4;else if(r(V))$.channels=$.channels||4,$.data=V,!("type"in j)&&$.type===Fn&&($.type=Mf(V));else if(Tf(V))$.channels=$.channels||4,vv($,V),$.alignment=1,$.needsFree=!0;else if(hr(V)){var w=V.data;!Array.isArray(w)&&$.type===Fn&&($.type=Mf(w));var m=V.shape,S=V.stride,D,B,O,C,N,_;m.length===3?(O=m[2],_=S[2]):(y(m.length===2,"invalid ndarray pixel data, must be 2 or 3D"),O=1,_=1),D=m[0],B=m[1],C=S[0],N=S[1],$.alignment=1,$.width=D,$.height=B,$.channels=O,$.format=$.internalformat=vo[O],$.needsFree=!0,gv($,w,C,N,_,V.offset)}else if(Pf(V)||Cf(V)||dv(V))Pf(V)||Cf(V)?$.element=V:$.element=V.canvas,$.width=$.element.width,$.height=$.element.height,$.channels=4;else if(hv(V))$.element=V,$.width=V.width,$.height=V.height,$.channels=4;else if(mv(V))$.element=V,$.width=V.naturalWidth,$.height=V.naturalHeight,$.channels=4;else if(pv(V))$.element=V,$.width=V.videoWidth,$.height=V.videoHeight,$.channels=4;else if(Sf(V)){var A=$.width||V[0].length,x=$.height||V.length,z=$.channels;ht(V[0][0])?z=z||V[0][0].length:z=z||1;for(var I=io.shape(V),W=1,re=0;re<I.length;++re)W*=I[re];var ve=Of($,W);io.flatten(V,I,"",ve),Rf($,ve),$.alignment=1,$.width=A,$.height=x,$.channels=z,$.format=$.internalformat=vo[z],$.needsFree=!0}$.type===ys?y(T.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):$.type===Ln&&y(T.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function we($,j,V){var Ce=$.element,We=$.data,w=$.internalformat,m=$.format,S=$.type,D=$.width,B=$.height;ye($),Ce?f.texImage2D(j,V,m,m,S,Ce):$.compressed?f.compressedTexImage2D(j,V,w,D,B,0,We):$.needsCopy?(X(),f.copyTexImage2D(j,V,m,$.xOffset,$.yOffset,D,B,0)):f.texImage2D(j,V,m,D,B,0,m,S,We||null)}function je($,j,V,Ce,We){var w=$.element,m=$.data,S=$.internalformat,D=$.format,B=$.type,O=$.width,C=$.height;ye($),w?f.texSubImage2D(j,We,V,Ce,D,B,w):$.compressed?f.compressedTexSubImage2D(j,We,V,Ce,S,O,C,m):$.needsCopy?(X(),f.copyTexSubImage2D(j,We,V,Ce,$.xOffset,$.yOffset,O,C)):f.texSubImage2D(j,We,V,Ce,O,C,D,B,m)}var Ue=[];function xe(){return Ue.pop()||new le}function Ae($){$.needsFree&&_t.freeType($.data),le.call($),Ue.push($)}function ke(){te.call(this),this.genMipmaps=!1,this.mipmapHint=po,this.mipmask=0,this.images=Array(16)}function He($,j,V){var Ce=$.images[0]=xe();$.mipmask=1,Ce.width=$.width=j,Ce.height=$.height=V,Ce.channels=$.channels=4}function Qe($,j){var V=null;if(di(j))V=$.images[0]=xe(),K(V,$),be(V,j),$.mipmask=1;else if(Me($,j),Array.isArray(j.mipmap))for(var Ce=j.mipmap,We=0;We<Ce.length;++We)V=$.images[We]=xe(),K(V,$),V.width>>=We,V.height>>=We,be(V,Ce[We]),$.mipmask|=1<<We;else V=$.images[0]=xe(),K(V,$),be(V,j),$.mipmask=1;K($,$.images[0]),$.compressed&&($.internalformat===ri||$.internalformat===ni||$.internalformat===si||$.internalformat===oi)&&y($.width%4===0&&$.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function mt($,j){for(var V=$.images,Ce=0;Ce<V.length;++Ce){if(!V[Ce])return;we(V[Ce],j,Ce)}}var pt=[];function tt(){var $=pt.pop()||new ke;te.call($),$.mipmask=0;for(var j=0;j<16;++j)$.images[j]=null;return $}function At($){for(var j=$.images,V=0;V<j.length;++V)j[V]&&Ae(j[V]),j[V]=null;pt.push($)}function ft(){this.minFilter=li,this.magFilter=li,this.wrapS=ci,this.wrapT=ci,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=po}function Et($,j){if("min"in j){var V=j.min;y.parameter(V,me),$.minFilter=me[V],fv.indexOf($.minFilter)>=0&&!("faces"in j)&&($.genMipmaps=!0)}if("mag"in j){var Ce=j.mag;y.parameter(Ce,de),$.magFilter=de[Ce]}var We=$.wrapS,w=$.wrapT;if("wrap"in j){var m=j.wrap;typeof m=="string"?(y.parameter(m,ae),We=w=ae[m]):Array.isArray(m)&&(y.parameter(m[0],ae),y.parameter(m[1],ae),We=ae[m[0]],w=ae[m[1]])}else{if("wrapS"in j){var S=j.wrapS;y.parameter(S,ae),We=ae[S]}if("wrapT"in j){var D=j.wrapT;y.parameter(D,ae),w=ae[D]}}if($.wrapS=We,$.wrapT=w,"anisotropic"in j){var B=j.anisotropic;y(typeof B=="number"&&B>=1&&B<=T.maxAnisotropic,"aniso samples must be between 1 and "),$.anisotropic=j.anisotropic}if("mipmap"in j){var O=!1;switch(typeof j.mipmap){case"string":y.parameter(j.mipmap,ie,"invalid mipmap hint"),$.mipmapHint=ie[j.mipmap],$.genMipmaps=!0,O=!0;break;case"boolean":O=$.genMipmaps=j.mipmap;break;case"object":y(Array.isArray(j.mipmap),"invalid mipmap type"),$.genMipmaps=!1,O=!0;break;default:y.raise("invalid mipmap type")}O&&!("min"in j)&&($.minFilter=fi)}}function Tt($,j){f.texParameteri(j,ev,$.minFilter),f.texParameteri(j,J2,$.magFilter),f.texParameteri(j,Z2,$.wrapS),f.texParameteri(j,W2,$.wrapT),v.ext_texture_filter_anisotropic&&f.texParameteri(j,ov,$.anisotropic),$.genMipmaps&&(f.hint(rv,$.mipmapHint),f.generateMipmap(j))}var St=0,Ft={},kt=T.maxTextureUnits,gt=Array(kt).map(function(){return null});function Ye($){te.call(this),this.mipmask=0,this.internalformat=an,this.id=St++,this.refCount=1,this.target=$,this.texture=f.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new ft,Y.profile&&(this.stats={size:0})}function Bt($){f.activeTexture(bs),f.bindTexture($.target,$.texture)}function ot(){var $=gt[0];$?f.bindTexture($.target,$.texture):f.bindTexture(wr,null)}function De($){var j=$.texture;y(j,"must not double destroy texture");var V=$.unit,Ce=$.target;V>=0&&(f.activeTexture(bs+V),f.bindTexture(Ce,null),gt[V]=null),f.deleteTexture(j),$.texture=null,$.params=null,$.pixels=null,$.refCount=0,delete Ft[$.id],q.textureCount--}n(Ye.prototype,{bind:function(){var $=this;$.bindCount+=1;var j=$.unit;if(j<0){for(var V=0;V<kt;++V){var Ce=gt[V];if(Ce){if(Ce.bindCount>0)continue;Ce.unit=-1}gt[V]=$,j=V;break}j>=kt&&y.raise("insufficient number of texture units"),Y.profile&&q.maxTextureUnits<j+1&&(q.maxTextureUnits=j+1),$.unit=j,f.activeTexture(bs+j),f.bindTexture($.target,$.texture)}return j},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&De(this)}});function Ke($,j){var V=new Ye(wr);Ft[V.id]=V,q.textureCount++;function Ce(m,S){var D=V.texInfo;ft.call(D);var B=tt();return typeof m=="number"?typeof S=="number"?He(B,m|0,S|0):He(B,m|0,m|0):m?(y.type(m,"object","invalid arguments to regl.texture"),Et(D,m),Qe(B,m)):He(B,1,1),D.genMipmaps&&(B.mipmask=(B.width<<1)-1),V.mipmask=B.mipmask,K(V,B),y.texture2D(D,B,T),V.internalformat=B.internalformat,Ce.width=B.width,Ce.height=B.height,Bt(V),mt(B,wr),Tt(D,wr),ot(),At(B),Y.profile&&(V.stats.size=go(V.internalformat,V.type,B.width,B.height,D.genMipmaps,!1)),Ce.format=fe[V.internalformat],Ce.type=Te[V.type],Ce.mag=se[D.magFilter],Ce.min=Ee[D.minFilter],Ce.wrapS=_e[D.wrapS],Ce.wrapT=_e[D.wrapT],Ce}function We(m,S,D,B){y(!!m,"must specify image data");var O=S|0,C=D|0,N=B|0,_=xe();return K(_,V),_.width=0,_.height=0,be(_,m),_.width=_.width||(V.width>>N)-O,_.height=_.height||(V.height>>N)-C,y(V.type===_.type&&V.format===_.format&&V.internalformat===_.internalformat,"incompatible format for texture.subimage"),y(O>=0&&C>=0&&O+_.width<=V.width&&C+_.height<=V.height,"texture.subimage write out of bounds"),y(V.mipmask&1<<N,"missing mipmap data"),y(_.data||_.element||_.needsCopy,"missing image data"),Bt(V),je(_,wr,O,C,N),ot(),Ae(_),Ce}function w(m,S){var D=m|0,B=S|0||D;if(D===V.width&&B===V.height)return Ce;Ce.width=V.width=D,Ce.height=V.height=B,Bt(V);for(var O=0;V.mipmask>>O;++O){var C=D>>O,N=B>>O;if(!C||!N)break;f.texImage2D(wr,O,V.format,C,N,0,V.format,V.type,null)}return ot(),Y.profile&&(V.stats.size=go(V.internalformat,V.type,D,B,!1,!1)),Ce}return Ce($,j),Ce.subimage=We,Ce.resize=w,Ce._reglType="texture2d",Ce._texture=V,Y.profile&&(Ce.stats=V.stats),Ce.destroy=function(){V.decRef()},Ce}function nt($,j,V,Ce,We,w){var m=new Ye(Wa);Ft[m.id]=m,q.cubeCount++;var S=new Array(6);function D(C,N,_,A,x,z){var I,W=m.texInfo;for(ft.call(W),I=0;I<6;++I)S[I]=tt();if(typeof C=="number"||!C){var re=C|0||1;for(I=0;I<6;++I)He(S[I],re,re)}else if(typeof C=="object")if(N)Qe(S[0],C),Qe(S[1],N),Qe(S[2],_),Qe(S[3],A),Qe(S[4],x),Qe(S[5],z);else if(Et(W,C),Me(m,C),"faces"in C){var ve=C.faces;for(y(Array.isArray(ve)&&ve.length===6,"cube faces must be a length 6 array"),I=0;I<6;++I)y(typeof ve[I]=="object"&&!!ve[I],"invalid input for cube map face"),K(S[I],m),Qe(S[I],ve[I])}else for(I=0;I<6;++I)Qe(S[I],C);else y.raise("invalid arguments to cube map");for(K(m,S[0]),y.optional(function(){T.npotTextureCube||y(of(m.width)&&of(m.height),"your browser does not support non power or two texture dimensions")}),W.genMipmaps?m.mipmask=(S[0].width<<1)-1:m.mipmask=S[0].mipmask,y.textureCube(m,W,S,T),m.internalformat=S[0].internalformat,D.width=S[0].width,D.height=S[0].height,Bt(m),I=0;I<6;++I)mt(S[I],fo+I);for(Tt(W,Wa),ot(),Y.profile&&(m.stats.size=go(m.internalformat,m.type,D.width,D.height,W.genMipmaps,!0)),D.format=fe[m.internalformat],D.type=Te[m.type],D.mag=se[W.magFilter],D.min=Ee[W.minFilter],D.wrapS=_e[W.wrapS],D.wrapT=_e[W.wrapT],I=0;I<6;++I)At(S[I]);return D}function B(C,N,_,A,x){y(!!N,"must specify image data"),y(typeof C=="number"&&C===(C|0)&&C>=0&&C<6,"invalid face");var z=_|0,I=A|0,W=x|0,re=xe();return K(re,m),re.width=0,re.height=0,be(re,N),re.width=re.width||(m.width>>W)-z,re.height=re.height||(m.height>>W)-I,y(m.type===re.type&&m.format===re.format&&m.internalformat===re.internalformat,"incompatible format for texture.subimage"),y(z>=0&&I>=0&&z+re.width<=m.width&&I+re.height<=m.height,"texture.subimage write out of bounds"),y(m.mipmask&1<<W,"missing mipmap data"),y(re.data||re.element||re.needsCopy,"missing image data"),Bt(m),je(re,fo+C,z,I,W),ot(),Ae(re),D}function O(C){var N=C|0;if(N!==m.width){D.width=m.width=N,D.height=m.height=N,Bt(m);for(var _=0;_<6;++_)for(var A=0;m.mipmask>>A;++A)f.texImage2D(fo+_,A,m.format,N>>A,N>>A,0,m.format,m.type,null);return ot(),Y.profile&&(m.stats.size=go(m.internalformat,m.type,D.width,D.height,!1,!0)),D}}return D($,j,V,Ce,We,w),D.subimage=B,D.resize=O,D._reglType="textureCube",D._texture=m,Y.profile&&(D.stats=m.stats),D.destroy=function(){m.decRef()},D}function yt(){for(var $=0;$<kt;++$)f.activeTexture(bs+$),f.bindTexture(wr,null),gt[$]=null;sr(Ft).forEach(De),q.cubeCount=0,q.textureCount=0}Y.profile&&(q.getTotalTextureSize=function(){var $=0;return Object.keys(Ft).forEach(function(j){$+=Ft[j].stats.size}),$});function xr(){for(var $=0;$<kt;++$){var j=gt[$];j&&(j.bindCount=0,j.unit=-1,gt[$]=null)}sr(Ft).forEach(function(V){V.texture=f.createTexture(),f.bindTexture(V.target,V.texture);for(var Ce=0;Ce<32;++Ce)if((V.mipmask&1<<Ce)!==0)if(V.target===wr)f.texImage2D(wr,Ce,V.internalformat,V.width>>Ce,V.height>>Ce,0,V.internalformat,V.type,null);else for(var We=0;We<6;++We)f.texImage2D(fo+We,Ce,V.internalformat,V.width>>Ce,V.height>>Ce,0,V.internalformat,V.type,null);Tt(V.texInfo,V.target)})}function pn(){for(var $=0;$<kt;++$){var j=gt[$];j&&(j.bindCount=0,j.unit=-1,gt[$]=null),f.activeTexture(bs+$),f.bindTexture(wr,null),f.bindTexture(Wa,null)}}return{create2D:Ke,createCube:nt,clear:yt,getTexture:function($){return null},restore:xr,refresh:pn}}var Ir=36161,yo=32854,Lf=32855,Ff=36194,Gf=33189,Nf=36168,Df=34041,kf=35907,Bf=34836,If=34842,zf=34843,mr=[];mr[yo]=2,mr[Lf]=2,mr[Ff]=2,mr[Gf]=2,mr[Nf]=1,mr[Df]=4,mr[kf]=4,mr[Bf]=16,mr[If]=8,mr[zf]=6;function Vf(f,v,T){return mr[f]*v*T}var bv=function(f,v,T,X,J){var q={rgba4:yo,rgb565:Ff,"rgb5 a1":Lf,depth:Gf,stencil:Nf,"depth stencil":Df};v.ext_srgb&&(q.srgba=kf),v.ext_color_buffer_half_float&&(q.rgba16f=If,q.rgb16f=zf),v.webgl_color_buffer_float&&(q.rgba32f=Bf);var Y=[];Object.keys(q).forEach(function(ce){var ue=q[ce];Y[ue]=ce});var ie=0,ae={};function de(ce){this.id=ie++,this.refCount=1,this.renderbuffer=ce,this.format=yo,this.width=0,this.height=0,J.profile&&(this.stats={size:0})}de.prototype.decRef=function(){--this.refCount<=0&&me(this)};function me(ce){var ue=ce.renderbuffer;y(ue,"must not double destroy renderbuffer"),f.bindRenderbuffer(Ir,null),f.deleteRenderbuffer(ue),ce.renderbuffer=null,ce.refCount=0,delete ae[ce.id],X.renderbufferCount--}function he(ce,ue){var k=new de(f.createRenderbuffer());ae[k.id]=k,X.renderbufferCount++;function H(Te,se){var Ee=0,_e=0,Ge=yo;if(typeof Te=="object"&&Te){var te=Te;if("shape"in te){var K=te.shape;y(Array.isArray(K)&&K.length>=2,"invalid renderbuffer shape"),Ee=K[0]|0,_e=K[1]|0}else"radius"in te&&(Ee=_e=te.radius|0),"width"in te&&(Ee=te.width|0),"height"in te&&(_e=te.height|0);"format"in te&&(y.parameter(te.format,q,"invalid renderbuffer format"),Ge=q[te.format])}else typeof Te=="number"?(Ee=Te|0,typeof se=="number"?_e=se|0:_e=Ee):Te?y.raise("invalid arguments to renderbuffer constructor"):Ee=_e=1;if(y(Ee>0&&_e>0&&Ee<=T.maxRenderbufferSize&&_e<=T.maxRenderbufferSize,"invalid renderbuffer size"),!(Ee===k.width&&_e===k.height&&Ge===k.format))return H.width=k.width=Ee,H.height=k.height=_e,k.format=Ge,f.bindRenderbuffer(Ir,k.renderbuffer),f.renderbufferStorage(Ir,Ge,Ee,_e),y(f.getError()===0,"invalid render buffer format"),J.profile&&(k.stats.size=Vf(k.format,k.width,k.height)),H.format=Y[k.format],H}function fe(Te,se){var Ee=Te|0,_e=se|0||Ee;return Ee===k.width&&_e===k.height||(y(Ee>0&&_e>0&&Ee<=T.maxRenderbufferSize&&_e<=T.maxRenderbufferSize,"invalid renderbuffer size"),H.width=k.width=Ee,H.height=k.height=_e,f.bindRenderbuffer(Ir,k.renderbuffer),f.renderbufferStorage(Ir,k.format,Ee,_e),y(f.getError()===0,"invalid render buffer format"),J.profile&&(k.stats.size=Vf(k.format,k.width,k.height))),H}return H(ce,ue),H.resize=fe,H._reglType="renderbuffer",H._renderbuffer=k,J.profile&&(H.stats=k.stats),H.destroy=function(){k.decRef()},H}J.profile&&(X.getTotalRenderbufferSize=function(){var ce=0;return Object.keys(ae).forEach(function(ue){ce+=ae[ue].stats.size}),ce});function ge(){sr(ae).forEach(function(ce){ce.renderbuffer=f.createRenderbuffer(),f.bindRenderbuffer(Ir,ce.renderbuffer),f.renderbufferStorage(Ir,ce.format,ce.width,ce.height)}),f.bindRenderbuffer(Ir,null)}return{create:he,clear:function(){sr(ae).forEach(me)},restore:ge}},Cr=36160,hi=36161,ln=3553,bo=34069,Uf=36064,qf=36096,Xf=36128,jf=33306,Hf=36053,wv=36054,_v=36055,xv=36057,Ev=36061,$v=36193,Av=5121,Tv=5126,Yf=6407,Zf=6408,Sv=6402,Pv=[Yf,Zf],mi=[];mi[Zf]=4,mi[Yf]=3;var wo=[];wo[Av]=1,wo[Tv]=4,wo[$v]=2;var Cv=32854,Mv=32855,Ov=36194,Rv=33189,Lv=36168,Wf=34041,Fv=35907,Gv=34836,Nv=34842,Dv=34843,kv=[Cv,Mv,Ov,Fv,Nv,Dv,Gv],Dn={};Dn[Hf]="complete",Dn[wv]="incomplete attachment",Dn[xv]="incomplete dimensions",Dn[_v]="incomplete, missing attachment",Dn[Ev]="unsupported";function Bv(f,v,T,X,J,q){var Y={cur:null,next:null,dirty:!1,setFBO:null},ie=["rgba"],ae=["rgba4","rgb565","rgb5 a1"];v.ext_srgb&&ae.push("srgba"),v.ext_color_buffer_half_float&&ae.push("rgba16f","rgb16f"),v.webgl_color_buffer_float&&ae.push("rgba32f");var de=["uint8"];v.oes_texture_half_float&&de.push("half float","float16"),v.oes_texture_float&&de.push("float","float32");function me(le,be,we){this.target=le,this.texture=be,this.renderbuffer=we;var je=0,Ue=0;be?(je=be.width,Ue=be.height):we&&(je=we.width,Ue=we.height),this.width=je,this.height=Ue}function he(le){le&&(le.texture&&le.texture._texture.decRef(),le.renderbuffer&&le.renderbuffer._renderbuffer.decRef())}function ge(le,be,we){if(!!le)if(le.texture){var je=le.texture._texture,Ue=Math.max(1,je.width),xe=Math.max(1,je.height);y(Ue===be&&xe===we,"inconsistent width/height for supplied texture"),je.refCount+=1}else{var Ae=le.renderbuffer._renderbuffer;y(Ae.width===be&&Ae.height===we,"inconsistent width/height for renderbuffer"),Ae.refCount+=1}}function ce(le,be){be&&(be.texture?f.framebufferTexture2D(Cr,le,be.target,be.texture._texture.texture,0):f.framebufferRenderbuffer(Cr,le,hi,be.renderbuffer._renderbuffer.renderbuffer))}function ue(le){var be=ln,we=null,je=null,Ue=le;typeof le=="object"&&(Ue=le.data,"target"in le&&(be=le.target|0)),y.type(Ue,"function","invalid attachment data");var xe=Ue._reglType;return xe==="texture2d"?(we=Ue,y(be===ln)):xe==="textureCube"?(we=Ue,y(be>=bo&&be<bo+6,"invalid cube map target")):xe==="renderbuffer"?(je=Ue,be=hi):y.raise("invalid regl object for attachment"),new me(be,we,je)}function k(le,be,we,je,Ue){if(we){var xe=X.create2D({width:le,height:be,format:je,type:Ue});return xe._texture.refCount=0,new me(ln,xe,null)}else{var Ae=J.create({width:le,height:be,format:je});return Ae._renderbuffer.refCount=0,new me(hi,null,Ae)}}function H(le){return le&&(le.texture||le.renderbuffer)}function fe(le,be,we){le&&(le.texture?le.texture.resize(be,we):le.renderbuffer&&le.renderbuffer.resize(be,we),le.width=be,le.height=we)}var Te=0,se={};function Ee(){this.id=Te++,se[this.id]=this,this.framebuffer=f.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function _e(le){le.colorAttachments.forEach(he),he(le.depthAttachment),he(le.stencilAttachment),he(le.depthStencilAttachment)}function Ge(le){var be=le.framebuffer;y(be,"must not double destroy framebuffer"),f.deleteFramebuffer(be),le.framebuffer=null,q.framebufferCount--,delete se[le.id]}function te(le){var be;f.bindFramebuffer(Cr,le.framebuffer);var we=le.colorAttachments;for(be=0;be<we.length;++be)ce(Uf+be,we[be]);for(be=we.length;be<T.maxColorAttachments;++be)f.framebufferTexture2D(Cr,Uf+be,ln,null,0);f.framebufferTexture2D(Cr,jf,ln,null,0),f.framebufferTexture2D(Cr,qf,ln,null,0),f.framebufferTexture2D(Cr,Xf,ln,null,0),ce(qf,le.depthAttachment),ce(Xf,le.stencilAttachment),ce(jf,le.depthStencilAttachment);var je=f.checkFramebufferStatus(Cr);!f.isContextLost()&&je!==Hf&&y.raise("framebuffer configuration not supported, status = "+Dn[je]),f.bindFramebuffer(Cr,Y.next?Y.next.framebuffer:null),Y.cur=Y.next,f.getError()}function K(le,be){var we=new Ee;q.framebufferCount++;function je(xe,Ae){var ke;y(Y.next!==we,"can not update framebuffer which is currently in use");var He=0,Qe=0,mt=!0,pt=!0,tt=null,At=!0,ft="rgba",Et="uint8",Tt=1,St=null,Ft=null,kt=null,gt=!1;if(typeof xe=="number")He=xe|0,Qe=Ae|0||He;else if(!xe)He=Qe=1;else{y.type(xe,"object","invalid arguments for framebuffer");var Ye=xe;if("shape"in Ye){var Bt=Ye.shape;y(Array.isArray(Bt)&&Bt.length>=2,"invalid shape for framebuffer"),He=Bt[0],Qe=Bt[1]}else"radius"in Ye&&(He=Qe=Ye.radius),"width"in Ye&&(He=Ye.width),"height"in Ye&&(Qe=Ye.height);("color"in Ye||"colors"in Ye)&&(tt=Ye.color||Ye.colors,Array.isArray(tt)&&y(tt.length===1||v.webgl_draw_buffers,"multiple render targets not supported")),tt||("colorCount"in Ye&&(Tt=Ye.colorCount|0,y(Tt>0,"invalid color buffer count")),"colorTexture"in Ye&&(At=!!Ye.colorTexture,ft="rgba4"),"colorType"in Ye&&(Et=Ye.colorType,At?(y(v.oes_texture_float||!(Et==="float"||Et==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),y(v.oes_texture_half_float||!(Et==="half float"||Et==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Et==="half float"||Et==="float16"?(y(v.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),ft="rgba16f"):(Et==="float"||Et==="float32")&&(y(v.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),ft="rgba32f"),y.oneOf(Et,de,"invalid color type")),"colorFormat"in Ye&&(ft=Ye.colorFormat,ie.indexOf(ft)>=0?At=!0:ae.indexOf(ft)>=0?At=!1:y.optional(function(){At?y.oneOf(Ye.colorFormat,ie,"invalid color format for texture"):y.oneOf(Ye.colorFormat,ae,"invalid color format for renderbuffer")}))),("depthTexture"in Ye||"depthStencilTexture"in Ye)&&(gt=!!(Ye.depthTexture||Ye.depthStencilTexture),y(!gt||v.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Ye&&(typeof Ye.depth=="boolean"?mt=Ye.depth:(St=Ye.depth,pt=!1)),"stencil"in Ye&&(typeof Ye.stencil=="boolean"?pt=Ye.stencil:(Ft=Ye.stencil,mt=!1)),"depthStencil"in Ye&&(typeof Ye.depthStencil=="boolean"?mt=pt=Ye.depthStencil:(kt=Ye.depthStencil,mt=!1,pt=!1))}var ot=null,De=null,Ke=null,nt=null;if(Array.isArray(tt))ot=tt.map(ue);else if(tt)ot=[ue(tt)];else for(ot=new Array(Tt),ke=0;ke<Tt;++ke)ot[ke]=k(He,Qe,At,ft,Et);y(v.webgl_draw_buffers||ot.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),y(ot.length<=T.maxColorAttachments,"too many color attachments, not supported"),He=He||ot[0].width,Qe=Qe||ot[0].height,St?De=ue(St):mt&&!pt&&(De=k(He,Qe,gt,"depth","uint32")),Ft?Ke=ue(Ft):pt&&!mt&&(Ke=k(He,Qe,!1,"stencil","uint8")),kt?nt=ue(kt):!St&&!Ft&&pt&&mt&&(nt=k(He,Qe,gt,"depth stencil","depth stencil")),y(!!St+!!Ft+!!kt<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var yt=null;for(ke=0;ke<ot.length;++ke)if(ge(ot[ke],He,Qe),y(!ot[ke]||ot[ke].texture&&Pv.indexOf(ot[ke].texture._texture.format)>=0||ot[ke].renderbuffer&&kv.indexOf(ot[ke].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+ke+" is invalid"),ot[ke]&&ot[ke].texture){var xr=mi[ot[ke].texture._texture.format]*wo[ot[ke].texture._texture.type];yt===null?yt=xr:y(yt===xr,"all color attachments much have the same number of bits per pixel.")}return ge(De,He,Qe),y(!De||De.texture&&De.texture._texture.format===Sv||De.renderbuffer&&De.renderbuffer._renderbuffer.format===Rv,"invalid depth attachment for framebuffer object"),ge(Ke,He,Qe),y(!Ke||Ke.renderbuffer&&Ke.renderbuffer._renderbuffer.format===Lv,"invalid stencil attachment for framebuffer object"),ge(nt,He,Qe),y(!nt||nt.texture&&nt.texture._texture.format===Wf||nt.renderbuffer&&nt.renderbuffer._renderbuffer.format===Wf,"invalid depth-stencil attachment for framebuffer object"),_e(we),we.width=He,we.height=Qe,we.colorAttachments=ot,we.depthAttachment=De,we.stencilAttachment=Ke,we.depthStencilAttachment=nt,je.color=ot.map(H),je.depth=H(De),je.stencil=H(Ke),je.depthStencil=H(nt),je.width=we.width,je.height=we.height,te(we),je}function Ue(xe,Ae){y(Y.next!==we,"can not resize a framebuffer which is currently in use");var ke=Math.max(xe|0,1),He=Math.max(Ae|0||ke,1);if(ke===we.width&&He===we.height)return je;for(var Qe=we.colorAttachments,mt=0;mt<Qe.length;++mt)fe(Qe[mt],ke,He);return fe(we.depthAttachment,ke,He),fe(we.stencilAttachment,ke,He),fe(we.depthStencilAttachment,ke,He),we.width=je.width=ke,we.height=je.height=He,te(we),je}return je(le,be),n(je,{resize:Ue,_reglType:"framebuffer",_framebuffer:we,destroy:function(){Ge(we),_e(we)},use:function(xe){Y.setFBO({framebuffer:je},xe)}})}function Me(le){var be=Array(6);function we(Ue){var xe;y(be.indexOf(Y.next)<0,"can not update framebuffer which is currently in use");var Ae={color:null},ke=0,He=null,Qe="rgba",mt="uint8",pt=1;if(typeof Ue=="number")ke=Ue|0;else if(!Ue)ke=1;else{y.type(Ue,"object","invalid arguments for framebuffer");var tt=Ue;if("shape"in tt){var At=tt.shape;y(Array.isArray(At)&&At.length>=2,"invalid shape for framebuffer"),y(At[0]===At[1],"cube framebuffer must be square"),ke=At[0]}else"radius"in tt&&(ke=tt.radius|0),"width"in tt?(ke=tt.width|0,"height"in tt&&y(tt.height===ke,"must be square")):"height"in tt&&(ke=tt.height|0);("color"in tt||"colors"in tt)&&(He=tt.color||tt.colors,Array.isArray(He)&&y(He.length===1||v.webgl_draw_buffers,"multiple render targets not supported")),He||("colorCount"in tt&&(pt=tt.colorCount|0,y(pt>0,"invalid color buffer count")),"colorType"in tt&&(y.oneOf(tt.colorType,de,"invalid color type"),mt=tt.colorType),"colorFormat"in tt&&(Qe=tt.colorFormat,y.oneOf(tt.colorFormat,ie,"invalid color format for texture"))),"depth"in tt&&(Ae.depth=tt.depth),"stencil"in tt&&(Ae.stencil=tt.stencil),"depthStencil"in tt&&(Ae.depthStencil=tt.depthStencil)}var ft;if(He)if(Array.isArray(He))for(ft=[],xe=0;xe<He.length;++xe)ft[xe]=He[xe];else ft=[He];else{ft=Array(pt);var Et={radius:ke,format:Qe,type:mt};for(xe=0;xe<pt;++xe)ft[xe]=X.createCube(Et)}for(Ae.color=Array(ft.length),xe=0;xe<ft.length;++xe){var Tt=ft[xe];y(typeof Tt=="function"&&Tt._reglType==="textureCube","invalid cube map"),ke=ke||Tt.width,y(Tt.width===ke&&Tt.height===ke,"invalid cube map shape"),Ae.color[xe]={target:bo,data:ft[xe]}}for(xe=0;xe<6;++xe){for(var St=0;St<ft.length;++St)Ae.color[St].target=bo+xe;xe>0&&(Ae.depth=be[0].depth,Ae.stencil=be[0].stencil,Ae.depthStencil=be[0].depthStencil),be[xe]?be[xe](Ae):be[xe]=K(Ae)}return n(we,{width:ke,height:ke,color:ft})}function je(Ue){var xe,Ae=Ue|0;if(y(Ae>0&&Ae<=T.maxCubeMapSize,"invalid radius for cube fbo"),Ae===we.width)return we;var ke=we.color;for(xe=0;xe<ke.length;++xe)ke[xe].resize(Ae);for(xe=0;xe<6;++xe)be[xe].resize(Ae);return we.width=we.height=Ae,we}return we(le),n(we,{faces:be,resize:je,_reglType:"framebufferCube",destroy:function(){be.forEach(function(Ue){Ue.destroy()})}})}function ye(){Y.cur=null,Y.next=null,Y.dirty=!0,sr(se).forEach(function(le){le.framebuffer=f.createFramebuffer(),te(le)})}return n(Y,{getFramebuffer:function(le){if(typeof le=="function"&&le._reglType==="framebuffer"){var be=le._framebuffer;if(be instanceof Ee)return be}return null},create:K,createCube:Me,clear:function(){sr(se).forEach(Ge)},restore:ye})}var Iv=5126,Qf=34962,_o=34963,Kf=["attributes","elements","offset","count","primitive","instances"];function pi(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Iv,this.offset=0,this.stride=0,this.divisor=0}function zv(f,v,T,X,J,q,Y){for(var ie=T.maxAttributes,ae=new Array(ie),de=0;de<ie;++de)ae[de]=new pi;var me=0,he={},ge={Record:pi,scope:{},state:ae,currentVAO:null,targetVAO:null,restore:ue()?_e:function(){},createVAO:Ge,getVAO:H,destroyBuffer:ce,setVAO:ue()?fe:Te,clear:ue()?se:function(){}};function ce(te){for(var K=0;K<ae.length;++K){var Me=ae[K];Me.buffer===te&&(f.disableVertexAttribArray(K),Me.buffer=null)}}function ue(){return v.oes_vertex_array_object}function k(){return v.angle_instanced_arrays}function H(te){return typeof te=="function"&&te._vao?te._vao:null}function fe(te){if(te!==ge.currentVAO){var K=ue();te?K.bindVertexArrayOES(te.vao):K.bindVertexArrayOES(null),ge.currentVAO=te}}function Te(te){if(te!==ge.currentVAO){if(te)te.bindAttrs();else{for(var K=k(),Me=0;Me<ae.length;++Me){var ye=ae[Me];ye.buffer?(f.enableVertexAttribArray(Me),ye.buffer.bind(),f.vertexAttribPointer(Me,ye.size,ye.type,ye.normalized,ye.stride,ye.offfset),K&&ye.divisor&&K.vertexAttribDivisorANGLE(Me,ye.divisor)):(f.disableVertexAttribArray(Me),f.vertexAttrib4f(Me,ye.x,ye.y,ye.z,ye.w))}Y.elements?f.bindBuffer(_o,Y.elements.buffer.buffer):f.bindBuffer(_o,null)}ge.currentVAO=te}}function se(){sr(he).forEach(function(te){te.destroy()})}function Ee(){this.id=++me,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var te=ue();te?this.vao=te.createVertexArrayOES():this.vao=null,he[this.id]=this,this.buffers=[]}Ee.prototype.bindAttrs=function(){for(var te=k(),K=this.attributes,Me=0;Me<K.length;++Me){var ye=K[Me];ye.buffer?(f.enableVertexAttribArray(Me),f.bindBuffer(Qf,ye.buffer.buffer),f.vertexAttribPointer(Me,ye.size,ye.type,ye.normalized,ye.stride,ye.offset),te&&ye.divisor&&te.vertexAttribDivisorANGLE(Me,ye.divisor)):(f.disableVertexAttribArray(Me),f.vertexAttrib4f(Me,ye.x,ye.y,ye.z,ye.w))}for(var le=K.length;le<ie;++le)f.disableVertexAttribArray(le);var be=q.getElements(this.elements);be?f.bindBuffer(_o,be.buffer.buffer):f.bindBuffer(_o,null)},Ee.prototype.refresh=function(){var te=ue();te&&(te.bindVertexArrayOES(this.vao),this.bindAttrs(),ge.currentVAO=null,te.bindVertexArrayOES(null))},Ee.prototype.destroy=function(){if(this.vao){var te=ue();this===ge.currentVAO&&(ge.currentVAO=null,te.bindVertexArrayOES(null)),te.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),he[this.id]&&(delete he[this.id],X.vaoCount-=1)};function _e(){var te=ue();te&&sr(he).forEach(function(K){K.refresh()})}function Ge(te){var K=new Ee;X.vaoCount+=1;function Me(ye){var le;if(Array.isArray(ye))le=ye,K.elements&&K.ownsElements&&K.elements.destroy(),K.elements=null,K.ownsElements=!1,K.offset=0,K.count=0,K.instances=-1,K.primitive=4;else{if(y(typeof ye=="object","invalid arguments for create vao"),y("attributes"in ye,"must specify attributes for vao"),ye.elements){var be=ye.elements;K.ownsElements?typeof be=="function"&&be._reglType==="elements"?(K.elements.destroy(),K.ownsElements=!1):(K.elements(be),K.ownsElements=!1):q.getElements(ye.elements)?(K.elements=ye.elements,K.ownsElements=!1):(K.elements=q.create(ye.elements),K.ownsElements=!0)}else K.elements=null,K.ownsElements=!1;le=ye.attributes,K.offset=0,K.count=-1,K.instances=-1,K.primitive=4,K.elements&&(K.count=K.elements._elements.vertCount,K.primitive=K.elements._elements.primType),"offset"in ye&&(K.offset=ye.offset|0),"count"in ye&&(K.count=ye.count|0),"instances"in ye&&(K.instances=ye.instances|0),"primitive"in ye&&(y(ye.primitive in Br,"bad primitive type: "+ye.primitive),K.primitive=Br[ye.primitive]),y.optional(()=>{for(var mt=Object.keys(ye),pt=0;pt<mt.length;++pt)y(Kf.indexOf(mt[pt])>=0,'invalid option for vao: "'+mt[pt]+'" valid options are '+Kf)}),y(Array.isArray(le),"attributes must be an array")}y(le.length<ie,"too many attributes"),y(le.length>0,"must specify at least one attribute");var we={},je=K.attributes;je.length=le.length;for(var Ue=0;Ue<le.length;++Ue){var xe=le[Ue],Ae=je[Ue]=new pi,ke=xe.data||xe;if(Array.isArray(ke)||r(ke)||hr(ke)){var He;K.buffers[Ue]&&(He=K.buffers[Ue],r(ke)&&He._buffer.byteLength>=ke.byteLength?He.subdata(ke):(He.destroy(),K.buffers[Ue]=null)),K.buffers[Ue]||(He=K.buffers[Ue]=J.create(xe,Qf,!1,!0)),Ae.buffer=J.getBuffer(He),Ae.size=Ae.buffer.dimension|0,Ae.normalized=!1,Ae.type=Ae.buffer.dtype,Ae.offset=0,Ae.stride=0,Ae.divisor=0,Ae.state=1,we[Ue]=1}else J.getBuffer(xe)?(Ae.buffer=J.getBuffer(xe),Ae.size=Ae.buffer.dimension|0,Ae.normalized=!1,Ae.type=Ae.buffer.dtype,Ae.offset=0,Ae.stride=0,Ae.divisor=0,Ae.state=1):J.getBuffer(xe.buffer)?(Ae.buffer=J.getBuffer(xe.buffer),Ae.size=(+xe.size||Ae.buffer.dimension)|0,Ae.normalized=!!xe.normalized||!1,"type"in xe?(y.parameter(xe.type,sn,"invalid buffer type"),Ae.type=sn[xe.type]):Ae.type=Ae.buffer.dtype,Ae.offset=(xe.offset||0)|0,Ae.stride=(xe.stride||0)|0,Ae.divisor=(xe.divisor||0)|0,Ae.state=1,y(Ae.size>=1&&Ae.size<=4,"size must be between 1 and 4"),y(Ae.offset>=0,"invalid offset"),y(Ae.stride>=0&&Ae.stride<=255,"stride must be between 0 and 255"),y(Ae.divisor>=0,"divisor must be positive"),y(!Ae.divisor||!!v.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in xe?(y(Ue>0,"first attribute must not be a constant"),Ae.x=+xe.x||0,Ae.y=+xe.y||0,Ae.z=+xe.z||0,Ae.w=+xe.w||0,Ae.state=2):y(!1,"invalid attribute spec for location "+Ue)}for(var Qe=0;Qe<K.buffers.length;++Qe)!we[Qe]&&K.buffers[Qe]&&(K.buffers[Qe].destroy(),K.buffers[Qe]=null);return K.refresh(),Me}return Me.destroy=function(){for(var ye=0;ye<K.buffers.length;++ye)K.buffers[ye]&&K.buffers[ye].destroy();K.buffers.length=0,K.ownsElements&&(K.elements.destroy(),K.elements=null,K.ownsElements=!1),K.destroy()},Me._vao=K,Me._reglType="vao",Me(te)}return ge}var Jf=35632,Vv=35633,Uv=35718,qv=35721;function Xv(f,v,T,X){var J={},q={};function Y(k,H,fe,Te){this.name=k,this.id=H,this.location=fe,this.info=Te}function ie(k,H){for(var fe=0;fe<k.length;++fe)if(k[fe].id===H.id){k[fe].location=H.location;return}k.push(H)}function ae(k,H,fe){var Te=k===Jf?J:q,se=Te[H];if(!se){var Ee=v.str(H);se=f.createShader(k),f.shaderSource(se,Ee),f.compileShader(se),y.shaderError(f,se,Ee,k,fe),Te[H]=se}return se}var de={},me=[],he=0;function ge(k,H){this.id=he++,this.fragId=k,this.vertId=H,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,X.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function ce(k,H,fe){var Te,se,Ee=ae(Jf,k.fragId),_e=ae(Vv,k.vertId),Ge=k.program=f.createProgram();if(f.attachShader(Ge,Ee),f.attachShader(Ge,_e),fe)for(Te=0;Te<fe.length;++Te){var te=fe[Te];f.bindAttribLocation(Ge,te[0],te[1])}f.linkProgram(Ge),y.linkError(f,Ge,v.str(k.fragId),v.str(k.vertId),H);var K=f.getProgramParameter(Ge,Uv);X.profile&&(k.stats.uniformsCount=K);var Me=k.uniforms;for(Te=0;Te<K;++Te)if(se=f.getActiveUniform(Ge,Te),se){if(se.size>1)for(var ye=0;ye<se.size;++ye){var le=se.name.replace("[0]","["+ye+"]");ie(Me,new Y(le,v.id(le),f.getUniformLocation(Ge,le),se))}var be=se.name;se.size>1&&(be=be.replace("[0]","")),ie(Me,new Y(be,v.id(be),f.getUniformLocation(Ge,be),se))}var we=f.getProgramParameter(Ge,qv);X.profile&&(k.stats.attributesCount=we);var je=k.attributes;for(Te=0;Te<we;++Te)se=f.getActiveAttrib(Ge,Te),se&&ie(je,new Y(se.name,v.id(se.name),f.getAttribLocation(Ge,se.name),se))}X.profile&&(T.getMaxUniformsCount=function(){var k=0;return me.forEach(function(H){H.stats.uniformsCount>k&&(k=H.stats.uniformsCount)}),k},T.getMaxAttributesCount=function(){var k=0;return me.forEach(function(H){H.stats.attributesCount>k&&(k=H.stats.attributesCount)}),k});function ue(){J={},q={};for(var k=0;k<me.length;++k)ce(me[k],null,me[k].attributes.map(function(H){return[H.location,H.name]}))}return{clear:function(){var k=f.deleteShader.bind(f);sr(J).forEach(k),J={},sr(q).forEach(k),q={},me.forEach(function(H){f.deleteProgram(H.program)}),me.length=0,de={},T.shaderCount=0},program:function(k,H,fe,Te){y.command(k>=0,"missing vertex shader",fe),y.command(H>=0,"missing fragment shader",fe);var se=de[H];se||(se=de[H]={});var Ee=se[k];if(Ee&&(Ee.refCount++,!Te))return Ee;var _e=new ge(H,k);return T.shaderCount++,ce(_e,fe,Te),Ee||(se[k]=_e),me.push(_e),n(_e,{destroy:function(){if(_e.refCount--,_e.refCount<=0){f.deleteProgram(_e.program);var Ge=me.indexOf(_e);me.splice(Ge,1),T.shaderCount--}se[_e.vertId].refCount<=0&&(f.deleteShader(q[_e.vertId]),delete q[_e.vertId],delete de[_e.fragId][_e.vertId]),Object.keys(de[_e.fragId]).length||(f.deleteShader(J[_e.fragId]),delete J[_e.fragId],delete de[_e.fragId])}})},restore:ue,shader:ae,frag:-1,vert:-1}}var jv=6408,ws=5121,Hv=3333,xo=5126;function Yv(f,v,T,X,J,q,Y){function ie(me){var he;v.next===null?(y(J.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),he=ws):(y(v.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),he=v.next.colorAttachments[0].texture._texture.type,y.optional(function(){q.oes_texture_float?(y(he===ws||he===xo,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),he===xo&&y(Y.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):y(he===ws,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var ge=0,ce=0,ue=X.framebufferWidth,k=X.framebufferHeight,H=null;r(me)?H=me:me&&(y.type(me,"object","invalid arguments to regl.read()"),ge=me.x|0,ce=me.y|0,y(ge>=0&&ge<X.framebufferWidth,"invalid x offset for regl.read"),y(ce>=0&&ce<X.framebufferHeight,"invalid y offset for regl.read"),ue=(me.width||X.framebufferWidth-ge)|0,k=(me.height||X.framebufferHeight-ce)|0,H=me.data||null),H&&(he===ws?y(H instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):he===xo&&y(H instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),y(ue>0&&ue+ge<=X.framebufferWidth,"invalid width for read pixels"),y(k>0&&k+ce<=X.framebufferHeight,"invalid height for read pixels"),T();var fe=ue*k*4;return H||(he===ws?H=new Uint8Array(fe):he===xo&&(H=H||new Float32Array(fe))),y.isTypedArray(H,"data buffer for regl.read() must be a typedarray"),y(H.byteLength>=fe,"data buffer for regl.read() too small"),f.pixelStorei(Hv,4),f.readPixels(ge,ce,ue,k,jv,he,H),H}function ae(me){var he;return v.setFBO({framebuffer:me.framebuffer},function(){he=ie(me)}),he}function de(me){return!me||!("framebuffer"in me)?ie(me):ae(me)}return de}function kn(f){return Array.prototype.slice.call(f)}function Bn(f){return kn(f).join("")}function Zv(){var f=0,v=[],T=[];function X(he){for(var ge=0;ge<T.length;++ge)if(T[ge]===he)return v[ge];var ce="g"+f++;return v.push(ce),T.push(he),ce}function J(){var he=[];function ge(){he.push.apply(he,kn(arguments))}var ce=[];function ue(){var k="v"+f++;return ce.push(k),arguments.length>0&&(he.push(k,"="),he.push.apply(he,kn(arguments)),he.push(";")),k}return n(ge,{def:ue,toString:function(){return Bn([ce.length>0?"var "+ce.join(",")+";":"",Bn(he)])}})}function q(){var he=J(),ge=J(),ce=he.toString,ue=ge.toString;function k(H,fe){ge(H,fe,"=",he.def(H,fe),";")}return n(function(){he.apply(he,kn(arguments))},{def:he.def,entry:he,exit:ge,save:k,set:function(H,fe,Te){k(H,fe),he(H,fe,"=",Te,";")},toString:function(){return ce()+ue()}})}function Y(){var he=Bn(arguments),ge=q(),ce=q(),ue=ge.toString,k=ce.toString;return n(ge,{then:function(){return ge.apply(ge,kn(arguments)),this},else:function(){return ce.apply(ce,kn(arguments)),this},toString:function(){var H=k();return H&&(H="else{"+H+"}"),Bn(["if(",he,"){",ue(),"}",H])}})}var ie=J(),ae={};function de(he,ge){var ce=[];function ue(){var se="a"+ce.length;return ce.push(se),se}ge=ge||0;for(var k=0;k<ge;++k)ue();var H=q(),fe=H.toString,Te=ae[he]=n(H,{arg:ue,toString:function(){return Bn(["function(",ce.join(),"){",fe(),"}"])}});return Te}function me(){var he=['"use strict";',ie,"return {"];Object.keys(ae).forEach(function(ue){he.push('"',ue,'":',ae[ue].toString(),",")}),he.push("}");var ge=Bn(he).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),ce=Function.apply(null,v.concat(ge));return ce.apply(null,T)}return{global:ie,link:X,block:J,proc:de,scope:q,cond:Y,compile:me}}var In="xyzw".split(""),e1=5121,zn=1,vi=2,gi=0,yi=1,bi=2,wi=3,Eo=4,t1=5,r1=6,n1="dither",s1="blend.enable",o1="blend.color",_i="blend.equation",xi="blend.func",a1="depth.enable",i1="depth.func",c1="depth.range",l1="depth.mask",Ei="colorMask",f1="cull.enable",u1="cull.face",$i="frontFace",Ai="lineWidth",d1="polygonOffset.enable",Ti="polygonOffset.offset",h1="sample.alpha",m1="sample.enable",Si="sample.coverage",p1="stencil.enable",v1="stencil.mask",Pi="stencil.func",Ci="stencil.opFront",_s="stencil.opBack",g1="scissor.enable",$o="scissor.box",Mr="viewport",xs="profile",fn="framebuffer",Es="vert",$s="frag",un="elements",dn="primitive",hn="count",Ao="offset",To="instances",As="vao",Mi="Width",Oi="Height",Vn=fn+Mi,Un=fn+Oi,Wv=Mr+Mi,Qv=Mr+Oi,y1="drawingBuffer",b1=y1+Mi,w1=y1+Oi,Kv=[xi,_i,Pi,Ci,_s,Si,Mr,$o,Ti],qn=34962,Ri=34963,Jv=35632,eg=35633,_1=3553,tg=34067,rg=2884,ng=3042,sg=3024,og=2960,ag=2929,ig=3089,cg=32823,lg=32926,fg=32928,Li=5126,So=35664,Po=35665,Co=35666,Fi=5124,Mo=35667,Oo=35668,Ro=35669,Gi=35670,Lo=35671,Fo=35672,Go=35673,Ts=35674,Ss=35675,Ps=35676,Cs=35678,Ms=35680,Ni=4,Os=1028,mn=1029,x1=2304,Di=2305,ug=32775,dg=32776,hg=519,zr=7680,E1=0,$1=1,A1=32774,mg=513,T1=36160,pg=36064,_r={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},S1=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Xn={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Vr={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},P1={frag:Jv,vert:eg},ki={cw:x1,ccw:Di};function No(f){return Array.isArray(f)||r(f)||hr(f)}function C1(f){return f.sort(function(v,T){return v===Mr?-1:T===Mr?1:v<T?-1:1})}function Mt(f,v,T,X){this.thisDep=f,this.contextDep=v,this.propDep=T,this.append=X}function Ur(f){return f&&!(f.thisDep||f.contextDep||f.propDep)}function xt(f){return new Mt(!1,!1,!1,f)}function Wt(f,v){var T=f.type;if(T===gi){var X=f.data.length;return new Mt(!0,X>=1,X>=2,v)}else if(T===Eo){var J=f.data;return new Mt(J.thisDep,J.contextDep,J.propDep,v)}else{if(T===t1)return new Mt(!1,!1,!1,v);if(T===r1){for(var q=!1,Y=!1,ie=!1,ae=0;ae<f.data.length;++ae){var de=f.data[ae];if(de.type===yi)ie=!0;else if(de.type===bi)Y=!0;else if(de.type===wi)q=!0;else if(de.type===gi){q=!0;var me=de.data;me>=1&&(Y=!0),me>=2&&(ie=!0)}else de.type===Eo&&(q=q||de.data.thisDep,Y=Y||de.data.contextDep,ie=ie||de.data.propDep)}return new Mt(q,Y,ie,v)}else return new Mt(T===wi,T===bi,T===yi,v)}}var M1=new Mt(!1,!1,!1,function(){});function vg(f,v,T,X,J,q,Y,ie,ae,de,me,he,ge,ce,ue){var k=de.Record,H={add:32774,subtract:32778,"reverse subtract":32779};T.ext_blend_minmax&&(H.min=ug,H.max=dg);var fe=T.angle_instanced_arrays,Te=T.webgl_draw_buffers,se=T.oes_vertex_array_object,Ee={dirty:!0,profile:ue.profile},_e={},Ge=[],te={},K={};function Me(w){return w.replace(".","_")}function ye(w,m,S){var D=Me(w);Ge.push(w),_e[D]=Ee[D]=!!S,te[D]=m}function le(w,m,S){var D=Me(w);Ge.push(w),Array.isArray(S)?(Ee[D]=S.slice(),_e[D]=S.slice()):Ee[D]=_e[D]=S,K[D]=m}ye(n1,sg),ye(s1,ng),le(o1,"blendColor",[0,0,0,0]),le(_i,"blendEquationSeparate",[A1,A1]),le(xi,"blendFuncSeparate",[$1,E1,$1,E1]),ye(a1,ag,!0),le(i1,"depthFunc",mg),le(c1,"depthRange",[0,1]),le(l1,"depthMask",!0),le(Ei,Ei,[!0,!0,!0,!0]),ye(f1,rg),le(u1,"cullFace",mn),le($i,$i,Di),le(Ai,Ai,1),ye(d1,cg),le(Ti,"polygonOffset",[0,0]),ye(h1,lg),ye(m1,fg),le(Si,"sampleCoverage",[1,!1]),ye(p1,og),le(v1,"stencilMask",-1),le(Pi,"stencilFunc",[hg,0,-1]),le(Ci,"stencilOpSeparate",[Os,zr,zr,zr]),le(_s,"stencilOpSeparate",[mn,zr,zr,zr]),ye(g1,ig),le($o,"scissor",[0,0,f.drawingBufferWidth,f.drawingBufferHeight]),le(Mr,Mr,[0,0,f.drawingBufferWidth,f.drawingBufferHeight]);var be={gl:f,context:ge,strings:v,next:_e,current:Ee,draw:he,elements:q,buffer:J,shader:me,attributes:de.state,vao:de,uniforms:ae,framebuffer:ie,extensions:T,timer:ce,isBufferArgs:No},we={primTypes:Br,compareFuncs:Xn,blendFuncs:_r,blendEquations:H,stencilOps:Vr,glTypes:sn,orientationType:ki};y.optional(function(){be.isArrayLike=ht}),Te&&(we.backBuffer=[mn],we.drawBuffer=nr(X.maxDrawbuffers,function(w){return w===0?[0]:nr(w,function(m){return pg+m})}));var je=0;function Ue(){var w=Zv(),m=w.link,S=w.global;w.id=je++,w.batchId="0";var D=m(be),B=w.shared={props:"a0"};Object.keys(be).forEach(function(A){B[A]=S.def(D,".",A)}),y.optional(function(){w.CHECK=m(y),w.commandStr=y.guessCommand(),w.command=m(w.commandStr),w.assert=function(A,x,z){A("if(!(",x,"))",this.CHECK,".commandRaise(",m(z),",",this.command,");")},we.invalidBlendCombinations=S1});var O=w.next={},C=w.current={};Object.keys(K).forEach(function(A){Array.isArray(Ee[A])&&(O[A]=S.def(B.next,".",A),C[A]=S.def(B.current,".",A))});var N=w.constants={};Object.keys(we).forEach(function(A){N[A]=S.def(JSON.stringify(we[A]))}),w.invoke=function(A,x){switch(x.type){case gi:var z=["this",B.context,B.props,w.batchId];return A.def(m(x.data),".call(",z.slice(0,Math.max(x.data.length+1,4)),")");case yi:return A.def(B.props,x.data);case bi:return A.def(B.context,x.data);case wi:return A.def("this",x.data);case Eo:return x.data.append(w,A),x.data.ref;case t1:return x.data.toString();case r1:return x.data.map(function(I){return w.invoke(A,I)})}},w.attribCache={};var _={};return w.scopeAttrib=function(A){var x=v.id(A);if(x in _)return _[x];var z=de.scope[x];z||(z=de.scope[x]=new k);var I=_[x]=m(z);return I},w}function xe(w){var m=w.static,S=w.dynamic,D;if(xs in m){var B=!!m[xs];D=xt(function(C,N){return B}),D.enable=B}else if(xs in S){var O=S[xs];D=Wt(O,function(C,N){return C.invoke(N,O)})}return D}function Ae(w,m){var S=w.static,D=w.dynamic;if(fn in S){var B=S[fn];return B?(B=ie.getFramebuffer(B),y.command(B,"invalid framebuffer object"),xt(function(C,N){var _=C.link(B),A=C.shared;N.set(A.framebuffer,".next",_);var x=A.context;return N.set(x,"."+Vn,_+".width"),N.set(x,"."+Un,_+".height"),_})):xt(function(C,N){var _=C.shared;N.set(_.framebuffer,".next","null");var A=_.context;return N.set(A,"."+Vn,A+"."+b1),N.set(A,"."+Un,A+"."+w1),"null"})}else if(fn in D){var O=D[fn];return Wt(O,function(C,N){var _=C.invoke(N,O),A=C.shared,x=A.framebuffer,z=N.def(x,".getFramebuffer(",_,")");y.optional(function(){C.assert(N,"!"+_+"||"+z,"invalid framebuffer object")}),N.set(x,".next",z);var I=A.context;return N.set(I,"."+Vn,z+"?"+z+".width:"+I+"."+b1),N.set(I,"."+Un,z+"?"+z+".height:"+I+"."+w1),z})}else return null}function ke(w,m,S){var D=w.static,B=w.dynamic;function O(_){if(_ in D){var A=D[_];y.commandType(A,"object","invalid "+_,S.commandStr);var x=!0,z=A.x|0,I=A.y|0,W,re;return"width"in A?(W=A.width|0,y.command(W>=0,"invalid "+_,S.commandStr)):x=!1,"height"in A?(re=A.height|0,y.command(re>=0,"invalid "+_,S.commandStr)):x=!1,new Mt(!x&&m&&m.thisDep,!x&&m&&m.contextDep,!x&&m&&m.propDep,function(Fe,Pe){var ne=Fe.shared.context,Z=W;"width"in A||(Z=Pe.def(ne,".",Vn,"-",z));var Le=re;return"height"in A||(Le=Pe.def(ne,".",Un,"-",I)),[z,I,Z,Le]})}else if(_ in B){var ve=B[_],Ie=Wt(ve,function(Fe,Pe){var ne=Fe.invoke(Pe,ve);y.optional(function(){Fe.assert(Pe,ne+"&&typeof "+ne+'==="object"',"invalid "+_)});var Z=Fe.shared.context,Le=Pe.def(ne,".x|0"),Oe=Pe.def(ne,".y|0"),Be=Pe.def('"width" in ',ne,"?",ne,".width|0:","(",Z,".",Vn,"-",Le,")"),at=Pe.def('"height" in ',ne,"?",ne,".height|0:","(",Z,".",Un,"-",Oe,")");return y.optional(function(){Fe.assert(Pe,Be+">=0&&"+at+">=0","invalid "+_)}),[Le,Oe,Be,at]});return m&&(Ie.thisDep=Ie.thisDep||m.thisDep,Ie.contextDep=Ie.contextDep||m.contextDep,Ie.propDep=Ie.propDep||m.propDep),Ie}else return m?new Mt(m.thisDep,m.contextDep,m.propDep,function(Fe,Pe){var ne=Fe.shared.context;return[0,0,Pe.def(ne,".",Vn),Pe.def(ne,".",Un)]}):null}var C=O(Mr);if(C){var N=C;C=new Mt(C.thisDep,C.contextDep,C.propDep,function(_,A){var x=N.append(_,A),z=_.shared.context;return A.set(z,"."+Wv,x[2]),A.set(z,"."+Qv,x[3]),x})}return{viewport:C,scissor_box:O($o)}}function He(w,m){var S=w.static,D=typeof S[$s]=="string"&&typeof S[Es]=="string";if(D){if(Object.keys(m.dynamic).length>0)return null;var B=m.static,O=Object.keys(B);if(O.length>0&&typeof B[O[0]]=="number"){for(var C=[],N=0;N<O.length;++N)y(typeof B[O[N]]=="number","must specify all vertex attribute locations when using vaos"),C.push([B[O[N]]|0,O[N]]);return C}}return null}function Qe(w,m,S){var D=w.static,B=w.dynamic;function O(x){if(x in D){var z=v.id(D[x]);y.optional(function(){me.shader(P1[x],z,y.guessCommand())});var I=xt(function(){return z});return I.id=z,I}else if(x in B){var W=B[x];return Wt(W,function(re,ve){var Ie=re.invoke(ve,W),Fe=ve.def(re.shared.strings,".id(",Ie,")");return y.optional(function(){ve(re.shared.shader,".shader(",P1[x],",",Fe,",",re.command,");")}),Fe})}return null}var C=O($s),N=O(Es),_=null,A;return Ur(C)&&Ur(N)?(_=me.program(N.id,C.id,null,S),A=xt(function(x,z){return x.link(_)})):A=new Mt(C&&C.thisDep||N&&N.thisDep,C&&C.contextDep||N&&N.contextDep,C&&C.propDep||N&&N.propDep,function(x,z){var I=x.shared.shader,W;C?W=C.append(x,z):W=z.def(I,".",$s);var re;N?re=N.append(x,z):re=z.def(I,".",Es);var ve=I+".program("+re+","+W;return y.optional(function(){ve+=","+x.command}),z.def(ve+")")}),{frag:C,vert:N,progVar:A,program:_}}function mt(w,m){var S=w.static,D=w.dynamic,B={},O=!1;function C(){if(As in S){var Pe=S[As];return Pe!==null&&de.getVAO(Pe)===null&&(Pe=de.createVAO(Pe)),O=!0,B.vao=Pe,xt(function(Z){var Le=de.getVAO(Pe);return Le?Z.link(Le):"null"})}else if(As in D){O=!0;var ne=D[As];return Wt(ne,function(Z,Le){var Oe=Z.invoke(Le,ne);return Le.def(Z.shared.vao+".getVAO("+Oe+")")})}return null}var N=C(),_=!1;function A(){if(un in S){var Pe=S[un];if(B.elements=Pe,No(Pe)){var ne=B.elements=q.create(Pe,!0);Pe=q.getElements(ne),_=!0}else Pe&&(Pe=q.getElements(Pe),_=!0,y.command(Pe,"invalid elements",m.commandStr));var Z=xt(function(Oe,Be){if(Pe){var at=Oe.link(Pe);return Oe.ELEMENTS=at,at}return Oe.ELEMENTS=null,null});return Z.value=Pe,Z}else if(un in D){_=!0;var Le=D[un];return Wt(Le,function(Oe,Be){var at=Oe.shared,It=at.isBufferArgs,vn=at.elements,Or=Oe.invoke(Be,Le),Er=Be.def("null"),qr=Be.def(It,"(",Or,")"),gn=Oe.cond(qr).then(Er,"=",vn,".createStream(",Or,");").else(Er,"=",vn,".getElements(",Or,");");return y.optional(function(){Oe.assert(gn.else,"!"+Or+"||"+Er,"invalid elements")}),Be.entry(gn),Be.exit(Oe.cond(qr).then(vn,".destroyStream(",Er,");")),Oe.ELEMENTS=Er,Er})}else if(O)return new Mt(N.thisDep,N.contextDep,N.propDep,function(Oe,Be){return Be.def(Oe.shared.vao+".currentVAO?"+Oe.shared.elements+".getElements("+Oe.shared.vao+".currentVAO.elements):null")});return null}var x=A();function z(){if(dn in S){var Pe=S[dn];return B.primitive=Pe,y.commandParameter(Pe,Br,"invalid primitve",m.commandStr),xt(function(Z,Le){return Br[Pe]})}else if(dn in D){var ne=D[dn];return Wt(ne,function(Z,Le){var Oe=Z.constants.primTypes,Be=Z.invoke(Le,ne);return y.optional(function(){Z.assert(Le,Be+" in "+Oe,"invalid primitive, must be one of "+Object.keys(Br))}),Le.def(Oe,"[",Be,"]")})}else{if(_)return Ur(x)?x.value?xt(function(Z,Le){return Le.def(Z.ELEMENTS,".primType")}):xt(function(){return Ni}):new Mt(x.thisDep,x.contextDep,x.propDep,function(Z,Le){var Oe=Z.ELEMENTS;return Le.def(Oe,"?",Oe,".primType:",Ni)});if(O)return new Mt(N.thisDep,N.contextDep,N.propDep,function(Z,Le){return Le.def(Z.shared.vao+".currentVAO?"+Z.shared.vao+".currentVAO.primitive:"+Ni)})}return null}function I(Pe,ne){if(Pe in S){var Z=S[Pe]|0;return ne?B.offset=Z:B.instances=Z,y.command(!ne||Z>=0,"invalid "+Pe,m.commandStr),xt(function(Oe,Be){return ne&&(Oe.OFFSET=Z),Z})}else if(Pe in D){var Le=D[Pe];return Wt(Le,function(Oe,Be){var at=Oe.invoke(Be,Le);return ne&&(Oe.OFFSET=at,y.optional(function(){Oe.assert(Be,at+">=0","invalid "+Pe)})),at})}else if(ne){if(_)return xt(function(Oe,Be){return Oe.OFFSET=0,0});if(O)return new Mt(N.thisDep,N.contextDep,N.propDep,function(Oe,Be){return Be.def(Oe.shared.vao+".currentVAO?"+Oe.shared.vao+".currentVAO.offset:0")})}else if(O)return new Mt(N.thisDep,N.contextDep,N.propDep,function(Oe,Be){return Be.def(Oe.shared.vao+".currentVAO?"+Oe.shared.vao+".currentVAO.instances:-1")});return null}var W=I(Ao,!0);function re(){if(hn in S){var Pe=S[hn]|0;return B.count=Pe,y.command(typeof Pe=="number"&&Pe>=0,"invalid vertex count",m.commandStr),xt(function(){return Pe})}else if(hn in D){var ne=D[hn];return Wt(ne,function(Be,at){var It=Be.invoke(at,ne);return y.optional(function(){Be.assert(at,"typeof "+It+'==="number"&&'+It+">=0&&"+It+"===("+It+"|0)","invalid vertex count")}),It})}else if(_)if(Ur(x)){if(x)return W?new Mt(W.thisDep,W.contextDep,W.propDep,function(Be,at){var It=at.def(Be.ELEMENTS,".vertCount-",Be.OFFSET);return y.optional(function(){Be.assert(at,It+">=0","invalid vertex offset/element buffer too small")}),It}):xt(function(Be,at){return at.def(Be.ELEMENTS,".vertCount")});var Z=xt(function(){return-1});return y.optional(function(){Z.MISSING=!0}),Z}else{var Le=new Mt(x.thisDep||W.thisDep,x.contextDep||W.contextDep,x.propDep||W.propDep,function(Be,at){var It=Be.ELEMENTS;return Be.OFFSET?at.def(It,"?",It,".vertCount-",Be.OFFSET,":-1"):at.def(It,"?",It,".vertCount:-1")});return y.optional(function(){Le.DYNAMIC=!0}),Le}else if(O){var Oe=new Mt(N.thisDep,N.contextDep,N.propDep,function(Be,at){return at.def(Be.shared.vao,".currentVAO?",Be.shared.vao,".currentVAO.count:-1")});return Oe}return null}var ve=z(),Ie=re(),Fe=I(To,!1);return{elements:x,primitive:ve,count:Ie,instances:Fe,offset:W,vao:N,vaoActive:O,elementsActive:_,static:B}}function pt(w,m){var S=w.static,D=w.dynamic,B={};return Ge.forEach(function(O){var C=Me(O);function N(_,A){if(O in S){var x=_(S[O]);B[C]=xt(function(){return x})}else if(O in D){var z=D[O];B[C]=Wt(z,function(I,W){return A(I,W,I.invoke(W,z))})}}switch(O){case f1:case s1:case n1:case p1:case a1:case g1:case d1:case h1:case m1:case l1:return N(function(_){return y.commandType(_,"boolean",O,m.commandStr),_},function(_,A,x){return y.optional(function(){_.assert(A,"typeof "+x+'==="boolean"',"invalid flag "+O,_.commandStr)}),x});case i1:return N(function(_){return y.commandParameter(_,Xn,"invalid "+O,m.commandStr),Xn[_]},function(_,A,x){var z=_.constants.compareFuncs;return y.optional(function(){_.assert(A,x+" in "+z,"invalid "+O+", must be one of "+Object.keys(Xn))}),A.def(z,"[",x,"]")});case c1:return N(function(_){return y.command(ht(_)&&_.length===2&&typeof _[0]=="number"&&typeof _[1]=="number"&&_[0]<=_[1],"depth range is 2d array",m.commandStr),_},function(_,A,x){y.optional(function(){_.assert(A,_.shared.isArrayLike+"("+x+")&&"+x+".length===2&&typeof "+x+'[0]==="number"&&typeof '+x+'[1]==="number"&&'+x+"[0]<="+x+"[1]","depth range must be a 2d array")});var z=A.def("+",x,"[0]"),I=A.def("+",x,"[1]");return[z,I]});case xi:return N(function(_){y.commandType(_,"object","blend.func",m.commandStr);var A="srcRGB"in _?_.srcRGB:_.src,x="srcAlpha"in _?_.srcAlpha:_.src,z="dstRGB"in _?_.dstRGB:_.dst,I="dstAlpha"in _?_.dstAlpha:_.dst;return y.commandParameter(A,_r,C+".srcRGB",m.commandStr),y.commandParameter(x,_r,C+".srcAlpha",m.commandStr),y.commandParameter(z,_r,C+".dstRGB",m.commandStr),y.commandParameter(I,_r,C+".dstAlpha",m.commandStr),y.command(S1.indexOf(A+", "+z)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+A+", "+z+")",m.commandStr),[_r[A],_r[z],_r[x],_r[I]]},function(_,A,x){var z=_.constants.blendFuncs;y.optional(function(){_.assert(A,x+"&&typeof "+x+'==="object"',"invalid blend func, must be an object")});function I(ne,Z){var Le=A.def('"',ne,Z,'" in ',x,"?",x,".",ne,Z,":",x,".",ne);return y.optional(function(){_.assert(A,Le+" in "+z,"invalid "+O+"."+ne+Z+", must be one of "+Object.keys(_r))}),Le}var W=I("src","RGB"),re=I("dst","RGB");y.optional(function(){var ne=_.constants.invalidBlendCombinations;_.assert(A,ne+".indexOf("+W+'+", "+'+re+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var ve=A.def(z,"[",W,"]"),Ie=A.def(z,"[",I("src","Alpha"),"]"),Fe=A.def(z,"[",re,"]"),Pe=A.def(z,"[",I("dst","Alpha"),"]");return[ve,Fe,Ie,Pe]});case _i:return N(function(_){if(typeof _=="string")return y.commandParameter(_,H,"invalid "+O,m.commandStr),[H[_],H[_]];if(typeof _=="object")return y.commandParameter(_.rgb,H,O+".rgb",m.commandStr),y.commandParameter(_.alpha,H,O+".alpha",m.commandStr),[H[_.rgb],H[_.alpha]];y.commandRaise("invalid blend.equation",m.commandStr)},function(_,A,x){var z=_.constants.blendEquations,I=A.def(),W=A.def(),re=_.cond("typeof ",x,'==="string"');return y.optional(function(){function ve(Ie,Fe,Pe){_.assert(Ie,Pe+" in "+z,"invalid "+Fe+", must be one of "+Object.keys(H))}ve(re.then,O,x),_.assert(re.else,x+"&&typeof "+x+'==="object"',"invalid "+O),ve(re.else,O+".rgb",x+".rgb"),ve(re.else,O+".alpha",x+".alpha")}),re.then(I,"=",W,"=",z,"[",x,"];"),re.else(I,"=",z,"[",x,".rgb];",W,"=",z,"[",x,".alpha];"),A(re),[I,W]});case o1:return N(function(_){return y.command(ht(_)&&_.length===4,"blend.color must be a 4d array",m.commandStr),nr(4,function(A){return+_[A]})},function(_,A,x){return y.optional(function(){_.assert(A,_.shared.isArrayLike+"("+x+")&&"+x+".length===4","blend.color must be a 4d array")}),nr(4,function(z){return A.def("+",x,"[",z,"]")})});case v1:return N(function(_){return y.commandType(_,"number",C,m.commandStr),_|0},function(_,A,x){return y.optional(function(){_.assert(A,"typeof "+x+'==="number"',"invalid stencil.mask")}),A.def(x,"|0")});case Pi:return N(function(_){y.commandType(_,"object",C,m.commandStr);var A=_.cmp||"keep",x=_.ref||0,z="mask"in _?_.mask:-1;return y.commandParameter(A,Xn,O+".cmp",m.commandStr),y.commandType(x,"number",O+".ref",m.commandStr),y.commandType(z,"number",O+".mask",m.commandStr),[Xn[A],x,z]},function(_,A,x){var z=_.constants.compareFuncs;y.optional(function(){function ve(){_.assert(A,Array.prototype.join.call(arguments,""),"invalid stencil.func")}ve(x+"&&typeof ",x,'==="object"'),ve('!("cmp" in ',x,")||(",x,".cmp in ",z,")")});var I=A.def('"cmp" in ',x,"?",z,"[",x,".cmp]",":",zr),W=A.def(x,".ref|0"),re=A.def('"mask" in ',x,"?",x,".mask|0:-1");return[I,W,re]});case Ci:case _s:return N(function(_){y.commandType(_,"object",C,m.commandStr);var A=_.fail||"keep",x=_.zfail||"keep",z=_.zpass||"keep";return y.commandParameter(A,Vr,O+".fail",m.commandStr),y.commandParameter(x,Vr,O+".zfail",m.commandStr),y.commandParameter(z,Vr,O+".zpass",m.commandStr),[O===_s?mn:Os,Vr[A],Vr[x],Vr[z]]},function(_,A,x){var z=_.constants.stencilOps;y.optional(function(){_.assert(A,x+"&&typeof "+x+'==="object"',"invalid "+O)});function I(W){return y.optional(function(){_.assert(A,'!("'+W+'" in '+x+")||("+x+"."+W+" in "+z+")","invalid "+O+"."+W+", must be one of "+Object.keys(Vr))}),A.def('"',W,'" in ',x,"?",z,"[",x,".",W,"]:",zr)}return[O===_s?mn:Os,I("fail"),I("zfail"),I("zpass")]});case Ti:return N(function(_){y.commandType(_,"object",C,m.commandStr);var A=_.factor|0,x=_.units|0;return y.commandType(A,"number",C+".factor",m.commandStr),y.commandType(x,"number",C+".units",m.commandStr),[A,x]},function(_,A,x){y.optional(function(){_.assert(A,x+"&&typeof "+x+'==="object"',"invalid "+O)});var z=A.def(x,".factor|0"),I=A.def(x,".units|0");return[z,I]});case u1:return N(function(_){var A=0;return _==="front"?A=Os:_==="back"&&(A=mn),y.command(!!A,C,m.commandStr),A},function(_,A,x){return y.optional(function(){_.assert(A,x+'==="front"||'+x+'==="back"',"invalid cull.face")}),A.def(x,'==="front"?',Os,":",mn)});case Ai:return N(function(_){return y.command(typeof _=="number"&&_>=X.lineWidthDims[0]&&_<=X.lineWidthDims[1],"invalid line width, must be a positive number between "+X.lineWidthDims[0]+" and "+X.lineWidthDims[1],m.commandStr),_},function(_,A,x){return y.optional(function(){_.assert(A,"typeof "+x+'==="number"&&'+x+">="+X.lineWidthDims[0]+"&&"+x+"<="+X.lineWidthDims[1],"invalid line width")}),x});case $i:return N(function(_){return y.commandParameter(_,ki,C,m.commandStr),ki[_]},function(_,A,x){return y.optional(function(){_.assert(A,x+'==="cw"||'+x+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),A.def(x+'==="cw"?'+x1+":"+Di)});case Ei:return N(function(_){return y.command(ht(_)&&_.length===4,"color.mask must be length 4 array",m.commandStr),_.map(function(A){return!!A})},function(_,A,x){return y.optional(function(){_.assert(A,_.shared.isArrayLike+"("+x+")&&"+x+".length===4","invalid color.mask")}),nr(4,function(z){return"!!"+x+"["+z+"]"})});case Si:return N(function(_){y.command(typeof _=="object"&&_,C,m.commandStr);var A="value"in _?_.value:1,x=!!_.invert;return y.command(typeof A=="number"&&A>=0&&A<=1,"sample.coverage.value must be a number between 0 and 1",m.commandStr),[A,x]},function(_,A,x){y.optional(function(){_.assert(A,x+"&&typeof "+x+'==="object"',"invalid sample.coverage")});var z=A.def('"value" in ',x,"?+",x,".value:1"),I=A.def("!!",x,".invert");return[z,I]})}}),B}function tt(w,m){var S=w.static,D=w.dynamic,B={};return Object.keys(S).forEach(function(O){var C=S[O],N;if(typeof C=="number"||typeof C=="boolean")N=xt(function(){return C});else if(typeof C=="function"){var _=C._reglType;_==="texture2d"||_==="textureCube"?N=xt(function(A){return A.link(C)}):_==="framebuffer"||_==="framebufferCube"?(y.command(C.color.length>0,'missing color attachment for framebuffer sent to uniform "'+O+'"',m.commandStr),N=xt(function(A){return A.link(C.color[0])})):y.commandRaise('invalid data for uniform "'+O+'"',m.commandStr)}else ht(C)?N=xt(function(A){var x=A.global.def("[",nr(C.length,function(z){return y.command(typeof C[z]=="number"||typeof C[z]=="boolean","invalid uniform "+O,A.commandStr),C[z]}),"]");return x}):y.commandRaise('invalid or missing data for uniform "'+O+'"',m.commandStr);N.value=C,B[O]=N}),Object.keys(D).forEach(function(O){var C=D[O];B[O]=Wt(C,function(N,_){return N.invoke(_,C)})}),B}function At(w,m){var S=w.static,D=w.dynamic,B={};return Object.keys(S).forEach(function(O){var C=S[O],N=v.id(O),_=new k;if(No(C))_.state=zn,_.buffer=J.getBuffer(J.create(C,qn,!1,!0)),_.type=0;else{var A=J.getBuffer(C);if(A)_.state=zn,_.buffer=A,_.type=0;else if(y.command(typeof C=="object"&&C,"invalid data for attribute "+O,m.commandStr),"constant"in C){var x=C.constant;_.buffer="null",_.state=vi,typeof x=="number"?_.x=x:(y.command(ht(x)&&x.length>0&&x.length<=4,"invalid constant for attribute "+O,m.commandStr),In.forEach(function(Fe,Pe){Pe<x.length&&(_[Fe]=x[Pe])}))}else{No(C.buffer)?A=J.getBuffer(J.create(C.buffer,qn,!1,!0)):A=J.getBuffer(C.buffer),y.command(!!A,'missing buffer for attribute "'+O+'"',m.commandStr);var z=C.offset|0;y.command(z>=0,'invalid offset for attribute "'+O+'"',m.commandStr);var I=C.stride|0;y.command(I>=0&&I<256,'invalid stride for attribute "'+O+'", must be integer betweeen [0, 255]',m.commandStr);var W=C.size|0;y.command(!("size"in C)||W>0&&W<=4,'invalid size for attribute "'+O+'", must be 1,2,3,4',m.commandStr);var re=!!C.normalized,ve=0;"type"in C&&(y.commandParameter(C.type,sn,"invalid type for attribute "+O,m.commandStr),ve=sn[C.type]);var Ie=C.divisor|0;y.optional(function(){"divisor"in C&&(y.command(Ie===0||fe,'cannot specify divisor for attribute "'+O+'", instancing not supported',m.commandStr),y.command(Ie>=0,'invalid divisor for attribute "'+O+'"',m.commandStr));var Fe=m.commandStr,Pe=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(C).forEach(function(ne){y.command(Pe.indexOf(ne)>=0,'unknown parameter "'+ne+'" for attribute pointer "'+O+'" (valid parameters are '+Pe+")",Fe)})}),_.buffer=A,_.state=zn,_.size=W,_.normalized=re,_.type=ve||A.dtype,_.offset=z,_.stride=I,_.divisor=Ie}}B[O]=xt(function(Fe,Pe){var ne=Fe.attribCache;if(N in ne)return ne[N];var Z={isStream:!1};return Object.keys(_).forEach(function(Le){Z[Le]=_[Le]}),_.buffer&&(Z.buffer=Fe.link(_.buffer),Z.type=Z.type||Z.buffer+".dtype"),ne[N]=Z,Z})}),Object.keys(D).forEach(function(O){var C=D[O];function N(_,A){var x=_.invoke(A,C),z=_.shared,I=_.constants,W=z.isBufferArgs,re=z.buffer;y.optional(function(){_.assert(A,x+"&&(typeof "+x+'==="object"||typeof '+x+'==="function")&&('+W+"("+x+")||"+re+".getBuffer("+x+")||"+re+".getBuffer("+x+".buffer)||"+W+"("+x+'.buffer)||("constant" in '+x+"&&(typeof "+x+'.constant==="number"||'+z.isArrayLike+"("+x+".constant))))",'invalid dynamic attribute "'+O+'"')});var ve={isStream:A.def(!1)},Ie=new k;Ie.state=zn,Object.keys(Ie).forEach(function(Z){ve[Z]=A.def(""+Ie[Z])});var Fe=ve.buffer,Pe=ve.type;A("if(",W,"(",x,")){",ve.isStream,"=true;",Fe,"=",re,".createStream(",qn,",",x,");",Pe,"=",Fe,".dtype;","}else{",Fe,"=",re,".getBuffer(",x,");","if(",Fe,"){",Pe,"=",Fe,".dtype;",'}else if("constant" in ',x,"){",ve.state,"=",vi,";","if(typeof "+x+'.constant === "number"){',ve[In[0]],"=",x,".constant;",In.slice(1).map(function(Z){return ve[Z]}).join("="),"=0;","}else{",In.map(function(Z,Le){return ve[Z]+"="+x+".constant.length>"+Le+"?"+x+".constant["+Le+"]:0;"}).join(""),"}}else{","if(",W,"(",x,".buffer)){",Fe,"=",re,".createStream(",qn,",",x,".buffer);","}else{",Fe,"=",re,".getBuffer(",x,".buffer);","}",Pe,'="type" in ',x,"?",I.glTypes,"[",x,".type]:",Fe,".dtype;",ve.normalized,"=!!",x,".normalized;");function ne(Z){A(ve[Z],"=",x,".",Z,"|0;")}return ne("size"),ne("offset"),ne("stride"),ne("divisor"),A("}}"),A.exit("if(",ve.isStream,"){",re,".destroyStream(",Fe,");","}"),ve}B[O]=Wt(C,N)}),B}function ft(w){var m=w.static,S=w.dynamic,D={};return Object.keys(m).forEach(function(B){var O=m[B];D[B]=xt(function(C,N){return typeof O=="number"||typeof O=="boolean"?""+O:C.link(O)})}),Object.keys(S).forEach(function(B){var O=S[B];D[B]=Wt(O,function(C,N){return C.invoke(N,O)})}),D}function Et(w,m,S,D,B){var O=w.static,C=w.dynamic;y.optional(function(){var ne=[fn,Es,$s,un,dn,Ao,hn,To,xs,As].concat(Ge);function Z(Le){Object.keys(Le).forEach(function(Oe){y.command(ne.indexOf(Oe)>=0,'unknown parameter "'+Oe+'"',B.commandStr)})}Z(O),Z(C)});var N=He(w,m),_=Ae(w),A=ke(w,_,B),x=mt(w,B),z=pt(w,B),I=Qe(w,B,N);function W(ne){var Z=A[ne];Z&&(z[ne]=Z)}W(Mr),W(Me($o));var re=Object.keys(z).length>0,ve={framebuffer:_,draw:x,shader:I,state:z,dirty:re,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(ve.profile=xe(w),ve.uniforms=tt(S,B),ve.drawVAO=ve.scopeVAO=x.vao,!ve.drawVAO&&I.program&&!N&&T.angle_instanced_arrays&&x.static.elements){var Ie=!0,Fe=I.program.attributes.map(function(ne){var Z=m.static[ne];return Ie=Ie&&!!Z,Z});if(Ie&&Fe.length>0){var Pe=de.getVAO(de.createVAO({attributes:Fe,elements:x.static.elements}));ve.drawVAO=new Mt(null,null,null,function(ne,Z){return ne.link(Pe)}),ve.useVAO=!0}}return N?ve.useVAO=!0:ve.attributes=At(m,B),ve.context=ft(D),ve}function Tt(w,m,S){var D=w.shared,B=D.context,O=w.scope();Object.keys(S).forEach(function(C){m.save(B,"."+C);var N=S[C],_=N.append(w,m);Array.isArray(_)?O(B,".",C,"=[",_.join(),"];"):O(B,".",C,"=",_,";")}),m(O)}function St(w,m,S,D){var B=w.shared,O=B.gl,C=B.framebuffer,N;Te&&(N=m.def(B.extensions,".webgl_draw_buffers"));var _=w.constants,A=_.drawBuffer,x=_.backBuffer,z;S?z=S.append(w,m):z=m.def(C,".next"),D||m("if(",z,"!==",C,".cur){"),m("if(",z,"){",O,".bindFramebuffer(",T1,",",z,".framebuffer);"),Te&&m(N,".drawBuffersWEBGL(",A,"[",z,".colorAttachments.length]);"),m("}else{",O,".bindFramebuffer(",T1,",null);"),Te&&m(N,".drawBuffersWEBGL(",x,");"),m("}",C,".cur=",z,";"),D||m("}")}function Ft(w,m,S){var D=w.shared,B=D.gl,O=w.current,C=w.next,N=D.current,_=D.next,A=w.cond(N,".dirty");Ge.forEach(function(x){var z=Me(x);if(!(z in S.state)){var I,W;if(z in C){I=C[z],W=O[z];var re=nr(Ee[z].length,function(Ie){return A.def(I,"[",Ie,"]")});A(w.cond(re.map(function(Ie,Fe){return Ie+"!=="+W+"["+Fe+"]"}).join("||")).then(B,".",K[z],"(",re,");",re.map(function(Ie,Fe){return W+"["+Fe+"]="+Ie}).join(";"),";"))}else{I=A.def(_,".",z);var ve=w.cond(I,"!==",N,".",z);A(ve),z in te?ve(w.cond(I).then(B,".enable(",te[z],");").else(B,".disable(",te[z],");"),N,".",z,"=",I,";"):ve(B,".",K[z],"(",I,");",N,".",z,"=",I,";")}}}),Object.keys(S.state).length===0&&A(N,".dirty=false;"),m(A)}function kt(w,m,S,D){var B=w.shared,O=w.current,C=B.current,N=B.gl;C1(Object.keys(S)).forEach(function(_){var A=S[_];if(!(D&&!D(A))){var x=A.append(w,m);if(te[_]){var z=te[_];Ur(A)?x?m(N,".enable(",z,");"):m(N,".disable(",z,");"):m(w.cond(x).then(N,".enable(",z,");").else(N,".disable(",z,");")),m(C,".",_,"=",x,";")}else if(ht(x)){var I=O[_];m(N,".",K[_],"(",x,");",x.map(function(W,re){return I+"["+re+"]="+W}).join(";"),";")}else m(N,".",K[_],"(",x,");",C,".",_,"=",x,";")}})}function gt(w,m){fe&&(w.instancing=m.def(w.shared.extensions,".angle_instanced_arrays"))}function Ye(w,m,S,D,B){var O=w.shared,C=w.stats,N=O.current,_=O.timer,A=S.profile;function x(){return typeof performance>"u"?"Date.now()":"performance.now()"}var z,I;function W(ne){z=m.def(),ne(z,"=",x(),";"),typeof B=="string"?ne(C,".count+=",B,";"):ne(C,".count++;"),ce&&(D?(I=m.def(),ne(I,"=",_,".getNumPendingQueries();")):ne(_,".beginQuery(",C,");"))}function re(ne){ne(C,".cpuTime+=",x(),"-",z,";"),ce&&(D?ne(_,".pushScopeStats(",I,",",_,".getNumPendingQueries(),",C,");"):ne(_,".endQuery();"))}function ve(ne){var Z=m.def(N,".profile");m(N,".profile=",ne,";"),m.exit(N,".profile=",Z,";")}var Ie;if(A){if(Ur(A)){A.enable?(W(m),re(m.exit),ve("true")):ve("false");return}Ie=A.append(w,m),ve(Ie)}else Ie=m.def(N,".profile");var Fe=w.block();W(Fe),m("if(",Ie,"){",Fe,"}");var Pe=w.block();re(Pe),m.exit("if(",Ie,"){",Pe,"}")}function Bt(w,m,S,D,B){var O=w.shared;function C(_){switch(_){case So:case Mo:case Lo:return 2;case Po:case Oo:case Fo:return 3;case Co:case Ro:case Go:return 4;default:return 1}}function N(_,A,x){var z=O.gl,I=m.def(_,".location"),W=m.def(O.attributes,"[",I,"]"),re=x.state,ve=x.buffer,Ie=[x.x,x.y,x.z,x.w],Fe=["buffer","normalized","offset","stride"];function Pe(){m("if(!",W,".buffer){",z,".enableVertexAttribArray(",I,");}");var Z=x.type,Le;if(x.size?Le=m.def(x.size,"||",A):Le=A,m("if(",W,".type!==",Z,"||",W,".size!==",Le,"||",Fe.map(function(Be){return W+"."+Be+"!=="+x[Be]}).join("||"),"){",z,".bindBuffer(",qn,",",ve,".buffer);",z,".vertexAttribPointer(",[I,Le,Z,x.normalized,x.stride,x.offset],");",W,".type=",Z,";",W,".size=",Le,";",Fe.map(function(Be){return W+"."+Be+"="+x[Be]+";"}).join(""),"}"),fe){var Oe=x.divisor;m("if(",W,".divisor!==",Oe,"){",w.instancing,".vertexAttribDivisorANGLE(",[I,Oe],");",W,".divisor=",Oe,";}")}}function ne(){m("if(",W,".buffer){",z,".disableVertexAttribArray(",I,");",W,".buffer=null;","}if(",In.map(function(Z,Le){return W+"."+Z+"!=="+Ie[Le]}).join("||"),"){",z,".vertexAttrib4f(",I,",",Ie,");",In.map(function(Z,Le){return W+"."+Z+"="+Ie[Le]+";"}).join(""),"}")}re===zn?Pe():re===vi?ne():(m("if(",re,"===",zn,"){"),Pe(),m("}else{"),ne(),m("}"))}D.forEach(function(_){var A=_.name,x=S.attributes[A],z;if(x){if(!B(x))return;z=x.append(w,m)}else{if(!B(M1))return;var I=w.scopeAttrib(A);y.optional(function(){w.assert(m,I+".state","missing attribute "+A)}),z={},Object.keys(new k).forEach(function(W){z[W]=m.def(I,".",W)})}N(w.link(_),C(_.info.type),z)})}function ot(w,m,S,D,B,O){for(var C=w.shared,N=C.gl,_={},A,x=0;x<D.length;++x){var z=D[x],I=z.name,W=z.info.type,re=z.info.size,ve=S.uniforms[I];if(re>1){if(!ve)continue;var Ie=I.replace("[0]","");if(_[Ie])continue;_[Ie]=1}var Fe=w.link(z),Pe=Fe+".location",ne;if(ve){if(!B(ve))continue;if(Ur(ve)){var Z=ve.value;if(y.command(Z!==null&&typeof Z<"u",'missing uniform "'+I+'"',w.commandStr),W===Cs||W===Ms){y.command(typeof Z=="function"&&(W===Cs&&(Z._reglType==="texture2d"||Z._reglType==="framebuffer")||W===Ms&&(Z._reglType==="textureCube"||Z._reglType==="framebufferCube")),"invalid texture for uniform "+I,w.commandStr);var Le=w.link(Z._texture||Z.color[0]._texture);m(N,".uniform1i(",Pe,",",Le+".bind());"),m.exit(Le,".unbind();")}else if(W===Ts||W===Ss||W===Ps){y.optional(function(){y.command(ht(Z),"invalid matrix for uniform "+I,w.commandStr),y.command(W===Ts&&Z.length===4||W===Ss&&Z.length===9||W===Ps&&Z.length===16,"invalid length for matrix uniform "+I,w.commandStr)});var Oe=w.global.def("new Float32Array(["+Array.prototype.slice.call(Z)+"])"),Be=2;W===Ss?Be=3:W===Ps&&(Be=4),m(N,".uniformMatrix",Be,"fv(",Pe,",false,",Oe,");")}else{switch(W){case Li:re===1?y.commandType(Z,"number","uniform "+I,w.commandStr):y.command(ht(Z)&&Z.length===re,"uniform "+I,w.commandStr),A="1f";break;case So:y.command(ht(Z)&&Z.length&&Z.length%2===0&&Z.length<=re*2,"uniform "+I,w.commandStr),A="2f";break;case Po:y.command(ht(Z)&&Z.length&&Z.length%3===0&&Z.length<=re*3,"uniform "+I,w.commandStr),A="3f";break;case Co:y.command(ht(Z)&&Z.length&&Z.length%4===0&&Z.length<=re*4,"uniform "+I,w.commandStr),A="4f";break;case Gi:re===1?y.commandType(Z,"boolean","uniform "+I,w.commandStr):y.command(ht(Z)&&Z.length===re,"uniform "+I,w.commandStr),A="1i";break;case Fi:re===1?y.commandType(Z,"number","uniform "+I,w.commandStr):y.command(ht(Z)&&Z.length===re,"uniform "+I,w.commandStr),A="1i";break;case Lo:y.command(ht(Z)&&Z.length&&Z.length%2===0&&Z.length<=re*2,"uniform "+I,w.commandStr),A="2i";break;case Mo:y.command(ht(Z)&&Z.length&&Z.length%2===0&&Z.length<=re*2,"uniform "+I,w.commandStr),A="2i";break;case Fo:y.command(ht(Z)&&Z.length&&Z.length%3===0&&Z.length<=re*3,"uniform "+I,w.commandStr),A="3i";break;case Oo:y.command(ht(Z)&&Z.length&&Z.length%3===0&&Z.length<=re*3,"uniform "+I,w.commandStr),A="3i";break;case Go:y.command(ht(Z)&&Z.length&&Z.length%4===0&&Z.length<=re*4,"uniform "+I,w.commandStr),A="4i";break;case Ro:y.command(ht(Z)&&Z.length&&Z.length%4===0&&Z.length<=re*4,"uniform "+I,w.commandStr),A="4i";break}re>1?(A+="v",Z=w.global.def("["+Array.prototype.slice.call(Z)+"]")):Z=ht(Z)?Array.prototype.slice.call(Z):Z,m(N,".uniform",A,"(",Pe,",",Z,");")}continue}else ne=ve.append(w,m)}else{if(!B(M1))continue;ne=m.def(C.uniforms,"[",v.id(I),"]")}W===Cs?(y(!Array.isArray(ne),"must specify a scalar prop for textures"),m("if(",ne,"&&",ne,'._reglType==="framebuffer"){',ne,"=",ne,".color[0];","}")):W===Ms&&(y(!Array.isArray(ne),"must specify a scalar prop for cube maps"),m("if(",ne,"&&",ne,'._reglType==="framebufferCube"){',ne,"=",ne,".color[0];","}")),y.optional(function(){function or(Qt,Do){w.assert(m,Qt,'bad data or missing for uniform "'+I+'".  '+Do)}function yn(Qt,Do){Do===1&&y(!Array.isArray(ne),"must not specify an array type for uniform"),or("Array.isArray("+ne+") && typeof "+ne+'[0]===" '+Qt+'" || typeof '+ne+'==="'+Qt+'"',"invalid type, expected "+Qt)}function fr(Qt,Do,ko){Array.isArray(ne)?y(ne.length&&ne.length%Qt===0&&ne.length<=Qt*ko,"must have length of "+(ko===1?"":"n * ")+Qt):or(C.isArrayLike+"("+ne+")&&"+ne+".length && "+ne+".length % "+Qt+" === 0 && "+ne+".length<="+Qt*ko,"invalid vector, should have length of "+(ko===1?"":"n * ")+Qt,w.commandStr)}function D1(Qt){y(!Array.isArray(ne),"must not specify a value type"),or("typeof "+ne+'==="function"&&'+ne+'._reglType==="texture'+(Qt===_1?"2d":"Cube")+'"',"invalid texture type",w.commandStr)}switch(W){case Fi:yn("number",re);break;case Mo:fr(2,"number",re);break;case Oo:fr(3,"number",re);break;case Ro:fr(4,"number",re);break;case Li:yn("number",re);break;case So:fr(2,"number",re);break;case Po:fr(3,"number",re);break;case Co:fr(4,"number",re);break;case Gi:yn("boolean",re);break;case Lo:fr(2,"boolean",re);break;case Fo:fr(3,"boolean",re);break;case Go:fr(4,"boolean",re);break;case Ts:fr(4,"number",re);break;case Ss:fr(9,"number",re);break;case Ps:fr(16,"number",re);break;case Cs:D1(_1);break;case Ms:D1(tg);break}});var at=1;switch(W){case Cs:case Ms:var It=m.def(ne,"._texture");m(N,".uniform1i(",Pe,",",It,".bind());"),m.exit(It,".unbind();");continue;case Fi:case Gi:A="1i";break;case Mo:case Lo:A="2i",at=2;break;case Oo:case Fo:A="3i",at=3;break;case Ro:case Go:A="4i",at=4;break;case Li:A="1f";break;case So:A="2f",at=2;break;case Po:A="3f",at=3;break;case Co:A="4f",at=4;break;case Ts:A="Matrix2fv";break;case Ss:A="Matrix3fv";break;case Ps:A="Matrix4fv";break}if(A.indexOf("Matrix")===-1&&re>1&&(A+="v",at=1),A.charAt(0)==="M"){m(N,".uniform",A,"(",Pe,",");var vn=Math.pow(W-Ts+2,2),Or=w.global.def("new Float32Array(",vn,")");Array.isArray(ne)?m("false,(",nr(vn,function(or){return Or+"["+or+"]="+ne[or]}),",",Or,")"):m("false,(Array.isArray(",ne,")||",ne," instanceof Float32Array)?",ne,":(",nr(vn,function(or){return Or+"["+or+"]="+ne+"["+or+"]"}),",",Or,")"),m(");")}else if(at>1){for(var Er=[],qr=[],gn=0;gn<at;++gn)Array.isArray(ne)?qr.push(ne[gn]):qr.push(m.def(ne+"["+gn+"]")),O&&Er.push(m.def());O&&m("if(!",w.batchId,"||",Er.map(function(or,yn){return or+"!=="+qr[yn]}).join("||"),"){",Er.map(function(or,yn){return or+"="+qr[yn]+";"}).join("")),m(N,".uniform",A,"(",Pe,",",qr.join(","),");"),O&&m("}")}else{if(y(!Array.isArray(ne),"uniform value must not be an array"),O){var N1=m.def();m("if(!",w.batchId,"||",N1,"!==",ne,"){",N1,"=",ne,";")}m(N,".uniform",A,"(",Pe,",",ne,");"),O&&m("}")}}}function De(w,m,S,D){var B=w.shared,O=B.gl,C=B.draw,N=D.draw;function _(){var Le=N.elements,Oe,Be=m;return Le?((Le.contextDep&&D.contextDynamic||Le.propDep)&&(Be=S),Oe=Le.append(w,Be),N.elementsActive&&Be("if("+Oe+")"+O+".bindBuffer("+Ri+","+Oe+".buffer.buffer);")):(Oe=Be.def(),Be(Oe,"=",C,".",un,";","if(",Oe,"){",O,".bindBuffer(",Ri,",",Oe,".buffer.buffer);}","else if(",B.vao,".currentVAO){",Oe,"=",w.shared.elements+".getElements("+B.vao,".currentVAO.elements);",se?"":"if("+Oe+")"+O+".bindBuffer("+Ri+","+Oe+".buffer.buffer);","}")),Oe}function A(){var Le=N.count,Oe,Be=m;return Le?((Le.contextDep&&D.contextDynamic||Le.propDep)&&(Be=S),Oe=Le.append(w,Be),y.optional(function(){Le.MISSING&&w.assert(m,"false","missing vertex count"),Le.DYNAMIC&&w.assert(Be,Oe+">=0","missing vertex count")})):(Oe=Be.def(C,".",hn),y.optional(function(){w.assert(Be,Oe+">=0","missing vertex count")})),Oe}var x=_();function z(Le){var Oe=N[Le];return Oe?Oe.contextDep&&D.contextDynamic||Oe.propDep?Oe.append(w,S):Oe.append(w,m):m.def(C,".",Le)}var I=z(dn),W=z(Ao),re=A();if(typeof re=="number"){if(re===0)return}else S("if(",re,"){"),S.exit("}");var ve,Ie;fe&&(ve=z(To),Ie=w.instancing);var Fe=x+".type",Pe=N.elements&&Ur(N.elements)&&!N.vaoActive;function ne(){function Le(){S(Ie,".drawElementsInstancedANGLE(",[I,re,Fe,W+"<<(("+Fe+"-"+e1+")>>1)",ve],");")}function Oe(){S(Ie,".drawArraysInstancedANGLE(",[I,W,re,ve],");")}x&&x!=="null"?Pe?Le():(S("if(",x,"){"),Le(),S("}else{"),Oe(),S("}")):Oe()}function Z(){function Le(){S(O+".drawElements("+[I,re,Fe,W+"<<(("+Fe+"-"+e1+")>>1)"]+");")}function Oe(){S(O+".drawArrays("+[I,W,re]+");")}x&&x!=="null"?Pe?Le():(S("if(",x,"){"),Le(),S("}else{"),Oe(),S("}")):Oe()}fe&&(typeof ve!="number"||ve>=0)?typeof ve=="string"?(S("if(",ve,">0){"),ne(),S("}else if(",ve,"<0){"),Z(),S("}")):ne():Z()}function Ke(w,m,S,D,B){var O=Ue(),C=O.proc("body",B);return y.optional(function(){O.commandStr=m.commandStr,O.command=O.link(m.commandStr)}),fe&&(O.instancing=C.def(O.shared.extensions,".angle_instanced_arrays")),w(O,C,S,D),O.compile().body}function nt(w,m,S,D){gt(w,m),S.useVAO?S.drawVAO?m(w.shared.vao,".setVAO(",S.drawVAO.append(w,m),");"):m(w.shared.vao,".setVAO(",w.shared.vao,".targetVAO);"):(m(w.shared.vao,".setVAO(null);"),Bt(w,m,S,D.attributes,function(){return!0})),ot(w,m,S,D.uniforms,function(){return!0},!1),De(w,m,m,S)}function yt(w,m){var S=w.proc("draw",1);gt(w,S),Tt(w,S,m.context),St(w,S,m.framebuffer),Ft(w,S,m),kt(w,S,m.state),Ye(w,S,m,!1,!0);var D=m.shader.progVar.append(w,S);if(S(w.shared.gl,".useProgram(",D,".program);"),m.shader.program)nt(w,S,m,m.shader.program);else{S(w.shared.vao,".setVAO(null);");var B=w.global.def("{}"),O=S.def(D,".id"),C=S.def(B,"[",O,"]");S(w.cond(C).then(C,".call(this,a0);").else(C,"=",B,"[",O,"]=",w.link(function(N){return Ke(nt,w,m,N,1)}),"(",D,");",C,".call(this,a0);"))}Object.keys(m.state).length>0&&S(w.shared.current,".dirty=true;"),w.shared.vao&&S(w.shared.vao,".setVAO(null);")}function xr(w,m,S,D){w.batchId="a1",gt(w,m);function B(){return!0}Bt(w,m,S,D.attributes,B),ot(w,m,S,D.uniforms,B,!1),De(w,m,m,S)}function pn(w,m,S,D){gt(w,m);var B=S.contextDep,O=m.def(),C="a0",N="a1",_=m.def();w.shared.props=_,w.batchId=O;var A=w.scope(),x=w.scope();m(A.entry,"for(",O,"=0;",O,"<",N,";++",O,"){",_,"=",C,"[",O,"];",x,"}",A.exit);function z(Fe){return Fe.contextDep&&B||Fe.propDep}function I(Fe){return!z(Fe)}if(S.needsContext&&Tt(w,x,S.context),S.needsFramebuffer&&St(w,x,S.framebuffer),kt(w,x,S.state,z),S.profile&&z(S.profile)&&Ye(w,x,S,!1,!0),D)S.useVAO?S.drawVAO?z(S.drawVAO)?x(w.shared.vao,".setVAO(",S.drawVAO.append(w,x),");"):A(w.shared.vao,".setVAO(",S.drawVAO.append(w,A),");"):A(w.shared.vao,".setVAO(",w.shared.vao,".targetVAO);"):(A(w.shared.vao,".setVAO(null);"),Bt(w,A,S,D.attributes,I),Bt(w,x,S,D.attributes,z)),ot(w,A,S,D.uniforms,I,!1),ot(w,x,S,D.uniforms,z,!0),De(w,A,x,S);else{var W=w.global.def("{}"),re=S.shader.progVar.append(w,x),ve=x.def(re,".id"),Ie=x.def(W,"[",ve,"]");x(w.shared.gl,".useProgram(",re,".program);","if(!",Ie,"){",Ie,"=",W,"[",ve,"]=",w.link(function(Fe){return Ke(xr,w,S,Fe,2)}),"(",re,");}",Ie,".call(this,a0[",O,"],",O,");")}}function $(w,m){var S=w.proc("batch",2);w.batchId="0",gt(w,S);var D=!1,B=!0;Object.keys(m.context).forEach(function(W){D=D||m.context[W].propDep}),D||(Tt(w,S,m.context),B=!1);var O=m.framebuffer,C=!1;O?(O.propDep?D=C=!0:O.contextDep&&D&&(C=!0),C||St(w,S,O)):St(w,S,null),m.state.viewport&&m.state.viewport.propDep&&(D=!0);function N(W){return W.contextDep&&D||W.propDep}Ft(w,S,m),kt(w,S,m.state,function(W){return!N(W)}),(!m.profile||!N(m.profile))&&Ye(w,S,m,!1,"a1"),m.contextDep=D,m.needsContext=B,m.needsFramebuffer=C;var _=m.shader.progVar;if(_.contextDep&&D||_.propDep)pn(w,S,m,null);else{var A=_.append(w,S);if(S(w.shared.gl,".useProgram(",A,".program);"),m.shader.program)pn(w,S,m,m.shader.program);else{S(w.shared.vao,".setVAO(null);");var x=w.global.def("{}"),z=S.def(A,".id"),I=S.def(x,"[",z,"]");S(w.cond(I).then(I,".call(this,a0,a1);").else(I,"=",x,"[",z,"]=",w.link(function(W){return Ke(pn,w,m,W,2)}),"(",A,");",I,".call(this,a0,a1);"))}}Object.keys(m.state).length>0&&S(w.shared.current,".dirty=true;"),w.shared.vao&&S(w.shared.vao,".setVAO(null);")}function j(w,m){var S=w.proc("scope",3);w.batchId="a2";var D=w.shared,B=D.current;Tt(w,S,m.context),m.framebuffer&&m.framebuffer.append(w,S),C1(Object.keys(m.state)).forEach(function(C){var N=m.state[C],_=N.append(w,S);ht(_)?_.forEach(function(A,x){S.set(w.next[C],"["+x+"]",A)}):S.set(D.next,"."+C,_)}),Ye(w,S,m,!0,!0),[un,Ao,hn,To,dn].forEach(function(C){var N=m.draw[C];!N||S.set(D.draw,"."+C,""+N.append(w,S))}),Object.keys(m.uniforms).forEach(function(C){var N=m.uniforms[C].append(w,S);Array.isArray(N)&&(N="["+N.join()+"]"),S.set(D.uniforms,"["+v.id(C)+"]",N)}),Object.keys(m.attributes).forEach(function(C){var N=m.attributes[C].append(w,S),_=w.scopeAttrib(C);Object.keys(new k).forEach(function(A){S.set(_,"."+A,N[A])})}),m.scopeVAO&&S.set(D.vao,".targetVAO",m.scopeVAO.append(w,S));function O(C){var N=m.shader[C];N&&S.set(D.shader,"."+C,N.append(w,S))}O(Es),O($s),Object.keys(m.state).length>0&&(S(B,".dirty=true;"),S.exit(B,".dirty=true;")),S("a1(",w.shared.context,",a0,",w.batchId,");")}function V(w){if(!(typeof w!="object"||ht(w))){for(var m=Object.keys(w),S=0;S<m.length;++S)if(rr.isDynamic(w[m[S]]))return!0;return!1}}function Ce(w,m,S){var D=m.static[S];if(!D||!V(D))return;var B=w.global,O=Object.keys(D),C=!1,N=!1,_=!1,A=w.global.def("{}");O.forEach(function(z){var I=D[z];if(rr.isDynamic(I)){typeof I=="function"&&(I=D[z]=rr.unbox(I));var W=Wt(I,null);C=C||W.thisDep,_=_||W.propDep,N=N||W.contextDep}else{switch(B(A,".",z,"="),typeof I){case"number":B(I);break;case"string":B('"',I,'"');break;case"object":Array.isArray(I)&&B("[",I.join(),"]");break;default:B(w.link(I));break}B(";")}});function x(z,I){O.forEach(function(W){var re=D[W];if(!!rr.isDynamic(re)){var ve=z.invoke(I,re);I(A,".",W,"=",ve,";")}})}m.dynamic[S]=new rr.DynamicVariable(Eo,{thisDep:C,contextDep:N,propDep:_,ref:A,append:x}),delete m.static[S]}function We(w,m,S,D,B){var O=Ue();O.stats=O.link(B),Object.keys(m.static).forEach(function(N){Ce(O,m,N)}),Kv.forEach(function(N){Ce(O,w,N)});var C=Et(w,m,S,D,O);return yt(O,C),j(O,C),$(O,C),n(O.compile(),{destroy:function(){C.shader.program.destroy()}})}return{next:_e,current:Ee,procs:function(){var w=Ue(),m=w.proc("poll"),S=w.proc("refresh"),D=w.block();m(D),S(D);var B=w.shared,O=B.gl,C=B.next,N=B.current;D(N,".dirty=false;"),St(w,m),St(w,S,null,!0);var _;fe&&(_=w.link(fe)),T.oes_vertex_array_object&&S(w.link(T.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var A=0;A<X.maxAttributes;++A){var x=S.def(B.attributes,"[",A,"]"),z=w.cond(x,".buffer");z.then(O,".enableVertexAttribArray(",A,");",O,".bindBuffer(",qn,",",x,".buffer.buffer);",O,".vertexAttribPointer(",A,",",x,".size,",x,".type,",x,".normalized,",x,".stride,",x,".offset);").else(O,".disableVertexAttribArray(",A,");",O,".vertexAttrib4f(",A,",",x,".x,",x,".y,",x,".z,",x,".w);",x,".buffer=null;"),S(z),fe&&S(_,".vertexAttribDivisorANGLE(",A,",",x,".divisor);")}return S(w.shared.vao,".currentVAO=null;",w.shared.vao,".setVAO(",w.shared.vao,".targetVAO);"),Object.keys(te).forEach(function(I){var W=te[I],re=D.def(C,".",I),ve=w.block();ve("if(",re,"){",O,".enable(",W,")}else{",O,".disable(",W,")}",N,".",I,"=",re,";"),S(ve),m("if(",re,"!==",N,".",I,"){",ve,"}")}),Object.keys(K).forEach(function(I){var W=K[I],re=Ee[I],ve,Ie,Fe=w.block();if(Fe(O,".",W,"("),ht(re)){var Pe=re.length;ve=w.global.def(C,".",I),Ie=w.global.def(N,".",I),Fe(nr(Pe,function(ne){return ve+"["+ne+"]"}),");",nr(Pe,function(ne){return Ie+"["+ne+"]="+ve+"["+ne+"];"}).join("")),m("if(",nr(Pe,function(ne){return ve+"["+ne+"]!=="+Ie+"["+ne+"]"}).join("||"),"){",Fe,"}")}else ve=D.def(C,".",I),Ie=D.def(N,".",I),Fe(ve,");",N,".",I,"=",ve,";"),m("if(",ve,"!==",Ie,"){",Fe,"}");S(Fe)}),w.compile()}(),compile:We}}function gg(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var yg=34918,bg=34919,O1=35007,wg=function(f,v){if(!v.ext_disjoint_timer_query)return null;var T=[];function X(){return T.pop()||v.ext_disjoint_timer_query.createQueryEXT()}function J(fe){T.push(fe)}var q=[];function Y(fe){var Te=X();v.ext_disjoint_timer_query.beginQueryEXT(O1,Te),q.push(Te),ce(q.length-1,q.length,fe)}function ie(){v.ext_disjoint_timer_query.endQueryEXT(O1)}function ae(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var de=[];function me(){return de.pop()||new ae}function he(fe){de.push(fe)}var ge=[];function ce(fe,Te,se){var Ee=me();Ee.startQueryIndex=fe,Ee.endQueryIndex=Te,Ee.sum=0,Ee.stats=se,ge.push(Ee)}var ue=[],k=[];function H(){var fe,Te,se=q.length;if(se!==0){k.length=Math.max(k.length,se+1),ue.length=Math.max(ue.length,se+1),ue[0]=0,k[0]=0;var Ee=0;for(fe=0,Te=0;Te<q.length;++Te){var _e=q[Te];v.ext_disjoint_timer_query.getQueryObjectEXT(_e,bg)?(Ee+=v.ext_disjoint_timer_query.getQueryObjectEXT(_e,yg),J(_e)):q[fe++]=_e,ue[Te+1]=Ee,k[Te+1]=fe}for(q.length=fe,fe=0,Te=0;Te<ge.length;++Te){var Ge=ge[Te],te=Ge.startQueryIndex,K=Ge.endQueryIndex;Ge.sum+=ue[K]-ue[te];var Me=k[te],ye=k[K];ye===Me?(Ge.stats.gpuTime+=Ge.sum/1e6,he(Ge)):(Ge.startQueryIndex=Me,Ge.endQueryIndex=ye,ge[fe++]=Ge)}ge.length=fe}}return{beginQuery:Y,endQuery:ie,pushScopeStats:ce,update:H,getNumPendingQueries:function(){return q.length},clear:function(){T.push.apply(T,q);for(var fe=0;fe<T.length;fe++)v.ext_disjoint_timer_query.deleteQueryEXT(T[fe]);q.length=0,T.length=0},restore:function(){q.length=0,T.length=0}}},_g=16384,xg=256,Eg=1024,$g=34962,R1="webglcontextlost",L1="webglcontextrestored",F1=1,Ag=2,Tg=3;function G1(f,v){for(var T=0;T<f.length;++T)if(f[T]===v)return T;return-1}function Sg(f){var v=Ap(f);if(!v)return null;var T=v.gl,X=T.getContextAttributes(),J=T.isContextLost(),q=Tp(T,v);if(!q)return null;var Y=wp(),ie=gg(),ae=q.extensions,de=wg(T,ae),me=Vl(),he=T.drawingBufferWidth,ge=T.drawingBufferHeight,ce={tick:0,time:0,viewportWidth:he,viewportHeight:ge,framebufferWidth:he,framebufferHeight:ge,drawingBufferWidth:he,drawingBufferHeight:ge,pixelRatio:v.pixelRatio},ue={},k={elements:null,primitive:4,count:-1,offset:0,instances:-1},H=h2(T,ae),fe=C2(T,ie,v,Ee),Te=z2(T,ae,fe,ie),se=zv(T,ae,H,ie,fe,Te,k);function Ee(De){return se.destroyBuffer(De)}var _e=Xv(T,Y,ie,v),Ge=yv(T,ae,H,function(){Me.procs.poll()},ce,ie,v),te=bv(T,ae,H,ie,v),K=Bv(T,ae,H,Ge,te,ie),Me=vg(T,Y,ae,H,fe,Te,Ge,K,ue,se,_e,k,ce,de,v),ye=Yv(T,K,Me.procs.poll,ce,X,ae,H),le=Me.next,be=T.canvas,we=[],je=[],Ue=[],xe=[v.onDestroy],Ae=null;function ke(){if(we.length===0){de&&de.update(),Ae=null;return}Ae=Va.next(ke),kt();for(var De=we.length-1;De>=0;--De){var Ke=we[De];Ke&&Ke(ce,null,0)}T.flush(),de&&de.update()}function He(){!Ae&&we.length>0&&(Ae=Va.next(ke))}function Qe(){Ae&&(Va.cancel(ke),Ae=null)}function mt(De){De.preventDefault(),J=!0,Qe(),je.forEach(function(Ke){Ke()})}function pt(De){T.getError(),J=!1,q.restore(),_e.restore(),fe.restore(),Ge.restore(),te.restore(),K.restore(),se.restore(),de&&de.restore(),Me.procs.refresh(),He(),Ue.forEach(function(Ke){Ke()})}be&&(be.addEventListener(R1,mt,!1),be.addEventListener(L1,pt,!1));function tt(){we.length=0,Qe(),be&&(be.removeEventListener(R1,mt),be.removeEventListener(L1,pt)),_e.clear(),K.clear(),te.clear(),se.clear(),Ge.clear(),Te.clear(),fe.clear(),de&&de.clear(),xe.forEach(function(De){De()})}function At(De){y(!!De,"invalid args to regl({...})"),y.type(De,"object","invalid args to regl({...})");function Ke(B){var O=n({},B);delete O.uniforms,delete O.attributes,delete O.context,delete O.vao,"stencil"in O&&O.stencil.op&&(O.stencil.opBack=O.stencil.opFront=O.stencil.op,delete O.stencil.op);function C(N){if(N in O){var _=O[N];delete O[N],Object.keys(_).forEach(function(A){O[N+"."+A]=_[A]})}}return C("blend"),C("depth"),C("cull"),C("stencil"),C("polygonOffset"),C("scissor"),C("sample"),"vao"in B&&(O.vao=B.vao),O}function nt(B,O){var C={},N={};return Object.keys(B).forEach(function(_){var A=B[_];if(rr.isDynamic(A)){N[_]=rr.unbox(A,_);return}else if(O&&Array.isArray(A)){for(var x=0;x<A.length;++x)if(rr.isDynamic(A[x])){N[_]=rr.unbox(A,_);return}}C[_]=A}),{dynamic:N,static:C}}var yt=nt(De.context||{},!0),xr=nt(De.uniforms||{},!0),pn=nt(De.attributes||{},!1),$=nt(Ke(De),!1),j={gpuTime:0,cpuTime:0,count:0},V=Me.compile($,pn,xr,yt,j),Ce=V.draw,We=V.batch,w=V.scope,m=[];function S(B){for(;m.length<B;)m.push(null);return m}function D(B,O){var C;if(J&&y.raise("context lost"),typeof B=="function")return w.call(this,null,B,0);if(typeof O=="function")if(typeof B=="number")for(C=0;C<B;++C)w.call(this,null,O,C);else if(Array.isArray(B))for(C=0;C<B.length;++C)w.call(this,B[C],O,C);else return w.call(this,B,O,0);else if(typeof B=="number"){if(B>0)return We.call(this,S(B|0),B|0)}else if(Array.isArray(B)){if(B.length)return We.call(this,B,B.length)}else return Ce.call(this,B)}return n(D,{stats:j,destroy:function(){V.destroy()}})}var ft=K.setFBO=At({framebuffer:rr.define.call(null,F1,"framebuffer")});function Et(De,Ke){var nt=0;Me.procs.poll();var yt=Ke.color;yt&&(T.clearColor(+yt[0]||0,+yt[1]||0,+yt[2]||0,+yt[3]||0),nt|=_g),"depth"in Ke&&(T.clearDepth(+Ke.depth),nt|=xg),"stencil"in Ke&&(T.clearStencil(Ke.stencil|0),nt|=Eg),y(!!nt,"called regl.clear with no buffer specified"),T.clear(nt)}function Tt(De){if(y(typeof De=="object"&&De,"regl.clear() takes an object as input"),"framebuffer"in De)if(De.framebuffer&&De.framebuffer_reglType==="framebufferCube")for(var Ke=0;Ke<6;++Ke)ft(n({framebuffer:De.framebuffer.faces[Ke]},De),Et);else ft(De,Et);else Et(null,De)}function St(De){y.type(De,"function","regl.frame() callback must be a function"),we.push(De);function Ke(){var nt=G1(we,De);y(nt>=0,"cannot cancel a frame twice");function yt(){var xr=G1(we,yt);we[xr]=we[we.length-1],we.length-=1,we.length<=0&&Qe()}we[nt]=yt}return He(),{cancel:Ke}}function Ft(){var De=le.viewport,Ke=le.scissor_box;De[0]=De[1]=Ke[0]=Ke[1]=0,ce.viewportWidth=ce.framebufferWidth=ce.drawingBufferWidth=De[2]=Ke[2]=T.drawingBufferWidth,ce.viewportHeight=ce.framebufferHeight=ce.drawingBufferHeight=De[3]=Ke[3]=T.drawingBufferHeight}function kt(){ce.tick+=1,ce.time=Ye(),Ft(),Me.procs.poll()}function gt(){Ge.refresh(),Ft(),Me.procs.refresh(),de&&de.update()}function Ye(){return(Vl()-me)/1e3}gt();function Bt(De,Ke){y.type(Ke,"function","listener callback must be a function");var nt;switch(De){case"frame":return St(Ke);case"lost":nt=je;break;case"restore":nt=Ue;break;case"destroy":nt=xe;break;default:y.raise("invalid event, must be one of frame,lost,restore,destroy")}return nt.push(Ke),{cancel:function(){for(var yt=0;yt<nt.length;++yt)if(nt[yt]===Ke){nt[yt]=nt[nt.length-1],nt.pop();return}}}}var ot=n(At,{clear:Tt,prop:rr.define.bind(null,F1),context:rr.define.bind(null,Ag),this:rr.define.bind(null,Tg),draw:At({}),buffer:function(De){return fe.create(De,$g,!1,!1)},elements:function(De){return Te.create(De,!1)},texture:Ge.create2D,cube:Ge.createCube,renderbuffer:te.create,framebuffer:K.create,framebufferCube:K.createCube,vao:se.createVAO,attributes:X,frame:St,on:Bt,limits:H,hasExtension:function(De){return H.extensions.indexOf(De.toLowerCase())>=0},read:ye,destroy:tt,_gl:T,_refresh:gt,poll:function(){kt(),de&&de.update()},now:Ye,stats:ie});return v.onDone(null,ot),ot}return Sg})}(Fc)),Fc.exports}const CN=SN,MN=za,ON=e=>{const r=Object.assign({},{},e.glOptions,{onDone:(a,i)=>{if(a)throw a}}),n=PN()(r),s=new Map,o=a=>{a.rendering=Object.assign({},MN,a.rendering),CN(n)(a,i=>{n.clear({color:a.rendering.background,depth:1}),a.entities&&a.entities.sort((c,l)=>{const u="transparent"in c.visuals?c.visuals.transparent:!1,d="transparent"in l.visuals?l.visuals.transparent:!1;return u===d?0:u?1:-1}).forEach(c=>{const{visuals:l}=c;if(("show"in l?l.show:!0)&&l.drawCmd&&a.drawCommands[l.drawCmd]){let d;l.cacheId?d=s.get(l.cacheId):(l.cacheId=s.size,d=a.drawCommands[l.drawCmd](n,c),s.set(l.cacheId,d));const h={...c,...l,camera:a.camera};d(h)}})})};return function(i){n.poll(),o(i)}};var RN=ON,Gc,md;function pd(){if(md)return Gc;md=1;const e=dr;return Gc=(r,n={})=>{const s=[],o={visuals:{color:[0,0,1,1],fadeOut:!1},ticks:1,size:[16,16],centered:!1,lineWidth:2},a=Object.assign({},o.visuals,n.visuals||{}),{fadeOut:i,color:c}=a,{size:l,ticks:u,centered:d,lineWidth:h}=Object.assign({},o,n),p=l[0],E=l[1];if(d){const g=p*.5,b=E*.5,P=g%u,F=-g+P,R=-F,M=b%u,G=-b+M,L=-G,U=0;for(let ee=F,oe=0;ee<=R;ee+=u,oe+=1)oe%U!==0&&(s.push(G,ee,0),s.push(L,ee,0),s.push(G,ee,0));for(let ee=G,oe=0;ee<=L;ee+=u,oe+=1)oe%U!==0&&(s.push(ee,F,0),s.push(ee,R,0),s.push(ee,F,0))}else{for(let g=-p*.5;g<=p*.5;g+=u)s.push(-E*.5,g,0),s.push(E*.5,g,0),s.push(-E*.5,g,0);for(let g=-E*.5;g<=E*.5;g+=u)s.push(g,-p*.5,0),s.push(g,p*.5,0),s.push(g,-p*.5,0)}return r({vert:`precision mediump float;

    uniform float camNear, camFar;
    uniform mat4 model, view, projection;

    attribute vec3 position;
    varying vec3 fragNormal, fragPosition;
    varying vec4 worldPosition;

    void main() {
      fragPosition = position;
      worldPosition = model * vec4(position, 1);
      vec4 glPosition = projection * view * worldPosition;
      gl_Position = glPosition;
    }`,frag:`precision mediump float;
    uniform vec4 color;
    varying vec3 fragNormal, fragPosition;
    varying vec4 worldPosition;

    uniform vec4 fogColor;
    uniform bool fadeOut;
    void main() {
      float dist = .5;
      if(fadeOut){
        dist = distance( vec2(0.,0.), vec2(worldPosition.x, worldPosition.y));
        dist *= 0.0025;
        dist = sqrt(dist);
      }

      gl_FragColor = mix(color, fogColor, dist);
    }
    `,attributes:{position:r.buffer(s)},count:s.length/3,uniforms:{model:(g,b)=>b&&b.model?b.model:e.identity([]),color:(g,b)=>b&&b.color?b.color:c,fogColor:(g,b)=>b&&b.color?[b.color[0],b.color[1],b.color[2],0]:[c[0],c[1],c[2],0],fadeOut:(g,b)=>b&&b.fadeOut!==void 0?b.fadeOut:i},lineWidth:(g,b)=>Math.min(b&&b.lineWidth?b.lineWidth:h,r.limits.lineWidthDims[1]),primitive:"lines",cull:{enable:!0,face:"front"},polygonOffset:{enable:!0,offset:{factor:1,units:Math.random()*10}},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"}}})},Gc}const LN=(e,t)=>{const r={size:[50,50],ticks:[10,1]},{size:n,ticks:s}=Object.assign({},r,t),o=pd()(e,{size:n,ticks:s[0]}),a=pd()(e,{size:n,ticks:s[1]});return c=>{o(c),a({color:c.subColor,fadeOut:c.fadeOut})}};var FN=LN;const jt=dr,GN=(e,t)=>{const r={xColor:[1,0,0,1],yColor:[0,1,0,1],zColor:[0,0,1,1],size:10,lineWidth:3,alwaysVisible:!0};let{size:n,xColor:s,yColor:o,zColor:a,lineWidth:i,alwaysVisible:c}=Object.assign({},r,t);i>e.limits.lineWidthDims[1]&&(i=e.limits.lineWidthDims[1]);const l=[0,0,0,n,0,0],u={frag:`precision mediump float;
    uniform vec4 color;
    void main() {
      gl_FragColor = color;
    }`,vert:`
    precision mediump float;
    attribute vec3 position;
    uniform mat4 model, view, projection;
    void main() {
      gl_Position = projection * view * model * vec4(position, 1);
    }`,uniforms:{model:(g,b)=>b&&b.model?b.model:jt.identity([]),color:(g,b)=>b.color,angle:(g,b)=>b.angle},attributes:{position:l},count:l.length/3,primitive:"line loop",lineWidth:i,depth:{enable:!c}},d=jt.identity([]),h=jt.rotateZ(jt.create(),jt.identity([]),Math.PI/2),p=jt.rotateY(jt.create(),jt.identity([]),-Math.PI/2),E=e(u);return g=>{const b={model:jt.identity([])};return g=Object.assign({},b,g),E([{color:s,model:jt.multiply(jt.create(),g.model,d)},{color:o,model:jt.multiply(jt.create(),g.model,h)},{color:a,model:jt.multiply(jt.create(),g.model,p)}])}};var NN=GN,Nc,vd;function gd(){return vd||(vd=1,Nc={frag:`
precision mediump float;
varying vec3 surfaceNormal, surfacePosition;

uniform float ambientLightAmount;
uniform float diffuseLightAmount;
uniform float specularLightAmount;

uniform vec3 lightDirection;
uniform vec4 lightColor;
uniform vec3 opacity;
uniform float uMaterialShininess;

varying vec4 vColor;
uniform vec4 ucolor;
uniform float vColorToggler;

uniform vec2 printableArea;
vec4 errorColor = vec4(0.15, 0.15, 0.15, 0.3);//vec4(0.15, 0.15, 0.15, 0.3);
varying vec4 _worldSpacePosition;
varying float ambientAo;

void main () {
  vec4 depth = gl_FragCoord;
  vec4 endColor = vColor * vColorToggler + ucolor * (1.0 - vColorToggler);

  vec3 ambient = ambientLightAmount * endColor.rgb ; //ambientAo * 

  float diffuseWeight = dot(surfaceNormal, lightDirection);
  vec3 diffuse = diffuseLightAmount * endColor.rgb * clamp(diffuseWeight , 0.0, 1.0 );

  //specular
  
  vec4 specularColor = vec4(lightColor);
  vec3 eyeDirection = normalize(surfacePosition.xyz);
  vec3 reflectionDirection = reflect(-lightDirection, -surfaceNormal);
  float specularLightWeight = pow(max(dot(reflectionDirection, eyeDirection), 0.0), uMaterialShininess);
  vec3 specular = specularColor.rgb * specularLightWeight * specularLightAmount;

  gl_FragColor = vec4((ambient + diffuse + specular), endColor.a);
}
`,vert:`
precision mediump float;

uniform float camNear, camFar;
uniform mat4 model, view, projection, unormal;

attribute vec3 position, normal;
attribute vec4 color;

attribute float ao;
varying float ambientAo;

varying vec3 surfaceNormal, surfacePosition;
varying vec4 _worldSpacePosition;
varying vec4 vColor;

void main() {
  surfacePosition = (unormal * vec4(position, 1.0)).xyz;
  surfaceNormal = normalize((unormal * vec4(normal, 1.0)).xyz); //vec4 transformedNormal = uNormalMatrix * vec4(aVertexNormal, 1.0);
  vec4 worldSpacePosition = model * vec4(position, 1);
  _worldSpacePosition = worldSpacePosition;
  //gl_Position = projection * view * worldSpacePosition;

  vColor = color;

  //ambientAo = (1. - ao) * (0.5 * max(normal.x, 0.) + 0.5);

  vec4 glPosition = projection * view * model * vec4(position, 1);
  gl_Position = glPosition;
  //gl_Position = zBufferAdjust(glPosition, camNear, camFar);
}
`}),Nc}var Dc,yd;function bd(){return yd||(yd=1,Dc={vert:`
precision mediump float;

uniform float camNear, camFar;
uniform mat4 model, view, projection;

attribute vec3 position, normal;

varying vec3 surfaceNormal, surfacePosition;
varying vec4 _worldSpacePosition;

void main() {
  surfacePosition = position;
  surfaceNormal = normal;
  vec4 worldSpacePosition = model * vec4(position, 1);
  _worldSpacePosition = worldSpacePosition;

  vec4 glPosition = projection * view * model * vec4(position, 1);
  gl_Position = glPosition;
}
`,frag:`
precision mediump float;
varying vec3 surfaceNormal;
uniform float ambientLightAmount;
uniform float diffuseLightAmount;
uniform vec4 ucolor;
uniform vec3 lightDirection;
uniform vec3 opacity;

varying vec4 _worldSpacePosition;

uniform vec2 printableArea;

vec4 errorColor = vec4(0.15, 0.15, 0.15, 0.3);

void main () {
  vec4 depth = gl_FragCoord;

  float v = 0.8; // shadow value
  vec4 endColor = ucolor;

  vec3 ambient = ambientLightAmount * endColor.rgb;
  float cosTheta = dot(surfaceNormal, lightDirection);
  vec3 diffuse = diffuseLightAmount * endColor.rgb * clamp(cosTheta , 0.0, 1.0 );

  float cosTheta2 = dot(surfaceNormal, vec3(-lightDirection.x, -lightDirection.y, lightDirection.z));
  vec3 diffuse2 = diffuseLightAmount * endColor.rgb * clamp(cosTheta2 , 0.0, 1.0 );

  gl_FragColor = vec4((ambient + diffuse + diffuse2 * v), endColor.a);
}`}),Dc}const Qr=dr,{meshColor:DN}=za,kN=(e,t={extras:{}})=>{const r={useVertexColors:!0,dynamicCulling:!0,geometry:void 0,color:DN},{geometry:n,dynamicCulling:s,useVertexColors:o,color:a,transparent:i}=Object.assign({},r,t),c=e.buffer([]),l=!!(n.indices&&n.indices.length>0),u=!!(n.normals&&n.normals.length>0),d=!!(o&&n.colors&&n.colors.length>0),h=n.transforms||Qr.create(),p=Qr.determinant(h)<0,E=s&&p?"front":"back",g=d?gd().vert:bd().vert,b=d?gd().frag:bd().frag,P=Qr.invert(Qr.create(),h);let F={primitive:"triangles",vert:g,frag:b,uniforms:{model:(R,M)=>h,ucolor:(R,M)=>M&&M.color?M.color:a,vColorToggler:(R,M)=>M&&M.useVertexColors&&M.useVertexColors===!0?1:0,unormal:(R,M)=>{const G=Qr.invert(Qr.create(),M.camera.view);return Qr.multiply(G,P,G),Qr.transpose(G,G),G}},attributes:{position:e.buffer({usage:"static",type:"float",data:n.positions}),ao:c},cull:{enable:!0,face:E},depth:{enable:!i}};return i&&(F.blend={enable:!0,func:{src:"src alpha",dst:"one minus src alpha"}}),n.cells?F.elements=n.cells:l?F.elements=e.elements({usage:"static",type:"uint16",data:n.indices}):n.triangles?F.elements=n.triangles:F.count=n.positions.length/3,u&&(F.attributes.normal=e.buffer({usage:"static",type:"float",data:n.normals})),d&&(F.attributes.color=e.buffer({usage:"static",type:"float",data:n.colors})),F=Object.assign({},F,t.extras),e(F)};var BN=kN,kc,wd;function _d(){return wd||(wd=1,kc={frag:`
precision mediump float;
varying vec4 vColor;

void main () {
  gl_FragColor = vColor;
}
`,vert:`
precision mediump float;

uniform float camNear, camFar;
uniform mat4 model, view, projection;

attribute vec3 position, normal;
attribute vec4 color;

varying vec3 surfaceNormal, surfacePosition;
varying vec4 _worldSpacePosition;
varying vec4 vColor;

void main() {
  vColor = color;

  surfacePosition = position;
  surfaceNormal = normal;
  vec4 worldSpacePosition = model * vec4(position, 1);
  _worldSpacePosition = worldSpacePosition;

  vec4 glPosition = projection * view * model * vec4(position, 1);
  gl_Position = glPosition;
}
`}),kc}var Bc,xd;function IN(){return xd||(xd=1,Bc={vert:`
precision mediump float;

uniform float camNear, camFar;
uniform mat4 model, view, projection;

attribute vec3 position, normal;


varying vec3 surfaceNormal, surfacePosition;
varying vec4 _worldSpacePosition;


void main() {


  surfacePosition = position;
  surfaceNormal = normal;
  vec4 worldSpacePosition = model * vec4(position, 1);
  _worldSpacePosition = worldSpacePosition;

  vec4 glPosition = projection * view * model * vec4(position, 1);
  gl_Position = glPosition;
}
`,frag:`
precision mediump float;
varying vec3 surfaceNormal;
uniform float ambientLightAmount;
uniform float diffuseLightAmount;
uniform vec4 ucolor;
uniform vec3 lightDirection;
uniform vec3 opacity;

varying vec4 _worldSpacePosition;

uniform vec2 printableArea;

vec4 errorColor = vec4(0.15, 0.15, 0.15, 0.3);

void main () {
  vec4 depth = gl_FragCoord;

  float v = 0.8; // shadow value
  vec4 endColor = ucolor;

  vec3 ambient = ambientLightAmount * endColor.rgb;
  float cosTheta = dot(surfaceNormal, lightDirection);
  vec3 diffuse = diffuseLightAmount * endColor.rgb * clamp(cosTheta , 0.0, 1.0 );

  float cosTheta2 = dot(surfaceNormal, vec3(-lightDirection.x, -lightDirection.y, lightDirection.z));
  vec3 diffuse2 = diffuseLightAmount * endColor.rgb * clamp(cosTheta2 , 0.0, 1.0 );

  gl_FragColor = vec4((ambient + diffuse + diffuse2 * v), endColor.a);
}`}),Bc}var Ic,Ed;function zN(){return Ed||(Ed=1,Ic={frag:`
precision mediump float;
uniform vec4 ucolor;

void main () {
  gl_FragColor = ucolor;
}
`}),Ic}const VN=dr,{meshColor:UN}=za,qN=(e,t={})=>{const r={color:UN,geometry:void 0};let{geometry:n,color:s,transparent:o}=Object.assign({},r,t);"color"in n&&(s=n.color);const a=!!(n.indices&&n.indices.length>0),i=!!(n.normals&&n.normals.length>0),c=!!(n.colors&&n.colors.length>0),l=c?_d().vert:IN().vert,u=c?_d().frag:zN().frag,d={primitive:"lines",vert:l,frag:u,uniforms:{model:(h,p)=>p.model||n.transforms||VN.create(),ucolor:(h,p)=>p&&p.color?p.color:s},attributes:{position:e.buffer({usage:"static",type:"float",data:n.positions})},depth:{enable:!o}};return o&&(d.blend={enable:!0,func:{src:"src alpha",dst:"one minus src alpha"}}),c&&(d.attributes.color=e.buffer({usage:"static",type:"float",data:n.colors})),a&&(d.elements=e.elements({usage:"static",type:"uint16",data:n.indices})),i&&(d.attributes.normal=e.buffer({usage:"static",type:"float",data:n.normals})),e(d)};var XN=qN,Lm=1e-6,Fm=jN;function jN(){var e=new Float32Array(3);return e[0]=0,e[1]=0,e[2]=0,e}var HN=YN;function YN(e){var t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}var Gm=ZN;function ZN(e,t,r){var n=new Float32Array(3);return n[0]=e,n[1]=t,n[2]=r,n}var Nm=WN;function WN(e,t){var r=t[0],n=t[1],s=t[2],o=r*r+n*n+s*s;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o),e}var Dm=QN;function QN(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}var KN=e7,$d=Gm,Ad=Nm,JN=Dm;function e7(e,t){var r=$d(e[0],e[1],e[2]),n=$d(t[0],t[1],t[2]);Ad(r,r),Ad(n,n);var s=JN(r,n);return s>1?0:Math.acos(s)}var t7=r7;function r7(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}var n7=s7;function s7(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}var o7=a7,zc=Lm;function a7(e,t){var r=e[0],n=e[1],s=e[2],o=t[0],a=t[1],i=t[2];return Math.abs(r-o)<=zc*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-a)<=zc*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(s-i)<=zc*Math.max(1,Math.abs(s),Math.abs(i))}var i7=c7;function c7(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}var l7=f7;function f7(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}var km=u7;function u7(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}var Bm={exports:{}};(function(e){e.exports=km})(Bm);var Im=d7;function d7(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}var zm={exports:{}};(function(e){e.exports=Im})(zm);var Vm=h7;function h7(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}var Um={exports:{}};(function(e){e.exports=Vm})(Um);var m7=p7;function p7(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}var v7=g7;function g7(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}var y7=b7;function b7(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}var w7=_7;function _7(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}var x7=E7;function E7(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}var $7=A7;function A7(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}var T7=S7;function S7(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}var qm=P7;function P7(e,t){var r=t[0]-e[0],n=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(r*r+n*n+s*s)}var Xm={exports:{}};(function(e){e.exports=qm})(Xm);var jm=C7;function C7(e,t){var r=t[0]-e[0],n=t[1]-e[1],s=t[2]-e[2];return r*r+n*n+s*s}var Hm={exports:{}};(function(e){e.exports=jm})(Hm);var Ym=M7;function M7(e){var t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}var Zm={exports:{}};(function(e){e.exports=Ym})(Zm);var Wm=O7;function O7(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}var Qm={exports:{}};(function(e){e.exports=Wm})(Qm);var R7=L7;function L7(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}var F7=G7;function G7(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}var N7=D7;function D7(e,t,r){var n=t[0],s=t[1],o=t[2],a=r[0],i=r[1],c=r[2];return e[0]=s*c-o*i,e[1]=o*a-n*c,e[2]=n*i-s*a,e}var k7=B7;function B7(e,t,r,n){var s=t[0],o=t[1],a=t[2];return e[0]=s+n*(r[0]-s),e[1]=o+n*(r[1]-o),e[2]=a+n*(r[2]-a),e}var I7=z7;function z7(e,t){t=t||1;var r=Math.random()*2*Math.PI,n=Math.random()*2-1,s=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*s,e[1]=Math.sin(r)*s,e[2]=n*t,e}var V7=U7;function U7(e,t,r){var n=t[0],s=t[1],o=t[2],a=r[3]*n+r[7]*s+r[11]*o+r[15];return a=a||1,e[0]=(r[0]*n+r[4]*s+r[8]*o+r[12])/a,e[1]=(r[1]*n+r[5]*s+r[9]*o+r[13])/a,e[2]=(r[2]*n+r[6]*s+r[10]*o+r[14])/a,e}var q7=X7;function X7(e,t,r){var n=t[0],s=t[1],o=t[2];return e[0]=n*r[0]+s*r[3]+o*r[6],e[1]=n*r[1]+s*r[4]+o*r[7],e[2]=n*r[2]+s*r[5]+o*r[8],e}var j7=H7;function H7(e,t,r){var n=t[0],s=t[1],o=t[2],a=r[0],i=r[1],c=r[2],l=r[3],u=l*n+i*o-c*s,d=l*s+c*n-a*o,h=l*o+a*s-i*n,p=-a*n-i*s-c*o;return e[0]=u*l+p*-a+d*-c-h*-i,e[1]=d*l+p*-i+h*-a-u*-c,e[2]=h*l+p*-c+u*-i-d*-a,e}var Y7=Z7;function Z7(e,t,r,n){var s=r[1],o=r[2],a=t[1]-s,i=t[2]-o,c=Math.sin(n),l=Math.cos(n);return e[0]=t[0],e[1]=s+a*l-i*c,e[2]=o+a*c+i*l,e}var W7=Q7;function Q7(e,t,r,n){var s=r[0],o=r[2],a=t[0]-s,i=t[2]-o,c=Math.sin(n),l=Math.cos(n);return e[0]=s+i*c+a*l,e[1]=t[1],e[2]=o+i*l-a*c,e}var K7=J7;function J7(e,t,r,n){var s=r[0],o=r[1],a=t[0]-s,i=t[1]-o,c=Math.sin(n),l=Math.cos(n);return e[0]=s+a*l-i*c,e[1]=o+a*c+i*l,e[2]=t[2],e}var eD=tD,Kr=Fm();function tD(e,t,r,n,s,o){var a,i;for(t||(t=3),r||(r=0),n?i=Math.min(n*t+r,e.length):i=e.length,a=r;a<i;a+=t)Kr[0]=e[a],Kr[1]=e[a+1],Kr[2]=e[a+2],s(Kr,Kr,o),e[a]=Kr[0],e[a+1]=Kr[1],e[a+2]=Kr[2];return e}var so={EPSILON:Lm,create:Fm,clone:HN,angle:KN,fromValues:Gm,copy:t7,set:n7,equals:o7,exactEquals:i7,add:l7,subtract:km,sub:Bm.exports,multiply:Im,mul:zm.exports,divide:Vm,div:Um.exports,min:m7,max:v7,floor:y7,ceil:w7,round:x7,scale:$7,scaleAndAdd:T7,distance:qm,dist:Xm.exports,squaredDistance:jm,sqrDist:Hm.exports,length:Ym,len:Zm.exports,squaredLength:Wm,sqrLen:Qm.exports,negate:R7,inverse:F7,normalize:Nm,dot:Dm,cross:N7,lerp:k7,random:I7,transformMat4:V7,transformMat3:q7,transformQuat:j7,rotateX:Y7,rotateY:W7,rotateZ:K7,forEach:eD};const Sn=dr,Vc=so,Km={view:Sn.identity(new Float32Array(16)),projection:Sn.identity(new Float32Array(16)),matrix:Sn.identity(new Float32Array(16)),near:1,far:18e3,up:[0,0,1],eye:new Float32Array(3),position:[450,550,700],target:[0,0,0],fov:Math.PI/4,aspect:1,viewport:[0,0,0,0],projectionType:"perspective"},Jm={},rD=Object.assign({},Km,Jm),nD=(e,t,r)=>{const n=r.width/r.height,s=Sn.perspective(Sn.identity([]),t.fov,n,t.near,t.far),o=[0,0,r.width,r.height],a=e||{};return a.projection=s,a.aspect=n,a.viewport=o,a},sD=(e,t)=>{t||(t=e);const{position:r,target:n,up:s}=t,o=Vc.subtract([],r,n),a=Vc.add(Vc.create(),n,o),i=Sn.lookAt(Sn.create(),a,n,s),c=e||{};return c.position=a,c.view=i,c};var sl={cameraState:Km,cameraProps:Jm,defaults:rD,setProjection:nD,update:sD};const fa=dr,oD={view:fa.identity(new Float32Array(16)),projection:fa.identity(new Float32Array(16)),matrix:fa.identity(new Float32Array(16)),near:1,far:1300,up:[0,0,1],eye:new Float32Array(3),position:[150,250,200],target:[0,0,0],fov:Math.PI/4,aspect:1,viewport:[0,0,0,0],zoom:1,projectionType:"orthographic"},aD={},iD=(e,t)=>{const{width:r,height:n}=t,s=r/n,o=[0,0,r,n],a=e.zoom,i=-r*a,c=r*a,l=-n*a,u=n*a;return{projection:fa.ortho([],i,c,l,u,e.near,e.far),aspect:s,viewport:o}};var ga={cameraState:oD,cameraProps:aD,setProjection:iD};const as=so,ya=dr,cD=e=>{const{near:t,far:r,fov:n,zoom:s}=e,{viewport:o}=e,a=sl.setProjection(e,{width:o[2],height:o[3]}),{projectionType:i}=sl.cameraState;return Object.assign({},e,a,{projectionType:i},{near:t,far:r,fov:n})},lD=e=>{const{fov:t,aspect:r}=e,n=as.length(as.subtract([],e.position,e.target))*.3,s=Math.tan(t)*n*r,o=Math.tan(t)*n,{near:a,far:i,viewport:c}=e,l={zoom:1,near:a,far:i},u=ga.cameraState,d=ga.setProjection(l,{width:s,height:o});return Object.assign({},u,e,d,{projectionType:u.projectionType,viewport:c})},fD=({camera:e})=>{const r=as.distance(e.position,e.target),n=[r,r,r];return{view:ya.lookAt(ya.create(),n,e.target,e.up),position:n}},uD=(e,{camera:t})=>{const r={top:[0,-1e-6,1],bottom:[0,0,-1],front:[0,1,0],back:[0,-1,0],left:[-1,0,0],right:[1,0,0],undefined:[0,0,0]},n=as.distance(t.position,t.target),s=as.add(as.create(),r[e].map(a=>a*n),t.target);return{view:ya.lookAt(ya.create(),s,t.target,t.up),position:s}};var dD={toPerspectiveView:fD,toPresetView:uD,fromOrthographicToPerspective:cD,fromPerspectiveToOrthographic:lD};const hD=e=>{if(e.length===0)return[[0,0,0],[0,0,0]];const t=Array.isArray(e)&&Array.isArray(e[0]),r=t?e[0].length:3,n=new Array(r),s=new Array(r);for(let o=0;o<r;o+=1)n[o]=1/0,s[o]=-1/0;if(t)e.forEach(o=>{for(let a=0;a<r;a+=1){const i=t?o[a]:o;s[a]=i>s[a]?i:s[a],n[a]=i<n[a]?i:n[a]}});else for(let o=0;o<e.length;o+=r)for(let a=0;a<r;a+=1){const i=e[a+o];s[a]=i>s[a]?i:s[a],n[a]=i<n[a]?i:n[a]}return[n,s]};var mD=hD;const cr=so,{flatten:pD}=Ol,vD=mD,gD=(...e)=>{e=pD(e);let t;e.forEach(c=>{let l=vD(c.positions);l=l.map(u=>cr.transformMat4(u,u,c.transforms)),t?(cr.min(t[0],t[0],l[0]),cr.max(t[1],t[1],l[1])):t=l});const r=cr.min(cr.create(),t[1],t[0]),n=cr.max(cr.create(),t[1],t[0]),s=cr.subtract(cr.create(),n,r);let o=cr.scale(cr.create(),s,.5);return o=cr.add(o,r,o),{dia:cr.distance(o,n),center:[...o],min:[...r],max:[...n],size:[...s]}};var yD=gD,Uc,Td;function bD(){if(Td)return Uc;Td=1,Uc=e;function e(t,r,n){var s=r[0],o=r[1],a=r[2],i=n[0],c=n[1],l=n[2],u=n[3],d=n[4],h=n[5],p=n[6],E=n[7],g=n[8],b=n[9],P=n[10],F=n[11],R=n[12],M=n[13],G=n[14],L=n[15],U=1/(s*u+o*E+a*F+L);return t[0]=(s*i+o*d+a*g+R)*U,t[1]=(s*c+o*h+a*b+M)*U,t[2]=(s*l+o*p+a*P+G)*U,t}return Uc}var qc,Sd;function wD(){if(Sd)return qc;Sd=1;var e=bD();qc=t;function t(r,n,s,o){var a=s[0],i=s[1],c=s[2],l=s[3],u=n[0],d=n[1],h=n[2];return u=u-a,d=l-d-1,d=d-i,r[0]=2*u/c-1,r[1]=2*d/l-1,r[2]=2*h-1,e(r,r,o)}return qc}const Yt=so,Qs=dr,{max:Xc,min:jc,sqrt:Pd,PI:_D,sin:ts,cos:oa,atan2:aa}=Math,xD=yD,Rl={limits:{minDistance:.01,maxDistance:1e4},drag:.27,EPS:1e-6,zoomToFit:{auto:!0,targets:"all",tightness:1.5},userControl:{zoom:!0,zoomSpeed:1,rotate:!0,rotateSpeed:1,pan:!0,panSpeed:1},autoRotate:{enabled:!1,speed:1},autoAdjustPlanes:!0},ep={thetaDelta:0,phiDelta:0,scale:1},ED=Object.assign({},ep,Rl),$D=({controls:e,camera:t},r)=>{const{EPS:n,drag:s}=e,{position:o,target:a}=t,i=e.up?e.up:t.up;let c=e.thetaDelta;const l=e.phiDelta,u=e.scale,d=Yt.subtract([],o,a);let h,p;i[2]===1?(h=aa(d[0],d[1]),p=aa(Pd(d[0]*d[0]+d[1]*d[1]),d[2])):(h=aa(d[0],d[2]),p=aa(Pd(d[0]*d[0]+d[2]*d[2]),d[1])),e.autoRotate.enabled&&e.userControl.rotate&&(c+=2*Math.PI/60/60*e.autoRotate.speed),h+=c,p+=l,p=Xc(n,jc(_D-n,p));const E=Xc(e.limits.minDistance,jc(e.limits.maxDistance,Yt.length(d)*u));i[2]===1?(d[0]=E*ts(p)*ts(h),d[2]=E*oa(p),d[1]=E*ts(p)*oa(h)):(d[0]=E*ts(p)*ts(h),d[1]=E*oa(p),d[2]=E*ts(p)*oa(h));const g=Yt.add(Yt.create(),a,d),b=Qs.lookAt(Qs.create(),g,a,i),P=1-Xc(jc(s,1),.01),F=Yt.distance(o,g)>.001;return{controls:{thetaDelta:c*P,phiDelta:l*P,scale:1,changed:F},camera:{position:g,view:b}}},AD=({controls:e,camera:t,speed:r=1},n)=>{let{thetaDelta:s,phiDelta:o}=e;return e.userControl.rotate&&(s+=n[0]*r,o+=n[1]*r),{controls:{thetaDelta:s,phiDelta:o},camera:t}},TD=({controls:e,camera:t,speed:r=1},n=0)=>{let{scale:s}=e;if(e.userControl.zoom&&t&&n!==void 0&&n!==0&&!isNaN(n)){const o=Math.sign(n)===0?1:Math.sign(n);n=n/n*o*r;const a=n+e.scale,i=Yt.distance(t.position,t.target)*a;if(i>e.limits.minDistance&&i<e.limits.maxDistance&&(s+=n),t.projectionType==="orthographic"){const c=Yt.length(Yt.subtract([],t.position,t.target))*.3,l=Math.tan(t.fov)*c*t.aspect,u=Math.tan(t.fov)*c;t=ga.setProjection(t,{width:l,height:u})}}return{controls:{scale:s},camera:t}},SD=({controls:e,camera:t,speed:r=1},n)=>{const s=wD(),{projection:o,view:a,viewport:i}=t,c=Qs.multiply([],o,a),l=Qs.invert([],c),u=[i[2],i[3],0],d=[i[2]-n[0],i[3]+n[1],0],h=s([],u,i,l),p=s([],d,i,l),E=Yt.distance(t.position,t.eye),g=Yt.subtract([],h,p).map(b=>b*r*E*e.scale);return{controls:e,camera:{position:Yt.add(Yt.create(),t.position,g),target:Yt.add(Yt.create(),t.target,g)}}},PD=({controls:e,camera:t,entities:r})=>{const{zoomToFit:n}=e;if(n.targets!=="all")return{controls:e,camera:t};if(r.length===0)return{controls:e,camera:t};const s=r.map(p=>p.geometry),o=xD(s),{fov:a,target:i,position:c}=t,{tightness:l}=Object.assign({},n,Rl.zoomToFit),u=o.dia*l/Math.tan(a/2),d=Yt.distance(i,c),h=u/d;return{camera:{target:o.center},controls:{scale:h}}},CD=({controls:e,camera:t},r)=>({camera:{position:r.camera.position,target:r.camera.target,projection:Qs.perspective([],t.fov,t.aspect,t.near,t.far),view:r.camera.view},controls:{thetaDelta:r.controls.thetaDelta,phiDelta:r.controls.phiDelta,scale:r.controls.scale}});var MD={controlsProps:Rl,controlsState:ep,defaults:ED,update:$D,rotate:AD,zoom:TD,pan:SD,zoomToFit:PD,reset:CD};const Cd=dr,Hc=Math.floor(65535/2),OD=(e,t)=>{let{color:r}=e;const n=t.sides;if(n.length===0)return[];"color"in t&&(r=t.color);const s=r[3]<1,o=[],a=Math.floor(n.length/Hc)+1,i=(l,u)=>{o.push(l,u||l)},c=[];for(let l=0;l<a;l++){const u=l*Hc,d=Math.min(u+Hc,n.length),h=[];for(let b=u;b<d;b++){const P=n[b];if(P.color){if(o.length===0&&h.length>0){const F=h.length;for(let R=0;R<F;R++)o.push(r)}i(P.color,P.endColor)}else o.length&&i(r);h.push([P[0][0],P[0][1],0]),h.push([P[1][0],P[1][1],0])}const p=h.map(b=>[0,0,-1]),E=h.map((b,P)=>P),g=t.transforms?Cd.clone(t.transforms):Cd.create();c.push({type:"2d",positions:h,normals:p,indices:E,transforms:g,color:r,colors:o,isTransparent:s})}return c};var RD=OD;const Jr=so,Md=dr,LD=65535,FD=(e,t)=>{let{color:r,smoothLighting:n}=e;"color"in t&&(r=t.color);const s=t.polygons,o=t.transforms?Md.clone(t.transforms):Md.create(),a=[];let i=0;for(;i<s.length;){let c=0,l=i;for(let b=i;b<s.length&&(c+=s[b].vertices.length,!(c>LD));b++)l++;const u=[],d=[],h=[],p=[],E=!0;for(let b=i;b<l;b++){const P=s[b],F=P.vertices,R=ND(P),M=GD(P,r),G=[];for(let L=0;L<F.length;L++){const U=F[L];u.push(U),d.push(R),p.push(M);const ee=u.length-1;G.push(ee)}for(let L=2;L<G.length;L++)h.push([G[0],G[L-1],G[L]])}const g={type:"3d",positions:u,normals:d,indices:h,colors:p,transforms:o,isTransparent:E};a.push(g),i=l}return a},GD=(e,t)=>{let r=t;return e.color&&(r=e.color),r&&r.length<4&&r.push(1),r},ND=e=>{if(e.plane)return Jr.clone(e.plane);const t=e.vertices,r=Jr.create();Jr.subtract(r,t[1],t[0]);const n=Jr.create();Jr.subtract(n,t[2],t[0]);const s=Jr.create();return Jr.cross(s,r,n),Jr.normalize(s,s),s};var DD=FD;const Od=dr,Yc=Math.floor(65535/2)-2,kD=(e,t)=>{let{color:r}=e;const n=t.points;if(n.length===0)return[];"color"in t&&(r=t.color);const s=r[3]<1,o=Math.floor(n.length/Yc)+1,a=[];for(let i=0;i<o;i++){const c=i*Yc,l=Math.min(c+Yc,n.length),u=[];let d;for(let g=c;g<l;g++){const b=n[g];d&&(u.push([d[0],d[1],0]),u.push([b[0],b[1],0])),d=b}if(i+1===o&&t.isClosed&&d){const g=n[0];u.push([d[0],d[1],0]),u.push([g[0],g[1],0])}const h=u.map(g=>[0,0,-1]),p=u.map((g,b)=>b),E=t.transforms?Od.clone(t.transforms):Od.create();a.push({type:"2d",positions:u,normals:h,indices:p,transforms:E,color:r,isTransparent:s})}return a};var BD=kD;const{flatten:ID,toArray:zD}=Ol,{meshColor:VD}=za,UD=RD,qD=DD,XD=BD,jD=e=>e.map(r=>{const n={drawCmd:r.type==="2d"?"drawLines":"drawMesh",show:!0,transparent:r.isTransparent,useVertexColors:!0};return{geometry:r,visuals:n}}),HD=(e,...t)=>{const r={color:VD,smoothNormals:!0},{color:n,smoothNormals:s}=Object.assign({},r,e);t=ID(zD(t)),t=t.filter(a=>a&&a instanceof Object);const o=[];return t.forEach(a=>{let i=[];"sides"in a?i=UD({color:n},a):"points"in a?i=XD({color:n},a):"polygons"in a&&(i=qD({smoothLighting:s,normalThreshold:.3,color:n},a)),o.push(...jD(i))}),o};var YD=HD,en={prepareRender:RN,drawCommands:{drawGrid:FN,drawAxis:NN,drawMesh:BN,drawLines:XN},cameras:{camera:dD,orthographic:ga,perspective:sl},controls:{orbit:MD},entitiesFromSolids:YD};const ia=en.cameras.perspective,Us=en.controls.orbit,ZD=({containerElement:e,model:t})=>{const r=e.clientWidth,n=e.clientHeight,s={};s.camera=Object.assign({},ia.defaults,{position:[450,550,700],fov:Math.PI/32}),ia.setProjection(s.camera,s.camera,{width:r,height:n}),ia.update(s.camera,s.camera),s.controls=Us.defaults;const o={glOptions:{container:e}},a=en.prepareRender(o),i={visuals:{drawCmd:"drawGrid",show:!0},size:[500,500],ticks:[10,1],color:[0,0,1,1],subColor:[0,0,1,.5]},c={visuals:{drawCmd:"drawAxis",show:!0},size:300},l=en.entitiesFromSolids({},t),u={camera:s.camera,drawCommands:{drawAxis:en.drawCommands.drawAxis,drawGrid:en.drawCommands.drawGrid,drawLines:en.drawCommands.drawLines,drawMesh:en.drawCommands.drawMesh},entities:[i,c,...l]};let d=!0;const h=()=>{if(R[0]||R[1]){const Q=Us.rotate({controls:s.controls,camera:s.camera,speed:b},R);s.controls={...s.controls,...Q.controls},d=!0,R=[0,0]}if(M[0]||M[1]){const Q=Us.pan({controls:s.controls,camera:s.camera,speed:P},M);s.controls={...s.controls,...Q.controls},M=[0,0],s.camera.position=Q.camera.position,s.camera.target=Q.camera.target,d=!0}if(G){const Q=Us.zoom({controls:s.controls,camera:s.camera,speed:F},G);s.controls={...s.controls,...Q.controls},G=0,d=!0}},p=Q=>{if(h(),d){const Se=Us.update({controls:s.controls,camera:s.camera});s.controls={...s.controls,...Se.controls},d=s.controls.changed,s.camera.position=Se.camera.position,ia.update(s.camera),a(u)}window.requestAnimationFrame(p)};window.requestAnimationFrame(p);let E=0,g=0;const b=.002,P=1,F=.08;let R=[0,0],M=[0,0],G=0,L=!1;const U=Q=>{if(!L)return;const Se=E-Q.pageX,qe=Q.pageY-g;Q.shiftKey===!0||Q.touches!==void 0&&Q.touches.length>2?(M[0]+=Se,M[1]+=qe):(R[0]-=Se,R[1]-=qe),E=Q.pageX,g=Q.pageY,Q.preventDefault()},ee=Q=>{L=!0,E=Q.pageX,g=Q.pageY,e.setPointerCapture(Q.pointerId)},oe=Q=>{L=!1,e.releasePointerCapture(Q.pointerId)},pe=Q=>{G+=Q.deltaY,Q.preventDefault()};e.onpointermove=U,e.onpointerdown=ee,e.onpointerup=oe,e.onwheel=pe},Rd=document.getElementById("jscad"),tp=yG();Rd!==null&&ZD({containerElement:Rd,model:tp});const WD=async e=>{const t=new File([await e.arrayBuffer()],"model.stl"),r=document.createElement("a");r.style.display="none",r.href=URL.createObjectURL(t),r.download=t.name,document.body.appendChild(r),r.click(),setTimeout(()=>{var n;URL.revokeObjectURL(r.href),(n=r.parentNode)==null||n.removeChild(r)},0)};window.startDownload=()=>{const e=cG.serialize({binary:!0},tp),t=new Blob(e);WD(t).catch(console.error)};
